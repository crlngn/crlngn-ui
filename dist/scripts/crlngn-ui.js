var no=Object.defineProperty;var ha=i=>{throw TypeError(i)};var ao=(i,e,t)=>e in i?no(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var b=(i,e,t)=>ao(i,typeof e!="symbol"?e+"":e,t),Hn=(i,e,t)=>e.has(i)||ha("Cannot "+t);var m=(i,e,t)=>(Hn(i,e,"read from private field"),t?t.call(i):e.get(i)),L=(i,e,t)=>e.has(i)?ha("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(i):e.set(i,t),I=(i,e,t,n)=>(Hn(i,e,"write to private field"),n?n.call(i,t):e.set(i,t),t),ee=(i,e,t)=>(Hn(i,e,"access private method"),t);var ba=(i,e,t,n)=>({set _(a){I(i,e,a,t)},get _(){return m(i,e,n)}});const A={INIT:"init",READY:"ready",CANVAS_READY:"canvasReady",CANVAS_INIT:"canvasInit",RENDER_CHAT_MESSAGE:"renderChatMessageHTML",GET_SCENE_CONTROLS:"getSceneControlButtons",RENDER_SCENE_CONTROLS:"renderSceneControls",RENDER_PLAYERS_LIST:"renderPlayers",ACTIVATE_SCENE_CONTROLS:"activateSceneControls",RENDER_SCENE_NAV:"renderSceneNavigation",COLLAPSE_SCENE_NAV:"collapseSceneNavigation",EXPAND_SCENE_NAV:"expandSceneNavigation",GET_SCENE_NAV_CONTEXT:"getSceneNavigationContext",RENDER_SCENE:"renderScene",RENDER_DOCUMENT_DIRECTORY:"renderDocumentDirectory",GET_SCENE_DIRECTORY_ENTRY_CONTEXT:"getSceneDirectoryEntryContext",RENDER_SCENE_DIRECTORY:"renderSceneDirectory",CREATE_FOLDER:"createFolder",UPDATE_FOLDER:"updateFolder",DELETE_FOLDER:"deleteFolder",CREATE_SCENE:"createScene",UPDATE_SCENE:"updateScene",DELETE_SCENE:"deleteScene",COLLAPSE_SIDE_BAR:"collapseSidebar",EXPAND_SIDE_BAR:"expandSidebar",RENDER_SIDE_BAR:"renderSidebar",ACTIVATE_CHAT_LOG:"activateChatLog",ACTIVATE_CHAT_LOG_5E:"activateChatLog5e",RENDER_HOTBAR:"renderHotbar",RENDER_CAMERA_VIEWS:"renderCameraViews",WEBRTC_USER_STATE_CHANGED:"webrtcUserStateChanged",WEBRTC_SETTINGS_CHANGED:"webrtcSettingsChanged",RTC_SETTINGS_CHANGED:"rtcSettingsChanged",RTC_MODE_CHANGED:"rtcModeChanged",RTC_VOICE_SETTINGS_CHANGED:"rtcVoiceSettingsChanged",RTC_LOCAL_STREAM_ESTABLISHED:"rtcLocalStreamEstablished",RTC_LOCAL_STREAM_ERROR:"rtcLocalStreamError",RTC_PEER_CONNECTED:"rtcPeerConnected",RTC_PEER_DISCONNECTED:"rtcPeerDisconnected",RTC_PEER_ERROR:"rtcPeerError",RTC_SIGNALING_EVENT:"rtcSignalingEvent",RENDER_AV_CONFIG:"renderAVConfig",RENDER_AV_MASTER:"renderAVMaster",RENDER_AV_CLIENT:"renderAVClient",USER_CONNECTED:"userConnected",USER_DISCONNECTED:"userDisconnected",UPDATE_USER:"updateUser",UPDATE_DOCUMENT:"updateDocument",UPDATE_SETTING:"updateSetting",CLIENT_SETTING_CHANGED:"clientSettingChanged",RENDER_TOKEN_HUD:"renderTokenHUD",RENDER_ACTOR_SHEET:"renderActorSheetV2",RENDER_ITEM_SHEET:"renderItemSheetV2",RENDER_COMPENDIUM_BROWSER:"renderCompendiumBrowser"},z="crlngn-ui",rn=["%cCarolingian UI","color:rgb(107, 72, 149); font-weight: bold;","|"],oo=`
  --background: var(--color-dark-bg-90) !important;
  --filigree-background-color: var(--color-dark-bg-10) !important;
  --dnd5e-border-dotted: 1px dotted var(--color-cool-4) !important;
  --dnd5e-color-gold: rgba(159, 146, 117, 0.6) !important;
  --input-background-color: var(--color-cool-4) !important;
  --chat-dark-blue: rgba(24, 32, 38, 1) !important;
  --input-background-alt: var(--color-dark-bg-50) !important;
  --color-text-secondary: var(--color-light-1) !important;
  --color-text-primary: var(--color-light-1) !important;
  --button-text-color: var(--color-light-1) !important;
  --color-border-light-1: var(--dnd5e-color-gold) !important;
  --color-text-dark-input: var(--color-light-3) !important;
  --color-border-trait: var(--color-cool-4) !important;

  --crlngn-button-bg: rgba(15, 15, 15, 0.15) !important;
  --color-bg-button: rgba(32, 37, 43, 1) !important;
  --dnd5e-border-groove: 1px solid rgba(36, 36, 36, 0.5) !important;
  --dnd5e-color-groove: var(--dnd5e-color-gold) !important;
  --dnd5e-sheet-bg: rgb(37, 40, 48) !important;
  --sidebar-background: var(--control-bg-color, var(--color-cool-5-90)) !important;
  --dnd5e-color-parchment: rgb(32, 37, 43) !important;
  --dnd5e-background-card: rgb(32, 37, 43) !important; 
  --dnd5e-background-parchment: var(--color-cool-4) !important;

  --color-pf-alternate: rgba(82, 107, 120, 0.44) !important;
  --color-text-gray-blue: rgb(168, 180, 188, 1) !important;
  --color-text-gray-blue-b: rgb(138, 155, 168, 1) !important;
  --chat-button-bg: rgba(32, 37, 43, 1) !important;
  --chat-button-bg-15: rgba(32, 37, 43, 0.15) !important;
  --chat-button-bg-25: rgba(32, 37, 43, 0.25) !important;
  --chat-button-bg-50: rgba(32, 37, 43, 0.5) !important;
  --chat-button-bg-75: rgba(32, 37, 43, 0.75) !important;
  --chat-dark-blue: rgba(24, 32, 38, 1) !important;
  --chat-dark-blue-b: rgb(29, 36, 48, 1) !important; 
  --chat-dark-bg: rgba(32, 37, 43, 1) !important; 
  --chat-dark-bg-15: rgba(32, 37, 43, 0.15) !important;
  --chat-dark-bg-25: rgba(32, 37, 43, 0.25) !important;
  --chat-dark-bg-50: rgba(32, 37, 43, 0.50) !important; 
  --chat-dark-bg-75: rgba(32, 37, 43, 0.75) !important; 
  --chat-dark-bg-90: rgba(32, 37, 43, 0.90) !important; 

  --color-input-bg: var(--color-dark-bg-50) !important; 

  --color-button-bg: rgba(90,120,150,0.5) !important;
  --color-input-border: rgba(90,120,150, 0.5) !important;
  --color-border-dark-5: rgba(80, 80, 80, 1) !important;
  --color-sidebar-font: rgba(213, 221, 230, 0.8) !important;

  --color-text-dark: rgba(235,235,235,1) !important;
  --color-text-dark-op: rgba(235,235,235,0.6) !important;
  --color-text-light: rgba(235,235,235,1) !important;
  --input-background-alt: var(--color-cool-5) !important;
  --color-text-secondary:var(--color-light-3) !important;
  --color-text-primary: var(--color-light-1) !important;

  --color-text-dark-primary: var(--color-light-1) !important;
  --button-border-color: transparent;

  background: var(--color-dark-bg-90) !important;
  color: var(--color-light-1) !important;

  .window-header, header, footer {
    background: var(--color-dark-bg-75) !important;
    color: var(--color-light-1) !important;
    box-shadow: none;
  }
  
  .window-content {
    background: var(--color-dark-bg-25) !important;
    color: var(--color-light-1) !important;
  }

  .window-header{
    border-bottom: 1px solid var(--color-cool-4) !important;
  }

  p, span, div:not(.currency-image), aside, section, nav, label, form, button, table, td, tr, th, h1, h2, h3, h4, h5, h6, ul, ol, li, b, strong, u{
    background: transparent;
    border-color: var(--color-cool-4);
    font-family: var(--font-family);
  }
  *{
    color: var(--color-light-1);
  }
  a.content-link, a.inline-roll  {
    background-color: transparent !important;
    color: var(--color-light-1) !important;
  }
  p{
     line-height: 1.75;
  }

  input:not([type="range"]), select {
    background-color: var(--color-cool-4);
    color: var(--color-light-1);
    border-color: var(--color-cool-4);
  }

  select option {
    background: transparent;
  }

  fieldset {
    border-color: var(--color-cool-4);
  }

  button, .window-resizable-handle{
    color: var(--color-light-1) !important;
    border-color: transparent;
    background-color: var(--color-bg-button) !important;
    font-family: var(--font-family);
  }

  button:hover{
    background-color: var(--color-warm-2) !important;
  }
`,Nn=class Nn{static log(e="",t=[],n=!1){try{const a=Nn.debugOn;if(!(n||a))return;console.log(...rn,e,...t)}catch{console.log(...rn,e,...t)}}static warn(e="",t=[]){console.warn(...rn,e,...t)}static error(e,t){var n;t.ui&&((n=ui.notifications)==null||n.error(e,{localize:!0,permanent:t.permanent})),t.console&&console.error(...rn,e)}};b(Nn,"debugOn",!1);let p=Nn;const ya={select:"select",checkbox:"checkbox",text:"text",number:"number"},S={client:"client",world:"world"},kt={small:{name:"small",size:"36px"},regular:{name:"regular",size:"42px"},large:{name:"large",size:"48px"}},Ct={playerColor:{name:"playerColor"},rollType:{name:"rollType"},none:{name:"none"}},gn={left:{name:"left"},right:{name:"right"},top:{name:"top"},all:{name:"all"}},Oe={off:{name:"OFF"},horizontal:{name:"horizontal"},vertical:{name:"vertical"}},xn=140,ke=[{label:"Carolingian Teal",className:"crlngn-theme",colorPreview:["rgb(62, 62, 88)","rgb(68, 147, 173)"]},{label:"Royal Blood",className:"crlngn-theme-royal-blood",colorPreview:["rgb(40, 31, 49)","rgb(127, 18, 36)"]},{label:"Dark Sorcery",className:"crlngn-theme-dark-sorcery",colorPreview:["rgb(31, 47, 49)","rgb(130, 110, 160)"]},{label:"Grass and Stone",className:"crlngn-theme-grass-stone",colorPreview:["rgb(47, 48, 48)","rgb(133, 174, 74)"]},{label:"Gold and Chocolate",className:"crlngn-theme-gold-chocolate",colorPreview:["rgb(34, 25, 25)","rgb(164, 138, 51)"]},{label:"Pumpkin Patch",className:"crlngn-theme-pumpkin-patch",colorPreview:["rgb(40, 31, 49)","rgb(220, 120, 43)"]},{label:"Gambit's Blue",className:"crlngn-theme-gambits-blue",colorPreview:["rgb(40, 31, 49)","rgb(45, 126, 207)"]}];function R(){return{moduleSettingsMenu:{isMenu:!0,showOnRoot:!0,tag:"v2-interface-options-menu",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.hint"),propType:Object,scope:S.client,config:!1,requiresReload:!1,fields:[],default:{}},interfaceOptionsMenu:{isMenu:!0,showOnRoot:!1,tag:"v2-interface-options-menu",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.hint"),propType:Object,fields:["sceneControlsFadeOut","sidebarTabsFadeOut","chatLogControlsFadeOut","playerListFadeOut","cameraDockFadeOut","macroHotbarFadeOut","sceneNavFadeOut","sceneControlsHide","sidebarTabsHide","chatLogControlsHide","playerListHide","cameraDockHide","macroHotbarHide","sceneNavHide","enableSceneControls","enableSidebarTabs","enableChatLogControls","sceneNavEnabled","enableMacroLayout","enableFloatingDock","enablePlayerList","collapseMacroBar","useFolderStyle","controlsAutoHide"],default:{sceneControlsFadeOut:!1,sidebarTabsFadeOut:!1,chatLogControlsFadeOut:!0,playerListFadeOut:!0,cameraDockFadeOut:!1,macroHotbarFadeOut:!0,sceneNavFadeOut:!1,sceneControlsHide:!1,sidebarTabsHide:!1,chatLogControlsHide:!1,playerListHide:!1,cameraDockHide:!1,macroHotbarHide:!1,sceneNavHide:!1,enableSceneControls:!0,enableSidebarTabs:!0,enableChatLogControls:!0,sceneNavEnabled:!0,enableMacroLayout:!0,enableFloatingDock:!0,enablePlayerList:!0,collapseMacroBar:!1,useFolderStyle:!0,controlsAutoHide:!1},scope:S.client,config:!1,requiresReload:!1},customFontsMenu:{tag:"v2-custom-font-families",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.label"),title:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.hint"),description:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.description"),propType:Object,fields:["uiFontBody","uiFontTitles","journalFontBody","journalFontTitles"],default:{uiFontBody:'"Work Sans", Arial, sans-serif',uiFontTitles:'"Roboto Slab", Arial, sans-serif',journalFontBody:'"Work Sans", Arial, sans-serif',journalFontTitles:'"Roboto Slab", Arial, sans-serif'},scope:S.world,config:!1,requiresReload:!1},themeAndStylesMenu:{isMenu:!0,showOnRoot:!1,tag:"v2-theme-styles-menu",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.label"),title:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.hint"),propType:String,fields:["colorTheme","applyDarkThemeToModules","adjustOtherModules","otherModulesList","forcedDarkTheme","customStyles","applyThemeToSheets"],default:{colorTheme:"crlngn-theme",applyDarkThemeToModules:!0,adjustOtherModules:!0,otherModulesList:"'combat-carousel','dice-tray','hurry-up','crux','fvtt-youtube-player','bg3-inspired-hotbar','touch-vtt','breaktime', 'simple-timekeeping'",forcedDarkTheme:"",customStyles:"",applyThemeToSheets:!0},scope:S.world,config:!1,requiresReload:!1},player_themeAndStylesMenu:{isMenu:!0,showOnRoot:!1,tag:"v2-player-theme-styles-menu",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.label"),title:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.hint"),propType:String,fields:["playerColorTheme","useHorizontalSheetTabs"],default:{playerColorTheme:"",useHorizontalSheetTabs:!0},scope:S.client,config:!1,requiresReload:!1},chatMessagesMenu:{isMenu:!0,showOnRoot:!1,tag:"v2-chat-messages-menu",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.hint"),propType:Object,fields:["sideBarWidth","enableChatStyles","chatBorderColor","useLeftChatBorder","chatBorderPosition"],default:{sideBarWidth:300,enableChatStyles:!0,chatBorderColor:Ct.playerColor.name,useLeftChatBorder:!0,chatBorderPosition:"left"},scope:S.client,config:!1,requiresReload:!1},leftControlsMenu:{isMenu:!0,showOnRoot:!1,tag:"v2-left-controls-menu",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.hint"),propType:Object,fields:["controlsAutoHide"],default:{controlsAutoHide:!1},scope:S.client,config:!1,requiresReload:!1},playersListMenu:{isMenu:!0,showOnRoot:!1,tag:"v2-players-list-menu",label:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.hint"),propType:Object,fields:["autoHidePlayerList","playerListAvatars"],default:{autoHidePlayerList:!1,playerListAvatars:!0},scope:S.client,config:!1,requiresReload:!1},sheets5eMenu:{isMenu:!0,showOnRoot:!1,tag:"v2-sheets-5e-menu",label:game.i18n.localize("CRLNGN_UI.settings.sheets5eMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sheets5eMenu.hint"),propType:Object,fields:["applyThemeToSheets","useHorizontalSheetTabs"],default:{applyThemeToSheets:!0,useHorizontalSheetTabs:!0},scope:S.client,config:!1,requiresReload:!1},cameraDockMenu:{isMenu:!0,showOnRoot:!1,tag:"v2-camera-dock-menu",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.hint"),propType:Object,fields:["dockResizeOnUserJoin","dockPosX","dockPosY","dockWidth","dockHeight","defaultVideoWidth"],default:{dockResizeOnUserJoin:Oe.horizontal.name,defaultVideoWidth:160,dockPosX:0,dockPosY:120,dockWidth:160,dockHeight:140},scope:S.client,config:!1,requiresReload:!1},sceneNavMenu:{isMenu:!0,showOnRoot:!1,tag:"v2-scene-nav-menu",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.hint"),propType:Object,fields:["useSceneFolders","navShowRootFolders","useSceneLookup","sceneClickToView","useSceneIcons","useSceneBackButton","useScenePreview","hideInactiveOnFolderToggle"],default:{useSceneFolders:!0,sceneClickToView:!0,useSceneIcons:!0,navShowRootFolders:!1,useSceneLookup:!0,useScenePreview:!0,useSceneBackButton:!0,hideInactiveOnFolderToggle:!0},scope:S.world,config:!1,requiresReload:!1},player_sceneNavMenu:{isMenu:!0,showOnRoot:!1,tag:"v2-player-scene-nav-menu",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.hint"),propType:Object,fields:["navStartCollapsed","showNavOnHover","sceneItemWidth"],default:{navStartCollapsed:!1,showNavOnHover:!1,sceneItemWidth:150},scope:S.client,config:!1,requiresReload:!1},enforceGMSettings:{tag:"v2-enforce-gm-settings",label:game.i18n.localize("CRLNGN_UI.settings.enforceGMSettings.label"),hint:game.i18n.localize("CRLNGN_UI.settings.enforceGMSettings.hint"),propType:Boolean,default:!1,scope:S.world,config:!0,requiresReload:!0},defaultSettings:{tag:"v2-default-settings",label:game.i18n.localize("CRLNGN_UI.settings.defaultSettings.label"),hint:game.i18n.localize("CRLNGN_UI.settings.defaultSettings.hint"),propType:Object,default:{},scope:S.world,config:!1,requiresReload:!1},disableUI:{tag:"disable-ui",label:game.i18n.localize("CRLNGN_UI.settings.disableUI.label"),hint:game.i18n.localize("CRLNGN_UI.settings.disableUI.hint"),propType:Boolean,scope:S.client,config:!0,default:!1,requiresReload:!1},useSceneFolders:{tag:"v2-nav-folders-enabled",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useSceneFolders.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useSceneFolders.hint"),propType:Boolean,default:!0,scope:S.client,config:!1,requiresReload:!1},navFoldersForPlayers:{tag:"v2-nav-folders-for-players",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navFoldersForPlayers.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navFoldersForPlayers.hint"),propType:Boolean,default:!1,scope:S.client,config:!1,requiresReload:!1},navStartCollapsed:{tag:"v2-nav-start-collapsed",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navStartCollapsed.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navStartCollapsed.hint"),propType:Boolean,default:!1,scope:S.client,config:!1,requiresReload:!1},navShowRootFolders:{tag:"v2-nav-show-root-folders",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navShowRootFolders.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navShowRootFolders.hint"),propType:Boolean,default:!1,scope:S.client,config:!1,requiresReload:!1},hideInactiveOnFolderToggle:{tag:"v2-hide-inactive-on-folder-toggle",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.hideInactiveOnFolderToggle.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.hideInactiveOnFolderToggle.hint"),propType:Boolean,default:!0,scope:S.client,config:!1,requiresReload:!1},useSceneLookup:{tag:"v2-use-scene-lookup",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useSceneLookup.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useSceneLookup.hint"),propType:Boolean,default:!0,scope:S.world,config:!1,requiresReload:!1},sceneItemWidth:{tag:"v2-scene-nav-item-width",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneItemWidth.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneItemWidth.hint"),propType:Number,inputType:ya.number,default:150,scope:S.client,config:!1},showNavOnHover:{tag:"v2-show-nav-on-hover",oldName:"showNavOnHover",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.showNavOnHover.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.showNavOnHover.hint"),propType:Boolean,default:!1,scope:S.client,config:!1,requiresReload:!1},sceneClickToView:{tag:"v2-scene-click-to-view",oldName:"sceneClickToView",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneClickToView.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneClickToView.hint"),propType:Boolean,default:!0,scope:S.world,config:!1,requiresReload:!1},useSceneIcons:{tag:"v2-use-scene-icons",oldName:"useSceneIcons",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useSceneIcons.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useSceneIcons.hint"),propType:Boolean,default:!0,scope:S.world,config:!1,requiresReload:!1},useSceneBackButton:{tag:"v2-use-scene-back-button",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useSceneBackButton.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useSceneBackButton.hint"),propType:Boolean,default:!0,scope:S.world,config:!1,requiresReload:!1},useScenePreview:{tag:"v2-use-scene-preview",oldName:"useScenePreview",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useScenePreview.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useScenePreview.hint"),propType:Boolean,default:!0,scope:S.world,config:!1,requiresReload:!1},sceneNavCollapsed:{tag:"v2-scene-nav-collapsed",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavCollapsed.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavCollapsed.hint"),propType:Boolean,default:!0,scope:S.client,config:!1,requiresReload:!1},sceneNavPos:{tag:"v2-scene-nav-pos",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavPos.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavPos.hint"),propType:Number,default:0,scope:S.client,config:!1,requiresReload:!1},collapseMacroBar:{tag:"v2-collapse-macro-bar",label:game.i18n.localize("CRLNGN_UI.settings.collapseMacroBar.label"),hint:game.i18n.localize("CRLNGN_UI.settings.collapseMacroBar.hint"),propType:Boolean,default:!0,scope:S.client,config:!1,requiresReload:!1},useFolderStyle:{tag:"v2-use-folder-style",label:game.i18n.localize("CRLNGN_UI.settings.useFolderStyle.label"),hint:game.i18n.localize("CRLNGN_UI.settings.useFolderStyle.hint"),propType:Boolean,default:!0,scope:S.world,config:!1,requiresReload:!1},debugMode:{tag:"v2-debug-mode",label:game.i18n.localize("CRLNGN_UI.settings.debugMode.label"),hint:game.i18n.localize("CRLNGN_UI.settings.debugMode.hint"),propType:Boolean,default:!1,scope:S.client,config:!0,requiresReload:!1},autoHidePlayerList:{tag:"v2-auto-hide-player-list",label:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.fields.autoHidePlayerList.label"),hint:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.fields.autoHidePlayerList.hint"),propType:Boolean,default:!1,scope:S.client,config:!1,requiresReload:!1},playerListAvatars:{tag:"v2-player-list-avatars",label:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.fields.playerListAvatars.label"),hint:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.fields.playerListAvatars.hint"),propType:Boolean,default:!0,scope:S.client,config:!1,requiresReload:!1},uiFontBody:{tag:"v2-ui-font-body",oldName:"uiFont",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiBody.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiBody.hint"),propType:String,default:'"Work Sans", Arial, sans-serif',scope:S.world,config:!1,requiresReload:!1},uiFontTitles:{tag:"v2-ui-font-titles",oldName:"uiTitles",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiTitles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiTitles.hint"),propType:String,default:'"Roboto Slab", Arial, sans-serif',scope:S.world,config:!1,requiresReload:!1},journalFontBody:{tag:"v2-journal-font-body",oldName:"journalBody",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalBody.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalBody.hint"),propType:String,default:'"Work Sans", Arial, sans-serif',scope:S.world,config:!1,requiresReload:!1},journalFontTitles:{tag:"v2-journal-font-titles",oldName:"journalTitles",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalTitles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalTitles.hint"),propType:String,default:'"Roboto Slab", Arial, sans-serif',scope:S.world,config:!1,requiresReload:!1},colorTheme:{tag:"v2-color-theme",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.colorTheme.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.colorTheme.hint"),propType:String,default:"crlngn-theme",scope:S.world,config:!1,requiresReload:!1},playerColorTheme:{tag:"v2-player-color-theme",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.playerColorTheme.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.playerColorTheme.hint"),propType:String,default:"",scope:S.client,config:!1,requiresReload:!1},adjustOtherModules:{tag:"v2-adjust-other-modules",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.adjustOtherModules.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.adjustOtherModules.hint"),propType:Boolean,default:!0,scope:S.world,config:!1,requiresReload:!1},applyDarkThemeToModules:{tag:"v2-apply-dark-theme-to-modules",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.applyDarkThemeToModules.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.applyDarkThemeToModules.hint"),propType:Boolean,default:!0,scope:S.world,config:!1,requiresReload:!0},otherModulesList:{tag:"v2-other-modules-list-a3",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.otherModulesList.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.otherModulesList.hint"),propType:String,default:"'combat-carousel','dice-tray','hurry-up','crux','fvtt-youtube-player','bg3-inspired-hotbar','touch-vtt','breaktime','simple-timekeeping'",options:{"BG3 Inspired Hotbar":"'bg3-inspired-hotbar'",Breaktime:"'breaktime'","Combat Carousel":"'combat-carousel'",Crux:"'crux'","Dice Tray":"'dice-tray'","Hurry Up":"'hurry-up'","Simple Timekeeping & Calendar":"'simple-timekeeping'","Touch VTT":"'touch-vtt'","Youtube Player":"'fvtt-youtube-player'"},scope:S.world,config:!1,requiresReload:!1},customStyles:{tag:"v2-custom-styles",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.customStyles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.customStyles.hint"),propType:String,default:"",scope:S.world,config:!1,requiresReload:!0},forcedDarkTheme:{tag:"v2-forced-dark-theme",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.forcedDarkTheme.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.forcedDarkTheme.hint"),propType:String,default:"",scope:S.world,config:!1,requiresReload:!1},chatBorderColor:{tag:"v2-chat-border-color",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.hint"),options:{playerColor:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.options.playerColor"),rollType:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.options.rollType"),none:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.options.none")},propType:String,default:Ct.playerColor.name,scope:S.client,config:!1,requiresReload:!0},chatBorderPosition:{tag:"v2-chat-border-position",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderPosition.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderPosition.hint"),options:{left:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderPosition.options.left"),right:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderPosition.options.right"),top:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderPosition.options.top"),all:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderPosition.options.all")},propType:String,default:gn.left.name,scope:S.client,config:!1,requiresReload:!0},useLeftChatBorder:{tag:"v2-use-left-chat-border",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.useLeftChatBorder.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.useLeftChatBorder.hint"),propType:Boolean,inputType:ya.checkbox,default:!0,scope:S.client,config:!1,requiresReload:!0},enableChatStyles:{tag:"v2-enable-chat-styles",oldName:"enableChatStyles",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.enableChatStyles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.enableChatStyles.hint"),propType:Boolean,default:!0,scope:S.client,config:!1,requiresReload:!0},sideBarWidth:{tag:"v2-side-bar-width",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.sideBarWidth.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.sideBarWidth.hint"),propType:Number,default:300,scope:S.client,config:!1,requiresReload:!1},controlsAutoHide:{tag:"v2-auto-hide-secondary-controls",oldName:"autoHideSecondary",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.autoHideSecondary.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.autoHideSecondary.hint"),propType:Boolean,default:!1,scope:S.client,config:!1,requiresReload:!1},dockPosX:{tag:"v2-camera-dock-x",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosX.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosX.hint"),propType:Number,default:0,scope:S.client,config:!1,requiresReload:!1},dockPosY:{tag:"v2-camera-dock-y",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosY.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosY.hint"),propType:Number,default:120,scope:S.client,config:!1,requiresReload:!1},dockWidth:{tag:"v2-camera-dock-width",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockWidth.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockWidth.hint"),propType:Number,default:160,scope:S.client,config:!1,requiresReload:!1},dockHeight:{tag:"v2-camera-dock-height",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockHeight.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockHeight.hint"),propType:Number,default:145,scope:S.client,config:!1,requiresReload:!1},dockResizeOnUserJoin:{tag:"v2-dock-resize-on-user-join",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockResizeOnUserJoin.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockResizeOnUserJoin.hint"),options:{off:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockResizeOnUserJoin.options.off"),horizontal:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockResizeOnUserJoin.options.horizontal"),vertical:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockResizeOnUserJoin.options.vertical")},propType:String,default:Oe.horizontal.name,scope:S.client,config:!1,requiresReload:!1},defaultVideoWidth:{tag:"v2-default-video-width",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.defaultVideoWidth.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.defaultVideoWidth.hint"),propType:Number,default:160,scope:S.client,config:!1,requiresReload:!1},lastUpdateId:{tag:"last-update-id",label:game.i18n.localize("CRLNGN_UI.ui.updates.label"),hint:game.i18n.localize("CRLNGN_UI.ui.updates.hint"),propType:String,scope:S.world,config:!1,default:"",requiresReload:!1},sceneControlsFadeOut:{tag:"v2-scene-controls-fade-out",oldName:"sceneControlsFadeOut",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.sceneControls"),propType:Boolean,default:!0,scope:S.client,config:!1,requiresReload:!1},sidebarTabsFadeOut:{tag:"v2-sidebar-tabs-fade-out",oldName:"sidebarTabsFadeOut",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.sidebarTabs"),propType:Boolean,default:!0,scope:S.client,config:!1,requiresReload:!1},chatLogControlsFadeOut:{tag:"v2-chat-log-controls-fade-out",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.chatLogControls"),propType:Boolean,default:!0,scope:S.client,config:!1,requiresReload:!1},playerListFadeOut:{tag:"v2-player-list-fade-out",oldName:"playerListFadeOut",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.playerList"),propType:Boolean,default:!0,scope:S.client,config:!1,requiresReload:!1},cameraDockFadeOut:{tag:"v2-camera-fade-out",oldName:"cameraDockFadeOut",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.cameraDock"),propType:Boolean,default:!1,scope:S.client,config:!1,requiresReload:!1},macroHotbarFadeOut:{tag:"v2-macro-hotbar-fade-out",oldName:"macroHotbarFadeOut",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.macroHotbar"),propType:Boolean,default:!0,scope:S.client,config:!1,requiresReload:!1},sceneNavFadeOut:{tag:"v2-scene-nav-fade-out",oldName:"sceneNavFadeOut",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.sceneNav"),propType:Boolean,default:!0,scope:S.client,config:!1,requiresReload:!1},sceneControlsHide:{tag:"v2-scene-controls-hide",oldName:"sceneControlsHide",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.sceneControls"),propType:Boolean,default:!1,scope:S.client,config:!1,requiresReload:!1},sidebarTabsHide:{tag:"v2-sidebar-tabs-hide",oldName:"sidebarTabsHide",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.sidebarTabs"),propType:Boolean,default:!1,scope:S.client,config:!1,requiresReload:!1},chatLogControlsHide:{tag:"v2-chat-log-controls-hide",oldName:"chatLogControlsHide",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.chatLogControls"),propType:Boolean,default:!1,scope:S.client,config:!1,requiresReload:!1},playerListHide:{tag:"v2-player-list-hide",oldName:"playerListHide",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.playerList"),propType:Boolean,default:!1,scope:S.client,config:!1,requiresReload:!1},cameraDockHide:{tag:"v2-camera-dock-hide",oldName:"cameraDockHide",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.cameraDock"),propType:Boolean,default:!1,scope:S.client,config:!1,requiresReload:!1},macroHotbarHide:{tag:"v2-macro-hotbar-hide",oldName:"macroHotbarHide",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.macroHotbar"),propType:Boolean,default:!1,scope:S.client,config:!1,requiresReload:!1},sceneNavHide:{tag:"v2-scene-nav-hide",oldName:"sceneNavHide",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.sceneNav"),propType:Boolean,default:!1,scope:S.client,config:!1,requiresReload:!1},sceneNavEnabled:{tag:"v2-scene-nav-enabled",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneNavEnabled.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneNavEnabled.hint"),propType:Boolean,default:!0,scope:S.client,config:!1,requiresReload:!0},enableSceneControls:{tag:"v2-enable-scene-controls",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.sceneControls"),propType:Boolean,default:!0,scope:S.client,config:!1,requiresReload:!1},enableSidebarTabs:{tag:"v2-enable-sidebar-tabs",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.sidebarTabs"),propType:Boolean,default:!0,scope:S.client,config:!1,requiresReload:!1},enableChatLogControls:{tag:"v2-enable-chat-log-controls",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.chatLogControls"),propType:Boolean,default:!0,scope:S.client,config:!1,requiresReload:!1},enableMacroLayout:{tag:"v2-enable-macro-layout",label:game.i18n.localize("CRLNGN_UI.settings.enableMacroLayout.label"),hint:game.i18n.localize("CRLNGN_UI.settings.enableMacroLayout.hint"),propType:Boolean,default:!0,scope:S.client,config:!1,requiresReload:!1},enablePlayerList:{tag:"v2-enable-player-list",label:game.i18n.localize("CRLNGN_UI.settings.enablePlayerList.label"),hint:game.i18n.localize("CRLNGN_UI.settings.enablePlayerList.hint"),propType:Boolean,default:!0,scope:S.client,config:!1,requiresReload:!1},enableFloatingDock:{tag:"v2-enable-floating-dock",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.enableFloatingDock.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.enableFloatingDock.hint"),propType:Boolean,default:!0,scope:S.client,config:!1,requiresReload:!0},applyThemeToSheets:{tag:"v2-apply-theme-and-styles",label:game.i18n.localize("CRLNGN_UI.settings.sheets5eMenu.fields.applyThemeToSheets.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sheets5eMenu.fields.applyThemeToSheets.hint"),propType:Boolean,default:!0,scope:S.world,config:!1,requiresReload:!1},useHorizontalSheetTabs:{tag:"v2-use-horizontal-tabs",label:game.i18n.localize("CRLNGN_UI.settings.sheets5eMenu.fields.useHorizontalSheetTabs.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sheets5eMenu.fields.useHorizontalSheetTabs.hint"),propType:Boolean,default:!0,scope:S.client,config:!1,requiresReload:!1}}}var Ln,ka;const ut=class ut{static isModuleOn(e){var n;const t=(n=game.modules)==null?void 0:n.get(e);return!!(t!=null&&t.active)}static html(e,t){return e.querySelector(t)}static getFullWidth(e){return window.getComputedStyle(e).width==="0px"?0:e.offsetWidth}static async processStyleSheetRules(e,t){var n;try{if(((n=e.ownerNode)==null?void 0:n.tagName)==="STYLE"){const a=e.ownerNode.textContent;this.extractFontsFromCSSText(a,t)}try{const a=e.cssRules||e.rules;if(!a)return;for(let o=0;o<a.length;o++){const s=a[o];if(s instanceof CSSFontFaceRule){const r=s.style.getPropertyValue("font-family");r&&(t.add(r),p.log("Found font-face rule:",[r]))}else if(s instanceof CSSImportRule){if(p.log("Found import rule:",[s.href]),s.styleSheet)await this.processStyleSheetRules(s.styleSheet,t);else if(s.href)try{const c=await(await fetch(s.href)).text();this.extractFontsFromCSSText(c,t)}catch(r){p.warn("Error fetching imported CSS:",[r])}}}}catch(a){if(a.name==="SecurityError"&&e.href){p.log("Security restriction on stylesheet, trying to fetch directly:",[e.href]);try{const s=await(await fetch(e.href)).text();this.extractFontsFromCSSText(s,t)}catch(o){p.warn("Error fetching cross-origin stylesheet:",[o])}}else p.warn("Error accessing CSS rules:",[a])}}catch(a){p.warn("Error in processStyleSheetRules:",[a])}}static extractFontsFromCSSText(e,t){if(!e)return;const n=/@font-face\s*{[^}]*font-family\s*:\s*(['"])(.+?)\1[^}]*}/gs;(e.match(n)||[]).forEach(o=>{const s=/font-family\s*:\s*(['"])(.+?)\1/,r=o.match(s);if(r&&r[2]){const c=r[2].trim();t.add(c)}})}static getOffsetBottom(e){const t=e.offsetTop,n=e.offsetHeight;return window.innerHeight-(t+n)}static async getAllFonts(){const e=new Set(Object.keys(CONFIG.fontDefinitions)),t=game.settings.get("core","fonts")||{},n=Object.entries(t).map(([s])=>s),a=await this.processStyleSheets();return Array.from(new Set([...e,...n,...a])).filter(s=>!/FontAwesome|Font Awesome|FoundryVTT/.test(s)).map(s=>s.replace(/['"]/g,"").trim()).sort((s,r)=>s.toLowerCase().localeCompare(r.toLowerCase()))||[]}static addCSSVars(e,t){let n=document.querySelector("#crlngn-ui-vars");if(!n){const h=document.querySelector("body.crlngn-ui");if(!h)return;n=document.createElement("style"),n.id="crlngn-ui-vars",n.textContent=`body.crlngn-ui {
}
`,h.prepend(n)}let a=n.textContent,o=a.indexOf("body.crlngn-ui {"),s=a.indexOf("}",o);o===-1&&(a=`body.crlngn-ui {
}
`,o=0,s=a.indexOf("}"));const c=a.substring(o+16,s).split(";").map(h=>h.trim()).filter(h=>h!==""),d={};c.forEach(h=>{const C=h.split(":");if(C.length>=2){const E=C[0].trim(),O=C.slice(1).join(":").trim();E&&(d[E]=O)}}),e.includes("i18n")&&typeof t=="string"&&!t.startsWith('"')&&!t.startsWith("'")&&!t.match(/^url\(|^rgba?\(|^hsla?\(/)&&(t=`"${t}"`),d[e]=t;const f=Object.entries(d).map(([h,C])=>`  ${h}: ${C};`).join(`
`),g=a.substring(0,o)+`body.crlngn-ui {
`+f+`
}`+a.substring(s+1);n.textContent=g}static addCustomCSS(e,t="crlngn-ui-custom-css",n=!0){if(!e)return;let a=document.querySelector("#"+t);a||(a=document.createElement("style"),a.id=t,a.textContent="",document.head.appendChild(a));const o=/@import\s+(?:url\()?\s*['"]?[^'")]+['"]?\s*\)?\s*;/g,s=[];let r=e,c;for(;(c=o.exec(e))!==null;)s.push(c[0]);if(r=e.replace(o,"").trim(),!n){a.textContent=s.join(`
`)+(s.length?`

`:"")+r;return}if(!a.textContent.includes(r)){const d=a.textContent,f=[];let g;for(;(g=o.exec(d))!==null;)f.push(g[0]);const h=d.replace(o,"").trim(),C=s.filter(O=>!f.includes(O)),E=[...f,...C];a.textContent=E.join(`
`)+(E.length?`

`:"")+h+(h&&r?`

`:"")+r}}static smoothScrollTo(e,t,n="horizontal",a=300,o=null){const s=e.dataset.scrollAnimationId;s&&cancelAnimationFrame(Number(s));const r=n==="horizontal",c=r?e.scrollLeft:e.scrollTop,d=t-c;if(d===0)return o&&o(),null;const f=performance.now(),g=C=>{const E=C-f;if(E>=a){r?e.scrollLeft=t:e.scrollTop=t,delete e.dataset.scrollAnimationId,o&&o();return}const O=E/a,j=O<.5?2*O*O:1-Math.pow(-2*O+2,2)/2;r?e.scrollLeft=c+d*j:e.scrollTop=c+d*j;const ne=requestAnimationFrame(g);return e.dataset.scrollAnimationId=ne,ne},h=requestAnimationFrame(g);return e.dataset.scrollAnimationId=h,h}static confirmReload(e=game.i18n.localize("CRLNGN_UI.ui.reloadRequiredTitle"),t=game.i18n.localize("CRLNGN_UI.ui.reloadRequiredLabel"),n={}){const a={title:e,content:t,yes:{label:game.i18n.localize("CRLNGN_UI.ui.reloadButton"),callback:()=>(p.log("Reloading page after confirmation"),window.location.reload(),!0)},no:{label:game.i18n.localize("CRLNGN_UI.ui.cancelButton"),callback:()=>!1},defaultYes:!1,rejectClose:!1};return mergeObject(a,n),foundry.applications.api.DialogV2.confirm(a)}static renderTemplate(e,t){return foundry.applications.handlebars.renderTemplate(e,t)}static loadTemplate(e){return foundry.applications.handlebars.loadTemplate(e)}static loadTemplates(e){return foundry.applications.handlebars.loadTemplates(e)}static isValidCSSRule(e){if(!e||typeof e!="string")return!1;const t=e.trim();if(!t)return!1;try{const n=document.createElement("style"),a=`${t} { color: inherit; }`;n.textContent=a,document.head.appendChild(n);const o=!!(n.sheet&&n.sheet.cssRules&&n.sheet.cssRules.length>0);return document.head.removeChild(n),o}catch(n){return p.log("CSS validation error:",[n,e]),!1}}static processCSSRules(e,t){if(!e||!t)return"";const n=ee(this,Ln,ka).call(this,e),a=t+` {
`+n.baseProperties.join(`
`)+`
}`,o=[],s=new Map;return n.nestedRules.forEach(r=>{const{selector:c,content:d}=r;if(c.startsWith("&")){const h=c.substring(1),C=t.split(",").map(E=>E.trim()).filter(Boolean).map(E=>E+h).join(", ");o.push(`${C} {
${d}
}`);return}s.has(d)||s.set(d,[]);const f=c.split(",").map(h=>h.trim()),g=t.split(",").map(h=>h.trim()).filter(Boolean);f.forEach(h=>{g.forEach(C=>{s.get(d).push(`${C} ${h}`)})})}),s.forEach((r,c)=>{o.push(`${r.join(", ")} {
${c}
}`)}),a+`

`+o.join(`

`)}};Ln=new WeakSet,ka=function(e){const t=[],n=[],a=e.split(`
`);let o=null,s=0;for(let r=0;r<a.length;r++){const c=a[r].trim();if(!c)continue;const d=(c.match(/{/g)||[]).length,f=(c.match(/}/g)||[]).length;if(c.includes("{")&&!o){o={selector:c.substring(0,c.indexOf("{")).trim(),content:"",startLine:r},s=1;const h=c.substring(c.indexOf("{")+1).trim();h&&!h.includes("}")&&(o.content+=h+`
`)}else o?(s+=d-f,s>0?o.content+=c+`
`:(o.content=o.content.replace(/}\s*$/,"").trim(),n.push(o),o=null)):!c.includes("{")&&!c.includes("}")&&t.push(c)}return{baseProperties:t,nestedRules:n}},L(ut,Ln),b(ut,"processStyleSheets",async()=>{const e=new Set(Object.keys(CONFIG.fontDefinitions)),t=game.settings.get("core","fonts")||{},n=Object.entries(t).map(([s])=>s),a=new Set;for(const s of document.styleSheets)try{if(s.ownerNode){const r=s.href||"",c=r.includes("css/")||r.includes("styles/"),d=r.includes("modules/crlngn-ui/"),f=r.includes("systems/");if(r&&!c&&!d&&!f)continue;await ut.processStyleSheetRules(s,a)}}catch(r){p.warn("Error processing stylesheet:",[r])}return p.log("Found fonts:",[{foundry:Array.from(e),custom:n,cssImported:Array.from(a)}]),Array.from(new Set([...e,...n,...a])).filter(s=>!/FontAwesome|Font Awesome|FoundryVTT/.test(s)).map(s=>s.replace(/['"]/g,"").trim()).sort((s,r)=>s.toLowerCase().localeCompare(r.toLowerCase()))}),b(ut,"wrapFontName",e=>{const t=e.replace(/['"`]/g,"");return t.includes(" ")?`"${t}"`:t});let N=ut;var xe,Bt,Ht;const G=class G{static init(){p.log("LeftControls - init",[]),Hooks.on(A.RENDER_SCENE_CONTROLS,G.initSceneControls),Hooks.on(A.ACTIVATE_SCENE_CONTROLS,G.onActivateSceneControls),window.addEventListener("resize",G.onActivateSceneControls),G.initSceneControls()}static applyFadeOut(e){G.useFadeOut=e,p.log("applyFadeOut",[e]),G.handleFadeOut()}static applyHide(e){G.hidden=e,G.handleHide()}static handleHide(e,t,n){const a=t||document.querySelector("#scene-controls");G.hidden?a==null||a.classList.add("hidden-ui"):a==null||a.classList.remove("hidden-ui"),p.log("handle Hide",[G.hidden])}static handleFadeOut(e,t,n){const a=t||document.querySelector("#scene-controls"),o=document.querySelector("#touch-vtt-controls");G.useFadeOut?(a==null||a.classList.add("faded-ui"),o==null||o.classList.add("faded-ui")):(a==null||a.classList.remove("faded-ui"),o==null||o.classList.remove("faded-ui")),p.log("handle FadeOut",[G.customStylesEnabled,G.useFadeOut])}static applyCustomStyle(e){var t;G.customStylesEnabled=e,p.log("applyCustomStyle",[G.customStylesEnabled,ui.controls]),(t=ui.controls)==null||t.render()}static resetLocalVars(){I(G,xe,document.querySelector("#ui-left #controls")),I(G,Bt,document.querySelector("#ui-left"))}static initSceneControls(e,t,n){p.log("initSceneControls",[]),G.resetLocalVars();const a=document.querySelector("#interface");G.customStylesEnabled?a==null||a.classList.add("crlngn-controls"):a==null||a.classList.remove("crlngn-controls"),G.handleFadeOut(e,t,n),G.handleHide(e,t,n)}static observeControlsWidth(){if(p.log("observeControlsWidth",[]),!m(G,xe))return;let e;const t=(n,a)=>{e||(e=setTimeout(()=>{n(),e=null},a))};I(G,Ht,new ResizeObserver(n=>{t(()=>G.updateCSSVars(),250)})),m(G,Ht).observe(m(G,xe),{box:"border-box"}),G.updateCSSVars()}static updateCSSVars(){if(!m(G,xe))return;let e=parseInt(m(G,Bt).offsetWidth),t=parseInt(m(G,xe).offsetWidth),n=-e+t;p.log("updateCSSVars",[t,e]),!isNaN(t)&&!isNaN(e)&&N.addCSSVars("--ui-controls-margin-left",n+"px")}static onActivateSceneControls(e,t){const n=document.querySelectorAll("#scene-controls-layers .ui-control"),a=document.querySelectorAll("#scene-controls-tools .ui-control"),o=getComputedStyle(document.querySelector("#ui-left")).getPropertyValue("--control-columns");a.length>=n.length?(document.querySelector("#scene-controls").classList.add("more-tools"),Number(o)>2?document.querySelector("#scene-controls").classList.add("extra-columns"):document.querySelector("#scene-controls").classList.remove("extra-columns")):(document.querySelector("#scene-controls").classList.remove("more-tools"),document.querySelector("#scene-controls").classList.remove("extra-columns")),p.log("onActivateSceneControls",[o,a.length,n.length])}};xe=new WeakMap,Bt=new WeakMap,Ht=new WeakMap,L(G,xe),L(G,Bt),L(G,Ht),b(G,"useFadeOut",!0),b(G,"hidden",!1),b(G,"customStylesEnabled",!0),b(G,"preloadTemplates",async()=>{try{const e=[`modules/${MODULE_ID}/templates/chat-toggle-button.hbs`];return await N.loadTemplates(e),!0}catch(e){return p.log("Error loading navigation button templates:",[e]),!1}});let gt=G;foundry.utils;const{ApplicationV2:so,HandlebarsApplicationMixin:io}=foundry.applications.api;var Ia,K,mt,ra,ie,Oa,Ma,Da,_n,ea,Fa;const k=class k extends io(so){constructor(){super(...arguments);b(this,"_onRender",(t,n)=>{R(),I(k,K,this.element);const a=m(k,K).querySelector('input[type="range"][name="sceneItemWidth"]'),o=m(k,K).querySelector('input[type="number"].range-value-input[name="sceneItemWidth_value"]');a&&o&&k.handleRangeInputs(a,o);const s=m(k,K).querySelector('input[type="range"][name="sideBarWidth"]'),r=m(k,K).querySelector('input[type="number"].range-value-input[name="sideBarWidth_value"]');s&&r&&k.handleRangeInputs(s,r);const c=m(k,K).querySelectorAll(".toggle-hint");p.log("_onRender",[t,n,this.element]),c.forEach(d=>{d.addEventListener("click",()=>{m(k,K).querySelectorAll("p.hint").forEach(f=>f.classList.toggle("shown"))})}),k.handleCustomFontFields(),k.handleThemeAndStyleFields(),p.log("_onRender",[t,n])})}_configureRenderParts(t){const n=super._configureRenderParts(t),a=k.getRestrictedTabs();return game.user.isGM||a.forEach(o=>{delete n[o]}),n}async _prepareContext(t){const n=await super._prepareContext(t);n.activeTab=t.activeTab||Object.keys(n.tabs)[0],n.isGM=game.user.isGM,R(),n.themes=ke;const a=await N.getAllFonts();return n.fontList=a,n}async _preparePartContext(t,n,a){var r,c,d;const o=await super._preparePartContext(t,n,a);t in n.tabs&&(o.tab=o.tabs[t]),R(),Pa();const s=k.getRestrictedTabs();switch(game.user.isGM||s.forEach(f=>{delete o.tabs[f]}),t){case"tabs":break;case"footer":{o.buttons=[{type:"button",icon:"",label:"CRLNGN_UI.settings.moduleSettingsMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.moduleSettingsMenu.save"}];break}default:{o.tab=o.tabs[t];const f=((r=k.PARTS[t])==null?void 0:r.menuKey)||null;if(f){const g=k.getMenuContext(f);if(g.fields&&(o.fields={...o.fields,...g.fields}),g.fieldDefaults&&(o.fieldDefaults={...o.fieldDefaults,...g.fieldDefaults}),g.fieldValues){if(t==="themes"){const h=ke.find(E=>E.className===g.fieldValues.colorTheme);g.fieldValues.colorTheme=(h==null?void 0:h.label)||ke[0].label;const C=ke.find(E=>E.className===g.fieldValues.playerColorTheme);g.fieldValues.playerColorTheme=(C==null?void 0:C.label)||""}Object.assign(o,g.fieldValues)}o.sidebarTabs=Object.values(((d=(c=foundry.applications)==null?void 0:c.sidebar)==null?void 0:d.tabs)||{}).map(h=>({tabName:h.tabName,name:h.name,hideForGM:!1,hideForPlayer:!1,localizedName:`CRLNGN_UI.settings.sidebarTabs.${h.name}`}))}break}}return p.log("_preparePartContext",[o,t]),o}static getMenuContext(t){var d,f;const n=R(),a=((d=n[t])==null?void 0:d.fields)||[],o=((f=n["player_"+t])==null?void 0:f.fields)||[];if(!a||a.length===0)return{};const s={},r={},c={};return a==null||a.forEach(g=>{if(n[g]){const h=T.get(n[g].tag);s[g]=n[g],r[g]=h!==void 0?h:n[g].default,c[g]=n[g].default}}),o==null||o.forEach(g=>{if(n[g]){const h=T.get(n[g].tag);s[g]=n[g],r[g]=h!==void 0?h:n[g].default,c[g]=n[g].default}}),{fields:s,fieldValues:r,fieldDefaults:c}}static getRestrictedTabs(){const t=[];return Object.entries(k.PARTS).forEach((n,a)=>{n[0]!=="tabs"&&n[0]!=="footer"&&n[1].isGMOnly&&t.push(n[0])}),t}static handleRangeInputs(t,n){if(t&&n){const a=parseInt(t.min,10),o=parseInt(t.max,10);t.addEventListener("input",()=>{n.value=t.value}),n.addEventListener("input",()=>{const s=n.value;if(s===""||s==="-")return;const r=parseInt(s,10);!isNaN(r)&&r>=a&&r<=o&&(t.value=r)}),n.addEventListener("change",()=>{let s=parseInt(n.value,10);isNaN(s)||s<a?s=a:s>o&&(s=o),n.value=s,t.value=s}),n.value=t.value}}static updateSettings(t){let n=!1;const a=R(),r=m(k,K).querySelector(".form-content.active").dataset.tab;if(I(k,mt,r),!t)return;let c;t.object&&(c=foundry.utils.expandObject(t.object));const d=ke.find(g=>g.label===c.colorTheme);c.colorTheme=d?d.className:ke[0].className;const f=ke.find(g=>g.label===c.playerColorTheme);return c.playerColorTheme=f?f.className:"",Object.entries(c).forEach(([g,h])=>{var C;if(!g.endsWith("_value")&&(p.log("updateSettings #1",[a,a[g]]),c[g]!==void 0&&a[g])){const E=T.get(a[g].tag),O=a[g].scope===S.client,j=a[g].scope===S.world;O||j&&game.user.isGM?T.set(a[g].tag,c[g]):p.log(`Skipping world-scoped setting ${g} for non-GM user`),(C=a[g])!=null&&C.requiresReload&&E!==c[g]&&(n=!0)}}),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated")),n}changeTab(t,n,a){super.changeTab(t,n,a),I(k,mt,t)}static handleCustomFontFields(){const t=m(k,K).querySelector(".form-content[data-tab=fonts]");if(!t)return;t.querySelectorAll('input[type="text"]').forEach(o=>{const s=o.closest(".dropdown-wrapper"),r=s==null?void 0:s.querySelector(".dropdown-options");if(!s||!r)return;const c=()=>{var d;ee(d=k,ie,_n).call(d),r.classList.add("active")};o.addEventListener("focus",c),o.addEventListener("click",c),o.addEventListener("keydown",ee(k,ie,ea)),document.addEventListener("click",d=>{s.contains(d.target)||r.classList.remove("active")})}),t.querySelectorAll(".dropdown-option").forEach(o=>{o.addEventListener("mouseenter",()=>{o.closest(".dropdown-options").querySelectorAll(".dropdown-option").forEach(r=>r.classList.remove("highlighted")),o.classList.add("highlighted")}),o.addEventListener("click",s=>{const r=o.closest(".dropdown-wrapper").querySelector("input");let c=o.dataset.value;c.includes(" ")&&!c.startsWith('"')?c=`"${c}"`:c.startsWith("&quot;")&&(c=c.replace(/&quot;/g,'"')),r.value=c;const d=o.closest(".dropdown-options");d.classList.remove("active"),p.log("handleCustomFontFields",[c,r,d])})})}static handleThemeAndStyleFields(){const t=m(k,K).querySelector(".form-content[data-tab=themes]");if(!t)return;t.querySelectorAll('input[type="text"]:not([hidden])').forEach(c=>{const d=c.closest(".dropdown-wrapper"),f=d==null?void 0:d.querySelector(".dropdown-options");if(!d||!f)return;const g=()=>{var h;ee(h=k,ie,_n).call(h),f.classList.add("active")};c.addEventListener("focus",g),c.addEventListener("click",g),c.addEventListener("keydown",ee(k,ie,ea)),document.addEventListener("click",h=>{d.contains(h.target)||f.classList.remove("active")})}),t.querySelectorAll(".dropdown-option").forEach(c=>{c.addEventListener("mouseenter",()=>{c.closest(".dropdown-options").querySelectorAll(".dropdown-option").forEach(f=>f.classList.remove("highlighted")),c.classList.add("highlighted")}),c.addEventListener("click",function(d){var C,E,O;p.log("theme option",[c,c.querySelector(".theme-name")]);const f=(C=c.closest(".dropdown-wrapper"))==null?void 0:C.querySelector("input");let g=(E=c.querySelector(".theme-name"))==null?void 0:E.innerHTML.toString();if(f.value=g,f.name==="colorTheme"||f.name==="playerColorTheme"){const j=ke.find(ne=>ne.label===g);ee(O=k,ie,Fa).call(O,j)}c.closest(".dropdown-options").classList.remove("active")})});const o=m(k,K).querySelectorAll('.multiple-select.other-modules input[type="checkbox"]'),s=m(k,K).querySelector('input.otherModulesList[type="hidden"]');o.forEach(c=>{c.addEventListener("change",d=>{const f=d.currentTarget;let h=`${s.value}`.split(",")||[],C=h.indexOf(f.value);!d.currentTarget.checked&&C>-1?h.splice(C,1):d.currentTarget.checked&&C===-1&&h.push(f.value),s.value=h.join(","),p.log("checkbox changed",[h,s.value])})});const r=m(k,K).querySelector("input.adjustOtherModules");r==null||r.addEventListener("change",c=>{const d=m(k,K).querySelectorAll('.multiple-select.other-modules input[type="checkbox"]');d.forEach(h=>{h.checked=c.currentTarget.checked;const C=new Event("change",{bubbles:!0});h.dispatchEvent(C)});const f=[],g=m(k,K).querySelector('input.otherModulesList[type="hidden"]');d.forEach(h=>{h.checked&&f.push(h.value)}),g.value=f.join(","),f.length===0&&(r.checked=!1)})}};K=new WeakMap,mt=new WeakMap,ra=new WeakMap,ie=new WeakSet,Oa=async function(t,n,a){t.preventDefault(),t.stopPropagation(),k.updateSettings(a)&&N.confirmReload()},Ma=async function(t,n){const a=R(),s=m(k,K).querySelector(".form-content.active"),r=s.dataset.tab,c=k.PARTS[r].menuKey,d=a[c].default;s.querySelectorAll("input, select").forEach(g=>{g.value=d[g.name],g.type==="checkbox"&&(g.checked=d[g.name])}),p.log("#onReset",[m(k,mt),r,t,n])},Da=function(){var a;const t=[],n=k.PARTS;return((a=game.system)==null?void 0:a.id)!=="dnd5e"&&delete n.sheets5e,p.log("#getTabs",[n,k.PARTS]),Object.entries(n).forEach(([o,s])=>{s.menuKey&&t.push({id:o,icon:"",group:"primary-tabs",label:`CRLNGN_UI.settings.moduleSettingsMenu.tabs.${o}`})}),t},_n=function(){m(k,K).querySelectorAll(".dropdown-options").forEach(t=>{t.classList.remove("active")})},ea=function(t){const n=t.target.closest(".dropdown-wrapper"),a=n==null?void 0:n.querySelector(".dropdown-options"),o=a.classList.contains("active"),s=Array.from(a.querySelectorAll(".dropdown-option"));let r=s.findIndex(c=>c.classList.contains("highlighted"));t.key==="ArrowDown"||t.key==="ArrowUp"?(t.preventDefault(),o||a.classList.add("active"),s.forEach(c=>c.classList.remove("highlighted")),r===-1?r=t.key==="ArrowDown"?0:s.length-1:r=t.key==="ArrowDown"?(r+1)%s.length:(r-1+s.length)%s.length,s[r]&&(s[r].classList.add("highlighted"),s[r].scrollIntoView({block:"nearest"}))):t.key==="Enter"?(t.preventDefault(),o&&r!==-1&&s[r]&&s[r].click()):t.key==="Escape"&&a.classList.remove("active")},Fa=function(t){if(p.log("Selected theme updated:",[t]),!t)return;m(k,K).querySelectorAll("span.selected-theme").forEach((a,o)=>{a.style.setProperty("background-color",t.colorPreview[o])})},L(k,ie),L(k,K),L(k,mt),L(k,ra),b(k,"selectedTheme"),b(k,"DEFAULT_OPTIONS",{id:"crlngn-ui-settings",tag:"form",window:{icon:"fas fa-cog",title:"CRLNGN_UI.settings.moduleSettingsMenu.title",contentClasses:["standard-form","crlngn","tabbed-settings"],resizable:!0},position:{width:700,height:"auto"},actions:{redefine:ee(k,ie,Ma)},form:{handler:ee(k,ie,Oa),closeOnSubmit:!0}}),b(k,"PARTS",{tabs:{template:"templates/generic/tab-navigation.hbs",isGMOnly:!1},interface:{menuKey:"interfaceOptionsMenu",template:"modules/crlngn-ui/templates/interface-elements-settings.hbs",isGMOnly:!1},themes:{menuKey:"themeAndStylesMenu",template:"modules/crlngn-ui/templates/theme-and-styles-settings.hbs",isGMOnly:!1},fonts:{menuKey:"customFontsMenu",template:"modules/crlngn-ui/templates/custom-fonts-settings.hbs",isGMOnly:!0},chat:{menuKey:"chatMessagesMenu",template:"modules/crlngn-ui/templates/chat-messages-settings.hbs",isGMOnly:!1},scenes:{menuKey:"sceneNavMenu",template:"modules/crlngn-ui/templates/scene-nav-settings.hbs",isGMOnly:!1},players:{menuKey:"playersListMenu",template:"modules/crlngn-ui/templates/players-list-settings.hbs",isGMOnly:!1},camera:{menuKey:"cameraDockMenu",template:"modules/crlngn-ui/templates/camera-dock-settings.hbs",isGMOnly:!1},footer:{template:"templates/generic/form-footer.hbs",isGMOnly:!1}}),b(k,"TABS",{primary:{initial:"interface",tabs:ee(Ia=k,ie,Da).call(Ia),labelPrefix:""}});let Qn=k;function Pa(){return{moduleSettingsMenu:{tab:"",tag:game.i18n.localize("CRLNGN_UI.settings.moduleSettingsMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.moduleSettingsMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.moduleSettingsMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.moduleSettingsMenu.hint"),icon:"fas fa-sliders-h",propType:Qn,restricted:!1}}}var tt,Ue,xt,Ut,Wt,Vt,jt,$t,Yt,Xt,nt,Jt,Kt;const u=class u{static applyFadeOut(e){u.useFadeOut=e,u.cameraContainer&&u.cameraContainer.classList.toggle("faded-ui",e)}static applyHide(e){u.hidden=e,u.cameraContainer&&u.cameraContainer.classList.toggle("hidden",e)}static applyCustomStyle(e){var t;u.enableFloatingDock=e,p.log("applyCustomStyle",["enableFloatingDock",e,u.enableFloatingDock,ui.webrtc]),(t=ui.webrtc)==null||t.render()}static init(){const e=R();u.enableFloatingDock=T.get(e.enableFloatingDock.tag),u.currSettings={enableFloatingDock:u.enableFloatingDock,defaultVideoWidth:T.get(e.defaultVideoWidth.tag),dockHeight:T.get(e.dockHeight.tag),dockWidth:T.get(e.dockWidth.tag),dockPosX:T.get(e.dockPosX.tag),dockPosY:T.get(e.dockPosY.tag),dockResizeOnUserJoin:T.get(e.dockResizeOnUserJoin.tag)},u.enableFloatingDock?(u.positionIntervalId&&(clearInterval(u.positionIntervalId),u.positionIntervalId=null),Hooks.on(A.RENDER_CAMERA_VIEWS,u.onRenderFloating),Hooks.on(A.RENDER_PLAYERS_LIST,u.onRenderPlayersList),Hooks.on(A.CLIENT_SETTING_CHANGED,t=>{p.log("Setting updated",[t]),t.includes("rtcClientSettings")&&u.checkMinimizedState()})):(Hooks.on(A.RENDER_CAMERA_VIEWS,u.onRenderPlain),u.onRenderPlain())}static onRenderPlain(e,t){var n;u.cameraContainer||(u.cameraContainer=document.querySelector("#av-holder")),(n=u.cameraContainer)==null||n.classList.add("visible")}static onRenderFloating(e,t,n){R();const a=u.currSettings,o=document.querySelector("#camera-views");if(u.cameraContainer=document.querySelector("#av-holder"),u.cameraContainer)u.cameraContainer.appendChild(o);else{const d=document.createElement("div");u.cameraContainer=d,d.id="av-holder",d.appendChild(o),document.querySelector("body.crlngn-ui").appendChild(d)}u.cameraContainer.querySelector("button[data-action=toggleDock]").addEventListener("click",()=>{var d;(d=ui.webrtc)==null||d.render()}),((t==null?void 0:t.querySelectorAll(".camera-view"))||[]).forEach(d=>{const f=game.users.get(d.dataset.user),g=(f==null?void 0:f.color)||"";d.style.setProperty("--player-color",g)}),p.log("CameraDockUtil.onRender",[e,t,n,a.dockPosX,a.dockPosY]);const c=game.settings.get("core","rtcClientSettings");(c==null?void 0:c.hideDock)!==!0?(u.checkMinimizedState(),u.applyDockResize(a.dockResizeOnUserJoin),u.makeDraggable(),u.makeResizeable(),u.applyVideoWidth(),u.resetPositionAndSize()):u.checkMinimizedState(),u.applyFadeOut(u.useFadeOut)}static onRenderPlayersList(){p.log("onRenderPlayersList")}static applyPositionWithDelay(){u.positionIntervalId&&(clearInterval(u.positionIntervalId),u.positionIntervalId=null),u.resetPositionAndSize();let e=0;u.positionIntervalId=setInterval(()=>{u.resetPositionAndSize(),e++,e>=u.positionAttempts&&(clearInterval(u.positionIntervalId),u.positionIntervalId=null)},20)}static applyVideoWidth(e){const t=R(),n=T.get(t.defaultVideoWidth.tag);let a=e||n;if(a<xn)a=xn,T.set(t.defaultVideoWidth.tag,a);else if(!Number.isNaN(a)){u.currSettings.defaultVideoWidth=a;const o=document.querySelector("#av-holder.minimized #camera-views"),s=document.querySelector("#camera-views");!o&&s&&(s.parentNode.style.setProperty("--av-width",a+"px"),s.style.setProperty("--av-width",a+"px")),u.updateDockSize()}}static resetPositionAndSize({x:e,y:t,w:n,h:a}={x:null,y:null,w:null,h:null}){R();const o=u.currSettings;if(!u.enableFloatingDock||!u.cameraContainer)return;const s=game.settings.get("core","rtcClientSettings");if((s==null?void 0:s.hideDock)===!0){u.checkMinimizedState();return}if(p.log("CameraDock",[o]),!e&&!t&&!n&&!a){const r=o.dockPosX||0,c=o.dockPosY||0;if(u.cameraContainer.style.left=`${r}px`,u.cameraContainer.style.bottom=`${c}px`,u.currSettings.dockResizeOnUserJoin===Oe.off.name){const d=o.dockWidth||0,f=o.dockHeight||0;u.cameraContainer.style.width=`${d}px`,u.cameraContainer.style.height=`${f}px`}}else e!==null&&(u.cameraContainer.style.left=`${e}px`),t!==null&&(u.cameraContainer.style.bottom=`${t}px`),u.currSettings.dockResizeOnUserJoin===Oe.horizontal.name?n!==null&&(u.cameraContainer.style.width=`${n}px`):u.currSettings.dockResizeOnUserJoin===Oe.vertical.name&&a!==null&&(u.cameraContainer.style.height=`${a}px`)}static makeDraggable(){var e,t;(e=u.cameraContainer)==null||e.addEventListener("mousedown",n=>{var c,d;const a=document.querySelector("#av-holder.minimized #camera-views");if(n.button!==0)return;const o=document.querySelector("body.crlngn-ui");if(p.log("mousedown",[n.target.tagName,n.target.parentNode.tagName]),n.target.tagName=="input"||(c=n.target.parentNode)!=null&&c.classList.contains("webrtc-volume-slider")||(o==null||o.addEventListener("mousemove",m(u,$t)),o==null||o.addEventListener("mouseup",m(u,Yt)),a))return;const s=N.getOffsetBottom(u.cameraContainer);let r=((d=u.cameraContainer)==null?void 0:d.offsetLeft)||0;u.isDragging=!0,I(u,tt,n.clientX-r),I(u,Ue,window.innerHeight-n.clientY-s),n.preventDefault(),n.stopPropagation()}),(t=u.cameraContainer)==null||t.addEventListener("touchstart",n=>{var d,f;const a=document.querySelector("#av-holder.minimized #camera-views");if(!n.touches[0])return;const o=document.querySelector("body.crlngn-ui");if((d=n.target.parentNode)!=null&&d.classList.contains("volume-bar")||(o.addEventListener("touchmove",m(u,Xt)),o.addEventListener("touchend",m(u,nt)),o.addEventListener("touchcancel",m(u,nt)),a))return;const s=n.touches[0],r=N.getOffsetBottom(u.cameraContainer);let c=((f=u.cameraContainer)==null?void 0:f.offsetLeft)||0;u.isDragging=!0,I(u,tt,s.clientX-c),I(u,Ue,window.innerHeight-s.clientY-r),n.preventDefault(),n.stopPropagation()})}static updateDockSize(){var c,d;if(!u.cameraContainer)return;const e=R(),t=u.currSettings.dockResizeOnUserJoin,n=u.currSettings.defaultVideoWidth||xn,o=(((d=(c=game.webrtc)==null?void 0:c.users)==null?void 0:d.filter(f=>f.active&&f.canBroadcastVideo))||[]).length;if(o===0)return;if(t===Oe.horizontal.name){const f=n*o+16;u.cameraContainer.style.width=`${f}px`}else if(t===Oe.vertical.name){const f=n*o+16;u.cameraContainer.style.height=`${f}px`}const s=parseInt(u.cameraContainer.style.width||0),r=parseInt(u.cameraContainer.style.height||0);s>0&&T.set(e.dockWidth.tag,s),r>0&&T.set(e.dockHeight.tag,r)}static applyDockResize(e=null){if(!u.cameraContainer)return;e?u.currSettings.dockResizeOnUserJoin=e:e=u.currSettings.dockResizeOnUserJoin,u.cameraContainer.classList.remove("horizontal"),u.cameraContainer.classList.remove("vertical");const t=u.cameraContainer.querySelector("#camera-views");t.classList.remove("horizontal"),t.classList.remove("vertical"),e===Oe.horizontal.name?u.cameraContainer.classList.add("horizontal"):e===Oe.vertical.name&&u.cameraContainer.classList.add("vertical"),u.updateDockSize()}static makeResizeable(){if(u.cameraContainer){const e=document.querySelector("body.crlngn-ui"),t=document.createElement("div"),n=u.cameraContainer.querySelector(".resize-handle");n&&n.remove(),t.classList.add("resize-handle"),u.cameraContainer.append(t),t.addEventListener("mousedown",a=>{a.preventDefault(),a.stopPropagation(),u.isResizing=!0,I(u,xt,a.clientX),I(u,Ut,a.clientY),I(u,jt,parseInt(getComputedStyle(u.cameraContainer).bottom)||0),I(u,Wt,u.cameraContainer.offsetWidth),I(u,Vt,u.cameraContainer.offsetHeight),e==null||e.addEventListener("mousemove",m(u,Jt)),e==null||e.addEventListener("mouseup",m(u,Kt))})}}static checkMinimizedState(){if(!u.cameraContainer)return;const e=game.settings.get("core","rtcClientSettings"),t=(e==null?void 0:e.hideDock)===!0;t?document.querySelector("#av-holder").classList.add("minimized"):document.querySelector("#av-holder").classList.remove("minimized"),p.log("Checking minimized state",[e,t]),u.handleMinimizedState(t)}static handleMinimizedState(e){var o;const t=document.querySelector("#interface #players #players-active"),n=u.cameraContainer.querySelector("button[data-action=toggleDock]");if(!t||!n||!u.cameraContainer)return;if(p.log("handleMinimizedState",[e]),e)u.cameraContainer.parentNode!==t&&(u.originalParent=u.cameraContainer.parentNode,t.prepend(u.cameraContainer),n.classList.remove("fa-caret-down"),n.classList.remove("fa-caret-left"),n.classList.remove("fa-caret-right"),n.classList.remove("fa-compress"),n.classList.add("fa-camera"));else{if(!u.originalParent)return;u.originalParent.prepend(u.cameraContainer),u.makeDraggable(),u.makeResizeable(),n.classList.remove("fa-caret-up"),n.classList.remove("fa-caret-left"),n.classList.remove("fa-caret-right"),n.classList.remove("fa-expand"),n.classList.add("fa-caret-down"),p.log("Restored camera position from settings",[u.currSettings])}const a=(o=u.cameraContainer)==null?void 0:o.querySelector("#camera-views");a==null||a.classList.remove("horizontal"),a==null||a.classList.remove("vertical")}};tt=new WeakMap,Ue=new WeakMap,xt=new WeakMap,Ut=new WeakMap,Wt=new WeakMap,Vt=new WeakMap,jt=new WeakMap,$t=new WeakMap,Yt=new WeakMap,Xt=new WeakMap,nt=new WeakMap,Jt=new WeakMap,Kt=new WeakMap,L(u,tt,0),L(u,Ue,0),b(u,"isDragging",!1),b(u,"cameraContainer"),b(u,"isResizing",!1),L(u,xt,0),L(u,Ut,0),L(u,Wt,0),L(u,Vt,0),L(u,jt,0),b(u,"currSettings",{}),b(u,"positionIntervalId",null),b(u,"positionAttempts",5),b(u,"useFadeOut",!0),b(u,"hidden",!1),b(u,"enableFloatingDock",!0),L(u,$t,e=>{const t=document.querySelector("#av-holder.minimized #camera-views");if(!(!u.isDragging||t)){if(p.log("mousemove",[window.innerHeight,e.clientY,m(u,Ue)]),u.cameraContainer){let n=e.clientX-m(u,tt),a=window.innerHeight-e.clientY-m(u,Ue);n+u.cameraContainer.offsetWidth>window.innerWidth&&(n=window.innerWidth-u.cameraContainer.offsetWidth),n<0&&(n=0),u.cameraContainer.style.left=`${n}px`,a+u.cameraContainer.offsetHeight>window.innerHeight&&(a=window.innerHeight-u.cameraContainer.offsetHeight),u.cameraContainer.style.bottom=`${a}px`}e.preventDefault(),e.stopPropagation()}}),L(u,Yt,e=>{var o,s;const t=R(),n={...u.currSettings},a=document.querySelector("#av-holder.minimized #camera-views");if(u.isDragging&&!a){const r=document.querySelector("body.crlngn-ui");n.dockPosX=parseInt((o=u.cameraContainer)==null?void 0:o.style.left)||0,n.dockPosY=parseInt((s=u.cameraContainer)==null?void 0:s.style.bottom)||0,n.dockPosY<=0&&(n.dockPosY=0),T.set(t.dockPosX.tag,n.dockPosX),T.set(t.dockPosY.tag,n.dockPosY),r==null||r.removeEventListener("mousemove",m(u,$t)),r==null||r.removeEventListener("mouseup",m(u,Yt)),u.isDragging=!1,e.stopPropagation()}}),L(u,Xt,e=>{if(!(!u.isDragging||!e.touches[0])){if(u.cameraContainer){const t=e.touches[0];let n=t.clientX-m(u,tt),a=window.innerHeight-t.clientY-m(u,Ue);n+u.cameraContainer.offsetWidth>window.innerWidth&&(n=window.innerWidth-u.cameraContainer.offsetWidth),n<0&&(n=0),u.cameraContainer.style.left=`${n}px`,a+u.cameraContainer.offsetHeight>window.innerHeight&&(a=window.innerHeight-u.cameraContainer.offsetHeight),u.cameraContainer.style.bottom=`${a}px`}e.preventDefault(),e.stopPropagation()}}),L(u,nt,e=>{var a,o;const t=R(),n={...u.currSettings};if(u.isDragging){const s=document.querySelector("body.crlngn-ui");n.dockPosX=parseInt((a=u.cameraContainer)==null?void 0:a.style.left)||0,n.dockPosY=parseInt((o=u.cameraContainer)==null?void 0:o.style.bottom)||0,n.dockPosY<=0&&(n.dockPosY=0),T.set(t.dockPosX.tag,n.dockPosX),T.set(t.dockPosY.tag,n.dockPosY),s==null||s.removeEventListener("touchmove",m(u,Xt)),s==null||s.removeEventListener("touchend",m(u,nt)),s==null||s.removeEventListener("touchcancel",m(u,nt)),u.isDragging=!1,e.preventDefault(),e.stopPropagation()}}),L(u,Jt,e=>{if(!u.isResizing)return;const t=m(u,Wt)+(e.clientX-m(u,xt)),n=e.clientY-m(u,Ut),a=m(u,Vt)+n,o=m(u,jt)-n;u.cameraContainer.style.width=`${t}px`,u.cameraContainer.style.height=`${a}px`,u.cameraContainer.style.bottom=`${o}px`}),L(u,Kt,()=>{var a,o,s,r,c,d,f;const e=R(),t={...u.currSettings},n=document.querySelector("body.crlngn-ui");u.isResizing=!1,n==null||n.removeEventListener("mousemove",m(u,Jt)),n==null||n.removeEventListener("mouseup",m(u,Kt)),p.log("onStopResize",[(a=u.cameraContainer)==null?void 0:a.style.width,(o=u.cameraContainer)==null?void 0:o.style.height,(s=u.cameraContainer)==null?void 0:s.style.bottom]),t.dockWidth=parseInt(((r=u.cameraContainer)==null?void 0:r.style.width)||0),t.dockHeight=parseInt(((c=u.cameraContainer)==null?void 0:c.style.height)||0),t.dockPosY=parseInt(((d=u.cameraContainer)==null?void 0:d.style.bottom)||0),t.dockPosX=parseInt(((f=u.cameraContainer)==null?void 0:f.style.left)||0),T.set(e.dockWidth.tag,t.dockWidth),T.set(e.dockHeight.tag,t.dockHeight),T.set(e.dockPosY.tag,t.dockPosY),T.set(e.dockPosX.tag,t.dockPosX)});let te=u;const U=class U{static init(){Hooks.on(A.RENDER_SIDE_BAR,U.onRender),Hooks.on(A.COLLAPSE_SIDE_BAR,U.onRender),Hooks.on(A.READY,U.onRender)}static applyFadeOut(e){U.useFadeOut=e,U.handleFadeOut()}static applyHide(e){U.hidden=e,U.handleHide()}static applyCustomStyle(e){var t;U.customStylesEnabled=e,p.log("applyCustomStyle",[U.customStylesEnabled]),(t=ui.sidebar)==null||t.render()}static onRender(e,t,n){const a=t&&typeof t===HTMLElement?t:document;a.querySelector("#roll-privacy button[data-action='toggleChat']")||U.addChatToggle(a),U.handleFadeOut(e,a,n),U.handleHide(e,a,n)}static handleFadeOut(e,t,n){p.log("handle FadeOut, ChatLogControls",[U.useFadeOut]);const a=t?t.querySelector("#chat-notifications"):document.querySelector("#ui-right #chat-notifications");U.useFadeOut?a==null||a.classList.add("faded-ui"):a==null||a.classList.remove("faded-ui")}static handleHide(e,t,n){p.log("handle Hide, ChatLogControls",[U.hidden]);const a=t?t.querySelector("#chat-notifications"):document.querySelector("#ui-right #chat-notifications");U.hidden?a==null||a.classList.add("hidden-ui"):a==null||a.classList.remove("hidden-ui")}};b(U,"useFadeOut",!0),b(U,"hidden",!1),b(U,"customStylesEnabled",!0),b(U,"addChatToggle",async e=>{if(!U.customStylesEnabled)return;const t=await N.renderTemplate(`modules/${z}/templates/chat-toggle-button.hbs`,{}),n=document.querySelector("#ui-right #roll-privacy");n.insertAdjacentHTML("afterbegin",t);const a=n.querySelector("button[data-action=toggleChat]");a.addEventListener("click",U.onToggleChatBox);const o=game.user.getFlag(z,"chatBoxHidden");if(o!==void 0){p.log("Applying saved chat box state",[o]);const s=document.querySelector("#chat-notifications");o?(a.classList.remove("fa-comment-slash"),a.classList.add("fa-comment"),s.classList.add("input-hidden"),N.addCSSVars("--chat-input-height","0px")):(a.classList.add("fa-comment-slash"),a.classList.remove("fa-comment"),s.classList.remove("input-hidden"),N.addCSSVars("--chat-input-height","100px"))}}),b(U,"onToggleChatBox",e=>{const t=document.querySelector("#ui-right button[data-action=toggleChat]"),n=document.querySelector("#chat-notifications");let a=!1;t.classList.contains("fa-comment-slash")?(t.classList.remove("fa-comment-slash"),t.classList.add("fa-comment"),n.classList.add("input-hidden"),N.addCSSVars("--chat-input-height","0px"),a=!0):(t.classList.add("fa-comment-slash"),t.classList.remove("fa-comment"),n.classList.remove("input-hidden"),N.addCSSVars("--chat-input-height","100px"),a=!1),game.user.setFlag(z,"chatBoxHidden",a),p.log("Chat box state saved to flag",[a])});let ft=U;const he=class he{static init(){const e=R();he.enableChatStyles=T.get(e.enableChatStyles.tag),he.chatBorderColor=T.get(e.chatBorderColor.tag),he.chatBorderPosition=T.get(e.chatBorderPosition.tag)}};b(he,"chatBorderColor"),b(he,"enableChatStyles"),b(he,"chatBorderPosition"),b(he,"enrichCard",async(e,t)=>{var s,r,c,d,f,g,h,C;p.log("renderChatMessage",[he.chatBorderColor,he.enableChatStyles,Ct.playerColor.name,(s=e.author)==null?void 0:s.id]);const n=((d=(c=(r=e.flags)==null?void 0:r.dnd5e)==null?void 0:c.activity)==null?void 0:d.type)||((h=(g=(f=e.flags)==null?void 0:f.dnd5e)==null?void 0:g.roll)==null?void 0:h.type)||"custom";let a=t.get?t.get(0):t;if(!a)return;switch(a.classList.add(n),a.classList.add("crlngn"),he.chatBorderPosition){case gn.left.name:a.classList.add("left-border");break;case gn.right.name:a.classList.add("right-border");break;case gn.top.name:a.classList.add("top-border");break}const o=a.querySelectorAll(".card-buttons button[data-action=rollSave]");o.length>0&&o.forEach(E=>{const O=E.querySelector(".visible-dc"),j=E.querySelector(".hidden-dc");p.log("enrichCard",[O,j]),O.setAttribute("data-ability",E.getAttribute("data-ability")||""),O.setAttribute("data-dc",E.getAttribute("data-dc")||""),j.setAttribute("data-ability",E.getAttribute("data-ability")||"")}),he.chatBorderColor===Ct.playerColor.name&&((C=e.author)!=null&&C.id)&&a.style.setProperty("border-color",`var(--user-color-${e.author.id})`)});let je=he;const H=class H{static init(){this.preloadTemplates(),Hooks.on(A.RENDER_HOTBAR,H.onRender)}static applyFadeOut(e){H.useFadeOut=e,H.handleFadeOut()}static applyHide(e){H.hidden=e,H.handleHide()}static handleHide(e,t,n){const a=t||document.querySelector("#hotbar");H.hidden?a==null||a.classList.add("hidden-ui"):a==null||a.classList.remove("hidden-ui"),p.log("handle Hide",[H.hidden])}static onRender(e,t,n){p.log("MacroHotbar onRender",[H.customStylesEnabled]),H.applyCustomStyle(H.customStylesEnabled),H.handleFadeOut(e,t,n),H.handleHide(e,t,n),H.addCollapseButton(),H.applyHotBarCollapse()}static handleCollapse(e){const t=game.user.getFlag(z,"hotbarCollapsed");H.applyHotBarCollapse(!t)}static handleOpenDirectory(e){p.log("open directory")}static handleFadeOut(e,t,n){const a=t||document.querySelector("#hotbar");H.useFadeOut?a==null||a.classList.add("faded-ui"):a==null||a.classList.remove("faded-ui")}static applyCustomStyle(e){const t=R();H.customStylesEnabled=e!==void 0?e:T.get(t.enableMacroLayout.tag),p.log("applyCustomStyle",[H.customStylesEnabled]),H.applyHotBarLayout()}static applyHotBarLayout(){const e=document.querySelector("#hotbar");e&&(H.customStylesEnabled?e.classList.add("crlngn-macro"):e.classList.remove("crlngn-macro"))}};b(H,"useFadeOut",!0),b(H,"customStylesEnabled",!0),b(H,"macroStartCollapsed",!1),b(H,"hidden",!1),b(H,"preloadTemplates",async()=>{try{const e=[`modules/${z}/templates/macro-buttons.hbs`];return await N.loadTemplates(e),!0}catch(e){return console.error("Error loading navigation button templates:",e),!1}}),b(H,"addCollapseButton",async()=>{const e=document.querySelector("#hotbar #hotbar-controls-right");if(!e)return;game.user.getFlag(z,"hotbarCollapsed");const t=await N.renderTemplate(`modules/${z}/templates/macro-buttons.hbs`,{});e.insertAdjacentHTML("beforeend",t);const n=e.querySelector("button[data-action=collapse]"),a=e.querySelector("button[data-action=openDirectory]");n==null||n.addEventListener("click",H.handleCollapse),a==null||a.addEventListener("click",H.handleOpenDirectory)}),b(H,"applyHotBarCollapse",async e=>{const t=R();H.macroStartCollapsed=e!==void 0?e:T.get(t.collapseMacroBar.tag),game.user&&await game.user.setFlag(z,"hotbarCollapsed",H.macroStartCollapsed);const n=document.querySelector("#hotbar #hotbar-controls-right"),a=n==null?void 0:n.querySelector("button[data-action=collapse]"),o=document.querySelector("#hotbar");H.macroStartCollapsed&&o?(o.classList.add("collapsed"),a&&(a.classList.remove("fa-angle-down"),a.classList.add("fa-angle-up"),a.dataset.tooltip=game.i18n.localize("CRLNGN_UI.ui.macroBarTooltipKeepOpen"))):(o==null||o.classList.remove("collapsed"),a&&(a.classList.add("fa-angle-down"),a.classList.remove("fa-angle-up"),a.dataset.tooltip=game.i18n.localize("CRLNGN_UI.ui.macroBarTooltipAutoHide")))});let Le=H;var wn;const Y=class Y{static init(){p.log("PlayersList init",[]),Hooks.on(A.RENDER_PLAYERS_LIST,Y.onRender)}static applyFadeOut(e){Y.useFadeOut=e,Y.handleFadeOut()}static applyHide(e){Y.hidden=e,Y.handleHide()}static handleHide(e,t,n){const a=t||document.querySelector("#players");Y.hidden?a==null||a.classList.add("hidden-ui"):a==null||a.classList.remove("hidden-ui"),p.log("handle Hide",[Y.hidden])}static handleFadeOut(e,t,n){const a=t||document.querySelector("#players");I(Y,wn,setTimeout(()=>{p.log("handleFadeOut - PlayersList",[a,Y.useFadeOut]),Y.useFadeOut?a==null||a.classList.add("faded-ui"):a==null||a.classList.remove("faded-ui"),Et.handleYTPlayerFadeOut()},500))}static applyCustomStyle(e){Y.customStylesEnabled=e,ui.players&&ui.players.render()}static onRender(e,t,n){p.log("PlayersList onRender",[e,t,n]),R();const a=t||document.querySelector("#players");Y.customStylesEnabled?a==null||a.classList.add("crlngn-ui"):a==null||a.classList.remove("crlngn-ui"),Y.applyPlayersListSettings(),Y.applyAvatars(),Y.handleFadeOut(e,a,n),Y.handleHide(e,a,n)}static applyPlayersListSettings(){var t,n,a,o;const e=R();p.log("applyPlayersListSettings",[T.get(e.autoHidePlayerList.tag)]),T.get(e.autoHidePlayerList.tag)?((t=document.querySelector("#players.crlngn-ui"))==null||t.classList.add("minimized"),(n=document.querySelector("body"))==null||n.classList.add("crlngn-players-minimized")):((a=document.querySelector("#players"))==null||a.classList.remove("minimized"),(o=document.querySelector("body"))==null||o.classList.remove("crlngn-players-minimized"))}static applyAvatars(){const e=R();p.log("applyAvatars",[game.users]);const t=document.querySelector("#players"),n=game.users.filter(s=>s.active===!0),a=game.users.filter(s=>s.active===!1),o=[...n,...a];T.get(e.playerListAvatars.tag)&&Y.customStylesEnabled?(t==null||t.classList.add("crlngn-avatars"),o.forEach(s=>{var g;const r=t==null?void 0:t.querySelector(`li[data-user-id='${s.id}']`),c=game.users.get(s.id),d=((g=c.character)==null?void 0:g.img)||"";p.log("player",[c]);const f=document.createElement("img");f.src=d||c.avatar||"",f.alt="*",f.classList.add("crlngn-avatar"),r&&r.prepend(f)})):((t==null?void 0:t.querySelectorAll("li.player")).forEach(r=>{const c=r.querySelector("img.crlngn-avatar");c==null||c.remove()}),t==null||t.classList.remove("crlngn-avatars"))}};wn=new WeakMap,L(Y,wn),b(Y,"useFadeOut",!0),b(Y,"customStylesEnabled",!0),b(Y,"playerListAvatars",!0),b(Y,"hidden",!1);let Se=Y;var la,Zt,ht;const oe=class oe{static init(){var a;if(N.isModuleOn("foundry-taskbar")&&Hooks.on(A.UPDATE_USER,oe.checkTaskbarLock),oe.checkTaskbarLock(),oe.addModuleClasses(),N.isModuleOn("minimal-ui")&&ui.notifications.warn(game.i18n.localize("CRLNGN_UI.ui.notifications.minimalUiNotSupported"),{permanent:!0}),Hooks.on(A.CLIENT_SETTING_CHANGED,o=>{o.includes("fvtt-youtube-player.windowPosition")&&oe.handleYTPlayerFadeOut()}),I(oe,ht,0),I(oe,Zt,setInterval(()=>{(document.querySelector("#sidebar-video-player")||m(oe,ht)>=10)&&(clearInterval(m(oe,Zt)),oe.handleYTPlayerFadeOut()),ba(oe,ht)._++},200)),N.isModuleOn("dfreds-chat-pins")){const o=document.querySelector("#chat-pins"),s=game.settings.get("core","uiConfig"),r=(a=s==null?void 0:s.colorScheme)==null?void 0:a.interface;p.log("currentTheme",[r,o]),o==null||o.classList.add(`theme-${r}`)}}static handleYTPlayerFadeOut(){var n,a;const e=N.isModuleOn("fvtt-youtube-player"),t=document.querySelector("#sidebar-video-player.tyw-docked");p.log("handleYTPlayerFadeOut",[e,Se.useFadeOut,t]),e&&t&&Se.useFadeOut?(n=document.querySelector("#sidebar-video-player.tyw-docked"))==null||n.classList.add("faded-ui"):e&&((a=document.querySelector("#sidebar-video-player"))==null||a.classList.remove("faded-ui"))}};la=new WeakMap,Zt=new WeakMap,ht=new WeakMap,L(oe,la),L(oe,Zt),L(oe,ht,0),b(oe,"addModuleClasses",()=>{const e=R(),t=T.get(e.otherModulesList.tag)||"",n=t.split(",");p.log("addModuleClasses",[n,t]),Object.entries(e.otherModulesList.options).forEach(a=>{const o=a[1].replace(/'/g,"");document.querySelector("body").classList.remove("crlngn-"+o)}),n.forEach(a=>{const o=a.replace(/'/g,"");document.querySelector("body").classList.add("crlngn-"+o)})}),b(oe,"checkTaskbarLock",()=>{var o,s,r;const e=N.isModuleOn("foundry-taskbar"),t=(o=game.user.flags)==null?void 0:o["foundry-taskbar"];if(!e||!(t!=null&&t.taskbarSettings))return;const n=game.settings.get("foundry-taskbar","reduceSidebar");p.log("checkTaskbarLock #2",[t,n]),(s=t.taskbarSettings)!=null&&s.locked?N.addCSSVars("--crlngn-margin-bottom",n?"50px":"0px"):N.addCSSVars("--crlngn-margin-bottom",n?"10px":"0px"),(r=t.taskbarSettings)!=null&&r.locked?N.addCSSVars("--crlngn-taskbar-height","50px"):N.addCSSVars("--crlngn-taskbar-height","10px"),N.addCustomCSS("body.crlngn-ui #ui-right {height: calc((100% - var(--crlngn-margin-bottom)) / var(--ui-scale));}");const a=document.querySelector("#ft-move-players-macro");a&&(a.innerHTML="")});let Et=oe;var V,Qt,at,ca,bt,ot,st,Rn,da,_t,ye,yt,it,Ee,We,De,St,en,In,tn,nn,kn,On,Mn,Dn,Fn,Pn,An;const l=class l{static applyFadeOut(e){l.useFadeOut=e,p.log("applyFadeOut",[e]),l.handleSceneFadeOut()}static applyHide(e){l.hidden=e,l.handleHide()}static handleHide(){const e=document.querySelector("#scene-navigation"),t=document.querySelector("#crlngn-scene-navigation-expand"),n=document.querySelectorAll("#ui-left-column-2 .crlngn-btn");l.hidden?(e==null||e.classList.add("hidden-ui"),t==null||t.classList.add("hidden-ui"),n.forEach(a=>{a.classList.add("hidden-ui")})):(e==null||e.classList.remove("hidden-ui"),t==null||t.classList.remove("hidden-ui"),n.forEach(a=>{a.classList.remove("hidden-ui")})),p.log("handle Hide",[l.hidden])}static applyCustomStyle(e){l.sceneNavEnabled=e,p.log("applyCustomStyle - TopNavigation",[l.sceneNavEnabled,ui.nav])}static resetLocalVars(){I(l,V,document.querySelector("#scene-navigation")),I(l,bt,document.querySelector("#crlngn-scene-navigation-expand")),I(l,ot,document.querySelector("#ui-left")),I(l,Qt,document.querySelector("#scene-navigation-inactive"))}static handleSceneFadeOut(e,t,n){const a=document.querySelector("#ui-left-column-2"),o=t||document.querySelector("#ui-left-column-2 #scene-navigation")||null;p.log("handleSceneFadeOut",[t,o,document.querySelector("#ui-left-column-2 #scene-navigation")]),l.sceneNavEnabled?(o==null||o.classList.remove("faded-ui"),l.useFadeOut?a==null||a.classList.add("faded-ui"):a==null||a.classList.remove("faded-ui")):l.useFadeOut?o==null||o.classList.add("faded-ui"):o==null||o.classList.remove("faded-ui")}static handleFolderList(e,t,n){var a;!l.useSceneFolders||!((a=game.user)!=null&&a.isGM)||_e.addFolderButtons(e,t,n)}static handleNavState(){const e=R();m(l,_t)&&(I(l,_t,!1),l.toggleNav(T.get(e.navStartCollapsed.tag)))}static updateToggleButton(e){const t=document.querySelector("#crlngn-scene-navigation-expand");if(!t)return;const n=t.querySelector("i"),a=document.querySelector("#scene-navigation");a==null||a.classList.toggle("expanded",e),n&&(n.classList.toggle("fa-caret-down",!e),n.classList.toggle("fa-caret-up",e));const o=e?"SCENE_NAVIGATION.COLLAPSE":"SCENE_NAVIGATION.EXPAND",s=game.i18n.localize(o);t.setAttribute("data-tooltip",o),t.setAttribute("aria-label",s)}static toggleNav(e){I(l,Rn,setTimeout(()=>{l.resetLocalVars(),e===!0?(ui.nav.collapse(),l.isCollapsed=!0,p.log("toggleNav collapse",[ui.nav.collapse,e,l.navStartCollapsed]),document.querySelectorAll("#ui-left .crlngn-btn").forEach(n=>n.remove()),l.updateToggleButton(!1)):e===!1&&(l.isCollapsed=!1,ui.nav.expand(),p.log("toggleNav expand",[e,l.navStartCollapsed]),l.updateToggleButton(!0))},200))}static checkSceneNavCompat(){var e;R(),document.querySelector("#ui-left"),I(this,St,N.isModuleOn("monks-scene-navigation")),p.log("checkSceneNavCompat",[m(this,St)]),l.sceneNavEnabled&&!m(this,en)&&(e=game.user)!=null&&e.isGM&&m(this,St)&&(ui.notifications.warn(game.i18n.localize("CRLNGN_UI.ui.notifications.monksScenesNotSupported"),{localize:!0,permanent:!0,console:!1}),I(this,en,!0))}static addListeners(){var e,t,n,a;(e=m(l,V))==null||e.removeEventListener("mouseenter",m(l,tn)),(t=m(l,V))==null||t.removeEventListener("mouseleave",m(l,nn)),(n=m(l,V))==null||n.addEventListener("mouseenter",m(l,tn)),(a=m(l,V))==null||a.addEventListener("mouseleave",m(l,nn))}static setNavPosition(e=null,t=!0,n=400){var a,o;try{const s=R();if(!m(l,V))return;const r=((a=m(l,V))==null?void 0:a.querySelectorAll("li.nav-item"))||[],c=0,d=e!==null?e:l.navPos||0,f=(o=m(l,V))==null?void 0:o.querySelector("li.nav-item:first-of-type");if(!f)return;const g=r[d],h=f.offsetWidth||0,C=parseInt(h)*d;p.log("setNavPosition",["position",d,C,m(l,V).scrollWidth]);const E=C-c;if(E>m(l,V).scrollWidth)return;l.navPos=d,T.set(s.sceneNavPos.tag,d),t?N.smoothScrollTo(m(l,V),E,"horizontal",n):m(l,V).scrollTo({left:E,behavior:"instant"})}catch(s){p.log("setNavPosition",["Error:",s]),console.error("Error in setNavPosition:",s)}}static loadSettings(){const e=R();l.navStartCollapsed=T.get(e.navStartCollapsed.tag),l.showNavOnHover=T.get(e.showNavOnHover.tag),l.sceneNavEnabled=T.get(e.sceneNavEnabled.tag),l.useScenePreview=T.get(e.useScenePreview.tag),l.useSceneFolders=T.get(e.useSceneFolders.tag),l.navFoldersForPlayers=T.get(e.navFoldersForPlayers.tag),l.navShowRootFolders=T.get(e.navShowRootFolders.tag),l.useSceneIcons=T.get(e.useSceneIcons.tag),l.useSceneBackButton=T.get(e.useSceneBackButton.tag),l.useSceneLookup=T.get(e.useSceneLookup.tag),l.sceneClickToView=T.get(e.sceneClickToView.tag),l.isCollapsed=l.navStartCollapsed}static refreshSettings(){l.loadSettings();const e=document.querySelector("body");l.sceneNavEnabled?e.classList.add("crlngn-scene-nav"):e.classList.remove("crlngn-scene-nav"),ui.nav&&ui.nav.render()}};V=new WeakMap,Qt=new WeakMap,at=new WeakMap,ca=new WeakMap,bt=new WeakMap,ot=new WeakMap,st=new WeakMap,Rn=new WeakMap,da=new WeakMap,_t=new WeakMap,ye=new WeakMap,yt=new WeakMap,it=new WeakMap,Ee=new WeakMap,We=new WeakMap,De=new WeakMap,St=new WeakMap,en=new WeakMap,In=new WeakMap,tn=new WeakMap,nn=new WeakMap,kn=new WeakMap,On=new WeakMap,Mn=new WeakMap,Dn=new WeakMap,Fn=new WeakMap,Pn=new WeakMap,An=new WeakMap,L(l,V),L(l,Qt),L(l,at),L(l,ca),L(l,bt),L(l,ot),b(l,"sceneFoldersTemplate"),b(l,"navButtonsTemplate"),L(l,st),L(l,Rn),L(l,da),L(l,_t,!0),L(l,ye,null),L(l,yt,null),L(l,it,""),L(l,Ee,[]),L(l,We,!1),L(l,De),L(l,St,!1),L(l,en,!1),b(l,"useFadeOut",!0),b(l,"hidden",!1),b(l,"sceneNavEnabled"),b(l,"useSceneFolders"),b(l,"navFoldersForPlayers"),b(l,"navShowRootFolders"),b(l,"hideInactiveOnFolderToggle"),b(l,"navStartCollapsed"),b(l,"showNavOnHover"),b(l,"useSceneIcons"),b(l,"useScenePreview"),b(l,"useSceneBackButton"),b(l,"useSceneLookup"),b(l,"sceneClickToView"),b(l,"isCollapsed"),b(l,"navPos"),b(l,"init",()=>{R(),Hooks.on(A.RENDER_SCENE_NAV,l.onRender),l.loadSettings(),p.log("SCENE NAV INIT",[l.sceneNavEnabled]);const e=document.querySelector("body");l.sceneNavEnabled?e.classList.add("crlngn-scene-nav"):e.classList.remove("crlngn-scene-nav"),l.sceneNavEnabled&&(l.checkSceneNavCompat(),l.preloadTemplates(),_e.init(),Hooks.on(A.READY,()=>{l.handleSceneFadeOut(),N.isModuleOn("forien-quest-log")&&Hooks.on("questTrackerBoundaries",t=>t.top=42)}),Hooks.on(A.COLLAPSE_SIDE_BAR,t=>{p.log(A.COLLAPSE_SIDE_BAR,[t]),l.checkSideBar(t.expanded||!1),l.placeNavButtons()}),Hooks.on(A.COLLAPSE_SCENE_NAV,(t,n)=>{clearTimeout(m(l,st)),l.isCollapsed=n,n&&document.querySelectorAll("#ui-left .crlngn-btn").forEach(o=>o.remove()),I(l,st,setTimeout(()=>{l.setCollapsedClass(n),l.updateToggleButton(!n)},250))}),l.placeNavButtons()),Hooks.on(A.CREATE_SCENE,()=>{var t;(t=ui.nav)==null||t.render()}),Hooks.on(A.UPDATE_SCENE,()=>{if(m(l,We)){I(l,We,!1);return}p.log(A.UPDATE_SCENE,[m(l,We)])}),Hooks.on(A.DELETE_SCENE,()=>{var t;(t=ui.nav)==null||t.render()}),Hooks.on(A.CANVAS_INIT,()=>{var n,a;const t=(a=(n=game.scenes)==null?void 0:n.viewed)==null?void 0:a.id;t!==m(l,Ee)[m(l,Ee).length-1]&&m(l,Ee).push(t),l.handleSceneFadeOut()}),Hooks.on(A.RENDER_SCENE_DIRECTORY,t=>{p.log(A.RENDER_SCENE_DIRECTORY,[t]),document.querySelector("#scenes .directory-list").querySelectorAll(".directory-item.scene").forEach(o=>{var r,c;const s=game.scenes.get(o.dataset.entryId);if(l.sceneClickToView&&(o.addEventListener("dblclick",l.onActivateScene),o.addEventListener("click",l.onSelectScene)),l.useSceneIcons&&s&&((r=game.user)!=null&&r.isGM)){let d=document.createElement("i");d.classList.add("fas"),d.classList.add("icon"),s.ownership.default!==0?(s.active&&(d.classList.add("fa-bullseye"),o.prepend(d)),((c=game.scenes.current)==null?void 0:c.id)===s.id&&(d.classList.add("fa-star"),o.prepend(d))):(d.classList.add("fa-eye-slash"),o.prepend(d))}})})}),b(l,"onRender",(e,t,n)=>{const a=R(),o=T.get(a.sceneNavPos.tag);if(l.preventNavRender)return;p.log("onRender - "+A.RENDER_SCENE_NAV,[t]),l.checkSceneNavCompat(),l.resetLocalVars(),l.sceneNavEnabled?(l.handleExtraButtons(e,t,n),l.handleSceneList(e,t,n),l.handleFolderList(e,t,n),l.setNavPosition(o,!1),l.handleNavState(),l.addListeners(),l.addSceneListeners(t),N.addCSSVars("--region-legend-offset","calc(-100vw + 500px)")):N.addCSSVars("--region-legend-offset","0px"),l.resetLocalVars(),l.sceneNavEnabled&&l.navShowRootFolders&&game.user.isGM&&(_e.init(),_e.renderFolderList()),l.sceneNavEnabled&&(clearTimeout(m(l,st)),I(l,st,setTimeout(()=>{p.log("NAV no transition remove"),l.placeNavButtons()},500)));const s=T.get(a.navShowRootFolders.tag),r=T.get(a.hideInactiveOnFolderToggle.tag),c=t.querySelectorAll("#scene-navigation-inactive .scene");p.log("hideInactiveOnToggle",[s,r,c]),r&&s?c.forEach(d=>d.classList.add("hidden")):r&&c.forEach(d=>d.classList.remove("hidden")),l.handleSceneFadeOut(e,t,n)}),b(l,"setCollapsedClass",e=>{const t=document.querySelector("body");e?(m(l,ot).classList.add("navigation-collapsed"),t.classList.add("navigation-collapsed"),N.isModuleOn("forien-quest-log")&&Hooks.on("questTrackerBoundaries",n=>n.top=10)):(m(l,ot).classList.remove("navigation-collapsed"),t.classList.remove("navigation-collapsed"),l.placeNavButtons(),N.isModuleOn("forien-quest-log")&&Hooks.on("questTrackerBoundaries",n=>n.top=42))}),b(l,"checkSideBar",(e=!1)=>{l.placeNavButtons();const t=document.querySelector("body");p.log("TopNavigation.checkSideBar",[ui.sidebar,e],!0),e?t.classList.add("crlngn-sidebar-expanded"):t.classList.remove("crlngn-sidebar-expanded")}),b(l,"handleSceneList",async(e,t,n)=>{var o,s,r,c;p.log("handleSceneList",[e,t,n,l.useScenePreview,(o=game.user)==null?void 0:o.isGM]);const a=t.querySelectorAll(".scene-navigation-menu li.scene");for(const d of a){const f=d.dataset.sceneId;if(l.useScenePreview&&((s=game.user)!=null&&s.isGM)){const g=game.scenes.find(C=>C.id===f);g.isGM=(r=game.user)==null?void 0:r.isGM;const h=await N.renderTemplate(`modules/${z}/templates/scene-nav-preview.hbs`,g);if(d.classList.add("nav-item"),d.insertAdjacentHTML("beforeend",h),g.isGM&&m(l,it)===f){const C=new MouseEvent("mouseenter");d.dispatchEvent(C)}l.addPreviewIconListeners(d,g)}l.useSceneIcons&&d.classList.add("crlngn")}if(l.sceneNavEnabled){const d=document.querySelector("#ui-left-column-2"),f=document.querySelector("#crlngn-scene-navigation-expand");if(!d)return;f&&f.remove();const g=await N.renderTemplate(`modules/${z}/templates/scene-nav-toggle.hbs`,{isExpanded:((c=ui.nav)==null?void 0:c.expanded)||!1});d.insertAdjacentHTML("afterbegin",g);const h=document.querySelector("#crlngn-scene-navigation-expand");h&&h.addEventListener("click",C=>{C.preventDefault(),C.stopPropagation(),ui.nav&&(p.log("Toggle nav clicked",["expanded:",ui.nav.expanded]),l.toggleNav(ui.nav.expanded))}),l.handleHide()}}),b(l,"handleExtraButtons",async(e,t,n)=>{var s,r,c,d,f;R(),p.log("handleExtraButtons",[e,t,n]);const a=await N.renderTemplate(`modules/${z}/templates/scene-nav-extra-buttons.hbs`,{useSceneBackButton:l.useSceneBackButton,useSceneFolders:(s=game.user)!=null&&s.isGM?l.useSceneFolders:!1,useSceneLookup:(r=game.user)!=null&&r.isGM?l.useSceneLookup:!1,backButtonTooltip:game.i18n.localize("CRLNGN_UI.ui.sceneNav.backButtonTooltip"),sceneLookupTooltip:game.i18n.localize("CRLNGN_UI.ui.sceneNav.sceneLookupTooltip"),isGM:(c=game.user)==null?void 0:c.isGM});(d=t.querySelector("#scene-navigation-active"))==null||d.insertAdjacentHTML("afterbegin",a);const o=t.querySelector("#crlngn-back-button");o&&o.addEventListener("click",m(l,In)),l.sceneNavEnabled&&l.useSceneLookup&&((f=game.user)!=null&&f.isGM)&&_e.handleFolderLookup(e,t,n)}),L(l,In,e=>{var o;e.stopPropagation(),e.preventDefault();const t=m(l,Ee).length,n=m(l,Ee)[t-2];let a;p.log("#onBackButton before",[t,n,m(l,Ee)]),n&&n!==((o=game.scenes.current)==null?void 0:o.id)&&(a=game.scenes.get(n),a&&a.view(),m(l,Ee).pop()),p.log("#onBackButton after",[m(l,Ee)])}),L(l,tn,e=>{if(p.log("TopNavigation mouseenter",[]),!l.isCollapsed||!l.showNavOnHover)return;e.stopPropagation(),clearTimeout(m(l,at)),document.querySelector("#scene-navigation").classList.add("expanded")}),L(l,nn,e=>{p.log("TopNavigation mouseleave",[]),!(!l.isCollapsed||!l.showNavOnHover)&&(e.stopPropagation(),I(l,at,setTimeout(()=>{clearTimeout(m(l,at)),I(l,at,null),document.querySelector("#scene-navigation").classList.remove("expanded")},700)))}),b(l,"placeNavButtons",async()=>{var c;const e=document.querySelector("#scene-navigation");if(!e||!l.sceneNavEnabled)return;e.querySelector("#scene-navigation-inactive");let t=document.querySelectorAll("button.crlngn-btn");const n=((c=m(l,bt))==null?void 0:c.offsetWidth)*2||0,a=e.offsetWidth-n<e.scrollWidth;if(p.log("placeNavButtons *",[l.isCollapsed,a,t]),!a||l.isCollapsed||m(l,ot).classList.contains("navigation-collapsed")){t.forEach(d=>{p.log("placeNavButtons remove",[d.remove,d]),d.remove()}),t=[];return}if(t.length>0)return;const o=await N.renderTemplate(`modules/${z}/templates/scene-nav-buttons.hbs`,{});e.insertAdjacentHTML("afterend",o);const s=document.querySelector("#ui-left button.crlngn-btn.ui-nav-left"),r=document.querySelector("#ui-left button.crlngn-btn.ui-nav-right");s&&s.addEventListener("click",m(l,kn)),r&&r.addEventListener("click",m(l,On)),l.handleHide()}),L(l,kn,async e=>{const t=await l.getItemsPerPage(),n=l.navPos||0;if(!m(l,Qt)||!m(l,V))return;let a=n-(t-1);p.log("onNavLast",["pos",a,m(l,V).scrollWidth]),a=a<0?0:a,l.setNavPosition(a)}),L(l,On,async e=>{var d,f;const t=await l.getItemsPerPage(),n=l.navPos||0,a=(d=m(l,V))==null?void 0:d.querySelector("li.nav-item:first-of-type"),o=(a==null?void 0:a.offsetWidth)||0,s=((f=m(l,V))==null?void 0:f.scrollWidth)||0;if(!o||!m(l,V))return;let r=n+(t-1),c=r*o;p.log("onNavNext",["pos",n,r,a==null?void 0:a.offsetWidth,c,s]),c>=s&&(r=Math.floor(s/o)),l.setNavPosition(r)}),b(l,"getItemsPerPage",async()=>{var e,t;try{p.log("getItemsPerPage",["Starting"]),l.resetLocalVars();const n=0,a=0,o=((e=m(l,bt))==null?void 0:e.offsetWidth)||0,s=(t=m(l,V))==null?void 0:t.querySelector("li.nav-item:first-of-type");if(!s||!m(l,V))return p.log("getItemsPerPage",["No scene items found"]),0;const r=s.offsetWidth,c=m(l,V).offsetWidth;if(!c)return p.log("getItemsPerPage",["Nav element has no width"]),0;const d=Math.floor((c-o*2)/r);return p.log("getItemsPerPage",["Calculated:",d,c,r]),d||0}catch(n){return p.log("getItemsPerPage",["Error:",n]),p.error("Error in getItemsPerPage:",n),0}}),b(l,"preloadTemplates",async()=>{try{const e=[`modules/${z}/templates/scene-nav-buttons.hbs`,`modules/${z}/templates/scene-nav-preview.hbs`,`modules/${z}/templates/scene-nav-toggle.hbs`];return await N.loadTemplates(e),!0}catch(e){return console.error("Error loading navigation button templates:",e),!1}}),b(l,"getCurrScenePosition",async e=>{try{if(!m(l,V)||!e)return 0;const t=await l.getItemsPerPage()||1,n=m(l,V).querySelectorAll("li.nav-item");if(!n||n.length===0)return 0;const o=Array.from(n).findIndex(c=>c.dataset.sceneId===e);if(o===-1)return 0;const s=o>=l.navPos&&o<=l.navPos+t,r=s?l.navPos:o;return p.log("getCurrScenePosition",["Final position:",r,"isVisible:",s]),r}catch(t){return p.log("getCurrScenePosition",["Error:",t]),console.error("Error in getCurrScenePosition:",t),0}}),b(l,"onActivateScene",e=>{e.stopPropagation(),e.preventDefault();const t=e.currentTarget,a=t.classList.contains("scene-name")?t.parentNode.dataset:t.dataset,o=game.scenes.get(a.entryId||a.sceneId);p.log("onActivateScene",[a,o]),o.activate(),o.sheet.render=m(l,De),m(l,ye)&&(clearTimeout(m(l,ye)),I(l,ye,null))}),b(l,"onSelectScene",e=>{var s;e.preventDefault(),e.stopPropagation();const t=e.currentTarget,n=t.classList.contains("scene-name"),a=n?t.parentNode.dataset:t.dataset,o=game.scenes.get(a.entryId||a.sceneId);I(l,it,""),p.log("onSelectScene",[o,t,n]),o&&o.sheet&&!m(l,ye)&&(I(l,De,(s=o==null?void 0:o.sheet)==null?void 0:s.render),p.log("onSelectScene - originalRender",[m(l,De)]),o.sheet.render=()=>{},setTimeout(()=>{o.sheet.render=m(l,De)},500)),m(l,ye)&&(clearTimeout(m(l,ye)),o.sheet.render=m(l,De),I(l,ye,null)),I(l,ye,setTimeout(()=>{o.view(),o.sheet.render=m(l,De),I(l,ye,null)},350))}),b(l,"onScenePreviewOn",e=>{if(p.log("onScenePreviewOn",[]),e.preventDefault(),l.isCollapsed)return;const t=e.currentTarget,n=t.dataset;I(l,it,n.sceneId),I(l,yt,setTimeout(()=>{var a;clearTimeout(m(l,yt)),(a=t.querySelector(".scene-preview"))==null||a.classList.add("open")},200))}),b(l,"onScenePreviewOff",e=>{var n;if(p.log("onScenePreviewOff",[]),e.preventDefault(),clearTimeout(m(l,yt)),l.isCollapsed)return;const t=e.currentTarget;I(l,it,""),(n=t.querySelector(".scene-preview"))==null||n.classList.remove("open")}),b(l,"addSceneListeners",e=>{e.querySelectorAll("li.scene").forEach(n=>{var a;if(n.querySelector(".scene-name").addEventListener("click",l.onSelectScene),n.querySelector(".scene-name").addEventListener("dblclick",l.onActivateScene),n.removeEventListener("mouseenter",l.onScenePreviewOn),n.removeEventListener("mouseleave",l.onScenePreviewOff),l.useScenePreview){const o=n.dataset.sceneId,s=game.scenes.find(r=>r.id===o);(a=game.user)!=null&&a.isGM&&l.addPreviewIconListeners(n,s),n.addEventListener("mouseenter",l.onScenePreviewOn),n.addEventListener("mouseleave",l.onScenePreviewOff)}})}),b(l,"addPreviewIconListeners",(e,t)=>{if(!e||!t)return;const n=game.scenes.get(t.id);if(!n)return;const a=e.querySelector(".scene-preview");if(!a)return;const o=a.querySelector(".ilum");o&&o.addEventListener("click",m(l,Pn));const s=a.querySelector(".token-vision");s&&s.addEventListener("click",m(l,An));const r=a.querySelector(".sound");r&&n.playlistSound&&r.addEventListener("click",m(l,Fn));const c=a.querySelector(".preload");c&&c.addEventListener("click",m(l,Dn));const d=a.querySelector(".config");d&&d.addEventListener("click",m(l,Mn))}),L(l,Mn,e=>{e.stopPropagation(),e.preventDefault();const t=e.currentTarget.closest("li.scene");l.getSceneFromElement(t).sheet.render(!0),p.log("Opened scene configuration")}),L(l,Dn,e=>{e.stopPropagation(),e.preventDefault();const t=e.currentTarget.closest("li.scene"),n=l.getSceneFromElement(t);game.scenes.preload(n.id,!0),p.log("Preloaded scene")}),L(l,Fn,async e=>{e.stopPropagation(),e.preventDefault();const t=e.currentTarget.closest("li.scene");let n=l.getSceneFromElement(t);const a=n.playlistSound;if(a){const o=a.sound.playing;o?a.sound.pause():a.sound.play(),await l.updateScenePreview(t,n.id),p.log("Toggled playlist sound",[!o])}}),L(l,Pn,async e=>{e.stopPropagation(),e.preventDefault();const t=e.currentTarget.closest("li.scene");let n=l.getSceneFromElement(t);const a=n.environment.globalLight.enabled;I(l,We,!0),await n.update({"environment.globalLight.enabled":!a}),await l.updateScenePreview(t,n.id),p.log("Toggled global illumination",[!a])}),L(l,An,async e=>{e.stopPropagation(),e.preventDefault();const t=e.currentTarget.closest("li.scene");let n=l.getSceneFromElement(t);const a=n.tokenVision;I(l,We,!0),await n.update({tokenVision:!a}),await l.updateScenePreview(t,n.id),p.log("Toggled token vision",[!a])}),b(l,"getSceneFromElement",e=>{const t=e.dataset.sceneId;return game.scenes.get(t)}),b(l,"updateScenePreview",async(e,t)=>{var d,f,g,h;if(!l.sceneNavEnabled||!e||!t)return;const n=game.scenes.get(t);if(!n)return;const a=e.querySelector(".scene-preview");if(!a)return;const o=a.classList.contains("open");p.log("Scene data for preview",[t,(f=(d=n.environment)==null?void 0:d.globalLight)==null?void 0:f.enabled,n.tokenVision]);const s={id:n.id,name:n.name,thumb:n.thumb||"",environment:n.environment,tokenVision:n.tokenVision,isGM:(g=game.user)==null?void 0:g.isGM},r=await N.renderTemplate(`modules/${z}/templates/scene-nav-preview.hbs`,s);a.outerHTML=r;const c=e.querySelector(".scene-preview");o&&c&&c.classList.add("open"),l.sceneNavEnabled&&l.useScenePreview&&(e.removeEventListener("mouseenter",l.onScenePreviewOn),e.removeEventListener("mouseleave",l.onScenePreviewOff),e.addEventListener("mouseenter",l.onScenePreviewOn),e.addEventListener("mouseleave",l.onScenePreviewOff),(h=game.user)!=null&&h.isGM&&l.addPreviewIconListeners(e,s))}),b(l,"applySceneItemWidth",()=>{const e=R(),t=T.get(e.sceneItemWidth.tag)||150;N.addCSSVars("--scene-nav-item-width",`${t}px`)}),b(l,"applyTopNavHeight",()=>{const e=R(),t=T.get(e.sceneNavEnabled.tag);N.addCSSVars("--top-nav-height",`${t?"calc(var(--control-item-size) + 1px)":"0px"}`)});let P=l;/**!
 * Sortable 1.15.6
 * @author	RubaXa   <trash@rubaxa.org>
 * @author	owenm    <owen23355@gmail.com>
 * @license MIT
 */function Sa(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(i);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(i,a).enumerable})),t.push.apply(t,n)}return t}function Re(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Sa(Object(t),!0).forEach(function(n){ro(i,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):Sa(Object(t)).forEach(function(n){Object.defineProperty(i,n,Object.getOwnPropertyDescriptor(t,n))})}return i}function fn(i){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?fn=function(e){return typeof e}:fn=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},fn(i)}function ro(i,e,t){return e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function Pe(){return Pe=Object.assign||function(i){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(i[n]=t[n])}return i},Pe.apply(this,arguments)}function lo(i,e){if(i==null)return{};var t={},n=Object.keys(i),a,o;for(o=0;o<n.length;o++)a=n[o],!(e.indexOf(a)>=0)&&(t[a]=i[a]);return t}function co(i,e){if(i==null)return{};var t=lo(i,e),n,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(i);for(a=0;a<o.length;a++)n=o[a],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(i,n)&&(t[n]=i[n])}return t}var uo="1.15.6";function Fe(i){if(typeof window<"u"&&window.navigator)return!!navigator.userAgent.match(i)}var Ae=Fe(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),an=Fe(/Edge/i),va=Fe(/firefox/i),Ft=Fe(/safari/i)&&!Fe(/chrome/i)&&!Fe(/android/i),ua=Fe(/iP(ad|od|hone)/i),Aa=Fe(/chrome/i)&&Fe(/android/i),Ga={capture:!1,passive:!1};function B(i,e,t){i.addEventListener(e,t,!Ae&&Ga)}function q(i,e,t){i.removeEventListener(e,t,!Ae&&Ga)}function Sn(i,e){if(e){if(e[0]===">"&&(e=e.substring(1)),i)try{if(i.matches)return i.matches(e);if(i.msMatchesSelector)return i.msMatchesSelector(e);if(i.webkitMatchesSelector)return i.webkitMatchesSelector(e)}catch{return!1}return!1}}function za(i){return i.host&&i!==document&&i.host.nodeType?i.host:i.parentNode}function Te(i,e,t,n){if(i){t=t||document;do{if(e!=null&&(e[0]===">"?i.parentNode===t&&Sn(i,e):Sn(i,e))||n&&i===t)return i;if(i===t)break}while(i=za(i))}return null}var Ca=/\s+/g;function pe(i,e,t){if(i&&e)if(i.classList)i.classList[t?"add":"remove"](e);else{var n=(" "+i.className+" ").replace(Ca," ").replace(" "+e+" "," ");i.className=(n+(t?" "+e:"")).replace(Ca," ")}}function M(i,e,t){var n=i&&i.style;if(n){if(t===void 0)return document.defaultView&&document.defaultView.getComputedStyle?t=document.defaultView.getComputedStyle(i,""):i.currentStyle&&(t=i.currentStyle),e===void 0?t:t[e];!(e in n)&&e.indexOf("webkit")===-1&&(e="-webkit-"+e),n[e]=t+(typeof t=="string"?"":"px")}}function pt(i,e){var t="";if(typeof i=="string")t=i;else do{var n=M(i,"transform");n&&n!=="none"&&(t=n+" "+t)}while(!e&&(i=i.parentNode));var a=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return a&&new a(t)}function qa(i,e,t){if(i){var n=i.getElementsByTagName(e),a=0,o=n.length;if(t)for(;a<o;a++)t(n[a],a);return n}return[]}function we(){var i=document.scrollingElement;return i||document.documentElement}function Q(i,e,t,n,a){if(!(!i.getBoundingClientRect&&i!==window)){var o,s,r,c,d,f,g;if(i!==window&&i.parentNode&&i!==we()?(o=i.getBoundingClientRect(),s=o.top,r=o.left,c=o.bottom,d=o.right,f=o.height,g=o.width):(s=0,r=0,c=window.innerHeight,d=window.innerWidth,f=window.innerHeight,g=window.innerWidth),(e||t)&&i!==window&&(a=a||i.parentNode,!Ae))do if(a&&a.getBoundingClientRect&&(M(a,"transform")!=="none"||t&&M(a,"position")!=="static")){var h=a.getBoundingClientRect();s-=h.top+parseInt(M(a,"border-top-width")),r-=h.left+parseInt(M(a,"border-left-width")),c=s+o.height,d=r+o.width;break}while(a=a.parentNode);if(n&&i!==window){var C=pt(a||i),E=C&&C.a,O=C&&C.d;C&&(s/=O,r/=E,g/=E,f/=O,c=s+f,d=r+g)}return{top:s,left:r,bottom:c,right:d,width:g,height:f}}}function Ea(i,e,t){for(var n=$e(i,!0),a=Q(i)[e];n;){var o=Q(n)[t],s=void 0;if(s=a>=o,!s)return n;if(n===we())break;n=$e(n,!1)}return!1}function Tt(i,e,t,n){for(var a=0,o=0,s=i.children;o<s.length;){if(s[o].style.display!=="none"&&s[o]!==D.ghost&&(n||s[o]!==D.dragged)&&Te(s[o],t.draggable,i,!1)){if(a===e)return s[o];a++}o++}return null}function ga(i,e){for(var t=i.lastElementChild;t&&(t===D.ghost||M(t,"display")==="none"||e&&!Sn(t,e));)t=t.previousElementSibling;return t||null}function be(i,e){var t=0;if(!i||!i.parentNode)return-1;for(;i=i.previousElementSibling;)i.nodeName.toUpperCase()!=="TEMPLATE"&&i!==D.clone&&(!e||Sn(i,e))&&t++;return t}function Ta(i){var e=0,t=0,n=we();if(i)do{var a=pt(i),o=a.a,s=a.d;e+=i.scrollLeft*o,t+=i.scrollTop*s}while(i!==n&&(i=i.parentNode));return[e,t]}function go(i,e){for(var t in i)if(i.hasOwnProperty(t)){for(var n in e)if(e.hasOwnProperty(n)&&e[n]===i[t][n])return Number(t)}return-1}function $e(i,e){if(!i||!i.getBoundingClientRect)return we();var t=i,n=!1;do if(t.clientWidth<t.scrollWidth||t.clientHeight<t.scrollHeight){var a=M(t);if(t.clientWidth<t.scrollWidth&&(a.overflowX=="auto"||a.overflowX=="scroll")||t.clientHeight<t.scrollHeight&&(a.overflowY=="auto"||a.overflowY=="scroll")){if(!t.getBoundingClientRect||t===document.body)return we();if(n||e)return t;n=!0}}while(t=t.parentNode);return we()}function fo(i,e){if(i&&e)for(var t in e)e.hasOwnProperty(t)&&(i[t]=e[t]);return i}function Un(i,e){return Math.round(i.top)===Math.round(e.top)&&Math.round(i.left)===Math.round(e.left)&&Math.round(i.height)===Math.round(e.height)&&Math.round(i.width)===Math.round(e.width)}var Pt;function Ba(i,e){return function(){if(!Pt){var t=arguments,n=this;t.length===1?i.call(n,t[0]):i.apply(n,t),Pt=setTimeout(function(){Pt=void 0},e)}}}function po(){clearTimeout(Pt),Pt=void 0}function Ha(i,e,t){i.scrollLeft+=e,i.scrollTop+=t}function xa(i){var e=window.Polymer,t=window.jQuery||window.Zepto;return e&&e.dom?e.dom(i).cloneNode(!0):t?t(i).clone(!0)[0]:i.cloneNode(!0)}function Ua(i,e,t){var n={};return Array.from(i.children).forEach(function(a){var o,s,r,c;if(!(!Te(a,e.draggable,i,!1)||a.animated||a===t)){var d=Q(a);n.left=Math.min((o=n.left)!==null&&o!==void 0?o:1/0,d.left),n.top=Math.min((s=n.top)!==null&&s!==void 0?s:1/0,d.top),n.right=Math.max((r=n.right)!==null&&r!==void 0?r:-1/0,d.right),n.bottom=Math.max((c=n.bottom)!==null&&c!==void 0?c:-1/0,d.bottom)}}),n.width=n.right-n.left,n.height=n.bottom-n.top,n.x=n.left,n.y=n.top,n}var de="Sortable"+new Date().getTime();function mo(){var i=[],e;return{captureAnimationState:function(){if(i=[],!!this.options.animation){var n=[].slice.call(this.el.children);n.forEach(function(a){if(!(M(a,"display")==="none"||a===D.ghost)){i.push({target:a,rect:Q(a)});var o=Re({},i[i.length-1].rect);if(a.thisAnimationDuration){var s=pt(a,!0);s&&(o.top-=s.f,o.left-=s.e)}a.fromRect=o}})}},addAnimationState:function(n){i.push(n)},removeAnimationState:function(n){i.splice(go(i,{target:n}),1)},animateAll:function(n){var a=this;if(!this.options.animation){clearTimeout(e),typeof n=="function"&&n();return}var o=!1,s=0;i.forEach(function(r){var c=0,d=r.target,f=d.fromRect,g=Q(d),h=d.prevFromRect,C=d.prevToRect,E=r.rect,O=pt(d,!0);O&&(g.top-=O.f,g.left-=O.e),d.toRect=g,d.thisAnimationDuration&&Un(h,g)&&!Un(f,g)&&(E.top-g.top)/(E.left-g.left)===(f.top-g.top)/(f.left-g.left)&&(c=bo(E,h,C,a.options)),Un(g,f)||(d.prevFromRect=f,d.prevToRect=g,c||(c=a.options.animation),a.animate(d,E,g,c)),c&&(o=!0,s=Math.max(s,c),clearTimeout(d.animationResetTimer),d.animationResetTimer=setTimeout(function(){d.animationTime=0,d.prevFromRect=null,d.fromRect=null,d.prevToRect=null,d.thisAnimationDuration=null},c),d.thisAnimationDuration=c)}),clearTimeout(e),o?e=setTimeout(function(){typeof n=="function"&&n()},s):typeof n=="function"&&n(),i=[]},animate:function(n,a,o,s){if(s){M(n,"transition",""),M(n,"transform","");var r=pt(this.el),c=r&&r.a,d=r&&r.d,f=(a.left-o.left)/(c||1),g=(a.top-o.top)/(d||1);n.animatingX=!!f,n.animatingY=!!g,M(n,"transform","translate3d("+f+"px,"+g+"px,0)"),this.forRepaintDummy=ho(n),M(n,"transition","transform "+s+"ms"+(this.options.easing?" "+this.options.easing:"")),M(n,"transform","translate3d(0,0,0)"),typeof n.animated=="number"&&clearTimeout(n.animated),n.animated=setTimeout(function(){M(n,"transition",""),M(n,"transform",""),n.animated=!1,n.animatingX=!1,n.animatingY=!1},s)}}}}function ho(i){return i.offsetWidth}function bo(i,e,t,n){return Math.sqrt(Math.pow(e.top-i.top,2)+Math.pow(e.left-i.left,2))/Math.sqrt(Math.pow(e.top-t.top,2)+Math.pow(e.left-t.left,2))*n.animation}var rt=[],Wn={initializeByDefault:!0},on={mount:function(e){for(var t in Wn)Wn.hasOwnProperty(t)&&!(t in e)&&(e[t]=Wn[t]);rt.forEach(function(n){if(n.pluginName===e.pluginName)throw"Sortable: Cannot mount plugin ".concat(e.pluginName," more than once")}),rt.push(e)},pluginEvent:function(e,t,n){var a=this;this.eventCanceled=!1,n.cancel=function(){a.eventCanceled=!0};var o=e+"Global";rt.forEach(function(s){t[s.pluginName]&&(t[s.pluginName][o]&&t[s.pluginName][o](Re({sortable:t},n)),t.options[s.pluginName]&&t[s.pluginName][e]&&t[s.pluginName][e](Re({sortable:t},n)))})},initializePlugins:function(e,t,n,a){rt.forEach(function(r){var c=r.pluginName;if(!(!e.options[c]&&!r.initializeByDefault)){var d=new r(e,t,e.options);d.sortable=e,d.options=e.options,e[c]=d,Pe(n,d.defaults)}});for(var o in e.options)if(e.options.hasOwnProperty(o)){var s=this.modifyOption(e,o,e.options[o]);typeof s<"u"&&(e.options[o]=s)}},getEventProperties:function(e,t){var n={};return rt.forEach(function(a){typeof a.eventProperties=="function"&&Pe(n,a.eventProperties.call(t[a.pluginName],e))}),n},modifyOption:function(e,t,n){var a;return rt.forEach(function(o){e[o.pluginName]&&o.optionListeners&&typeof o.optionListeners[t]=="function"&&(a=o.optionListeners[t].call(e[o.pluginName],n))}),a}};function yo(i){var e=i.sortable,t=i.rootEl,n=i.name,a=i.targetEl,o=i.cloneEl,s=i.toEl,r=i.fromEl,c=i.oldIndex,d=i.newIndex,f=i.oldDraggableIndex,g=i.newDraggableIndex,h=i.originalEvent,C=i.putSortable,E=i.extraEventProperties;if(e=e||t&&t[de],!!e){var O,j=e.options,ne="on"+n.charAt(0).toUpperCase()+n.substr(1);window.CustomEvent&&!Ae&&!an?O=new CustomEvent(n,{bubbles:!0,cancelable:!0}):(O=document.createEvent("Event"),O.initEvent(n,!0,!0)),O.to=s||t,O.from=r||t,O.item=a||t,O.clone=o,O.oldIndex=c,O.newIndex=d,O.oldDraggableIndex=f,O.newDraggableIndex=g,O.originalEvent=h,O.pullMode=C?C.lastPutMode:void 0;var re=Re(Re({},E),on.getEventProperties(n,e));for(var ve in re)O[ve]=re[ve];t&&t.dispatchEvent(O),j[ne]&&j[ne].call(e,O)}}var So=["evt"],ce=function(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},a=n.evt,o=co(n,So);on.pluginEvent.bind(D)(e,t,Re({dragEl:v,parentEl:J,ghostEl:F,rootEl:$,nextEl:Qe,lastDownEl:pn,cloneEl:X,cloneHidden:He,dragStarted:Ot,putSortable:ae,activeSortable:D.active,originalEvent:a,oldIndex:dt,oldDraggableIndex:At,newIndex:me,newDraggableIndex:qe,hideGhostForTarget:$a,unhideGhostForTarget:Ya,cloneNowHidden:function(){He=!0},cloneNowShown:function(){He=!1},dispatchSortableEvent:function(r){le({sortable:t,name:r,originalEvent:a})}},o))};function le(i){yo(Re({putSortable:ae,cloneEl:X,targetEl:v,rootEl:$,oldIndex:dt,oldDraggableIndex:At,newIndex:me,newDraggableIndex:qe},i))}var v,J,F,$,Qe,pn,X,He,dt,me,At,qe,ln,ae,ct=!1,vn=!1,Cn=[],Ke,Ce,Vn,jn,Na,La,Ot,lt,Gt,zt=!1,cn=!1,mn,se,$n=[],ta=!1,En=[],Bn=typeof document<"u",dn=ua,wa=an||Ae?"cssFloat":"float",vo=Bn&&!Aa&&!ua&&"draggable"in document.createElement("div"),Wa=function(){if(Bn){if(Ae)return!1;var i=document.createElement("x");return i.style.cssText="pointer-events:auto",i.style.pointerEvents==="auto"}}(),Va=function(e,t){var n=M(e),a=parseInt(n.width)-parseInt(n.paddingLeft)-parseInt(n.paddingRight)-parseInt(n.borderLeftWidth)-parseInt(n.borderRightWidth),o=Tt(e,0,t),s=Tt(e,1,t),r=o&&M(o),c=s&&M(s),d=r&&parseInt(r.marginLeft)+parseInt(r.marginRight)+Q(o).width,f=c&&parseInt(c.marginLeft)+parseInt(c.marginRight)+Q(s).width;if(n.display==="flex")return n.flexDirection==="column"||n.flexDirection==="column-reverse"?"vertical":"horizontal";if(n.display==="grid")return n.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(o&&r.float&&r.float!=="none"){var g=r.float==="left"?"left":"right";return s&&(c.clear==="both"||c.clear===g)?"vertical":"horizontal"}return o&&(r.display==="block"||r.display==="flex"||r.display==="table"||r.display==="grid"||d>=a&&n[wa]==="none"||s&&n[wa]==="none"&&d+f>a)?"vertical":"horizontal"},Co=function(e,t,n){var a=n?e.left:e.top,o=n?e.right:e.bottom,s=n?e.width:e.height,r=n?t.left:t.top,c=n?t.right:t.bottom,d=n?t.width:t.height;return a===r||o===c||a+s/2===r+d/2},Eo=function(e,t){var n;return Cn.some(function(a){var o=a[de].options.emptyInsertThreshold;if(!(!o||ga(a))){var s=Q(a),r=e>=s.left-o&&e<=s.right+o,c=t>=s.top-o&&t<=s.bottom+o;if(r&&c)return n=a}}),n},ja=function(e){function t(o,s){return function(r,c,d,f){var g=r.options.group.name&&c.options.group.name&&r.options.group.name===c.options.group.name;if(o==null&&(s||g))return!0;if(o==null||o===!1)return!1;if(s&&o==="clone")return o;if(typeof o=="function")return t(o(r,c,d,f),s)(r,c,d,f);var h=(s?r:c).options.group.name;return o===!0||typeof o=="string"&&o===h||o.join&&o.indexOf(h)>-1}}var n={},a=e.group;(!a||fn(a)!="object")&&(a={name:a}),n.name=a.name,n.checkPull=t(a.pull,!0),n.checkPut=t(a.put),n.revertClone=a.revertClone,e.group=n},$a=function(){!Wa&&F&&M(F,"display","none")},Ya=function(){!Wa&&F&&M(F,"display","")};Bn&&!Aa&&document.addEventListener("click",function(i){if(vn)return i.preventDefault(),i.stopPropagation&&i.stopPropagation(),i.stopImmediatePropagation&&i.stopImmediatePropagation(),vn=!1,!1},!0);var Ze=function(e){if(v){e=e.touches?e.touches[0]:e;var t=Eo(e.clientX,e.clientY);if(t){var n={};for(var a in e)e.hasOwnProperty(a)&&(n[a]=e[a]);n.target=n.rootEl=t,n.preventDefault=void 0,n.stopPropagation=void 0,t[de]._onDragOver(n)}}},To=function(e){v&&v.parentNode[de]._isOutsideThisEl(e.target)};function D(i,e){if(!(i&&i.nodeType&&i.nodeType===1))throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(i));this.el=i,this.options=e=Pe({},e),i[de]=this;var t={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(i.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return Va(i,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(s,r){s.setData("Text",r.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:D.supportPointer!==!1&&"PointerEvent"in window&&(!Ft||ua),emptyInsertThreshold:5};on.initializePlugins(this,i,t);for(var n in t)!(n in e)&&(e[n]=t[n]);ja(e);for(var a in this)a.charAt(0)==="_"&&typeof this[a]=="function"&&(this[a]=this[a].bind(this));this.nativeDraggable=e.forceFallback?!1:vo,this.nativeDraggable&&(this.options.touchStartThreshold=1),e.supportPointer?B(i,"pointerdown",this._onTapStart):(B(i,"mousedown",this._onTapStart),B(i,"touchstart",this._onTapStart)),this.nativeDraggable&&(B(i,"dragover",this),B(i,"dragenter",this)),Cn.push(this.el),e.store&&e.store.get&&this.sort(e.store.get(this)||[]),Pe(this,mo())}D.prototype={constructor:D,_isOutsideThisEl:function(e){!this.el.contains(e)&&e!==this.el&&(lt=null)},_getDirection:function(e,t){return typeof this.options.direction=="function"?this.options.direction.call(this,e,t,v):this.options.direction},_onTapStart:function(e){if(e.cancelable){var t=this,n=this.el,a=this.options,o=a.preventOnFilter,s=e.type,r=e.touches&&e.touches[0]||e.pointerType&&e.pointerType==="touch"&&e,c=(r||e).target,d=e.target.shadowRoot&&(e.path&&e.path[0]||e.composedPath&&e.composedPath()[0])||c,f=a.filter;if(Mo(n),!v&&!(/mousedown|pointerdown/.test(s)&&e.button!==0||a.disabled)&&!d.isContentEditable&&!(!this.nativeDraggable&&Ft&&c&&c.tagName.toUpperCase()==="SELECT")&&(c=Te(c,a.draggable,n,!1),!(c&&c.animated)&&pn!==c)){if(dt=be(c),At=be(c,a.draggable),typeof f=="function"){if(f.call(this,e,c,this)){le({sortable:t,rootEl:d,name:"filter",targetEl:c,toEl:n,fromEl:n}),ce("filter",t,{evt:e}),o&&e.preventDefault();return}}else if(f&&(f=f.split(",").some(function(g){if(g=Te(d,g.trim(),n,!1),g)return le({sortable:t,rootEl:g,name:"filter",targetEl:c,fromEl:n,toEl:n}),ce("filter",t,{evt:e}),!0}),f)){o&&e.preventDefault();return}a.handle&&!Te(d,a.handle,n,!1)||this._prepareDragStart(e,r,c)}}},_prepareDragStart:function(e,t,n){var a=this,o=a.el,s=a.options,r=o.ownerDocument,c;if(n&&!v&&n.parentNode===o){var d=Q(n);if($=o,v=n,J=v.parentNode,Qe=v.nextSibling,pn=n,ln=s.group,D.dragged=v,Ke={target:v,clientX:(t||e).clientX,clientY:(t||e).clientY},Na=Ke.clientX-d.left,La=Ke.clientY-d.top,this._lastX=(t||e).clientX,this._lastY=(t||e).clientY,v.style["will-change"]="all",c=function(){if(ce("delayEnded",a,{evt:e}),D.eventCanceled){a._onDrop();return}a._disableDelayedDragEvents(),!va&&a.nativeDraggable&&(v.draggable=!0),a._triggerDragStart(e,t),le({sortable:a,name:"choose",originalEvent:e}),pe(v,s.chosenClass,!0)},s.ignore.split(",").forEach(function(f){qa(v,f.trim(),Yn)}),B(r,"dragover",Ze),B(r,"mousemove",Ze),B(r,"touchmove",Ze),s.supportPointer?(B(r,"pointerup",a._onDrop),!this.nativeDraggable&&B(r,"pointercancel",a._onDrop)):(B(r,"mouseup",a._onDrop),B(r,"touchend",a._onDrop),B(r,"touchcancel",a._onDrop)),va&&this.nativeDraggable&&(this.options.touchStartThreshold=4,v.draggable=!0),ce("delayStart",this,{evt:e}),s.delay&&(!s.delayOnTouchOnly||t)&&(!this.nativeDraggable||!(an||Ae))){if(D.eventCanceled){this._onDrop();return}s.supportPointer?(B(r,"pointerup",a._disableDelayedDrag),B(r,"pointercancel",a._disableDelayedDrag)):(B(r,"mouseup",a._disableDelayedDrag),B(r,"touchend",a._disableDelayedDrag),B(r,"touchcancel",a._disableDelayedDrag)),B(r,"mousemove",a._delayedDragTouchMoveHandler),B(r,"touchmove",a._delayedDragTouchMoveHandler),s.supportPointer&&B(r,"pointermove",a._delayedDragTouchMoveHandler),a._dragStartTimer=setTimeout(c,s.delay)}else c()}},_delayedDragTouchMoveHandler:function(e){var t=e.touches?e.touches[0]:e;Math.max(Math.abs(t.clientX-this._lastX),Math.abs(t.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){v&&Yn(v),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var e=this.el.ownerDocument;q(e,"mouseup",this._disableDelayedDrag),q(e,"touchend",this._disableDelayedDrag),q(e,"touchcancel",this._disableDelayedDrag),q(e,"pointerup",this._disableDelayedDrag),q(e,"pointercancel",this._disableDelayedDrag),q(e,"mousemove",this._delayedDragTouchMoveHandler),q(e,"touchmove",this._delayedDragTouchMoveHandler),q(e,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(e,t){t=t||e.pointerType=="touch"&&e,!this.nativeDraggable||t?this.options.supportPointer?B(document,"pointermove",this._onTouchMove):t?B(document,"touchmove",this._onTouchMove):B(document,"mousemove",this._onTouchMove):(B(v,"dragend",this),B($,"dragstart",this._onDragStart));try{document.selection?hn(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch{}},_dragStarted:function(e,t){if(ct=!1,$&&v){ce("dragStarted",this,{evt:t}),this.nativeDraggable&&B(document,"dragover",To);var n=this.options;!e&&pe(v,n.dragClass,!1),pe(v,n.ghostClass,!0),D.active=this,e&&this._appendGhost(),le({sortable:this,name:"start",originalEvent:t})}else this._nulling()},_emulateDragOver:function(){if(Ce){this._lastX=Ce.clientX,this._lastY=Ce.clientY,$a();for(var e=document.elementFromPoint(Ce.clientX,Ce.clientY),t=e;e&&e.shadowRoot&&(e=e.shadowRoot.elementFromPoint(Ce.clientX,Ce.clientY),e!==t);)t=e;if(v.parentNode[de]._isOutsideThisEl(e),t)do{if(t[de]){var n=void 0;if(n=t[de]._onDragOver({clientX:Ce.clientX,clientY:Ce.clientY,target:e,rootEl:t}),n&&!this.options.dragoverBubble)break}e=t}while(t=za(t));Ya()}},_onTouchMove:function(e){if(Ke){var t=this.options,n=t.fallbackTolerance,a=t.fallbackOffset,o=e.touches?e.touches[0]:e,s=F&&pt(F,!0),r=F&&s&&s.a,c=F&&s&&s.d,d=dn&&se&&Ta(se),f=(o.clientX-Ke.clientX+a.x)/(r||1)+(d?d[0]-$n[0]:0)/(r||1),g=(o.clientY-Ke.clientY+a.y)/(c||1)+(d?d[1]-$n[1]:0)/(c||1);if(!D.active&&!ct){if(n&&Math.max(Math.abs(o.clientX-this._lastX),Math.abs(o.clientY-this._lastY))<n)return;this._onDragStart(e,!0)}if(F){s?(s.e+=f-(Vn||0),s.f+=g-(jn||0)):s={a:1,b:0,c:0,d:1,e:f,f:g};var h="matrix(".concat(s.a,",").concat(s.b,",").concat(s.c,",").concat(s.d,",").concat(s.e,",").concat(s.f,")");M(F,"webkitTransform",h),M(F,"mozTransform",h),M(F,"msTransform",h),M(F,"transform",h),Vn=f,jn=g,Ce=o}e.cancelable&&e.preventDefault()}},_appendGhost:function(){if(!F){var e=this.options.fallbackOnBody?document.body:$,t=Q(v,!0,dn,!0,e),n=this.options;if(dn){for(se=e;M(se,"position")==="static"&&M(se,"transform")==="none"&&se!==document;)se=se.parentNode;se!==document.body&&se!==document.documentElement?(se===document&&(se=we()),t.top+=se.scrollTop,t.left+=se.scrollLeft):se=we(),$n=Ta(se)}F=v.cloneNode(!0),pe(F,n.ghostClass,!1),pe(F,n.fallbackClass,!0),pe(F,n.dragClass,!0),M(F,"transition",""),M(F,"transform",""),M(F,"box-sizing","border-box"),M(F,"margin",0),M(F,"top",t.top),M(F,"left",t.left),M(F,"width",t.width),M(F,"height",t.height),M(F,"opacity","0.8"),M(F,"position",dn?"absolute":"fixed"),M(F,"zIndex","100000"),M(F,"pointerEvents","none"),D.ghost=F,e.appendChild(F),M(F,"transform-origin",Na/parseInt(F.style.width)*100+"% "+La/parseInt(F.style.height)*100+"%")}},_onDragStart:function(e,t){var n=this,a=e.dataTransfer,o=n.options;if(ce("dragStart",this,{evt:e}),D.eventCanceled){this._onDrop();return}ce("setupClone",this),D.eventCanceled||(X=xa(v),X.removeAttribute("id"),X.draggable=!1,X.style["will-change"]="",this._hideClone(),pe(X,this.options.chosenClass,!1),D.clone=X),n.cloneId=hn(function(){ce("clone",n),!D.eventCanceled&&(n.options.removeCloneOnHide||$.insertBefore(X,v),n._hideClone(),le({sortable:n,name:"clone"}))}),!t&&pe(v,o.dragClass,!0),t?(vn=!0,n._loopId=setInterval(n._emulateDragOver,50)):(q(document,"mouseup",n._onDrop),q(document,"touchend",n._onDrop),q(document,"touchcancel",n._onDrop),a&&(a.effectAllowed="move",o.setData&&o.setData.call(n,a,v)),B(document,"drop",n),M(v,"transform","translateZ(0)")),ct=!0,n._dragStartId=hn(n._dragStarted.bind(n,t,e)),B(document,"selectstart",n),Ot=!0,window.getSelection().removeAllRanges(),Ft&&M(document.body,"user-select","none")},_onDragOver:function(e){var t=this.el,n=e.target,a,o,s,r=this.options,c=r.group,d=D.active,f=ln===c,g=r.sort,h=ae||d,C,E=this,O=!1;if(ta)return;function j(It,eo){ce(It,E,Re({evt:e,isOwner:f,axis:C?"vertical":"horizontal",revert:s,dragRect:a,targetRect:o,canSort:g,fromSortable:h,target:n,completed:re,onMove:function(ma,to){return un($,t,v,a,ma,Q(ma),e,to)},changed:ve},eo))}function ne(){j("dragOverAnimationCapture"),E.captureAnimationState(),E!==h&&h.captureAnimationState()}function re(It){return j("dragOverCompleted",{insertion:It}),It&&(f?d._hideClone():d._showClone(E),E!==h&&(pe(v,ae?ae.options.ghostClass:d.options.ghostClass,!1),pe(v,r.ghostClass,!0)),ae!==E&&E!==D.active?ae=E:E===D.active&&ae&&(ae=null),h===E&&(E._ignoreWhileAnimating=n),E.animateAll(function(){j("dragOverAnimationComplete"),E._ignoreWhileAnimating=null}),E!==h&&(h.animateAll(),h._ignoreWhileAnimating=null)),(n===v&&!v.animated||n===t&&!n.animated)&&(lt=null),!r.dragoverBubble&&!e.rootEl&&n!==document&&(v.parentNode[de]._isOutsideThisEl(e.target),!It&&Ze(e)),!r.dragoverBubble&&e.stopPropagation&&e.stopPropagation(),O=!0}function ve(){me=be(v),qe=be(v,r.draggable),le({sortable:E,name:"change",toEl:t,newIndex:me,newDraggableIndex:qe,originalEvent:e})}if(e.preventDefault!==void 0&&e.cancelable&&e.preventDefault(),n=Te(n,r.draggable,t,!0),j("dragOver"),D.eventCanceled)return O;if(v.contains(e.target)||n.animated&&n.animatingX&&n.animatingY||E._ignoreWhileAnimating===n)return re(!1);if(vn=!1,d&&!r.disabled&&(f?g||(s=J!==$):ae===this||(this.lastPutMode=ln.checkPull(this,d,v,e))&&c.checkPut(this,d,v,e))){if(C=this._getDirection(e,n)==="vertical",a=Q(v),j("dragOverValid"),D.eventCanceled)return O;if(s)return J=$,ne(),this._hideClone(),j("revert"),D.eventCanceled||(Qe?$.insertBefore(v,Qe):$.appendChild(v)),re(!0);var ge=ga(t,r.draggable);if(!ge||Ro(e,C,this)&&!ge.animated){if(ge===v)return re(!1);if(ge&&t===e.target&&(n=ge),n&&(o=Q(n)),un($,t,v,a,n,o,e,!!n)!==!1)return ne(),ge&&ge.nextSibling?t.insertBefore(v,ge.nextSibling):t.appendChild(v),J=t,ve(),re(!0)}else if(ge&&wo(e,C,this)){var Ye=Tt(t,0,r,!0);if(Ye===v)return re(!1);if(n=Ye,o=Q(n),un($,t,v,a,n,o,e,!1)!==!1)return ne(),t.insertBefore(v,Ye),J=t,ve(),re(!0)}else if(n.parentNode===t){o=Q(n);var Ne=0,Xe,Nt=v.parentNode!==t,fe=!Co(v.animated&&v.toRect||a,n.animated&&n.toRect||o,C),Lt=C?"top":"left",Ge=Ea(n,"top","top")||Ea(v,"top","top"),wt=Ge?Ge.scrollTop:void 0;lt!==n&&(Xe=o[Lt],zt=!1,cn=!fe&&r.invertSwap||Nt),Ne=Io(e,n,o,C,fe?1:r.swapThreshold,r.invertedSwapThreshold==null?r.swapThreshold:r.invertedSwapThreshold,cn,lt===n);var Ie;if(Ne!==0){var Je=be(v);do Je-=Ne,Ie=J.children[Je];while(Ie&&(M(Ie,"display")==="none"||Ie===F))}if(Ne===0||Ie===n)return re(!1);lt=n,Gt=Ne;var Rt=n.nextElementSibling,ze=!1;ze=Ne===1;var sn=un($,t,v,a,n,o,e,ze);if(sn!==!1)return(sn===1||sn===-1)&&(ze=sn===1),ta=!0,setTimeout(Lo,30),ne(),ze&&!Rt?t.appendChild(v):n.parentNode.insertBefore(v,ze?Rt:n),Ge&&Ha(Ge,0,wt-Ge.scrollTop),J=v.parentNode,Xe!==void 0&&!cn&&(mn=Math.abs(Xe-Q(n)[Lt])),ve(),re(!0)}if(t.contains(v))return re(!1)}return!1},_ignoreWhileAnimating:null,_offMoveEvents:function(){q(document,"mousemove",this._onTouchMove),q(document,"touchmove",this._onTouchMove),q(document,"pointermove",this._onTouchMove),q(document,"dragover",Ze),q(document,"mousemove",Ze),q(document,"touchmove",Ze)},_offUpEvents:function(){var e=this.el.ownerDocument;q(e,"mouseup",this._onDrop),q(e,"touchend",this._onDrop),q(e,"pointerup",this._onDrop),q(e,"pointercancel",this._onDrop),q(e,"touchcancel",this._onDrop),q(document,"selectstart",this)},_onDrop:function(e){var t=this.el,n=this.options;if(me=be(v),qe=be(v,n.draggable),ce("drop",this,{evt:e}),J=v&&v.parentNode,me=be(v),qe=be(v,n.draggable),D.eventCanceled){this._nulling();return}ct=!1,cn=!1,zt=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),na(this.cloneId),na(this._dragStartId),this.nativeDraggable&&(q(document,"drop",this),q(t,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),Ft&&M(document.body,"user-select",""),M(v,"transform",""),e&&(Ot&&(e.cancelable&&e.preventDefault(),!n.dropBubble&&e.stopPropagation()),F&&F.parentNode&&F.parentNode.removeChild(F),($===J||ae&&ae.lastPutMode!=="clone")&&X&&X.parentNode&&X.parentNode.removeChild(X),v&&(this.nativeDraggable&&q(v,"dragend",this),Yn(v),v.style["will-change"]="",Ot&&!ct&&pe(v,ae?ae.options.ghostClass:this.options.ghostClass,!1),pe(v,this.options.chosenClass,!1),le({sortable:this,name:"unchoose",toEl:J,newIndex:null,newDraggableIndex:null,originalEvent:e}),$!==J?(me>=0&&(le({rootEl:J,name:"add",toEl:J,fromEl:$,originalEvent:e}),le({sortable:this,name:"remove",toEl:J,originalEvent:e}),le({rootEl:J,name:"sort",toEl:J,fromEl:$,originalEvent:e}),le({sortable:this,name:"sort",toEl:J,originalEvent:e})),ae&&ae.save()):me!==dt&&me>=0&&(le({sortable:this,name:"update",toEl:J,originalEvent:e}),le({sortable:this,name:"sort",toEl:J,originalEvent:e})),D.active&&((me==null||me===-1)&&(me=dt,qe=At),le({sortable:this,name:"end",toEl:J,originalEvent:e}),this.save()))),this._nulling()},_nulling:function(){ce("nulling",this),$=v=J=F=Qe=X=pn=He=Ke=Ce=Ot=me=qe=dt=At=lt=Gt=ae=ln=D.dragged=D.ghost=D.clone=D.active=null,En.forEach(function(e){e.checked=!0}),En.length=Vn=jn=0},handleEvent:function(e){switch(e.type){case"drop":case"dragend":this._onDrop(e);break;case"dragenter":case"dragover":v&&(this._onDragOver(e),No(e));break;case"selectstart":e.preventDefault();break}},toArray:function(){for(var e=[],t,n=this.el.children,a=0,o=n.length,s=this.options;a<o;a++)t=n[a],Te(t,s.draggable,this.el,!1)&&e.push(t.getAttribute(s.dataIdAttr)||Oo(t));return e},sort:function(e,t){var n={},a=this.el;this.toArray().forEach(function(o,s){var r=a.children[s];Te(r,this.options.draggable,a,!1)&&(n[o]=r)},this),t&&this.captureAnimationState(),e.forEach(function(o){n[o]&&(a.removeChild(n[o]),a.appendChild(n[o]))}),t&&this.animateAll()},save:function(){var e=this.options.store;e&&e.set&&e.set(this)},closest:function(e,t){return Te(e,t||this.options.draggable,this.el,!1)},option:function(e,t){var n=this.options;if(t===void 0)return n[e];var a=on.modifyOption(this,e,t);typeof a<"u"?n[e]=a:n[e]=t,e==="group"&&ja(n)},destroy:function(){ce("destroy",this);var e=this.el;e[de]=null,q(e,"mousedown",this._onTapStart),q(e,"touchstart",this._onTapStart),q(e,"pointerdown",this._onTapStart),this.nativeDraggable&&(q(e,"dragover",this),q(e,"dragenter",this)),Array.prototype.forEach.call(e.querySelectorAll("[draggable]"),function(t){t.removeAttribute("draggable")}),this._onDrop(),this._disableDelayedDragEvents(),Cn.splice(Cn.indexOf(this.el),1),this.el=e=null},_hideClone:function(){if(!He){if(ce("hideClone",this),D.eventCanceled)return;M(X,"display","none"),this.options.removeCloneOnHide&&X.parentNode&&X.parentNode.removeChild(X),He=!0}},_showClone:function(e){if(e.lastPutMode!=="clone"){this._hideClone();return}if(He){if(ce("showClone",this),D.eventCanceled)return;v.parentNode==$&&!this.options.group.revertClone?$.insertBefore(X,v):Qe?$.insertBefore(X,Qe):$.appendChild(X),this.options.group.revertClone&&this.animate(v,X),M(X,"display",""),He=!1}}};function No(i){i.dataTransfer&&(i.dataTransfer.dropEffect="move"),i.cancelable&&i.preventDefault()}function un(i,e,t,n,a,o,s,r){var c,d=i[de],f=d.options.onMove,g;return window.CustomEvent&&!Ae&&!an?c=new CustomEvent("move",{bubbles:!0,cancelable:!0}):(c=document.createEvent("Event"),c.initEvent("move",!0,!0)),c.to=e,c.from=i,c.dragged=t,c.draggedRect=n,c.related=a||e,c.relatedRect=o||Q(e),c.willInsertAfter=r,c.originalEvent=s,i.dispatchEvent(c),f&&(g=f.call(d,c,s)),g}function Yn(i){i.draggable=!1}function Lo(){ta=!1}function wo(i,e,t){var n=Q(Tt(t.el,0,t.options,!0)),a=Ua(t.el,t.options,F),o=10;return e?i.clientX<a.left-o||i.clientY<n.top&&i.clientX<n.right:i.clientY<a.top-o||i.clientY<n.bottom&&i.clientX<n.left}function Ro(i,e,t){var n=Q(ga(t.el,t.options.draggable)),a=Ua(t.el,t.options,F),o=10;return e?i.clientX>a.right+o||i.clientY>n.bottom&&i.clientX>n.left:i.clientY>a.bottom+o||i.clientX>n.right&&i.clientY>n.top}function Io(i,e,t,n,a,o,s,r){var c=n?i.clientY:i.clientX,d=n?t.height:t.width,f=n?t.top:t.left,g=n?t.bottom:t.right,h=!1;if(!s){if(r&&mn<d*a){if(!zt&&(Gt===1?c>f+d*o/2:c<g-d*o/2)&&(zt=!0),zt)h=!0;else if(Gt===1?c<f+mn:c>g-mn)return-Gt}else if(c>f+d*(1-a)/2&&c<g-d*(1-a)/2)return ko(e)}return h=h||s,h&&(c<f+d*o/2||c>g-d*o/2)?c>f+d/2?1:-1:0}function ko(i){return be(v)<be(i)?1:-1}function Oo(i){for(var e=i.tagName+i.className+i.src+i.href+i.textContent,t=e.length,n=0;t--;)n+=e.charCodeAt(t);return n.toString(36)}function Mo(i){En.length=0;for(var e=i.getElementsByTagName("input"),t=e.length;t--;){var n=e[t];n.checked&&En.push(n)}}function hn(i){return setTimeout(i,0)}function na(i){return clearTimeout(i)}Bn&&B(document,"touchmove",function(i){(D.active||ct)&&i.cancelable&&i.preventDefault()});D.utils={on:B,off:q,css:M,find:qa,is:function(e,t){return!!Te(e,t,e,!1)},extend:fo,throttle:Ba,closest:Te,toggleClass:pe,clone:xa,index:be,nextTick:hn,cancelNextTick:na,detectDirection:Va,getChild:Tt,expando:de};D.get=function(i){return i[de]};D.mount=function(){for(var i=arguments.length,e=new Array(i),t=0;t<i;t++)e[t]=arguments[t];e[0].constructor===Array&&(e=e[0]),e.forEach(function(n){if(!n.prototype||!n.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(n));n.utils&&(D.utils=Re(Re({},D.utils),n.utils)),on.mount(n)})};D.create=function(i,e){return new D(i,e)};D.version=uo;var Z=[],Mt,aa,oa=!1,Xn,Jn,Tn,Dt;function Do(){function i(){this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0};for(var e in this)e.charAt(0)==="_"&&typeof this[e]=="function"&&(this[e]=this[e].bind(this))}return i.prototype={dragStarted:function(t){var n=t.originalEvent;this.sortable.nativeDraggable?B(document,"dragover",this._handleAutoScroll):this.options.supportPointer?B(document,"pointermove",this._handleFallbackAutoScroll):n.touches?B(document,"touchmove",this._handleFallbackAutoScroll):B(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(t){var n=t.originalEvent;!this.options.dragOverBubble&&!n.rootEl&&this._handleAutoScroll(n)},drop:function(){this.sortable.nativeDraggable?q(document,"dragover",this._handleAutoScroll):(q(document,"pointermove",this._handleFallbackAutoScroll),q(document,"touchmove",this._handleFallbackAutoScroll),q(document,"mousemove",this._handleFallbackAutoScroll)),Ra(),bn(),po()},nulling:function(){Tn=aa=Mt=oa=Dt=Xn=Jn=null,Z.length=0},_handleFallbackAutoScroll:function(t){this._handleAutoScroll(t,!0)},_handleAutoScroll:function(t,n){var a=this,o=(t.touches?t.touches[0]:t).clientX,s=(t.touches?t.touches[0]:t).clientY,r=document.elementFromPoint(o,s);if(Tn=t,n||this.options.forceAutoScrollFallback||an||Ae||Ft){Kn(t,this.options,r,n);var c=$e(r,!0);oa&&(!Dt||o!==Xn||s!==Jn)&&(Dt&&Ra(),Dt=setInterval(function(){var d=$e(document.elementFromPoint(o,s),!0);d!==c&&(c=d,bn()),Kn(t,a.options,d,n)},10),Xn=o,Jn=s)}else{if(!this.options.bubbleScroll||$e(r,!0)===we()){bn();return}Kn(t,this.options,$e(r,!1),!1)}}},Pe(i,{pluginName:"scroll",initializeByDefault:!0})}function bn(){Z.forEach(function(i){clearInterval(i.pid)}),Z=[]}function Ra(){clearInterval(Dt)}var Kn=Ba(function(i,e,t,n){if(e.scroll){var a=(i.touches?i.touches[0]:i).clientX,o=(i.touches?i.touches[0]:i).clientY,s=e.scrollSensitivity,r=e.scrollSpeed,c=we(),d=!1,f;aa!==t&&(aa=t,bn(),Mt=e.scroll,f=e.scrollFn,Mt===!0&&(Mt=$e(t,!0)));var g=0,h=Mt;do{var C=h,E=Q(C),O=E.top,j=E.bottom,ne=E.left,re=E.right,ve=E.width,ge=E.height,Ye=void 0,Ne=void 0,Xe=C.scrollWidth,Nt=C.scrollHeight,fe=M(C),Lt=C.scrollLeft,Ge=C.scrollTop;C===c?(Ye=ve<Xe&&(fe.overflowX==="auto"||fe.overflowX==="scroll"||fe.overflowX==="visible"),Ne=ge<Nt&&(fe.overflowY==="auto"||fe.overflowY==="scroll"||fe.overflowY==="visible")):(Ye=ve<Xe&&(fe.overflowX==="auto"||fe.overflowX==="scroll"),Ne=ge<Nt&&(fe.overflowY==="auto"||fe.overflowY==="scroll"));var wt=Ye&&(Math.abs(re-a)<=s&&Lt+ve<Xe)-(Math.abs(ne-a)<=s&&!!Lt),Ie=Ne&&(Math.abs(j-o)<=s&&Ge+ge<Nt)-(Math.abs(O-o)<=s&&!!Ge);if(!Z[g])for(var Je=0;Je<=g;Je++)Z[Je]||(Z[Je]={});(Z[g].vx!=wt||Z[g].vy!=Ie||Z[g].el!==C)&&(Z[g].el=C,Z[g].vx=wt,Z[g].vy=Ie,clearInterval(Z[g].pid),(wt!=0||Ie!=0)&&(d=!0,Z[g].pid=setInterval((function(){n&&this.layer===0&&D.active._onTouchMove(Tn);var Rt=Z[this.layer].vy?Z[this.layer].vy*r:0,ze=Z[this.layer].vx?Z[this.layer].vx*r:0;typeof f=="function"&&f.call(D.dragged.parentNode[de],ze,Rt,i,Tn,Z[this.layer].el)!=="continue"||Ha(Z[this.layer].el,ze,Rt)}).bind({layer:g}),24))),g++}while(e.bubbleScroll&&h!==c&&(h=$e(h,!1)));oa=d}},30),Xa=function(e){var t=e.originalEvent,n=e.putSortable,a=e.dragEl,o=e.activeSortable,s=e.dispatchSortableEvent,r=e.hideGhostForTarget,c=e.unhideGhostForTarget;if(t){var d=n||o;r();var f=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:t,g=document.elementFromPoint(f.clientX,f.clientY);c(),d&&!d.el.contains(g)&&(s("spill"),this.onSpill({dragEl:a,putSortable:n}))}};function fa(){}fa.prototype={startIndex:null,dragStart:function(e){var t=e.oldDraggableIndex;this.startIndex=t},onSpill:function(e){var t=e.dragEl,n=e.putSortable;this.sortable.captureAnimationState(),n&&n.captureAnimationState();var a=Tt(this.sortable.el,this.startIndex,this.options);a?this.sortable.el.insertBefore(t,a):this.sortable.el.appendChild(t),this.sortable.animateAll(),n&&n.animateAll()},drop:Xa};Pe(fa,{pluginName:"revertOnSpill"});function pa(){}pa.prototype={onSpill:function(e){var t=e.dragEl,n=e.putSortable,a=n||this.sortable;a.captureAnimationState(),t.parentNode&&t.parentNode.removeChild(t),a.animateAll()},drop:Xa};Pe(pa,{pluginName:"removeOnSpill"});D.mount(new Do);D.mount(pa,fa);const Zn="root";var Ve,_,Gn,zn,Ja;const w=class w{static init(){if(w.noFolderView()||!ui.scenes||!game.user.isGM)return;w.preloadTemplates(),game.user.getFlag(z,"activeSceneFolders")||game.user.setFlag(z,"activeSceneFolders",[]);const e=document.querySelector("#scene-navigation-inactive");((e==null?void 0:e.querySelectorAll("li.folder"))||[]).forEach(n=>{n.remove()}),Hooks.on(A.RENDER_SCENE_DIRECTORY,(n,a)=>{var o;ee(o=w,zn,Ja).call(o)})}static addFolderButtons(e,t,n){if(!P.useSceneFolders||game.scenes.size<2||game.scenes.folders.size<1)return;const a=R();if(document.querySelector("#crlngn-folder-toggle"))return;const s=t.querySelector("#scene-navigation-active");s==null||s.querySelector("li.scene");const r=`CRLNGN_UI.ui.sceneNav.${P.navShowRootFolders?"hideSceneFoldersTooltip":"showSceneFoldersTooltip"}`,c=document.createElement("div");c.dataset.tooltip=game.i18n.localize(r),c.id="crlngn-folder-toggle",c.innerHTML="<i class='fa-solid icon'></i>",c.addEventListener("click",()=>{P.setNavPosition(0);const d=!P.navShowRootFolders;T.set(a.navShowRootFolders.tag,d),P.placeNavButtons()}),s==null||s.append(c),P.navShowRootFolders?s==null||s.classList.add("with-folders"):s==null||s.classList.remove("with-folders")}static toggleFolderLookup(e){const t=e.target.parentNode;t.classList.contains("open")?t.classList.remove("open"):t.classList.add("open")}static buildTemplateData(e){if(!e||!ui.scenes)return{};const t=ui.scenes.collection.folders;let n={},a=[],o=e.contents?[...e.contents]:[];return o=o.filter(s=>s.permission>=2),I(w,Ve,game.scenes.sortingMode),p.log("buildFolderData A",[e.name,e]),e.id===Zn?a=t.filter(s=>s.folder===null)||[]:a=e.children,a=w.sortFolderList(a),n={currentFolder:e,folders:a,scenes:o},p.log("buildFolderData",[a,n]),n}static sortFolderList(e){return e=e.map((t,n)=>t.folder?t.folder:t),m(w,Ve)==="a"?e.sort((t,n)=>t.name.toLowerCase().localeCompare(n.name.toLowerCase())):e.sort((t,n)=>t.sort-n.sort),e}};Ve=new WeakMap,_=new WeakMap,Gn=new WeakMap,zn=new WeakSet,Ja=function(){try{if(game.scenes&&game.scenes.sortingMode!==void 0){I(w,Ve,game.scenes.sortingMode);return}}catch(e){console.error("Error checking scene directory sort mode:",e)}I(w,Ve,"a"),p.log("updateSortMode fallback",[m(w,Ve)])},L(w,zn),b(w,"selectedFolder",Zn),L(w,Ve,"a"),L(w,_,[]),b(w,"searchValue",""),b(w,"renderFolderList",async e=>{I(w,_,game.user.getFlag(z,"activeSceneFolders")||[]);let t;const n=ui.scenes.collection.folders,a=e?n.get(e.dataset.folderId):{name:"",id:Zn},o=w.buildTemplateData(a),s=await N.renderTemplate(`modules/${z}/templates/scene-nav-folders.hbs`,o);e?t=e.parentNode:t=document.querySelector("#scene-navigation-inactive"),t.insertAdjacentHTML("afterbegin",s);const r=t.querySelectorAll("li.folder");w.addFolderListeners(r),P.placeNavButtons()}),b(w,"handleFolderLookup",async()=>{const e=await N.renderTemplate(`modules/${z}/templates/scene-nav-lookup.hbs`,{}),t=document.querySelector("#crlngn-lookup-list");t&&t.remove();const n=document.querySelector("#crlngn-scene-lookup");n.insertAdjacentHTML("beforeend",e);const a=n.querySelector(".search-container .input-scene-search");a.addEventListener("keyup",w.onSearchInput),a.addEventListener("keydown",s=>{s.stopPropagation()});const o=n==null?void 0:n.querySelector(".scene-lookup-toggle");o&&o.addEventListener("click",w.toggleFolderLookup)}),b(w,"addFolderListeners",e=>{const t=ui.scenes.collection.folders;e&&e.forEach(n=>{n.querySelector(".folder-item").addEventListener("click",m(w,Gn));const a=n.dataset.folderId,o=t.get(a),s=m(w,_).includes(a);p.log("addFolderListeners isActive",[s,a,o.name]),s&&(n.classList.add("crlngn-folder-active"),w.injectSubfolders(o,n))})}),L(w,Gn,async e=>{e.preventDefault(),e.stopPropagation();const t=e.currentTarget;t.offsetLeft,t.parentNode.parentNode.querySelectorAll(".crlngn-folder-active");const n=t.dataset.folderId||t.parentNode.dataset.folderId,a=ui.scenes.collection.folders,o=n?a.get(n):null;if(!o)return;await w.injectSubfolders(o,t.parentNode),P.addSceneListeners(t.parentNode),p.log("onNavFolderClick",[t,t.parentNode,t.parentNode.dataset]),t.classList.contains("crlngn-folder-active")||t.parentNode.classList.contains("crlngn-folder-active")?w.updateActiveFolders(n,!0):w.updateActiveFolders(n,!1)}),b(w,"injectSubfolders",async(e,t)=>{const n=w.buildTemplateData(e),a=await N.renderTemplate(`modules/${z}/templates/scene-nav-subfolders.hbs`,n),o=t.querySelector(".contents");o&&o.remove(),t.insertAdjacentHTML("beforeend",a);const s=t.querySelectorAll("li.folder");w.addFolderListeners(s),P.addSceneListeners(t.querySelector(".contents"))}),b(w,"updateActiveFolders",async(e,t=!1)=>{const n=document.querySelector("#scene-navigation-inactive"),a=n==null?void 0:n.querySelector(`li.folder[data-folder-id="${e}"]`),o=m(w,_).indexOf(e);p.log("updateActiveFolders A",[o,e,game.user.getFlag(z,"activeSceneFolders"),m(w,_)]),t?(I(w,_,m(w,_).filter(s=>s!==e)),a.classList.remove("crlngn-folder-active")):m(w,_).includes(e)||(a.parentNode.querySelectorAll("li.folder").forEach(r=>{r!==a&&(I(w,_,m(w,_).filter(c=>c!==r.dataset.folderId)),r.classList.remove("crlngn-folder-active"))}),m(w,_).push(e),a.classList.add("crlngn-folder-active")),await game.user.setFlag(z,"activeSceneFolders",m(w,_)),p.log("updateActiveFolders B",[t,e,game.user.getFlag(z,"activeSceneFolders"),m(w,_)])}),b(w,"selectFolder",e=>w.getFolderById(e)||null),b(w,"noFolderView",()=>{var t;return!((t=game==null?void 0:game.user)==null?void 0:t.isGM)&&!P.navFoldersForPlayers||!P.useSceneFolders||!P.sceneNavEnabled}),b(w,"preloadTemplates",async()=>{const e=[`modules/${z}/templates/scene-nav-folders.hbs`,`modules/${z}/templates/scene-nav-subfolders.hbs`,`modules/${z}/templates/scene-nav-lookup.hbs`];return await N.loadTemplates(e),!0}),b(w,"onSearchInput",e=>{e.stopPropagation();const n=e.currentTarget.value;w.searchValue=n,w.updateSearchResults(n)}),b(w,"updateSearchResults",e=>{var o,s;if(!P.useSceneLookup)return;const t=document.querySelector("#crlngn-scene-lookup .search-container .search-results");if(!t)return;if(t.innerHTML="",!e){t.classList.add("hidden");return}const n=((o=game.scenes)==null?void 0:o.filter(r=>r.name.toLowerCase().includes(e.toLowerCase())&&r.permission>=2))||[];n.sort((r,c)=>r.name.toLowerCase().localeCompare(c.name.toLowerCase()));let a=[];if(P.useSceneFolders&&(a=((s=game.scenes)==null?void 0:s.folders.filter(r=>r.name.toLowerCase().includes(e.toLowerCase())))||[],a.sort((r,c)=>r.name.toLowerCase().localeCompare(c.name.toLowerCase())),a.forEach(r=>{const c=document.createElement("li");c.className="search-folder",c.dataset.folderId=r.id,c.innerHTML=`<a><i class="fas fa-folder"></i> ${r.name}</a>`,c.addEventListener("click",w.onSelectSearchedFolder),t.appendChild(c)})),t.classList.remove("hidden"),n.forEach(r=>{const c=document.createElement("li");c.className="search-scene",c.dataset.sceneId=r.id,c.innerHTML=`<a><i class="fas fa-map"></i> ${r.name}</a>`,c.addEventListener("dblclick",P.onActivateScene),c.addEventListener("click",P.onSelectScene),t.appendChild(c)}),a.length===0&&n.length===0){const r=document.createElement("li");r.className="no-results",r.textContent="No matching results found",t.appendChild(r)}}),b(w,"onSelectSearchedFolder",async e=>{e.stopPropagation(),e.preventDefault();const n=e.currentTarget.dataset.folderId,a=document.querySelector("#crlngn-folder-toggle");if(P.navShowRootFolders||a.click(),!n)return;const r=[...ui.scenes.collection.folders.get(n).ancestors];I(w,_,[]);for(const c of r)m(w,_).push(c.id);m(w,_).push(n),await game.user.setFlag(z,"activeSceneFolders",m(w,_)),setTimeout(async()=>{ui.nav.render()},200)});let _e=w;var ue,Ka,Za,Qa,yn,_a;const W=class W{static init(){const e=R();p.log("SheetsUtil.init",[]),game.system.id==="dnd5e"&&(W.themeStylesEnabled=T.get(e.applyThemeToSheets.tag),W.horizontalSheetTabsEnabled=T.get(e.useHorizontalSheetTabs.tag),Hooks.on(A.RENDER_ACTOR_SHEET,ee(W,ue,Ka)),Hooks.on(A.RENDER_COMPENDIUM_BROWSER,ee(W,ue,Za)))}static applyThemeToSheets(e){W.themeStylesEnabled=e,e?document.body.classList.add("crlngn-sheets"):(document.body.classList.remove("crlngn-sheets"),document.body.classList.remove("crlngn-sheet-tabs"),W.horizontalSheetTabsEnabled=!1)}static applyHorizontalSheetTabs(e){var t,n;W.horizontalSheetTabsEnabled=e,W.horizontalSheetTabsEnabled&&W.themeStylesEnabled?(document.body.classList.add("crlngn-sheet-tabs"),ee(t=W,ue,yn).call(t)):(document.body.classList.remove("crlngn-sheet-tabs"),ee(n=W,ue,_a).call(n))}};ue=new WeakSet,Ka=function(e,t,n){var o;p.log(A.RENDER_ACTOR_SHEET,[e,t.querySelector(".sheet-body"),n]),(o=t.querySelector(".sheet-body .main-content"))==null||o.addEventListener("scroll",ee(W,ue,Qa));const a=t.querySelectorAll("nav.tabs > a.item");for(const s of a)s.removeAttribute("data-tooltip"),s.removeAttribute("data-tooltip-delay");W.applyThemeToSheets(W.themeStylesEnabled),W.applyHorizontalSheetTabs(W.horizontalSheetTabsEnabled),W.horizontalSheetTabsEnabled&&setTimeout(()=>{var s;ee(s=W,ue,yn).call(s)},100)},Za=function(e,t,n){p.log(A.RENDER_COMPENDIUM_BROWSER,[e,t,n]),W.horizontalSheetTabsEnabled&&setTimeout(()=>{var a;ee(a=W,ue,yn).call(a)},100)},Qa=function(e){const t=e.target.closest(".window-content"),n=t==null?void 0:t.querySelector(".ability-scores");n&&(e.target.scrollTop>30?n.classList.add("fadeout"):n.classList.remove("fadeout"))},yn=function(){document.querySelectorAll(".dnd5e2.vertical-tabs nav.tabs").forEach(t=>{const n=t.parentElement;if(n.querySelector(".crlngn-tab-scroll-btn"))return;const a=document.createElement("div");a.className="crlngn-tab-scroll-wrapper";const o=document.createElement("button");o.className="crlngn-tab-scroll-btn crlngn-tab-scroll-prev",o.innerHTML='<i class="fas fa-caret-left"></i>',o.addEventListener("click",r=>{r.preventDefault(),t.scrollBy({left:-150,behavior:"smooth"})});const s=document.createElement("button");s.className="crlngn-tab-scroll-btn crlngn-tab-scroll-next",s.innerHTML='<i class="fas fa-caret-right"></i>',s.addEventListener("click",r=>{r.preventDefault(),t.scrollBy({left:150,behavior:"smooth"})}),n.insertBefore(a,t),a.appendChild(o),a.appendChild(t),a.appendChild(s)})},_a=function(){document.querySelectorAll(".crlngn-tab-scroll-wrapper").forEach(t=>{const n=t.querySelector("nav.tabs");n&&t.parentElement&&(t.parentElement.insertBefore(n,t),t.remove())})},L(W,ue),b(W,"themeStylesEnabled",!0),b(W,"horizontalSheetTabsEnabled",!0);let et=W;const x=class x{static init(){Hooks.on(A.RENDER_SIDE_BAR,x.onRender)}static applyFadeOut(e){x.useFadeOut=e,x.handleFadeOut()}static applyHide(e){x.hidden=e,x.handleHide()}static handleHide(e,t,n){var o;const a=t?t.querySelector("#sidebar-tabs"):document.querySelector("#sidebar-tabs");x.hidden?(o=game.user)!=null&&o.isGM||a==null||a.classList.add("hidden-ui"):a==null||a.classList.remove("hidden-ui"),p.log("handle Hide",[x.hidden])}static applyCustomStyle(e){var t;x.customStylesEnabled=e,p.log("applyCustomStyle",[x.customStylesEnabled]),(t=ui.sidebar)==null||t.render()}static applyFolderStyles(e){x.folderStylesEnabled=e,x.folderStylesEnabled?document.querySelector("body").classList.add("crlngn-folder-style"):document.querySelector("body").classList.remove("crlngn-folder-style"),p.log("applyFolderStyles",[x.folderStylesEnabled])}static onRender(e,t,n){var a,o;x.handleClassApplication(),x.handleFadeOut(e,t,n),x.handleHide(e,t,n),x.applyFolderStyles(x.folderStylesEnabled),p.log("SidebarTabs onRender",[(o=(a=foundry.applications)==null?void 0:a.sidebar)==null?void 0:o.tabs])}static handleClassApplication(){x.customStylesEnabled?document.querySelector("body").classList.add("crlngn-tabs"):document.querySelector("body").classList.remove("crlngn-tabs")}static handleFadeOut(e,t,n){const a=t?t.querySelector("#sidebar-tabs"):document.querySelector("#sidebar-tabs");x.useFadeOut?a==null||a.classList.add("faded-ui"):a==null||a.classList.remove("faded-ui"),p.log("SidebarTabs handle fade out",[x.useFadeOut])}};b(x,"useFadeOut",!0),b(x,"hidden",!1),b(x,"customStylesEnabled",!0),b(x,"folderStylesEnabled",!0),b(x,"applySideBarWidth",()=>{const e=R(),t=T.get(e.sideBarWidth.tag)||300;N.addCSSVars("--sidebar-width",`${t}px`)});let Me=x;var vt;const y=class y{static get(e,t=z){if(!e)return null;let n=!1;if(t===z)n=game.settings.get(t,e);else{let o=game.settings.storage.get("client")[`${t}.${e}`];o===void 0&&(o=game.settings.storage.get("world").getSetting(`${t}.${e}`)),n=o==null?void 0:o.value,p.log("GET Setting",[o,n])}return n}static set(e,t,n=z){var s;if(!e)return!1;let a=game.settings.storage.get("client")[`${n}.${e}`],o=!!a;a||(a=game.settings.storage.get("world").getSetting(`${n}.${e}`)),p.log("Setting",[e,a,t]);try{game.settings.set(n,e,t)}catch(r){(!o||!((s=r.message)!=null&&s.includes("lacks permission")))&&p.log("Unable to change setting",[e,a,r.message])}return!0}static apply(e,t=void 0){var a,o,s,r,c,d,f,g,h,C,E,O,j,ne;const n=R();switch(t===void 0&&(t=y.get(e)),p.log("SettingsUtil.apply",[e,t,y.get(e)]),e){case n.disableUI.tag:location.reload();break;case n.enableMacroLayout.tag:Le.applyCustomStyle(t);break;case n.collapseMacroBar.tag:Le.applyHotBarCollapse();break;case n.playerListAvatars.tag:Se.applyAvatars();break;case n.autoHidePlayerList.tag:Se.applyPlayersListSettings();break;case n.uiFontBody.tag:case n.uiFontTitles.tag:case n.journalFontBody.tag:case n.journalFontTitles.tag:y.applyCustomFonts(e,t);break;case n.controlsAutoHide.tag:y.applyLeftControlsSettings(e,t);break;case n.dockHeight.tag:te.currSettings.dockHeight=t,y.applyCameraHeight(t);break;case n.dockWidth.tag:te.currSettings.dockWidth=t,y.applyCameraWidth(t);break;case n.dockPosX.tag:te.currSettings.dockPosX=t,y.applyCameraPosX(t);break;case n.dockPosY.tag:te.currSettings.dockPosY=t,y.applyCameraPosY(t);break;case n.defaultVideoWidth.tag:te.currSettings.defaultVideoWidth=t,te.applyVideoWidth(t);break;case n.dockResizeOnUserJoin.tag:te.currSettings.dockResizeOnUserJoin=t,te.applyDockResize(t);break;case n.chatBorderColor.tag:je.chatBorderColor=t,y.applyBorderColors();break;case n.chatBorderPosition.tag:je.chatBorderPosition=t,y.applyBorderColors();break;case n.sideBarWidth.tag:P.sideBarWidth=t,Me.applySideBarWidth();break;case n.useLeftChatBorder.tag:je.useLeftChatBorder=t;case n.enableChatStyles.tag:je.enableChatStyles=t,y.applyChatStyles();break;case n.debugMode.tag:y.applyDebugSettings();break;case n.useSceneFolders.tag:P.useSceneFolders=t,(a=ui.nav)==null||a.render();break;case n.navShowRootFolders.tag:P.navShowRootFolders=t,(o=ui.nav)==null||o.render();break;case n.hideInactiveOnFolderToggle.tag:P.hideInactiveOnFolderToggle=t,(s=ui.nav)==null||s.render();break;case n.sceneClickToView.tag:P.sceneClickToView=t,(r=ui.nav)==null||r.render(),(d=(c=game.scenes)==null?void 0:c.directory)==null||d.render();break;case n.useSceneIcons.tag:P.useSceneIcons=t,(f=ui.nav)==null||f.render(),(h=(g=game.scenes)==null?void 0:g.directory)==null||h.render();break;case n.useSceneBackButton.tag:P.useSceneBackButton=t,(C=ui.nav)==null||C.render();break;case n.useSceneLookup.tag:P.useSceneLookup=t,(E=ui.nav)==null||E.render();break;case n.useScenePreview.tag:P.useScenePreview=t,(O=ui.nav)==null||O.render();break;case n.sceneItemWidth.tag:P.sceneItemWidth=t,P.applySceneItemWidth();break;case n.navStartCollapsed.tag:P.navStartCollapsed=t,(j=ui.nav)==null||j.render();break;case n.showNavOnHover.tag:P.showNavOnHover=t;break;case n.sceneNavCollapsed.tag:P.isCollapsed=y.get(n.sceneNavCollapsed.tag);break;case n.colorTheme.tag:y.applyThemeSettings();break;case n.playerColorTheme.tag:y.applyThemeSettings();break;case n.customStyles.tag:y.applyCustomCSS(t);break;case n.forcedDarkTheme.tag:y.applyForcedDarkTheme(t);break;case n.adjustOtherModules.tag:y.applyModuleAdjustments(t);break;case n.applyDarkThemeToModules.tag:y.applyDarkThemeToModules(t);break;case n.otherModulesList.tag:y.applyOtherModulesList(t);break;case n.enablePlayerList.tag:Se.applyCustomStyle(t);break;case n.sceneNavEnabled.tag:P.applyTopNavHeight(),P.applyCustomStyle(t);break;case n.enableMacroLayout.tag:Le.applyCustomStyle(t);break;case n.enableFloatingDock.tag:te.applyCustomStyle(t);break;case n.enableSidebarTabs.tag:Me.applyCustomStyle(t);break;case n.enableChatLogControls.tag:ft.applyCustomStyle(t);break;case n.enableSceneControls.tag:gt.applyCustomStyle(t);break;case n.sceneControlsFadeOut.tag:gt.applyFadeOut(t);break;case n.playerListFadeOut.tag:Se.applyFadeOut(t);break;case n.sidebarTabsFadeOut.tag:Me.applyFadeOut(t);break;case n.cameraDockFadeOut.tag:te.applyFadeOut(t);break;case n.macroHotbarFadeOut.tag:Le.applyFadeOut(t);break;case n.chatLogControlsFadeOut.tag:ft.applyFadeOut(t);break;case n.sceneNavFadeOut.tag:P.applyFadeOut(t);break;case n.sceneControlsHide.tag:gt.applyHide(t);break;case n.playerListHide.tag:Se.applyHide(t);break;case n.sidebarTabsHide.tag:Me.applyHide(t);break;case n.cameraDockHide.tag:te.applyHide(t);break;case n.macroHotbarHide.tag:Le.applyHide(t);break;case n.chatLogControlsHide.tag:ft.applyHide(t);break;case n.sceneNavHide.tag:P.applyHide(t);break;case n.useFolderStyle.tag:Me.applyFolderStyles(t);break;case n.applyThemeToSheets.tag:et.applyThemeToSheets(t);break;case n.useHorizontalSheetTabs.tag:et.applyHorizontalSheetTabs(t);break;case n.enforceGMSettings.tag:t&&((ne=game.user)!=null&&ne.isGM)&&(y.saveDefaultSettings(),ui.notifications.info("Current settings saved as defaults for players"));break}}static applyBorderColors(){const e=R(),t=y.get(e.chatBorderColor.tag),n=document.querySelector("body");t===Ct.playerColor.name?(n.classList.add("player-chat-borders"),n.classList.remove("roll-chat-borders")):t===Ct.rollType.name?(n.classList.add("roll-chat-borders"),n.classList.remove("player-chat-borders")):(n.classList.remove("player-chat-borders"),n.classList.remove("roll-chat-borders"))}static applyChatStyles(){const e=R(),t=y.get(e.enableChatStyles.tag),n=document.querySelector("body");p.log("applyChatStyles",[t,e]),t?n.classList.add("crlngn-chat"):n.classList.remove("crlngn-chat")}static applyLeftControlsSettings(e,t){const n=R();y.get(n.sceneNavEnabled.tag);const a=document.querySelector("#ui-left");switch(document.querySelector("body.crlngn-ui"),document.querySelector("#crlngn-ui-vars"),p.log("applyLeftControlsSettings",[e]),e){case n.controlsAutoHide.tag:y.get(n.controlsAutoHide.tag)?a.classList.add("auto-hide"):a.classList.remove("auto-hide");break}}static applyControlIconSize(){const e=R(),t=y.get(e.controlsIconSize.tag);document.querySelector("body");const n=kt[t]?kt[t].size:kt.regular.size;function a(o){switch(o){case kt.large.name:return"var(--font-size-18);";case kt.regular.name:return"var(--font-size-16);";default:return"var(--font-size-14);"}}p.log("applyControlIconSize",[n]),N.addCSSVars("--icon-font-size",a(t)),N.addCSSVars("--control-item-size",n),y.applyLeftControlsSettings()}static applySceneNavPos(e){const t=R();P.navPos=e||y.get(t.sceneNavPos.tag)}static applyCameraPosX(e){const t=R(),n=y.get(t.dockPosX.tag),a=e||n;te.resetPositionAndSize({x:a})}static applyCameraPosY(e){const t=R(),n=y.get(t.dockPosY.tag),a=e||n;te.resetPositionAndSize({y:a})}static applyCameraWidth(e){const t=R(),n=y.get(t.dockWidth.tag),a=e||n;te.resetPositionAndSize({w:a})}static applyCameraHeight(e){const t=R(),n=y.get(t.dockHeight.tag),a=e||n;te.resetPositionAndSize({h:a})}static applyCustomFonts(e,t){const n=R(),a=n.customFontsMenu.fields,o={};switch(p.log("applyCustomFonts",[e,t]),a.forEach(s=>{o[s]=y.get(n[s].tag)}),document.querySelector("body.crlngn-ui"),e){case n.uiFontBody.tag:N.addCSSVars("--crlngn-font-family",t||o.uiFontBody||n.uiFontBody.default.uiFont||"");break;case n.uiFontTitles.tag:N.addCSSVars("--crlngn-font-titles",t||o.uiFontTitles||n.uiFontTitles.default.uiTitles||"");break;case n.journalFontBody.tag:N.addCSSVars("--crlngn-font-journal-body",t||o.journalFontBody||o.journalFontBody||"");break;case n.journalFontTitles.tag:N.addCSSVars("--crlngn-font-journal-title",t||o.journalFontTitles||o.journalFontTitles||"");break}}static resetFoundryThemeSettings(){}static applyDebugSettings(e){const t=R();p.debugOn=e||y.get(t.debugMode.tag)}static enforceGMSettings(){var a;const e=R();if((a=game.user)!=null&&a.isGM||!y.get(e.enforceGMSettings.tag))return;const t=y.get(e.defaultSettings.tag);if(!t||Object.keys(t).length<=1){p.log("No default GM settings found to enforce");return}p.log("Enforcing GM settings to player",[t]);let n=!1;for(const[o,s]of Object.entries(t))if(o!=="_version")try{const r=Object.values(e).find(c=>c.tag===o);r&&r.scope==="client"&&y.get(o)!==s&&(y.set(o,s),p.log(`Applied GM setting: ${o}`,[s]),n=!0)}catch(r){p.log(`Failed to apply GM setting: ${o}`,[r])}return n}static saveDefaultSettings(){var n;const e=R();if(!((n=game.user)!=null&&n.isGM)||!y.get(e.enforceGMSettings.tag))return;const t={_version:Date.now()};for(const[a,o]of Object.entries(e))if(o.tag&&o.scope==="client"&&!o.isMenu){const s=y.get(o.tag);s!==void 0&&(t[o.tag]=s)}y.set(e.defaultSettings.tag,t),p.log("Saved default GM settings",[t])}static onSettingChange(e){var n;const t=R();(n=game.user)!=null&&n.isGM&&y.get(t.enforceGMSettings.tag)&&y.saveDefaultSettings()}};vt=new WeakMap,L(y,vt,!1),b(y,"firstLoad",!0),b(y,"foundryUiConfig",null),b(y,"registerSettings",async()=>{const e=R();if(Object.entries(e).forEach(async f=>{const g=f[1];if(g.showOnRoot&&g.isMenu||!g.isMenu){const h={name:g.label,hint:g.hint,default:g.default,type:g.propType,scope:g.scope,config:g.config,requiresReload:g.requiresReload||!1,onChange:C=>{y.apply(g.tag,C),g.tag!=="v2-enforce-gm-settings"&&g.tag!=="v2-default-settings"&&y.onSettingChange(g.tag)}};(g.choices||g.options)&&(h.choices=g.choices||g.options),await game.settings.register(z,g.tag,h),y.get(g.tag)===void 0&&(p.log("resetting...",[g.tag]),y.set(g.tag,g.default))}}),y.get(e.disableUI.tag))return;game.keybindings.register(z,"hideInterface",{name:game.i18n.localize("CRLNGN_UI.settings.hideInterface.label"),hint:game.i18n.localize("CRLNGN_UI.settings.hideInterface.hint"),editable:[{key:"0",modifiers:["Control"]}],onDown:()=>{},onUp:()=>{y.hideInterface()},restricted:!1}),y.applyThemeSettings(),y.applyCustomCSS(),y.applyModuleAdjustments(),P.applyTopNavHeight();const a=Object.entries(Pa()).find(f=>f[0]==="moduleSettingsMenu");if(a){const f=a[1],g={name:f.tag,label:f.label,hint:f.hint,icon:f.icon,type:f.propType,restricted:!1};await game.settings.registerMenu(z,f.tag,g)}y.foundryUiConfig=game.settings.get("core","uiConfig")||null,Hooks.on(A.RENDER_SCENE_CONTROLS,y.applyLeftControlsSettings),Hooks.on(A.RENDER_PLAYERS_LIST,Se.applyPlayersListSettings),Hooks.on(A.RENDER_HOTBAR,()=>{Le.applyCustomStyle(),y.firstLoad&&(y.firstLoad=!1,Le.applyHotBarCollapse())}),y.applyDebugSettings(),y.applyChatStyles(),y.applyBorderColors(),et.applyThemeToSheets(y.get(e.applyThemeToSheets.tag)),et.applyHorizontalSheetTabs(y.get(e.useHorizontalSheetTabs.tag)),e.sceneNavMenu.fields.forEach(f=>{y.apply(e[f].tag)}),e.cameraDockMenu.fields.forEach(f=>{y.apply(e[f].tag)}),e.customFontsMenu.fields.forEach(f=>{y.applyCustomFonts(e[f].tag)}),e.leftControlsMenu.fields.forEach(f=>{y.applyLeftControlsSettings(e[f].tag)}),e.interfaceOptionsMenu.fields.forEach(f=>{y.apply(e[f].tag)}),y.applyForcedDarkTheme(),Me.applySideBarWidth(),y.applyDarkThemeToModules()}),b(y,"applyThemeSettings",e=>{const t=R(),n=e||y.get(t.playerColorTheme.tag)||y.get(t.colorTheme.tag)||"",a=document.querySelector("body");p.log("applyThemeSettings",[e,n,y.get(t.colorTheme.tag)]),ke.forEach(o=>{o.className&&a.classList.remove(o.className)}),n&&a.classList.add(n)}),b(y,"applyCustomCSS",e=>{const t=R(),n=e||y.get(t.customStyles.tag)||"";N.addCustomCSS(n)}),b(y,"applyForcedDarkTheme",e=>{var s,r,c,d;if(!(((r=(s=y.foundryUiConfig)==null?void 0:s.colorScheme)==null?void 0:r.applications)==="dark"||((d=(c=y.foundryUiConfig)==null?void 0:c.colorScheme)==null?void 0:d.interface)==="dark"))return;const n=R(),a=e||y.get(n.forcedDarkTheme.tag)||"";if(!a.trim())return;const o=N.processCSSRules(oo,a);p.log("applyForcedDarkTheme",[o.substring(0,100)+"..."]),N.addCustomCSS(o,"crlngn-forced-dark-mode")}),b(y,"applyModuleAdjustments",e=>{const t=R();(e||y.get(t.adjustOtherModules.tag)||!1)&&Et.addModuleClasses()}),b(y,"applyDarkThemeToModules",e=>{var o;const t=R(),n=e||y.get(t.applyDarkThemeToModules.tag)||!1,a=game.settings.get("core","uiConfig")||null;n&&((o=a==null?void 0:a.colorScheme)==null?void 0:o.applications)==="dark"&&(y.applyForcedDarkTheme(".app.theme-light, .application.theme-light, #AA-autorec-settings"),document.querySelector("body").classList.add("crlngn-forced-dark-theme"))}),b(y,"applyOtherModulesList",e=>{const t=R(),n=e||y.get(t.otherModulesList.tag);p.log("applyOtherModulesList",[n]),n.split(",").length===0?(y.set(t.adjustOtherModules.tag,!1),y.set(t.otherModulesList.tag,"")):y.set(t.adjustOtherModules.tag,!0),Et.addModuleClasses()}),b(y,"hideInterface",()=>{p.log("hideInterface");const e=document.querySelector("#interface"),t=document.querySelector("#camera-views"),n=document.querySelector(".taskbar");m(y,vt)?(e&&e.style.removeProperty("visibility"),e&&t.style.removeProperty("visibility"),e&&n.style.removeProperty("visibility"),I(y,vt,!1)):(e&&e.style.setProperty("visibility","hidden"),t&&t.style.setProperty("visibility","hidden"),n&&n.style.setProperty("visibility","hidden"),I(y,vt,!0))});let T=y;const qt=class qt{static getUpdateNewsUrl(){var n;const e=(n=game.modules.get("crlngn-ui"))==null?void 0:n.version,t=e?`https://github.com/crlngn/crlngn-ui/releases/download/v${e}/module-updates.json`:"";return`https://proxy.carolingian.io/proxy?url=${encodeURIComponent(t)}&v=${e}`}static init(){var e;(e=game.user)!=null&&e.isGM&&this.checkForUpdates()}static cleanSetting(){const e=R();T.set(e.lastUpdateId.tag,"")}static async checkForUpdates(){const e=R();try{const t=new AbortController,n=setTimeout(()=>t.abort(),1e4);try{const a=await T.get(e.lastUpdateId.tag),o=await qt.getIdFromRawJson();if(p.log("checkForUpdates...",[o,a]),a===o)return;const s=await fetch(qt.getUpdateNewsUrl(),{signal:t.signal,mode:"cors",credentials:"omit"});if(clearTimeout(n),!s.ok){p.warn("checkForUpdates | Failed to fetch update news",[s.status,s.statusText]);return}const r=await s.json();await this.displayUpdateNews(r),T.set(e.lastUpdateId.tag,r.id),p.log("checkForUpdates | SUCCESS",[r.id])}catch(a){clearTimeout(n),a.name==="AbortError"?p.warn("checkForUpdates | Request timed out",[a]):p.warn("checkForUpdates | Fetch error",[a.message])}}catch(t){p.warn("checkForUpdates | Unexpected error",[t])}}static async displayUpdateNews(e){try{const t=`
        <div class="crlngn-news">
          <h3>${e.title}</h3>
          ${e.imageUrl?`<img src="${e.imageUrl}" alt="Update Preview" />`:""}
          ${e.videoUrl?`<div class="updates-media-container"><video controls autoplay loop src="${e.videoUrl}" alt="Update Preview" style="width: 100%"></video></div>`:""}
          <div class="crlngn-news-content">
          ${e.content}
          </div>
        </div>
      `;p.error("displayUpdateNews | Chat message created",[e]);const n=await ChatMessage.create({content:t,whisper:[game.user.id],speaker:{alias:"Carolingian UI"}});p.error("displayUpdateNews | Chat message created",[n,e])}catch(t){p.error("displayUpdateNews | Error creating chat message",[t])}}};b(qt,"getIdFromRawJson",async()=>{const t=await fetch("https://raw.githubusercontent.com/crlngn/crlngn-ui/refs/heads/v2/news/module-updates.json"),n=t.ok?await t.json():null;return n&&n.id||""});let sa=qt;class Fo{static init(){Handlebars.registerHelper("normalizedIncludes",function(e,t){return p.log("CustomHandlebarsHelpers",[e,t,e==null?void 0:e.includes(t)]),e==null?void 0:e.includes(t)})}}var qn;const Be=class Be{static init(){Hooks.once(A.INIT,()=>{var o,s;if(document.querySelector("body").classList.add(z),(o=document.querySelector("#ui-middle"))==null||o.classList.add(z),game.data.version<"13.339"){Be.isIncompatible=!0;return}p.log("Initiating module...",[],!0),window.crlngnUI=window.crlngnUI||{},T.registerSettings();const n=R(),a=T.get(n.disableUI.tag);if(p.log(A.INIT,[a]),a){document.querySelector("body").classList.remove(z),(s=document.querySelector("#ui-middle"))==null||s.classList.remove(z);return}Se.init(),P.init(),te.init(),gt.init(),ft.init(),je.init(),Me.init(),Le.init(),Hooks.on(A.RENDER_CHAT_MESSAGE,m(Be,qn))}),Hooks.once(A.READY,()=>{var o;if(p.log("Core Ready",[game]),Be.isIncompatible){ui.notifications.error(game.i18n.localize("CRLNGN_UI.notifications.incompatibleVersion"),{permanent:!0});return}const e=R();var t=T.get(e.debugMode.tag);t&&(CONFIG.debug.hooks=!0),Fo.init(),P.checkSideBar(((o=ui.sidebar)==null?void 0:o.expanded)||!1),T.enforceGMSettings()&&P.refreshSettings(),Se.applyPlayersListSettings(),Et.init(),sa.init(),et.init(),T.get(e.enableChatStyles.tag)&&Be.addCSSLocalization(),setTimeout(()=>{var s;(s=ui.combat.popout)==null||s.close()},200)})}static addCSSLocalization(){const e="CRLNGN_UI.dnd5e.chatCard.buttons";N.addCSSVars("--crlngn-i18n-attack",game.i18n.localize(`${e}.attack`)),N.addCSSVars("--crlngn-i18n-damage",game.i18n.localize(`${e}.damage`)),N.addCSSVars("--crlngn-i18n-summons",game.i18n.localize(`${e}.summons`)),N.addCSSVars("--crlngn-i18n-healing",game.i18n.localize(`${e}.healing`)),N.addCSSVars("--crlngn-i18n-template",game.i18n.localize(`${e}.template`)),N.addCSSVars("--crlngn-i18n-consume",game.i18n.localize(`${e}.consume`)),N.addCSSVars("--crlngn-i18n-refund",game.i18n.localize(`${e}.refund`)),N.addCSSVars("--crlngn-i18n-macro",game.i18n.localize(`${e}.macro`)),N.addCSSVars("--crlngn-i18n-save-dc",game.i18n.localize(`${e}.savedc`)),N.addCSSVars("--crlngn-i18n-save",game.i18n.localize(`${e}.save`))}};qn=new WeakMap,b(Be,"isIncompatible",!1),L(Be,qn,(e,t,n)=>{p.log(A.RENDER_CHAT_MESSAGE,[e,t,n]),je.enrichCard(e,t)});let ia=Be;ia.init();
//# sourceMappingURL=crlngn-ui.js.map

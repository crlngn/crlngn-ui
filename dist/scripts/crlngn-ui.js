var fa=Object.defineProperty;var To=l=>{throw TypeError(l)};var pa=(l,e,t)=>e in l?fa(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var b=(l,e,t)=>pa(l,typeof e!="symbol"?e+"":e,t),jn=(l,e,t)=>e.has(l)||To("Cannot "+t);var m=(l,e,t)=>(jn(l,e,"read from private field"),t?t.call(l):e.get(l)),k=(l,e,t)=>e.has(l)?To("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(l):e.set(l,t),O=(l,e,t,n)=>(jn(l,e,"write to private field"),n?n.call(l,t):e.set(l,t),t),H=(l,e,t)=>(jn(l,e,"access private method"),t);var No=(l,e,t,n)=>({set _(o){O(l,e,o,t)},get _(){return m(l,e,n)}});const A={INIT:"init",READY:"ready",CANVAS_READY:"canvasReady",CANVAS_INIT:"canvasInit",RENDER_CHAT_MESSAGE:"renderChatMessageHTML",GET_SCENE_CONTROLS:"getSceneControlButtons",RENDER_SCENE_CONTROLS:"renderSceneControls",RENDER_PLAYERS_LIST:"renderPlayers",ACTIVATE_SCENE_CONTROLS:"activateSceneControls",RENDER_SCENE_NAV:"renderSceneNavigation",COLLAPSE_SCENE_NAV:"collapseSceneNavigation",EXPAND_SCENE_NAV:"expandSceneNavigation",GET_SCENE_NAV_CONTEXT:"getSceneNavigationContext",RENDER_SCENE:"renderScene",RENDER_DOCUMENT_DIRECTORY:"renderDocumentDirectory",GET_SCENE_DIRECTORY_ENTRY_CONTEXT:"getSceneDirectoryEntryContext",RENDER_SCENE_DIRECTORY:"renderSceneDirectory",CREATE_FOLDER:"createFolder",UPDATE_FOLDER:"updateFolder",DELETE_FOLDER:"deleteFolder",CREATE_SCENE:"createScene",UPDATE_SCENE:"updateScene",DELETE_SCENE:"deleteScene",COLLAPSE_SIDE_BAR:"collapseSidebar",EXPAND_SIDE_BAR:"expandSidebar",RENDER_SIDE_BAR:"renderSidebar",ACTIVATE_CHAT_LOG:"activateChatLog",ACTIVATE_CHAT_LOG_5E:"activateChatLog5e",RENDER_HOTBAR:"renderHotbar",RENDER_CAMERA_VIEWS:"renderCameraViews",WEBRTC_USER_STATE_CHANGED:"webrtcUserStateChanged",WEBRTC_SETTINGS_CHANGED:"webrtcSettingsChanged",RTC_SETTINGS_CHANGED:"rtcSettingsChanged",RTC_MODE_CHANGED:"rtcModeChanged",RTC_VOICE_SETTINGS_CHANGED:"rtcVoiceSettingsChanged",RTC_LOCAL_STREAM_ESTABLISHED:"rtcLocalStreamEstablished",RTC_LOCAL_STREAM_ERROR:"rtcLocalStreamError",RTC_PEER_CONNECTED:"rtcPeerConnected",RTC_PEER_DISCONNECTED:"rtcPeerDisconnected",RTC_PEER_ERROR:"rtcPeerError",RTC_SIGNALING_EVENT:"rtcSignalingEvent",RENDER_AV_CONFIG:"renderAVConfig",RENDER_AV_MASTER:"renderAVMaster",RENDER_AV_CLIENT:"renderAVClient",USER_CONNECTED:"userConnected",USER_DISCONNECTED:"userDisconnected",UPDATE_USER:"updateUser",UPDATE_DOCUMENT:"updateDocument",UPDATE_SETTING:"updateSetting",CLIENT_SETTING_CHANGED:"clientSettingChanged",RENDER_TOKEN_HUD:"renderTokenHUD",RENDER_ACTOR_SHEET:"renderActorSheetV2",RENDER_ITEM_SHEET:"renderItemSheetV2",RENDER_COMPENDIUM_BROWSER:"renderCompendiumBrowser"},q="crlngn-ui",dn=["%cCarolingian UI","color:rgb(107, 72, 149); font-weight: bold;","|"],ha=`
  --background: var(--color-dark-bg-95) !important;
  --filigree-background-color: var(--color-dark-bg-10) !important;
  --dnd5e-border-dotted: 1px dotted var(--color-cool-4) !important;
  --dnd5e-color-gold: rgba(159, 146, 117, 0.6) !important;
  --input-background-color: var(--color-cool-4) !important;
  --chat-dark-blue: rgba(24, 32, 38, 1) !important;
  --input-background-alt: var(--color-dark-bg-50) !important;
  --color-text-secondary: var(--color-light-1) !important;
  --color-text-primary: var(--color-light-1) !important;
  --button-text-color: var(--color-light-1) !important;
  --color-border-light-1: var(--dnd5e-color-gold) !important;
  --color-text-dark-input: var(--color-light-3) !important;
  --color-border-trait: var(--color-cool-4) !important;

  --crlngn-button-bg: rgba(15, 15, 15, 0.15) !important;
  --color-bg-button: rgba(32, 37, 43, 1) !important;
  --dnd5e-border-groove: 1px solid rgba(36, 36, 36, 0.5) !important;
  --dnd5e-color-groove: var(--dnd5e-color-gold) !important;
  --dnd5e-sheet-bg: rgb(37, 40, 48) !important;
  --sidebar-background: var(--control-bg-color, var(--color-cool-5-90)) !important;
  --dnd5e-color-parchment: rgb(32, 37, 43) !important;
  --dnd5e-background-card: rgb(32, 37, 43) !important; 
  --dnd5e-background-parchment: var(--color-cool-4) !important;

  --color-pf-alternate: rgba(82, 107, 120, 0.44) !important;
  --color-text-gray-blue: rgb(168, 180, 188, 1) !important;
  --color-text-gray-blue-b: rgb(138, 155, 168, 1) !important;
  --chat-button-bg: rgba(32, 37, 43, 1) !important;
  --chat-button-bg-15: rgba(32, 37, 43, 0.15) !important;
  --chat-button-bg-25: rgba(32, 37, 43, 0.25) !important;
  --chat-button-bg-50: rgba(32, 37, 43, 0.5) !important;
  --chat-button-bg-75: rgba(32, 37, 43, 0.75) !important;
  --chat-dark-blue: rgba(24, 32, 38, 1) !important;
  --chat-dark-blue-b: rgb(29, 36, 48, 1) !important; 
  --chat-dark-bg: rgba(32, 37, 43, 1) !important; 
  --chat-dark-bg-15: rgba(32, 37, 43, 0.15) !important;
  --chat-dark-bg-25: rgba(32, 37, 43, 0.25) !important;
  --chat-dark-bg-50: rgba(32, 37, 43, 0.50) !important; 
  --chat-dark-bg-75: rgba(32, 37, 43, 0.75) !important; 
  --chat-dark-bg-90: rgba(32, 37, 43, 0.90) !important; 

  --color-input-bg: var(--color-dark-bg-50) !important; 

  --color-button-bg: rgba(90,120,150,0.5) !important;
  --color-input-border: rgba(90,120,150, 0.5) !important;
  --color-border-dark-5: rgba(80, 80, 80, 1) !important;
  --color-sidebar-font: rgba(213, 221, 230, 0.8) !important;

  --color-text-dark: rgba(235,235,235,1) !important;
  --color-text-dark-op: rgba(235,235,235,0.6) !important;
  --color-text-light: rgba(235,235,235,1) !important;
  --input-background-alt: var(--color-cool-5) !important;
  --color-text-secondary:var(--color-light-3) !important;
  --color-text-primary: var(--color-light-1) !important;

  --color-text-dark-primary: var(--color-light-1) !important;
  --button-border-color: transparent;

  background: var(--color-dark-bg-90) !important;
  color: var(--color-light-1) !important;

  .window-header, header, footer {
    background-color: var(--color-dark-bg-75) !important;
    color: var(--color-light-1) !important;
    box-shadow: none;
  }
  
  .window-content {
    background: var(--color-dark-bg-25) !important;
    color: var(--color-light-1) !important;
  }

  .window-header{
    border-bottom: 1px solid var(--color-cool-4) !important;
  }

  section.window-content form.crb-style header.char-header .char-level .level, section.window-content form.crb-style {
    background: transparent !important;
  }
  form.crb-style aside .sidebar * {
    background: transparent !important;
  }

  p, span, div:not(.currency-image), aside, section, nav, label, form, button, table, td, tr, th, h1, h2, h3, h4, h5, h6, ul, ol, li, b, strong, u{
    background-color: transparent;
    border-color: var(--color-cool-4);
  }

  *{
    color: var(--color-light-1);
  }

  a.content-link, a.inline-roll  {
    background-color: transparent !important;
    color: var(--color-light-1) !important;
  }
  p{
     line-height: 1.75;
  }

  input:not([type="range"]), select {
    background-color: var(--color-cool-4);
    color: var(--color-light-1);
    border-color: var(--color-cool-4);
  }

  select option {
    background: transparent;
  }

  fieldset {
    border-color: var(--color-cool-4);
  }

  button, .window-resizable-handle{
    color: var(--color-light-1) !important;
    border-color: transparent;
    background-color: var(--color-bg-button) !important;
  }

  button:hover{
    background-color: var(--color-warm-2) !important;
  }
`,On=class On{static log(e="",t=[],n=!1){try{const o=On.debugOn;if(!(n||o))return;console.log(...dn,e,...t)}catch{console.log(...dn,e,...t)}}static warn(e="",t=[]){console.warn(...dn,e,...t)}static error(e,t){var n;t.ui&&((n=ui.notifications)==null||n.error(e,{localize:!0,permanent:t.permanent})),t.console&&console.error(...dn,e)}};b(On,"debugOn",!1);let p=On;const ma="modulepreload",ya=function(l){return"/modules/crlngn-ui/"+l},Lo={},qo=function(e,t,n){let o=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),r=(s==null?void 0:s.nonce)||(s==null?void 0:s.getAttribute("nonce"));o=Promise.allSettled(t.map(i=>{if(i=ya(i),i in Lo)return;Lo[i]=!0;const c=i.endsWith(".css"),g=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${i}"]${g}`))return;const u=document.createElement("link");if(u.rel=c?"stylesheet":ma,c||(u.as="script"),u.crossOrigin="",u.href=i,r&&u.setAttribute("nonce",r),document.head.appendChild(u),c)return new Promise((h,y)=>{u.addEventListener("load",h),u.addEventListener("error",()=>y(new Error(`Unable to preload CSS for ${i}`)))})}))}function a(s){const r=new Event("vite:preloadError",{cancelable:!0});if(r.payload=s,window.dispatchEvent(r),!r.defaultPrevented)throw s}return o.then(s=>{for(const r of s||[])r.status==="rejected"&&a(r.reason);return e().catch(a)})},wo={select:"select",checkbox:"checkbox",text:"text",number:"number"},C={client:"client",world:"world"},Pt={small:{name:"small",size:"36px"},regular:{name:"regular",size:"42px"},large:{name:"large",size:"48px"}},Nt={playerColor:{name:"playerColor"},rollType:{name:"rollType"},none:{name:"none"}},hn={left:{name:"left"},right:{name:"right"},top:{name:"top"},all:{name:"all"}},De={off:{name:"OFF"},horizontal:{name:"horizontal"},vertical:{name:"vertical"}},Yn=140,$=[{label:"Carolingian Teal",className:"crlngn-theme",colorPreview:["rgb(193, 193, 217)","rgb(62, 62, 88)","rgb(68, 147, 173)"]},{label:"Royal Blood",className:"crlngn-theme-royal-blood",colorPreview:["rgb(215, 206, 224)","rgb(40, 31, 49)","rgb(159, 35, 49)"]},{label:"Dark Sorcery",className:"crlngn-theme-dark-sorcery",colorPreview:["rgb(206, 222, 224)","rgb(31, 47, 49)","rgb(126, 88, 182)"]},{label:"Grass and Stone",className:"crlngn-theme-grass-stone",colorPreview:["rgb(207, 208, 208)","rgb(47, 48, 48)","rgb(121, 163, 62)"]},{label:"Gold and Chocolate",className:"crlngn-theme-gold-chocolate",colorPreview:["rgb(221, 212, 212)","rgb(34, 25, 25)","rgb(164, 138, 51)"]},{label:"Pumpkin Patch",className:"crlngn-theme-pumpkin-patch",colorPreview:["rgb(215, 206, 224)","rgb(40, 31, 49)","rgb(220, 120, 43)"]},{label:"Plum Purple",className:"crlngn-plum-purple",colorPreview:["rgb(230, 233, 236)","rgb(20, 23, 26)","rgb(146, 42, 96)"]},{label:"Gambit's Blue",className:"crlngn-theme-gambits-blue",colorPreview:["rgb(215, 206, 224)","rgb(40, 31, 49)","rgb(45, 126, 207)"]}];function w(){return{moduleSettingsMenu:{isMenu:!0,showOnRoot:!0,tag:"v2-interface-options-menu",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.hint"),propType:Object,scope:C.client,config:!1,requiresReload:!1,fields:[],default:{}},interfaceOptionsMenu:{isMenu:!0,showOnRoot:!1,tag:"v2-interface-options-menu",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.hint"),propType:Object,fields:["sceneControlsFadeOut","sidebarTabsFadeOut","chatLogControlsFadeOut","playerListFadeOut","cameraDockFadeOut","macroHotbarFadeOut","sceneNavFadeOut","sceneControlsHide","sidebarTabsHide","chatLogControlsHide","playerListHide","cameraDockHide","macroHotbarHide","sceneNavHide","enableSceneControls","enableSidebarTabs","enableChatLogControls","sceneNavEnabled","enableMacroLayout","enableFloatingDock","enablePlayerList","collapseMacroBar","useFolderStyle","controlsAutoHide"],default:{sceneControlsFadeOut:!1,sidebarTabsFadeOut:!1,chatLogControlsFadeOut:!0,playerListFadeOut:!0,cameraDockFadeOut:!1,macroHotbarFadeOut:!0,sceneNavFadeOut:!1,sceneControlsHide:!1,sidebarTabsHide:!1,chatLogControlsHide:!1,playerListHide:!1,cameraDockHide:!1,macroHotbarHide:!1,sceneNavHide:!1,enableSceneControls:!0,enableSidebarTabs:!0,enableChatLogControls:!0,sceneNavEnabled:!0,enableMacroLayout:!0,enableFloatingDock:!0,enablePlayerList:!0,collapseMacroBar:!1,useFolderStyle:!0,controlsAutoHide:!1},scope:C.client,config:!1,requiresReload:!1},customFontsMenu:{tag:"v2-custom-font-families",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.label"),title:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.hint"),description:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.description"),propType:Object,fields:["uiFontBody","uiFontTitles","journalFontBody","journalFontTitles"],default:{uiFontBody:'"Work Sans", Arial, sans-serif',uiFontTitles:game.system.id==="daggerheart"?'"Cinzel Decorative", Arial, sans-serif':'"Roboto Slab", Arial, sans-serif',journalFontBody:'"Work Sans", Arial, sans-serif',journalFontTitles:game.system.id==="daggerheart"?'"Cinzel Decorative", Arial, sans-serif':'"Roboto Slab", Arial, sans-serif'},scope:C.world,config:!1,requiresReload:!1},themeAndStylesMenu:{isMenu:!0,showOnRoot:!1,tag:"v2-theme-styles-menu",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.label"),title:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.hint"),propType:String,fields:["colorTheme","applyDarkThemeToModules","adjustOtherModules","otherModulesList","forcedDarkTheme","customStyles","applyThemeToSheets"],default:{colorTheme:"crlngn-theme",applyDarkThemeToModules:!0,adjustOtherModules:!0,otherModulesList:"'combat-carousel','dice-tray','hurry-up','crux','fvtt-youtube-player','bg3-inspired-hotbar','touch-vtt','breaktime','simple-timekeeping'",forcedDarkTheme:"",customStyles:"",applyThemeToSheets:!0},scope:C.world,config:!1,requiresReload:!1},player_themeAndStylesMenu:{isMenu:!0,showOnRoot:!1,tag:"v2-player-theme-styles-menu",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.label"),title:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.hint"),propType:String,fields:["playerColorTheme","useHorizontalSheetTabs"],default:{playerColorTheme:"",useHorizontalSheetTabs:!0},scope:C.client,config:!1,requiresReload:!1},chatMessagesMenu:{isMenu:!0,showOnRoot:!1,tag:"v2-chat-messages-menu",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.hint"),propType:Object,fields:["sideBarWidth","enableChatStyles","chatBorderColor","useLeftChatBorder","chatBorderPosition"],default:{sideBarWidth:300,enableChatStyles:!0,chatBorderColor:Nt.playerColor.name,useLeftChatBorder:!0,chatBorderPosition:"left"},scope:C.client,config:!1,requiresReload:!1},leftControlsMenu:{isMenu:!0,showOnRoot:!1,tag:"v2-left-controls-menu",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.hint"),propType:Object,fields:["controlsAutoHide"],default:{controlsAutoHide:!1},scope:C.client,config:!1,requiresReload:!1},playersListMenu:{isMenu:!0,showOnRoot:!1,tag:"v2-players-list-menu",label:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.hint"),propType:Object,fields:["autoHidePlayerList","playerListAvatars"],default:{autoHidePlayerList:!1,playerListAvatars:!0},scope:C.client,config:!1,requiresReload:!1},sheets5eMenu:{isMenu:!0,showOnRoot:!1,tag:"v2-sheets-5e-menu",label:game.i18n.localize("CRLNGN_UI.settings.sheets5eMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sheets5eMenu.hint"),propType:Object,fields:["applyThemeToSheets","useHorizontalSheetTabs"],default:{applyThemeToSheets:!0,useHorizontalSheetTabs:!0},scope:C.client,config:!1,requiresReload:!1},cameraDockMenu:{isMenu:!0,showOnRoot:!1,tag:"v2-camera-dock-menu",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.hint"),propType:Object,fields:["dockResizeOnUserJoin","dockPosX","dockPosY","dockWidth","dockHeight","defaultVideoWidth"],default:{dockResizeOnUserJoin:De.horizontal.name,defaultVideoWidth:160,dockPosX:0,dockPosY:120,dockWidth:160,dockHeight:140},scope:C.client,config:!1,requiresReload:!1},sceneNavMenu:{isMenu:!0,showOnRoot:!1,tag:"v2-scene-nav-menu",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.hint"),propType:Object,fields:["useSceneFolders","navShowRootFolders","useSceneLookup","sceneClickToView","useSceneIcons","useSceneBackButton","useScenePreview","hideInactiveOnFolderToggle"],default:{useSceneFolders:!0,sceneClickToView:!0,useSceneIcons:!0,navShowRootFolders:!1,useSceneLookup:!0,useScenePreview:!0,useSceneBackButton:!0,hideInactiveOnFolderToggle:!0},scope:C.world,config:!1,requiresReload:!1},player_sceneNavMenu:{isMenu:!0,showOnRoot:!1,tag:"v2-player-scene-nav-menu",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.hint"),propType:Object,fields:["navStartCollapsed","showNavOnHover","sceneItemWidth"],default:{navStartCollapsed:!1,showNavOnHover:!1,sceneItemWidth:150},scope:C.client,config:!1,requiresReload:!1},enforceGMSettings:{tag:"v2-enforce-gm-settings",label:game.i18n.localize("CRLNGN_UI.settings.enforceGMSettings.label"),hint:game.i18n.localize("CRLNGN_UI.settings.enforceGMSettings.hint"),propType:Boolean,default:!1,scope:C.world,config:!0,requiresReload:!0},defaultSettings:{tag:"v2-default-settings",label:game.i18n.localize("CRLNGN_UI.settings.defaultSettings.label"),hint:game.i18n.localize("CRLNGN_UI.settings.defaultSettings.hint"),propType:Object,default:{},scope:C.world,config:!1,requiresReload:!1},disableUI:{tag:"disable-ui",label:game.i18n.localize("CRLNGN_UI.settings.disableUI.label"),hint:game.i18n.localize("CRLNGN_UI.settings.disableUI.hint"),propType:Boolean,scope:C.client,config:!0,default:!1,requiresReload:!1},useSceneFolders:{tag:"v2-nav-folders-enabled",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useSceneFolders.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useSceneFolders.hint"),propType:Boolean,default:!0,scope:C.client,config:!1,requiresReload:!1},navFoldersForPlayers:{tag:"v2-nav-folders-for-players",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navFoldersForPlayers.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navFoldersForPlayers.hint"),propType:Boolean,default:!1,scope:C.client,config:!1,requiresReload:!1},navStartCollapsed:{tag:"v2-nav-start-collapsed",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navStartCollapsed.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navStartCollapsed.hint"),propType:Boolean,default:!1,scope:C.client,config:!1,requiresReload:!1},navShowRootFolders:{tag:"v2-nav-show-root-folders",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navShowRootFolders.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navShowRootFolders.hint"),propType:Boolean,default:!1,scope:C.client,config:!1,requiresReload:!1},hideInactiveOnFolderToggle:{tag:"v2-hide-inactive-on-folder-toggle",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.hideInactiveOnFolderToggle.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.hideInactiveOnFolderToggle.hint"),propType:Boolean,default:!0,scope:C.client,config:!1,requiresReload:!1},useSceneLookup:{tag:"v2-use-scene-lookup",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useSceneLookup.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useSceneLookup.hint"),propType:Boolean,default:!0,scope:C.world,config:!1,requiresReload:!1},sceneItemWidth:{tag:"v2-scene-nav-item-width",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneItemWidth.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneItemWidth.hint"),propType:Number,inputType:wo.number,default:150,scope:C.client,config:!1},showNavOnHover:{tag:"v2-show-nav-on-hover",oldName:"showNavOnHover",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.showNavOnHover.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.showNavOnHover.hint"),propType:Boolean,default:!1,scope:C.client,config:!1,requiresReload:!1},sceneClickToView:{tag:"v2-scene-click-to-view",oldName:"sceneClickToView",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneClickToView.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneClickToView.hint"),propType:Boolean,default:!0,scope:C.world,config:!1,requiresReload:!1},useSceneIcons:{tag:"v2-use-scene-icons",oldName:"useSceneIcons",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useSceneIcons.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useSceneIcons.hint"),propType:Boolean,default:!0,scope:C.world,config:!1,requiresReload:!1},useSceneBackButton:{tag:"v2-use-scene-back-button",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useSceneBackButton.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useSceneBackButton.hint"),propType:Boolean,default:!0,scope:C.world,config:!1,requiresReload:!1},useScenePreview:{tag:"v2-use-scene-preview",oldName:"useScenePreview",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useScenePreview.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.useScenePreview.hint"),propType:Boolean,default:!0,scope:C.world,config:!1,requiresReload:!1},sceneNavCollapsed:{tag:"v2-scene-nav-collapsed",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavCollapsed.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavCollapsed.hint"),propType:Boolean,default:!0,scope:C.client,config:!1,requiresReload:!1},sceneNavPos:{tag:"v2-scene-nav-pos",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavPos.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavPos.hint"),propType:Number,default:0,scope:C.client,config:!1,requiresReload:!1},collapseMacroBar:{tag:"v2-collapse-macro-bar",label:game.i18n.localize("CRLNGN_UI.settings.collapseMacroBar.label"),hint:game.i18n.localize("CRLNGN_UI.settings.collapseMacroBar.hint"),propType:Boolean,default:!0,scope:C.client,config:!1,requiresReload:!1},useFolderStyle:{tag:"v2-use-folder-style",label:game.i18n.localize("CRLNGN_UI.settings.useFolderStyle.label"),hint:game.i18n.localize("CRLNGN_UI.settings.useFolderStyle.hint"),propType:Boolean,default:!0,scope:C.world,config:!1,requiresReload:!1},debugMode:{tag:"v2-debug-mode",label:game.i18n.localize("CRLNGN_UI.settings.debugMode.label"),hint:game.i18n.localize("CRLNGN_UI.settings.debugMode.hint"),propType:Boolean,default:!1,scope:C.client,config:!0,requiresReload:!1},autoHidePlayerList:{tag:"v2-auto-hide-player-list",label:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.fields.autoHidePlayerList.label"),hint:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.fields.autoHidePlayerList.hint"),propType:Boolean,default:!1,scope:C.client,config:!1,requiresReload:!1},playerListAvatars:{tag:"v2-player-list-avatars",label:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.fields.playerListAvatars.label"),hint:game.i18n.localize("CRLNGN_UI.settings.playersListMenu.fields.playerListAvatars.hint"),propType:Boolean,default:!0,scope:C.client,config:!1,requiresReload:!1},uiFontBody:{tag:"v2-ui-font-body",oldName:"uiFont",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiBody.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiBody.hint"),propType:String,default:'"Work Sans", Arial, sans-serif',scope:C.world,config:!1,requiresReload:!1},uiFontTitles:{tag:"v2-ui-font-titles",oldName:"uiTitles",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiTitles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiTitles.hint"),propType:String,default:game.system.id==="daggerheart"?'"Cinzel Decorative", Arial, sans-serif':'"Roboto Slab", Arial, sans-serif',scope:C.world,config:!1,requiresReload:!1},journalFontBody:{tag:"v2-journal-font-body",oldName:"journalBody",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalBody.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalBody.hint"),propType:String,default:'"Work Sans", Arial, sans-serif',scope:C.world,config:!1,requiresReload:!1},journalFontTitles:{tag:"v2-journal-font-titles",oldName:"journalTitles",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalTitles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalTitles.hint"),propType:String,default:game.system.id==="daggerheart"?'"Cinzel Decorative", Arial, sans-serif':'"Roboto Slab", Arial, sans-serif',scope:C.world,config:!1,requiresReload:!1},colorTheme:{tag:"v2-color-theme",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.colorTheme.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.colorTheme.hint"),propType:String,default:"crlngn-theme",scope:C.world,config:!1,requiresReload:!1},customThemeColors:{tag:"v2-custom-theme-colors",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.customThemeColors.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.customThemeColors.hint"),propType:Object,default:null,scope:C.world,config:!1,requiresReload:!1},applySecondaryColorToBg:{tag:"v2-apply-secondary-color-to-bg",label:game.i18n.localize("CRLNGN_UI.settings.colorPicker.applySecondaryColorToBg.label"),hint:game.i18n.localize("CRLNGN_UI.settings.colorPicker.applySecondaryColorToBg.hint"),propType:Boolean,default:!1,scope:C.client,config:!1,requiresReload:!0},playerColorTheme:{tag:"v2-player-color-theme",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.playerColorTheme.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.playerColorTheme.hint"),propType:String,default:"",scope:C.client,config:!1,requiresReload:!1},playerCustomThemeColors:{tag:"v2-player-custom-theme-colors",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.playerCustomThemeColors.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.playerCustomThemeColors.hint"),propType:Object,default:null,scope:C.client,config:!1,requiresReload:!1},adjustOtherModules:{tag:"v2-adjust-other-modules",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.adjustOtherModules.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.adjustOtherModules.hint"),propType:Boolean,default:!0,scope:C.world,config:!1,requiresReload:!1},applyDarkThemeToModules:{tag:"v2-dark-theme-to-modules",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.applyDarkThemeToModules.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.applyDarkThemeToModules.hint"),propType:Boolean,default:!1,scope:C.world,config:!1,requiresReload:!0},otherModulesList:{tag:"v2-other-modules-list-a3",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.otherModulesList.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.otherModulesList.hint"),propType:String,default:"'combat-carousel','dice-tray','hurry-up','crux','fvtt-youtube-player','bg3-inspired-hotbar','touch-vtt','breaktime','simple-timekeeping'",options:{"BG3 Inspired Hotbar":"'bg3-inspired-hotbar'",Breaktime:"'breaktime'","Combat Carousel":"'combat-carousel'",Crux:"'crux'","Dice Tray":"'dice-tray'","Hurry Up":"'hurry-up'","Simple Timekeeping & Calendar":"'simple-timekeeping'","Touch VTT":"'touch-vtt'","Youtube Player":"'fvtt-youtube-player'"},scope:C.world,config:!1,requiresReload:!1},customStyles:{tag:"v2-custom-styles",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.customStyles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.customStyles.hint"),propType:String,default:"",scope:C.world,config:!1,requiresReload:!0},forcedDarkTheme:{tag:"v2-forced-dark-theme",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.forcedDarkTheme.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.forcedDarkTheme.hint"),propType:String,default:"",scope:C.world,config:!1,requiresReload:!1},chatBorderColor:{tag:"v2-chat-border-color",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.hint"),options:{playerColor:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.options.playerColor"),rollType:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.options.rollType"),none:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.options.none")},propType:String,default:Nt.playerColor.name,scope:C.client,config:!1,requiresReload:!0},chatBorderPosition:{tag:"v2-chat-border-position",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderPosition.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderPosition.hint"),options:{left:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderPosition.options.left"),right:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderPosition.options.right"),top:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderPosition.options.top"),all:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderPosition.options.all")},propType:String,default:hn.left.name,scope:C.client,config:!1,requiresReload:!0},useLeftChatBorder:{tag:"v2-use-left-chat-border",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.useLeftChatBorder.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.useLeftChatBorder.hint"),propType:Boolean,inputType:wo.checkbox,default:!0,scope:C.client,config:!1,requiresReload:!0},enableChatStyles:{tag:"v2-enable-chat-styles",oldName:"enableChatStyles",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.enableChatStyles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.enableChatStyles.hint"),propType:Boolean,default:!0,scope:C.client,config:!1,requiresReload:!0},sideBarWidth:{tag:"v2-side-bar-width",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.sideBarWidth.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.sideBarWidth.hint"),propType:Number,default:300,scope:C.client,config:!1,requiresReload:!1},controlsAutoHide:{tag:"v2-auto-hide-secondary-controls",oldName:"autoHideSecondary",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.autoHideSecondary.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.autoHideSecondary.hint"),propType:Boolean,default:!1,scope:C.client,config:!1,requiresReload:!1},dockPosX:{tag:"v2-camera-dock-x",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosX.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosX.hint"),propType:Number,default:0,scope:C.client,config:!1,requiresReload:!1},dockPosY:{tag:"v2-camera-dock-y",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosY.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosY.hint"),propType:Number,default:120,scope:C.client,config:!1,requiresReload:!1},dockWidth:{tag:"v2-camera-dock-width",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockWidth.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockWidth.hint"),propType:Number,default:180,scope:C.client,config:!1,requiresReload:!1},dockHeight:{tag:"v2-camera-dock-height",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockHeight.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockHeight.hint"),propType:Number,default:145,scope:C.client,config:!1,requiresReload:!1},dockResizeOnUserJoin:{tag:"v2-dock-resize-on-user-join",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockResizeOnUserJoin.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockResizeOnUserJoin.hint"),options:{off:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockResizeOnUserJoin.options.off"),horizontal:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockResizeOnUserJoin.options.horizontal"),vertical:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockResizeOnUserJoin.options.vertical")},propType:String,default:De.horizontal.name,scope:C.client,config:!1,requiresReload:!1},defaultVideoWidth:{tag:"v2-default-video-width",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.defaultVideoWidth.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.defaultVideoWidth.hint"),propType:Number,default:160,scope:C.client,config:!1,requiresReload:!1},lastUpdateId:{tag:"last-update-id",label:game.i18n.localize("CRLNGN_UI.ui.updates.label"),hint:game.i18n.localize("CRLNGN_UI.ui.updates.hint"),propType:String,scope:C.world,config:!1,default:"",requiresReload:!1},sceneControlsFadeOut:{tag:"v2-scene-controls-fade-out",oldName:"sceneControlsFadeOut",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.sceneControls"),propType:Boolean,default:!0,scope:C.client,config:!1,requiresReload:!1},sidebarTabsFadeOut:{tag:"v2-sidebar-tabs-fade-out",oldName:"sidebarTabsFadeOut",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.sidebarTabs"),propType:Boolean,default:!0,scope:C.client,config:!1,requiresReload:!1},chatLogControlsFadeOut:{tag:"v2-chat-log-controls-fade-out",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.chatLogControls"),propType:Boolean,default:!0,scope:C.client,config:!1,requiresReload:!1},playerListFadeOut:{tag:"v2-player-list-fade-out",oldName:"playerListFadeOut",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.playerList"),propType:Boolean,default:!0,scope:C.client,config:!1,requiresReload:!1},cameraDockFadeOut:{tag:"v2-camera-fade-out",oldName:"cameraDockFadeOut",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.cameraDock"),propType:Boolean,default:!1,scope:C.client,config:!1,requiresReload:!1},macroHotbarFadeOut:{tag:"v2-macro-hotbar-fade-out",oldName:"macroHotbarFadeOut",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.macroHotbar"),propType:Boolean,default:!0,scope:C.client,config:!1,requiresReload:!1},sceneNavFadeOut:{tag:"v2-scene-nav-fade-out",oldName:"sceneNavFadeOut",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.sceneNav"),propType:Boolean,default:!0,scope:C.client,config:!1,requiresReload:!1},sceneControlsHide:{tag:"v2-scene-controls-hide",oldName:"sceneControlsHide",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.sceneControls"),propType:Boolean,default:!1,scope:C.client,config:!1,requiresReload:!1},sidebarTabsHide:{tag:"v2-sidebar-tabs-hide",oldName:"sidebarTabsHide",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.sidebarTabs"),propType:Boolean,default:!1,scope:C.client,config:!1,requiresReload:!1},chatLogControlsHide:{tag:"v2-chat-log-controls-hide",oldName:"chatLogControlsHide",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.chatLogControls"),propType:Boolean,default:!1,scope:C.client,config:!1,requiresReload:!1},playerListHide:{tag:"v2-player-list-hide",oldName:"playerListHide",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.playerList"),propType:Boolean,default:!1,scope:C.client,config:!1,requiresReload:!1},cameraDockHide:{tag:"v2-camera-dock-hide",oldName:"cameraDockHide",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.cameraDock"),propType:Boolean,default:!1,scope:C.client,config:!1,requiresReload:!1},macroHotbarHide:{tag:"v2-macro-hotbar-hide",oldName:"macroHotbarHide",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.macroHotbar"),propType:Boolean,default:!1,scope:C.client,config:!1,requiresReload:!1},sceneNavHide:{tag:"v2-scene-nav-hide",oldName:"sceneNavHide",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.sceneNav"),propType:Boolean,default:!1,scope:C.client,config:!1,requiresReload:!1},sceneNavEnabled:{tag:"v2-scene-nav-enabled",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneNavEnabled.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneNavEnabled.hint"),propType:Boolean,default:!0,scope:C.client,config:!1,requiresReload:!0},enableSceneControls:{tag:"v2-enable-scene-controls",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.sceneControls"),propType:Boolean,default:!0,scope:C.client,config:!1,requiresReload:!1},enableSidebarTabs:{tag:"v2-enable-sidebar-tabs",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.sidebarTabs"),propType:Boolean,default:!0,scope:C.client,config:!1,requiresReload:!1},enableChatLogControls:{tag:"v2-enable-chat-log-controls",label:game.i18n.localize("CRLNGN_UI.settings.interfaceOptionsMenu.fields.chatLogControls"),propType:Boolean,default:!0,scope:C.client,config:!1,requiresReload:!1},enableMacroLayout:{tag:"v2-enable-macro-layout",label:game.i18n.localize("CRLNGN_UI.settings.enableMacroLayout.label"),hint:game.i18n.localize("CRLNGN_UI.settings.enableMacroLayout.hint"),propType:Boolean,default:!0,scope:C.client,config:!1,requiresReload:!1},enablePlayerList:{tag:"v2-enable-player-list",label:game.i18n.localize("CRLNGN_UI.settings.enablePlayerList.label"),hint:game.i18n.localize("CRLNGN_UI.settings.enablePlayerList.hint"),propType:Boolean,default:!0,scope:C.client,config:!1,requiresReload:!1},enableFloatingDock:{tag:"v2-enable-floating-dock",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.enableFloatingDock.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.enableFloatingDock.hint"),propType:Boolean,default:!0,scope:C.client,config:!1,requiresReload:!0},applyThemeToSheets:{tag:"v2-apply-theme-and-styles",label:game.i18n.localize("CRLNGN_UI.settings.sheets5eMenu.fields.applyThemeToSheets.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sheets5eMenu.fields.applyThemeToSheets.hint"),propType:Boolean,default:!0,scope:C.world,config:!1,requiresReload:!1},useHorizontalSheetTabs:{tag:"v2-use-horizontal-tabs",label:game.i18n.localize("CRLNGN_UI.settings.sheets5eMenu.fields.useHorizontalSheetTabs.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sheets5eMenu.fields.useHorizontalSheetTabs.hint"),propType:Boolean,default:!0,scope:C.client,config:!1,requiresReload:!1}}}var Mn,zo;const pt=class pt{static isModuleOn(e){var n;const t=(n=game.modules)==null?void 0:n.get(e);return!!(t!=null&&t.active)}static html(e,t){return e.querySelector(t)}static getFullWidth(e){return window.getComputedStyle(e).width==="0px"?0:e.offsetWidth}static async processStyleSheetRules(e,t){var n;try{if(((n=e.ownerNode)==null?void 0:n.tagName)==="STYLE"){const o=e.ownerNode.textContent;this.extractFontsFromCSSText(o,t)}try{const o=e.cssRules||e.rules;if(!o)return;for(let a=0;a<o.length;a++){const s=o[a];if(s instanceof CSSFontFaceRule){const r=s.style.getPropertyValue("font-family");r&&(t.add(r),p.log("Found font-face rule:",[r]))}else if(s instanceof CSSImportRule){if(p.log("Found import rule:",[s.href]),s.styleSheet)await this.processStyleSheetRules(s.styleSheet,t);else if(s.href)try{const i=await(await fetch(s.href)).text();this.extractFontsFromCSSText(i,t)}catch(r){p.warn("Error fetching imported CSS:",[r])}}}}catch(o){if(o.name==="SecurityError"&&e.href){p.log("Security restriction on stylesheet, trying to fetch directly:",[e.href]);try{const s=await(await fetch(e.href)).text();this.extractFontsFromCSSText(s,t)}catch(a){p.warn("Error fetching cross-origin stylesheet:",[a])}}else p.warn("Error accessing CSS rules:",[o])}}catch(o){p.warn("Error in processStyleSheetRules:",[o])}}static extractFontsFromCSSText(e,t){if(!e)return;const n=/@font-face\s*{[^}]*font-family\s*:\s*(['"])(.+?)\1[^}]*}/gs;(e.match(n)||[]).forEach(a=>{const s=/font-family\s*:\s*(['"])(.+?)\1/,r=a.match(s);if(r&&r[2]){const i=r[2].trim();t.add(i)}})}static getOffsetBottom(e){const t=e.offsetTop,n=e.offsetHeight;return window.innerHeight-(t+n)}static async getAllFonts(){const e=new Set(Object.keys(CONFIG.fontDefinitions)),t=game.settings.get("core","fonts")||{},n=Object.entries(t).map(([s])=>s),o=await this.processStyleSheets();return Array.from(new Set([...e,...n,...o])).filter(s=>!/FontAwesome|Font Awesome|FoundryVTT/.test(s)).map(s=>s.replace(/['"]/g,"").trim()).sort((s,r)=>s.toLowerCase().localeCompare(r.toLowerCase()))||[]}static addCSSVars(e,t){let n=document.querySelector("#crlngn-ui-vars");if(!n){const h=document.querySelector("body.crlngn-ui");if(!h)return;n=document.createElement("style"),n.id="crlngn-ui-vars",n.textContent=`body.crlngn-ui {
}
`,h.prepend(n)}let o=n.textContent,a=o.indexOf("body.crlngn-ui {"),s=o.indexOf("}",a);a===-1&&(o=`body.crlngn-ui {
}
`,a=0,s=o.indexOf("}"));const i=o.substring(a+16,s).split(";").map(h=>h.trim()).filter(h=>h!==""),c={};i.forEach(h=>{const y=h.split(":");if(y.length>=2){const S=y[0].trim(),N=y.slice(1).join(":").trim();S&&(c[S]=N)}}),e.includes("i18n")&&typeof t=="string"&&!t.startsWith('"')&&!t.startsWith("'")&&!t.match(/^url\(|^rgba?\(|^hsla?\(/)&&(t=`"${t}"`),c[e]=t;const g=Object.entries(c).map(([h,y])=>`  ${h}: ${y};`).join(`
`),u=o.substring(0,a)+`body.crlngn-ui {
`+g+`
}`+o.substring(s+1);n.textContent=u}static addCustomCSS(e,t="crlngn-ui-custom-css",n=!0){if(!e)return;let o=document.querySelector("#"+t);o||(o=document.createElement("style"),o.id=t,o.textContent="",document.head.appendChild(o));const a=/@import\s+(?:url\()?\s*['"]?[^'")]+['"]?\s*\)?\s*;/g,s=[];let r=e,i;for(;(i=a.exec(e))!==null;)s.push(i[0]);if(r=e.replace(a,"").trim(),!n){o.textContent=s.join(`
`)+(s.length?`

`:"")+r;return}if(!o.textContent.includes(r)){const c=o.textContent,g=[];let u;for(;(u=a.exec(c))!==null;)g.push(u[0]);const h=c.replace(a,"").trim(),y=s.filter(N=>!g.includes(N)),S=[...g,...y];o.textContent=S.join(`
`)+(S.length?`

`:"")+h+(h&&r?`

`:"")+r}}static smoothScrollTo(e,t,n="horizontal",o=300,a=null){const s=e.dataset.scrollAnimationId;s&&cancelAnimationFrame(Number(s));const r=n==="horizontal",i=r?e.scrollLeft:e.scrollTop,c=t-i;if(c===0)return a&&a(),null;const g=performance.now(),u=y=>{const S=y-g;if(S>=o){r?e.scrollLeft=t:e.scrollTop=t,delete e.dataset.scrollAnimationId,a&&a();return}const N=S/o,U=N<.5?2*N*N:1-Math.pow(-2*N+2,2)/2;r?e.scrollLeft=i+c*U:e.scrollTop=i+c*U;const X=requestAnimationFrame(u);return e.dataset.scrollAnimationId=X,X},h=requestAnimationFrame(u);return e.dataset.scrollAnimationId=h,h}static confirmReload(e=game.i18n.localize("CRLNGN_UI.ui.reloadRequiredTitle"),t=game.i18n.localize("CRLNGN_UI.ui.reloadRequiredLabel"),n={}){const o={title:e,content:t,yes:{label:game.i18n.localize("CRLNGN_UI.ui.reloadButton"),callback:()=>(p.log("Reloading page after confirmation"),window.location.reload(),!0)},no:{label:game.i18n.localize("CRLNGN_UI.ui.cancelButton"),callback:()=>!1},defaultYes:!1,rejectClose:!1};return mergeObject(o,n),foundry.applications.api.DialogV2.confirm(o)}static renderTemplate(e,t){return foundry.applications.handlebars.renderTemplate(e,t)}static loadTemplate(e){return foundry.applications.handlebars.loadTemplate(e)}static loadTemplates(e){return foundry.applications.handlebars.loadTemplates(e)}static isValidCSSRule(e){if(!e||typeof e!="string")return!1;const t=e.trim();if(!t)return!1;try{const n=document.createElement("style"),o=`${t} { color: inherit; }`;n.textContent=o,document.head.appendChild(n);const a=!!(n.sheet&&n.sheet.cssRules&&n.sheet.cssRules.length>0);return document.head.removeChild(n),a}catch(n){return p.log("CSS validation error:",[n,e]),!1}}static processCSSRules(e,t){if(!e||!t)return"";const n=H(this,Mn,zo).call(this,e),o=t+` {
`+n.baseProperties.join(`
`)+`
}`,a=[],s=new Map;return n.nestedRules.forEach(r=>{const{selector:i,content:c}=r;if(i.startsWith("&")){const h=i.substring(1),y=t.split(",").map(S=>S.trim()).filter(Boolean).map(S=>S+h).join(", ");a.push(`${y} {
${c}
}`);return}s.has(c)||s.set(c,[]);const g=i.split(",").map(h=>h.trim()),u=t.split(",").map(h=>h.trim()).filter(Boolean);g.forEach(h=>{u.forEach(y=>{s.get(c).push(`${y} ${h}`)})})}),s.forEach((r,i)=>{a.push(`${r.join(", ")} {
${i}
}`)}),o+`

`+a.join(`

`)}};Mn=new WeakSet,zo=function(e){const t=[],n=[],o=e.split(`
`);let a=null,s=0;for(let r=0;r<o.length;r++){const i=o[r].trim();if(!i)continue;const c=(i.match(/{/g)||[]).length,g=(i.match(/}/g)||[]).length;if(i.includes("{")&&!a){a={selector:i.substring(0,i.indexOf("{")).trim(),content:"",startLine:r},s=1;const h=i.substring(i.indexOf("{")+1).trim();h&&!h.includes("}")&&(a.content+=h+`
`)}else a?(s+=c-g,s>0?a.content+=i+`
`:(a.content=a.content.replace(/}\s*$/,"").trim(),n.push(a),a=null)):!i.includes("{")&&!i.includes("}")&&t.push(i)}return{baseProperties:t,nestedRules:n}},k(pt,Mn),b(pt,"processStyleSheets",async()=>{const e=new Set(Object.keys(CONFIG.fontDefinitions)),t=game.settings.get("core","fonts")||{},n=Object.entries(t).map(([s])=>s),o=new Set;for(const s of document.styleSheets)try{if(s.ownerNode){const r=s.href||"",i=r.includes("css/")||r.includes("styles/"),c=r.includes("modules/crlngn-ui/"),g=r.includes("systems/");if(r&&!i&&!c&&!g)continue;await pt.processStyleSheetRules(s,o)}}catch(r){p.warn("Error processing stylesheet:",[r])}return p.log("Found fonts:",[{foundry:Array.from(e),custom:n,cssImported:Array.from(o)}]),Array.from(new Set([...e,...n,...o])).filter(s=>!/FontAwesome|Font Awesome|FoundryVTT/.test(s)).map(s=>s.replace(/['"]/g,"").trim()).sort((s,r)=>s.toLowerCase().localeCompare(r.toLowerCase()))}),b(pt,"wrapFontName",e=>{const t=e.replace(/['"`]/g,"");return t.includes(" ")?`"${t}"`:t});let L=pt;const ba=Object.freeze(Object.defineProperty({__proto__:null,GeneralUtil:L},Symbol.toStringTag,{value:"Module"}));var Ve,Ut,$t;const G=class G{static init(){p.log("LeftControls - init",[]),Hooks.on(A.RENDER_SCENE_CONTROLS,G.initSceneControls),Hooks.on(A.ACTIVATE_SCENE_CONTROLS,G.onActivateSceneControls),window.addEventListener("resize",G.onActivateSceneControls),G.initSceneControls()}static applyFadeOut(e){G.useFadeOut=e,p.log("applyFadeOut",[e]),G.handleFadeOut()}static applyHide(e){G.hidden=e,G.handleHide()}static handleHide(e,t,n){const o=t||document.querySelector("#scene-controls");G.hidden?o==null||o.classList.add("hidden-ui"):o==null||o.classList.remove("hidden-ui"),p.log("handle Hide",[G.hidden])}static handleFadeOut(e,t,n){const o=t||document.querySelector("#scene-controls"),a=document.querySelector("#touch-vtt-controls");G.useFadeOut?(o==null||o.classList.add("faded-ui"),a==null||a.classList.add("faded-ui")):(o==null||o.classList.remove("faded-ui"),a==null||a.classList.remove("faded-ui")),p.log("handle FadeOut",[G.customStylesEnabled,G.useFadeOut])}static applyCustomStyle(e){var t;G.customStylesEnabled=e,p.log("applyCustomStyle",[G.customStylesEnabled,ui.controls]),(t=ui.controls)==null||t.render()}static resetLocalVars(){O(G,Ve,document.querySelector("#ui-left #controls")),O(G,Ut,document.querySelector("#ui-left"))}static initSceneControls(e,t,n){p.log("initSceneControls",[]),G.resetLocalVars();const o=document.querySelector("#interface");G.customStylesEnabled?o==null||o.classList.add("crlngn-controls"):o==null||o.classList.remove("crlngn-controls"),G.handleFadeOut(e,t,n),G.handleHide(e,t,n)}static observeControlsWidth(){if(p.log("observeControlsWidth",[]),!m(G,Ve))return;let e;const t=(n,o)=>{e||(e=setTimeout(()=>{n(),e=null},o))};O(G,$t,new ResizeObserver(n=>{t(()=>G.updateCSSVars(),250)})),m(G,$t).observe(m(G,Ve),{box:"border-box"}),G.updateCSSVars()}static updateCSSVars(){if(!m(G,Ve))return;let e=parseInt(m(G,Ut).offsetWidth),t=parseInt(m(G,Ve).offsetWidth),n=-e+t;p.log("updateCSSVars",[t,e]),!isNaN(t)&&!isNaN(e)&&L.addCSSVars("--ui-controls-margin-left",n+"px")}static onActivateSceneControls(e,t){const n=document.querySelectorAll("#scene-controls-layers .ui-control"),o=document.querySelectorAll("#scene-controls-tools .ui-control"),a=getComputedStyle(document.querySelector("#ui-left")).getPropertyValue("--control-columns");o.length>=n.length?(document.querySelector("#scene-controls").classList.add("more-tools"),Number(a)>2?document.querySelector("#scene-controls").classList.add("extra-columns"):document.querySelector("#scene-controls").classList.remove("extra-columns")):(document.querySelector("#scene-controls").classList.remove("more-tools"),document.querySelector("#scene-controls").classList.remove("extra-columns")),p.log("onActivateSceneControls",[a,o.length,n.length])}};Ve=new WeakMap,Ut=new WeakMap,$t=new WeakMap,k(G,Ve),k(G,Ut),k(G,$t),b(G,"useFadeOut",!0),b(G,"hidden",!1),b(G,"customStylesEnabled",!0),b(G,"preloadTemplates",async()=>{try{const e=[`modules/${MODULE_ID}/templates/chat-toggle-button.hbs`];return await L.loadTemplates(e),!0}catch(e){return p.log("Error loading navigation button templates:",[e]),!1}});let ht=G;const{ApplicationV2:Sa,HandlebarsApplicationMixin:va}=foundry.applications.api;var ee,xo,Bo,mn,yn,et;class Nn extends va(Sa){constructor(t={}){super(t);k(this,ee);this.callback=t.callback,this.scope=t.scope||"world",this.currentColors=t.currentColors||H(this,ee,Bo).call(this),this.activeSecondaryTheme="dark",H(this,ee,xo).call(this)}async _prepareContext(t){var s;const n=await super._prepareContext(t);n.accentHSL=fe.rgbToHsl(this.currentColors.accent),n.secondaryDarkHSL=fe.rgbToHsl(this.currentColors.secondaryDark||this.currentColors.secondary||$[0].colorPreview[0]),n.secondaryLightHSL=fe.rgbToHsl(this.currentColors.secondaryLight||"rgb(223, 227, 231)"),n.themes=$;const o=w();n.applySecondaryColorToBg=T.get(o.applySecondaryColorToBg.tag)||!1,n.textOnAccent=fe.getContrastRating("rgb(255, 255, 255)",this.currentColors.accent);const a=((s=getComputedStyle(document.documentElement).getPropertyValue("--control-bg-color"))==null?void 0:s.trim())||"rgb(11, 10, 19)";return n.accentOnBg=fe.getContrastRating(this.currentColors.accent,a),n.currentColors=this.currentColors,n.secondaryColorDark=this.currentColors.secondaryDark||this.currentColors.secondary||$[0].colorPreview[0],n.secondaryColorLight=this.currentColors.secondaryLight||"rgb(223, 227, 231)",n}async _preparePartContext(t,n,o){const a=await super._preparePartContext(t,n,o);switch(t){case"footer":{a.buttons=[{type:"button",icon:"",label:"Cancel",action:"close"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.colorPicker.apply",action:"submit"}];break}}return a}async _onSubmit(t){t.preventDefault();const n=w(),o=game.user.isGM?n.customThemeColors.tag:n.playerCustomThemeColors.tag,a=this.element.querySelector(".color-picker-content"),s=new FormData;a.querySelectorAll('input[type="range"]').forEach(y=>{s.append(y.name,y.value)}),a.querySelectorAll('input[type="checkbox"]').forEach(y=>{s.append(y.name,y.checked)});const c=Object.fromEntries(s.entries()),u={accent:fe.hslToRgb(parseInt(c.accentHue),parseInt(c.accentSaturation),parseInt(c.accentLightness)),secondaryDark:this.currentColors.secondaryDark||$[0].colorPreview[1],secondaryLight:this.currentColors.secondaryLight||$[0].colorPreview[0]||"rgb(223, 227, 231)"};await T.set(o,u);let h=!1;if(game.user.isGM&&c.applySecondaryColorToBg!==void 0){const y=T.get(n.applySecondaryColorToBg.tag),S=c.applySecondaryColorToBg==="true";await T.set(n.applySecondaryColorToBg.tag,S),n.applySecondaryColorToBg.requiresReload&&y!==S&&(h=!0)}if(fe.applyCustomTheme(u),h){const{GeneralUtil:y}=await qo(async()=>{const{GeneralUtil:S}=await Promise.resolve().then(()=>ba);return{GeneralUtil:S}},void 0);y.confirmReload()}this.callback&&this.callback(u),this.close()}_onSecondaryTabClick(t){var y,S,N;const n=t.currentTarget,o=n.dataset.theme;this.element.querySelectorAll(".secondary-tab").forEach(U=>{U.classList.remove("active")}),n.classList.add("active"),this.activeSecondaryTheme=o;const a=o==="dark"?this.currentColors.secondaryDark||this.currentColors.secondary||$[0].colorPreview[1]:this.currentColors.secondaryLight||"rgb(223, 227, 231)",s=fe.rgbToHsl(a),r=this.element.querySelector('[name="secondaryHue"]'),i=this.element.querySelector('[name="secondarySaturation"]'),c=this.element.querySelector('[name="secondaryLightness"]');r&&(r.value=s.h),i&&(i.value=s.s),c&&(c.value=s.l);const g=(y=this.element.querySelector('[name="secondaryHue"]'))==null?void 0:y.parentElement,u=(S=this.element.querySelector('[name="secondarySaturation"]'))==null?void 0:S.parentElement,h=(N=this.element.querySelector('[name="secondaryLightness"]'))==null?void 0:N.parentElement;g&&(g.querySelector(".value").textContent=s.h),u&&(u.querySelector(".value").textContent=s.s+"%"),h&&(h.querySelector(".value").textContent=s.l+"%"),H(this,ee,yn).call(this),H(this,ee,mn).call(this)}_onClickPreset(t){const o=t.currentTarget.dataset.theme,a=$.find(s=>s.className===o);a&&(this.currentColors={accent:a.colorPreview[2],secondaryDark:a.colorPreview[1],secondaryLight:a.colorPreview[0]},this.render())}_onColorChange(t){const n=t.currentTarget,o=this.element.querySelector(".color-picker-content");p.log("ColorPickerDialog._onColorChange",[n]);const a=n.parentElement.querySelector(".value");if(a){const S=n.name.includes("Hue")?"":"%";a.textContent=n.value+S}const s=parseInt(o.querySelector('[name="accentHue"]').value),r=parseInt(o.querySelector('[name="accentSaturation"]').value),i=parseInt(o.querySelector('[name="accentLightness"]').value),c=parseInt(o.querySelector('[name="secondaryHue"]').value),g=parseInt(o.querySelector('[name="secondarySaturation"]').value),u=parseInt(o.querySelector('[name="secondaryLightness"]').value),h=fe.hslToRgb(s,r,i),y=fe.hslToRgb(c,g,u);this.activeSecondaryTheme==="dark"?this.currentColors.secondaryDark=y:this.currentColors.secondaryLight=y,this.currentColors.accent=h,p.log("ColorPickerDialog._onColorChange",[this.currentColors]),H(this,ee,mn).call(this),H(this,ee,yn).call(this)}_onRender(t,n){super._onRender(t,n),p.log("ColorPickerDialog._onRender",[this.element]),this.element.querySelectorAll(".preset-button").forEach(o=>{o.addEventListener("click",this._onClickPreset.bind(this))}),this._onSecondaryTabClick&&this.element.querySelectorAll(".secondary-tab").forEach(o=>{o.addEventListener("click",this._onSecondaryTabClick.bind(this))}),this.element.querySelectorAll('input[type="range"]').forEach(o=>{o.addEventListener("input",this._onColorChange.bind(this))}),this.element.querySelectorAll('button[type="submit"]').forEach(o=>{o.addEventListener("click",this._onSubmit.bind(this))}),this.element.querySelectorAll("button.cancel").forEach(o=>{o.addEventListener("click",()=>{this.close()})}),H(this,ee,yn).call(this),H(this,ee,mn).call(this)}}ee=new WeakSet,xo=async function(){const t=w(),n=game.user.isGM?t.customThemeColors.tag:t.playerCustomThemeColors.tag;if(!T.get(n)){const a=game.user.isGM?t.colorTheme.tag:t.playerColorTheme.tag,s=T.get(a);if(s){const r=fe.migrateFromOldTheme(s);try{await T.set(n,r),this.currentColors=r,this.render()}catch{}}}},Bo=function(){const t=this.scope==="player"?"v2-player-custom-theme-colors":"v2-custom-theme-colors",n=T.get(t);if(n!=null&&n.accent&&(n!=null&&n.secondaryDark))return n;if(this.scope==="player"){const o=T.get("v2-custom-theme-colors");if(o!=null&&o.accent&&(o!=null&&o.secondaryDark))return o}return{accent:$[0].colorPreview[2],secondaryDark:$[0].colorPreview[1],secondaryLight:$[0].colorPreview[0]||"rgb(223, 227, 231)"}},mn=function(){var r;const t=this.element.querySelector(".color-picker-content");if(!t)return;const n=((r=getComputedStyle(document.documentElement).getPropertyValue("--control-bg-color"))==null?void 0:r.trim())||"rgb(11, 10, 19)",o="rgb(240, 240, 240)";t.querySelectorAll(".accent-preview .preview-item").forEach((i,c)=>{if(c===0){i.style.backgroundColor=this.currentColors.accent,i.style.color=o;const g=fe.getContrastRating(o,this.currentColors.accent),u=i.querySelector(".contrast-rating");u&&(u.textContent=g.label,u.className=`contrast-rating ${g.class}`,u.style.color=o)}else if(c===1){i.style.backgroundColor=n,i.style.color=this.currentColors.accent,i.classList.remove("inverted");const g=fe.getContrastRating(this.currentColors.accent,n),u=i.querySelector(".contrast-rating");u&&(u.textContent=g.label,u.className=`contrast-rating ${g.class}`,u.style.color=this.currentColors.accent)}});const s=t.querySelectorAll(".secondary-preview .preview-item");if(s.length>0){const i=this.currentColors.secondaryDark||this.currentColors.secondary||$[0].colorPreview[0];if(s[0].style.backgroundColor=i,s[1]){const c=this.currentColors.secondaryLight||"rgb(223, 227, 231)";s[1].style.backgroundColor=c}}},yn=function(){const t=this.element.querySelector(".color-picker-content");if(!t)return;const n=parseInt(t.querySelector('[name="accentHue"]').value),o=parseInt(t.querySelector('[name="accentSaturation"]').value),a=parseInt(t.querySelector('[name="accentLightness"]').value),s=parseInt(t.querySelector('[name="secondaryHue"]').value),r=parseInt(t.querySelector('[name="secondarySaturation"]').value),i=parseInt(t.querySelector('[name="secondaryLightness"]').value);H(this,ee,et).call(this,"accentHue","hue",n,o,a),H(this,ee,et).call(this,"accentSaturation","saturation",n,o,a),H(this,ee,et).call(this,"accentLightness","lightness",n,o,a),H(this,ee,et).call(this,"secondaryHue","hue",s,r,i),H(this,ee,et).call(this,"secondarySaturation","saturation",s,r,i),H(this,ee,et).call(this,"secondaryLightness","lightness",s,r,i)},et=function(t,n,o,a,s){const r=this.element.querySelector(`[name="${t}"]`);if(!r)return;let i="";switch(n){case"hue":i=`linear-gradient(to right, 
          hsl(0, ${a}%, 50%) 0%, 
          hsl(60, ${a}%, 50%) 16.66%, 
          hsl(120, ${a}%, 50%) 33.33%, 
          hsl(180, ${a}%, 50%) 50%, 
          hsl(240, ${a}%, 50%) 66.66%, 
          hsl(300, ${a}%, 50%) 83.33%, 
          hsl(360, ${a}%, 50%) 100%)`;break;case"saturation":i=`linear-gradient(to right, 
          hsl(${o}, 0%, 50%) 0%, 
          hsl(${o}, 100%, 50%) 100%)`;break;case"lightness":i=`linear-gradient(to right, 
          hsl(${o}, ${a}%, 0%) 0%, 
          hsl(${o}, ${a}%, 50%) 50%, 
          hsl(${o}, ${a}%, 100%) 100%)`;break}r.style.background=i,r.style.backgroundSize="100% 100%",r.style.backgroundRepeat="no-repeat"},b(Nn,"DEFAULT_OPTIONS",{id:"crlngn-color-picker",tag:"div",window:{icon:"fas fa-palette",title:"CRLNGN_UI.settings.colorPicker.title",contentClasses:["crlngn","color-picker-dialog","standard-form"],resizable:!0},position:{width:600,height:"auto"}}),b(Nn,"PARTS",{form:{template:"modules/crlngn-ui/templates/color-picker-dialog.hbs"},footer:{template:"templates/generic/form-footer.hbs",isGMOnly:!1}});class fe{static rgbToHsl(e){const t=e.match(/\d+/g);if(!t)return{h:0,s:0,l:0};let[n,o,a]=t.map(u=>parseInt(u)/255);const s=Math.max(n,o,a),r=Math.min(n,o,a);let i,c,g=(s+r)/2;if(s===r)i=c=0;else{const u=s-r;switch(c=g>.5?u/(2-s-r):u/(s+r),s){case n:i=((o-a)/u+(o<a?6:0))/6;break;case o:i=((a-n)/u+2)/6;break;case a:i=((n-o)/u+4)/6;break}}return{h:Math.round(i*360),s:Math.round(c*100),l:Math.round(g*100)}}static hslToRgb(e,t,n){e=e/360,t=t/100,n=n/100;let o,a,s;if(t===0)o=a=s=n;else{const r=(g,u,h)=>(h<0&&(h+=1),h>1&&(h-=1),h<.16666666666666666?g+(u-g)*6*h:h<.5?u:h<.6666666666666666?g+(u-g)*(.6666666666666666-h)*6:g),i=n<.5?n*(1+t):n+t-n*t,c=2*n-i;o=r(c,i,e+1/3),a=r(c,i,e),s=r(c,i,e-1/3)}return`rgb(${Math.round(o*255)}, ${Math.round(a*255)}, ${Math.round(s*255)})`}static getContrastRatio(e,t){const n=i=>{const c=i.match(/\d+/g);if(!c)return 0;const[g,u,h]=c.map(y=>{const S=parseInt(y)/255;return S<=.03928?S/12.92:Math.pow((S+.055)/1.055,2.4)});return .2126*g+.7152*u+.0722*h},o=n(e),a=n(t),s=Math.max(o,a),r=Math.min(o,a);return(s+.05)/(r+.05)}static getContrastRating(e,t){const n=this.getContrastRatio(e,t);return n>=4.5?{label:game.i18n.localize("CRLNGN_UI.settings.colorPicker.contrastGood"),class:"good"}:n>=2.5?{label:game.i18n.localize("CRLNGN_UI.settings.colorPicker.contrastMedium"),class:"medium"}:{label:game.i18n.localize("CRLNGN_UI.settings.colorPicker.contrastPoor"),class:"poor"}}static generateColorVariations(e,t,n="dark"){const o={},a=e.match(/\d+/g);if(!a)return o;const[s,r,i]=a.map(h=>parseInt(h)),c=w(),g=T.get(c.applySecondaryColorToBg.tag)||!1,u=n==="light";if(t==="accent")o["--color-warm-2"]=e,o["--color-highlights"]=e,o["--color-warm-1"]=`rgb(${Math.min(255,s+30)}, ${Math.min(255,r+30)}, ${Math.min(255,i+30)})`,o["--color-warm-3"]=`rgb(${Math.max(0,s-30)}, ${Math.max(0,r-30)}, ${Math.max(0,i-30)})`,o["--color-highlights-15"]=`rgba(${s}, ${r}, ${i}, 0.15)`,o["--color-highlights-25"]=`rgba(${s}, ${r}, ${i}, 0.25)`,o["--color-highlights-50"]=`rgba(${s}, ${r}, ${i}, 0.5)`,o["--color-highlights-75"]=`rgba(${s}, ${r}, ${i}, 0.75)`,o["--color-highlights-90"]=`rgba(${s}, ${r}, ${i}, 0.9)`,o["--color-border-highlight"]=e,o["--color-border-highlight-alt"]=`rgba(${s}, ${r}, ${i}, 0.9)`,o["--color-shadow-highlight"]=`rgba(${s}, ${r}, ${i}, 0.5)`,o["--color-shadow-primary"]=`rgba(${s}, ${r}, ${i}, 0.8)`,o["--color-border-light-primary"]=`rgba(${s}, ${r}, ${i}, 0.5)`,o["--color-border-light-highlight"]=e,o["--color-underline-header"]=e,o["--color-underline-active"]=e,o["--color-text-hyperlink"]=e,o["--color-scrollbar"]=`rgba(${s}, ${r}, ${i}, 0.7)`,o["--color-scrollbar-border"]=`rgba(${s}, ${r}, ${i}, 0.75)`,o["--control-active-border-color"]=e,o["--color-text-accent"]=e;else if(t==="secondary"){o["--color-secondary"]=e,o["--color-secondary-bright"]=`rgb(${Math.min(255,s+120)}, ${Math.min(255,r+120)}, ${Math.min(255,i+120)})`,o["--color-secondary-bright-50"]=`rgba(${Math.min(255,s+120)}, ${Math.min(255,r+120)}, ${Math.min(255,i+120)}, 0.5)`,o["--color-secondary-15"]=`rgba(${s}, ${r}, ${i}, 0.15)`,o["--color-secondary-25"]=`rgba(${s}, ${r}, ${i}, 0.25)`,o["--color-secondary-50"]=`rgba(${s}, ${r}, ${i}, 0.5)`,o["--color-secondary-65"]=`rgba(${s}, ${r}, ${i}, 0.65)`,o["--color-secondary-75"]=`rgba(${s}, ${r}, ${i}, 0.75)`,o["--color-secondary-90"]=`rgba(${s}, ${r}, ${i}, 0.9)`,o["--color-secondary-b"]=`rgb(${Math.max(0,s-30)}, ${Math.max(0,r-30)}, ${Math.max(0,i-30)})`,o["--color-secondary-b-25"]=`rgba(${Math.max(0,s-30)}, ${Math.max(0,r-30)}, ${Math.max(0,i-30)}, 0.25)`,o["--color-secondary-b-50"]=`rgba(${Math.max(0,s-30)}, ${Math.max(0,r-30)}, ${Math.max(0,i-30)}, 0.5)`,o["--color-secondary-b-75"]=`rgba(${Math.max(0,s-30)}, ${Math.max(0,r-30)}, ${Math.max(0,i-30)}, 0.75)`,o["--color-secondary-b-90"]=`rgba(${Math.max(0,s-30)}, ${Math.max(0,r-30)}, ${Math.max(0,i-30)}, 0.9)`;const h=this.rgbToHsl(e);if(u){const y=Math.min(30,h.l-40);o["--color-text-secondary"]=this.hslToRgb(h.h,h.s,y)}else{const y=Math.max(70,h.l+40);o["--color-text-secondary"]=this.hslToRgb(h.h,h.s,y)}if(o["--color-ownership-none"]=e,o["--toggle-active-bg-color"]=e,o["--toggle-active-border-color"]=e,o["--color-fieldset-border"]=`rgba(${s}, ${r}, ${i}, 0.25)`,o["--input-border-color"]=e,g){const y=s,S=r,N=i,U=`rgb(${y}, ${S}, ${N})`;o["--color-cool-5"]=U,o["--color-cool-5-15"]=`rgba(${y}, ${S}, ${N}, 0.15)`,o["--color-cool-5-25"]=`rgba(${y}, ${S}, ${N}, 0.25)`,o["--color-cool-5-50"]=`rgba(${y}, ${S}, ${N}, 0.5)`,o["--color-cool-5-75"]=`rgba(${y}, ${S}, ${N}, 0.75)`,o["--color-cool-5-90"]=`rgba(${y}, ${S}, ${N}, 0.95)`,o["--background"]=`rgba(${y}, ${S}, ${N}, 0.98)`,o["--background-color"]=`rgba(${y}, ${S}, ${N}, 0.75)`,o["--control-bg-color"]=`rgba(${y}, ${S}, ${N}, 0.75)`,o["--sidebar-background"]=`rgba(${y}, ${S}, ${N}, 0.94)`,o["--color-bg-button"]="light-dark(rgba(0, 0, 0, 0.1), rgba(255, 255, 255, 0.1))"}}return o}static applyCustomTheme(e){var y;const t=w(),n=T.get(t.applySecondaryColorToBg.tag)||!1,o=document.getElementById("crlngn-custom-theme-style");o&&o.remove();const a=game.settings.get("core","uiConfig");(y=a==null?void 0:a.colorScheme)!=null&&y.interface;const s=this.generateColorVariations(e.accent,"accent"),r=e.secondaryDark||e.secondary||$[0].colorPreview[0],i=e.secondaryLight||"rgb(223, 227, 231)";p.log("Secondary colors",[r,i]);const c=this.generateColorVariations(r,"secondary","dark"),g=this.generateColorVariations(i,"secondary","light");let u=`body.crlngn-ui, body.crlngn-ui.game .app {
`;for(const[S,N]of Object.entries(s))u+=`  ${S}: ${N};
`;u+=`}
`,u+=`
      body.crlngn-ui.theme-dark,
      body.crlngn-ui.theme-dark .app,
      body.crlngn-ui.theme-dark .application:not(.sheet),
      body.crlngn-ui #interface.theme-dark,
      body.crlngn-ui .application.theme-dark,
      body.crlngn-ui #interface.theme-dark,
      body.crlngn-ui .sidebar-popout.theme-dark,
      body.crlngn-ui .themed.theme-dark .ui-control, 
      body.crlngn-ui .themed.theme-dark .placeable-hud, 
      body.crlngn-ui .themed.theme-dark #measurement .waypoint-label,
      body.crlngn-ui .themed.theme-dark #players,
      body.crlngn-ui #tooltip.theme-dark {
        ${Object.entries(c).map(([S,N])=>`${S}: ${N};`).join(`
    `)}
      }
      
      body.crlngn-ui.theme-light,
      body.crlngn-ui.theme-light .app,
      body.crlngn-ui.theme-light .application:not(.sheet),
      body.crlngn-ui #interface.theme-light,
      body.crlngn-ui .application.theme-light,
      body.crlngn-ui #interface.theme-light,
      body.crlngn-ui .sidebar-popout.theme-light,
      body.crlngn-ui .themed.theme-light .ui-control, 
      body.crlngn-ui .themed.theme-light .placeable-hud, 
      body.crlngn-ui .themed.theme-light #measurement .waypoint-label,
      body.crlngn-ui .themed.theme-light #players,
      body.crlngn-ui #tooltip.theme-light  {
        ${Object.entries(g).map(([S,N])=>`${S}: ${N};`).join(`
    `)}
      }
    `,n&&(u+=`
        body.crlngn-ui {
          --tools-visible-opacity: 0.75;
        }
        body.crlngn-ui .application.sheet.journal-sheet:not(.dnd5e2-journal),
        body.crlngn-ui .application.sheet.journal-sheet:not(.dnd5e2-journal) * {
          --color-light-1: light-dark(var(--color-dark-1), var(--color-light-1));
          --input-text-color: light-dark(var(--color-dark-1), var(--color-light-1));
        }
        body.crlngn-ui.theme-dark input[type=checkbox], 
        body.crlngn-ui.theme-dark input[type=radio]{
          --checkbox-background-color: light-dark(rgba(0, 0, 0, 0.25), rgba(255, 255, 255, 0.2));
        } 
      `);const h=document.createElement("style");h.id="crlngn-custom-theme-style",h.textContent=u,document.head.appendChild(h),p.log("Applied custom theme",[e,u])}static migrateFromOldTheme(e){const t=$.find(n=>n.className===e);return t?{accent:t.colorPreview[2],secondaryDark:t.colorPreview[1],secondaryLight:t.colorPreview[0]}:{accent:$[0].colorPreview[2],secondaryDark:$[0].colorPreview[1],secondaryLight:$[0].colorPreview[0]}}}const Ca=Object.freeze(Object.defineProperty({__proto__:null,ColorPickerDialog:Nn,ColorPickerUtil:fe},Symbol.toStringTag,{value:"Module"}));foundry.utils;const{ApplicationV2:Ea,HandlebarsApplicationMixin:Ta}=foundry.applications.api;var Go,_,bt,po,ce,Ho,Uo,$o,so,ro,Vo;const I=class I extends Ta(Ea){constructor(){super(...arguments);b(this,"_onRender",(t,n)=>{w(),O(I,_,this.element);const o=m(I,_).querySelector('input[type="range"][name="sceneItemWidth"]'),a=m(I,_).querySelector('input[type="number"].range-value-input[name="sceneItemWidth_value"]');o&&a&&I.handleRangeInputs(o,a);const s=m(I,_).querySelector('input[type="range"][name="sideBarWidth"]'),r=m(I,_).querySelector('input[type="number"].range-value-input[name="sideBarWidth_value"]');s&&r&&I.handleRangeInputs(s,r);const i=m(I,_).querySelectorAll(".toggle-hint");p.log("_onRender",[t,n,this.element]),i.forEach(c=>{c.addEventListener("click",()=>{m(I,_).querySelectorAll("p.hint").forEach(g=>g.classList.toggle("shown"))})}),I.handleCustomFontFields(),I.handleThemeAndStyleFields(),p.log("_onRender",[t,n])})}_configureRenderParts(t){const n=super._configureRenderParts(t),o=I.getRestrictedTabs();return game.user.isGM||o.forEach(a=>{delete n[a]}),n}async _prepareContext(t){const n=await super._prepareContext(t);n.activeTab=t.activeTab||Object.keys(n.tabs)[0],n.isGM=game.user.isGM,w(),n.themes=$;const o=await L.getAllFonts();return n.fontList=o,n}async _preparePartContext(t,n,o){var r,i,c;const a=await super._preparePartContext(t,n,o);t in n.tabs&&(a.tab=a.tabs[t]),w(),Wo();const s=I.getRestrictedTabs();switch(game.user.isGM||s.forEach(g=>{delete a.tabs[g]}),t){case"tabs":break;case"footer":{a.buttons=[{type:"button",icon:"",label:"CRLNGN_UI.settings.moduleSettingsMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.moduleSettingsMenu.save"}];break}default:{a.tab=a.tabs[t];const g=((r=I.PARTS[t])==null?void 0:r.menuKey)||null;if(g){const u=I.getMenuContext(g);if(u.fields&&(a.fields={...a.fields,...u.fields}),u.fieldDefaults&&(a.fieldDefaults={...a.fieldDefaults,...u.fieldDefaults}),u.fieldValues){if(t==="themes"){const h=$.find(S=>S.className===u.fieldValues.colorTheme);u.fieldValues.colorTheme=(h==null?void 0:h.label)||$[0].label;const y=$.find(S=>S.className===u.fieldValues.playerColorTheme);u.fieldValues.playerColorTheme=(y==null?void 0:y.label)||""}Object.assign(a,u.fieldValues)}if(t==="themes"){const h=T.get("v2-custom-theme-colors"),y=T.get("v2-player-custom-theme-colors"),S=X=>{if(!X.secondary)return X;const te=X.secondary.match(/\d+/g);if(te){const[me,de,Me]=te.map(Ce=>parseInt(Ce));return{...X,secondaryLight:`rgb(${Math.min(255,me+150)}, ${Math.min(255,de+150)}, ${Math.min(255,Me+150)})`,secondaryDark:X.secondary}}return X},N=h||{accent:$[0].colorPreview[1],secondary:$[0].colorPreview[0]};a.customColors=S(N);const U=y||h||{accent:$[0].colorPreview[1],secondary:$[0].colorPreview[0]};a.playerCustomColors=S(U)}a.sidebarTabs=Object.values(((c=(i=foundry.applications)==null?void 0:i.sidebar)==null?void 0:c.tabs)||{}).map(h=>({tabName:h.tabName,name:h.name,hideForGM:!1,hideForPlayer:!1,localizedName:`CRLNGN_UI.settings.sidebarTabs.${h.name}`}))}break}}return p.log("_preparePartContext",[a,t]),a}static getMenuContext(t){var c,g;const n=w(),o=((c=n[t])==null?void 0:c.fields)||[],a=((g=n["player_"+t])==null?void 0:g.fields)||[];if(!o||o.length===0)return{};const s={},r={},i={};return o==null||o.forEach(u=>{if(n[u]){const h=T.get(n[u].tag);s[u]=n[u],r[u]=h!==void 0?h:n[u].default,i[u]=n[u].default}}),a==null||a.forEach(u=>{if(n[u]){const h=T.get(n[u].tag);s[u]=n[u],r[u]=h!==void 0?h:n[u].default,i[u]=n[u].default}}),{fields:s,fieldValues:r,fieldDefaults:i}}static getRestrictedTabs(){const t=[];return Object.entries(I.PARTS).forEach((n,o)=>{n[0]!=="tabs"&&n[0]!=="footer"&&n[1].isGMOnly&&t.push(n[0])}),t}static handleRangeInputs(t,n){if(t&&n){const o=parseInt(t.min,10),a=parseInt(t.max,10);t.addEventListener("input",()=>{n.value=t.value}),n.addEventListener("input",()=>{const s=n.value;if(s===""||s==="-")return;const r=parseInt(s,10);!isNaN(r)&&r>=o&&r<=a&&(t.value=r)}),n.addEventListener("change",()=>{let s=parseInt(n.value,10);isNaN(s)||s<o?s=o:s>a&&(s=a),n.value=s,t.value=s}),n.value=t.value}}static updateSettings(t){let n=!1;const o=w(),r=m(I,_).querySelector(".form-content.active").dataset.tab;if(O(I,bt,r),!t)return;let i;t.object&&(i=foundry.utils.expandObject(t.object));const c=$.find(u=>u.label===i.colorTheme);i.colorTheme=c?c.className:$[0].className;const g=$.find(u=>u.label===i.playerColorTheme);return i.playerColorTheme=g?g.className:"",Object.entries(i).forEach(([u,h])=>{var y;if(!u.endsWith("_value")&&(p.log("updateSettings #1",[o,o[u]]),i[u]!==void 0&&o[u])){const S=T.get(o[u].tag),N=o[u].scope===C.client,U=o[u].scope===C.world;N||U&&game.user.isGM?T.set(o[u].tag,i[u]):p.log(`Skipping world-scoped setting ${u} for non-GM user`),(y=o[u])!=null&&y.requiresReload&&S!==i[u]&&(n=!0)}}),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated")),n}changeTab(t,n,o){super.changeTab(t,n,o),O(I,bt,t)}static handleCustomFontFields(){const t=m(I,_).querySelector(".form-content[data-tab=fonts]");if(!t)return;t.querySelectorAll('input[type="text"]').forEach(a=>{const s=a.closest(".dropdown-wrapper"),r=s==null?void 0:s.querySelector(".dropdown-options");if(!s||!r)return;const i=()=>{var c;H(c=I,ce,so).call(c),r.classList.add("active")};a.addEventListener("focus",i),a.addEventListener("click",i),a.addEventListener("keydown",H(I,ce,ro)),document.addEventListener("click",c=>{s.contains(c.target)||r.classList.remove("active")})}),t.querySelectorAll(".dropdown-option").forEach(a=>{a.addEventListener("mouseenter",()=>{a.closest(".dropdown-options").querySelectorAll(".dropdown-option").forEach(r=>r.classList.remove("highlighted")),a.classList.add("highlighted")}),a.addEventListener("click",s=>{const r=a.closest(".dropdown-wrapper").querySelector("input");let i=a.dataset.value;i.includes(" ")&&!i.startsWith('"')?i=`"${i}"`:i.startsWith("&quot;")&&(i=i.replace(/&quot;/g,'"')),r.value=i;const c=a.closest(".dropdown-options");c.classList.remove("active"),p.log("handleCustomFontFields",[i,r,c])})})}static handleThemeAndStyleFields(){const t=m(I,_).querySelector(".form-content[data-tab=themes]");if(!t)return;t.querySelectorAll(".open-color-picker").forEach(c=>{c.addEventListener("click",g=>{g.preventDefault();const u=c.dataset.scope||"world",h=u==="player"?"v2-player-custom-theme-colors":"v2-custom-theme-colors";new Nn({scope:u,currentColors:T.get(h),callback:S=>{I.updateColorPreview(S,u)}}).render(!0)})}),t.querySelectorAll('input[type="text"]:not([hidden])').forEach(c=>{const g=c.closest(".dropdown-wrapper"),u=g==null?void 0:g.querySelector(".dropdown-options");if(!g||!u)return;const h=()=>{var y;H(y=I,ce,so).call(y),u.classList.add("active")};c.addEventListener("focus",h),c.addEventListener("click",h),c.addEventListener("keydown",H(I,ce,ro)),document.addEventListener("click",y=>{g.contains(y.target)||u.classList.remove("active")})}),t.querySelectorAll(".dropdown-option").forEach(c=>{c.addEventListener("mouseenter",()=>{c.closest(".dropdown-options").querySelectorAll(".dropdown-option").forEach(u=>u.classList.remove("highlighted")),c.classList.add("highlighted")}),c.addEventListener("click",function(g){var S,N,U;p.log("theme option",[c,c.querySelector(".theme-name")]);const u=(S=c.closest(".dropdown-wrapper"))==null?void 0:S.querySelector("input");let h=(N=c.querySelector(".theme-name"))==null?void 0:N.innerHTML.toString();if(u.value=h,u.name==="colorTheme"||u.name==="playerColorTheme"){const X=$.find(te=>te.label===h);H(U=I,ce,Vo).call(U,X)}c.closest(".dropdown-options").classList.remove("active")})});const s=m(I,_).querySelectorAll('.multiple-select.other-modules input[type="checkbox"]'),r=m(I,_).querySelector('input.otherModulesList[type="hidden"]');s.forEach(c=>{c.addEventListener("change",g=>{const u=g.currentTarget;let y=`${r.value}`.split(",")||[],S=y.indexOf(u.value);!g.currentTarget.checked&&S>-1?y.splice(S,1):g.currentTarget.checked&&S===-1&&y.push(u.value),r.value=y.join(","),p.log("checkbox changed",[y,r.value])})});const i=m(I,_).querySelector("input.adjustOtherModules");i==null||i.addEventListener("change",c=>{const g=m(I,_).querySelectorAll('.multiple-select.other-modules input[type="checkbox"]');g.forEach(y=>{y.checked=c.currentTarget.checked;const S=new Event("change",{bubbles:!0});y.dispatchEvent(S)});const u=[],h=m(I,_).querySelector('input.otherModulesList[type="hidden"]');g.forEach(y=>{y.checked&&u.push(y.value)}),h.value=u.join(","),u.length===0&&(i.checked=!1)})}static updateColorPreview(t,n="world"){var r;const o=(r=m(I,_))==null?void 0:r.querySelector(".form-content[data-tab=themes]");if(!o)return;const a=o.querySelector(`.open-color-picker[data-scope="${n}"]`);if(!a)return;const s=a.closest(".form-group").querySelector(".custom-color-preview");if(s){const i=s.querySelector(".accent-swatch"),c=s.querySelector(".secondary-swatch");i&&(i.style.backgroundColor=t.accent),c&&(c.style.backgroundColor=t.secondary)}}};_=new WeakMap,bt=new WeakMap,po=new WeakMap,ce=new WeakSet,Ho=async function(t,n,o){t.preventDefault(),t.stopPropagation(),I.updateSettings(o)&&L.confirmReload()},Uo=async function(t,n){const o=w(),s=m(I,_).querySelector(".form-content.active"),r=s.dataset.tab,i=I.PARTS[r].menuKey,c=o[i].default;s.querySelectorAll("input, select").forEach(u=>{u.value=c[u.name],u.type==="checkbox"&&(u.checked=c[u.name])}),p.log("#onReset",[m(I,bt),r,t,n])},$o=function(){var o;const t=[],n=I.PARTS;return((o=game.system)==null?void 0:o.id)!=="dnd5e"&&delete n.sheets5e,p.log("#getTabs",[n,I.PARTS]),Object.entries(n).forEach(([a,s])=>{s.menuKey&&t.push({id:a,icon:"",group:"primary-tabs",label:`CRLNGN_UI.settings.moduleSettingsMenu.tabs.${a}`})}),t},so=function(){m(I,_).querySelectorAll(".dropdown-options").forEach(t=>{t.classList.remove("active")})},ro=function(t){const n=t.target.closest(".dropdown-wrapper"),o=n==null?void 0:n.querySelector(".dropdown-options"),a=o.classList.contains("active"),s=Array.from(o.querySelectorAll(".dropdown-option"));let r=s.findIndex(i=>i.classList.contains("highlighted"));t.key==="ArrowDown"||t.key==="ArrowUp"?(t.preventDefault(),a||o.classList.add("active"),s.forEach(i=>i.classList.remove("highlighted")),r===-1?r=t.key==="ArrowDown"?0:s.length-1:r=t.key==="ArrowDown"?(r+1)%s.length:(r-1+s.length)%s.length,s[r]&&(s[r].classList.add("highlighted"),s[r].scrollIntoView({block:"nearest"}))):t.key==="Enter"?(t.preventDefault(),a&&r!==-1&&s[r]&&s[r].click()):t.key==="Escape"&&o.classList.remove("active")},Vo=function(t){if(p.log("Selected theme updated:",[t]),!t)return;m(I,_).querySelectorAll("span.selected-theme").forEach((o,a)=>{o.style.setProperty("background-color",t.colorPreview[a])})},k(I,ce),k(I,_),k(I,bt),k(I,po),b(I,"selectedTheme"),b(I,"DEFAULT_OPTIONS",{id:"crlngn-ui-settings",tag:"form",window:{icon:"fas fa-cog",title:"CRLNGN_UI.settings.moduleSettingsMenu.title",contentClasses:["standard-form","crlngn","tabbed-settings"],resizable:!0},position:{width:740,height:"auto"},actions:{redefine:H(I,ce,Uo)},form:{handler:H(I,ce,Ho),closeOnSubmit:!0}}),b(I,"PARTS",{tabs:{template:"templates/generic/tab-navigation.hbs",isGMOnly:!1},interface:{menuKey:"interfaceOptionsMenu",template:"modules/crlngn-ui/templates/interface-elements-settings.hbs",isGMOnly:!1},themes:{menuKey:"themeAndStylesMenu",template:"modules/crlngn-ui/templates/theme-and-styles-settings.hbs",isGMOnly:!1},fonts:{menuKey:"customFontsMenu",template:"modules/crlngn-ui/templates/custom-fonts-settings.hbs",isGMOnly:!0},chat:{menuKey:"chatMessagesMenu",template:"modules/crlngn-ui/templates/chat-messages-settings.hbs",isGMOnly:!1},scenes:{menuKey:"sceneNavMenu",template:"modules/crlngn-ui/templates/scene-nav-settings.hbs",isGMOnly:!1},players:{menuKey:"playersListMenu",template:"modules/crlngn-ui/templates/players-list-settings.hbs",isGMOnly:!1},camera:{menuKey:"cameraDockMenu",template:"modules/crlngn-ui/templates/camera-dock-settings.hbs",isGMOnly:!1},footer:{template:"templates/generic/form-footer.hbs",isGMOnly:!1}}),b(I,"TABS",{primary:{initial:"interface",tabs:H(Go=I,ce,$o).call(Go),labelPrefix:""}});let ao=I;class Na extends FormApplication{constructor(...e){super(...e),window.open("https://www.patreon.com/c/carolingiandev/membership","_blank"),this.close()}render(){return this.close(),this}}function Wo(){return{moduleSettingsMenu:{tab:"",tag:game.i18n.localize("CRLNGN_UI.settings.moduleSettingsMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.moduleSettingsMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.moduleSettingsMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.moduleSettingsMenu.hint"),icon:"fas fa-sliders-h",propType:ao,restricted:!1},supportPatreon:{tab:"",tag:game.i18n.localize("CRLNGN_UI.settings.supportPatreon.label"),name:game.i18n.localize("CRLNGN_UI.settings.supportPatreon.label"),label:game.i18n.localize("CRLNGN_UI.settings.supportPatreon.buttonLabel"),hint:game.i18n.localize("CRLNGN_UI.settings.supportPatreon.hint"),icon:"fas fa-heart",propType:Na,restricted:!1}}}var at,We,Vt,Wt,jt,Yt,Xt,Jt,Kt,Zt,st,Qt,_t;const f=class f{static applyFadeOut(e){f.useFadeOut=e,f.cameraContainer&&f.cameraContainer.classList.toggle("faded-ui",e)}static applyHide(e){f.hidden=e,f.cameraContainer&&f.cameraContainer.classList.toggle("hidden",e)}static applyCustomStyle(e){var t;f.enableFloatingDock=e,p.log("applyCustomStyle",["enableFloatingDock",e,f.enableFloatingDock,ui.webrtc]),(t=ui.webrtc)==null||t.render()}static init(){const e=w();f.enableFloatingDock=T.get(e.enableFloatingDock.tag),f.currSettings={enableFloatingDock:f.enableFloatingDock,defaultVideoWidth:T.get(e.defaultVideoWidth.tag),dockHeight:T.get(e.dockHeight.tag),dockWidth:T.get(e.dockWidth.tag),dockPosX:T.get(e.dockPosX.tag),dockPosY:T.get(e.dockPosY.tag),dockResizeOnUserJoin:T.get(e.dockResizeOnUserJoin.tag)},f.enableFloatingDock?(f.positionIntervalId&&(clearInterval(f.positionIntervalId),f.positionIntervalId=null),Hooks.on(A.RENDER_CAMERA_VIEWS,f.onRenderFloating),Hooks.on(A.RENDER_PLAYERS_LIST,f.onRenderPlayersList),Hooks.on(A.CLIENT_SETTING_CHANGED,t=>{p.log("Setting updated",[t]),t.includes("rtcClientSettings")&&f.checkMinimizedState()})):(Hooks.on(A.RENDER_CAMERA_VIEWS,f.onRenderPlain),f.onRenderPlain())}static onRenderPlain(e,t){var n;f.cameraContainer||(f.cameraContainer=document.querySelector("#av-holder")),(n=f.cameraContainer)==null||n.classList.add("visible")}static onRenderFloating(e,t,n){w();const o=f.currSettings,a=document.querySelector("#camera-views");if(f.cameraContainer=document.querySelector("#av-holder"),f.cameraContainer)f.cameraContainer.appendChild(a);else{const c=document.createElement("div");f.cameraContainer=c,c.id="av-holder",c.appendChild(a),document.querySelector("body.crlngn-ui").appendChild(c)}f.cameraContainer.querySelector("button[data-action=toggleDock]").addEventListener("click",()=>{var c;(c=ui.webrtc)==null||c.render()}),((t==null?void 0:t.querySelectorAll(".camera-view"))||[]).forEach(c=>{const g=game.users.get(c.dataset.user),u=(g==null?void 0:g.color)||"";c.style.setProperty("--player-color",u)}),p.log("CameraDockUtil.onRender",[e,t,n,o.dockPosX,o.dockPosY]);const i=game.settings.get("core","rtcClientSettings");(i==null?void 0:i.hideDock)!==!0?(f.checkMinimizedState(),f.applyDockResize(o.dockResizeOnUserJoin),f.makeDraggable(),f.makeResizeable(),f.applyVideoWidth(),f.resetPositionAndSize()):f.checkMinimizedState(),f.applyFadeOut(f.useFadeOut)}static onRenderPlayersList(){p.log("onRenderPlayersList")}static applyPositionWithDelay(){f.positionIntervalId&&(clearInterval(f.positionIntervalId),f.positionIntervalId=null),f.resetPositionAndSize();let e=0;f.positionIntervalId=setInterval(()=>{f.resetPositionAndSize(),e++,e>=f.positionAttempts&&(clearInterval(f.positionIntervalId),f.positionIntervalId=null)},20)}static applyVideoWidth(e){const t=w(),n=T.get(t.defaultVideoWidth.tag);let o=e||n;if(o<Yn)o=Yn,T.set(t.defaultVideoWidth.tag,o);else if(!Number.isNaN(o)){f.currSettings.defaultVideoWidth=o;const a=document.querySelector("#av-holder.minimized #camera-views"),s=document.querySelector("#camera-views");!a&&s&&(s.parentNode.style.setProperty("--av-width",o+"px"),s.style.setProperty("--av-width",o+"px")),f.updateDockSize()}}static resetPositionAndSize({x:e,y:t,w:n,h:o}={x:null,y:null,w:null,h:null}){w();const a=f.currSettings;if(!f.enableFloatingDock||!f.cameraContainer)return;const s=game.settings.get("core","rtcClientSettings");if((s==null?void 0:s.hideDock)===!0){f.checkMinimizedState();return}if(p.log("CameraDock",[a]),!e&&!t&&!n&&!o){const r=a.dockPosX||0,i=a.dockPosY||0;if(f.cameraContainer.style.left=`${r}px`,f.cameraContainer.style.bottom=`${i}px`,f.currSettings.dockResizeOnUserJoin===De.off.name){const c=a.dockWidth||0,g=a.dockHeight||0;f.cameraContainer.style.width=`${c}px`,f.cameraContainer.style.height=`${g}px`}}else e!==null&&(f.cameraContainer.style.left=`${e}px`),t!==null&&(f.cameraContainer.style.bottom=`${t}px`),f.currSettings.dockResizeOnUserJoin===De.horizontal.name?n!==null&&(f.cameraContainer.style.width=`${n}px`):f.currSettings.dockResizeOnUserJoin===De.vertical.name&&o!==null&&(f.cameraContainer.style.height=`${o}px`)}static makeDraggable(){var e,t;(e=f.cameraContainer)==null||e.addEventListener("mousedown",n=>{var i,c;const o=document.querySelector("#av-holder.minimized #camera-views");if(n.button!==0)return;const a=document.querySelector("body.crlngn-ui");if(p.log("mousedown",[n.target.tagName,n.target.parentNode.tagName]),n.target.tagName=="input"||(i=n.target.parentNode)!=null&&i.classList.contains("webrtc-volume-slider")||(a==null||a.addEventListener("mousemove",m(f,Jt)),a==null||a.addEventListener("mouseup",m(f,Kt)),o))return;const s=L.getOffsetBottom(f.cameraContainer);let r=((c=f.cameraContainer)==null?void 0:c.offsetLeft)||0;f.isDragging=!0,O(f,at,n.clientX-r),O(f,We,window.innerHeight-n.clientY-s),n.preventDefault(),n.stopPropagation()}),(t=f.cameraContainer)==null||t.addEventListener("touchstart",n=>{var c,g;const o=document.querySelector("#av-holder.minimized #camera-views");if(!n.touches[0])return;const a=document.querySelector("body.crlngn-ui");if((c=n.target.parentNode)!=null&&c.classList.contains("volume-bar")||(a.addEventListener("touchmove",m(f,Zt)),a.addEventListener("touchend",m(f,st)),a.addEventListener("touchcancel",m(f,st)),o))return;const s=n.touches[0],r=L.getOffsetBottom(f.cameraContainer);let i=((g=f.cameraContainer)==null?void 0:g.offsetLeft)||0;f.isDragging=!0,O(f,at,s.clientX-i),O(f,We,window.innerHeight-s.clientY-r),n.preventDefault(),n.stopPropagation()})}static updateDockSize(){var i,c;if(!f.cameraContainer)return;const e=w(),t=f.currSettings.dockResizeOnUserJoin,n=f.currSettings.defaultVideoWidth||Yn,a=(((c=(i=game.webrtc)==null?void 0:i.users)==null?void 0:c.filter(g=>g.active&&g.canBroadcastVideo))||[]).length;if(a===0)return;if(t===De.horizontal.name){const g=n*a+16;f.cameraContainer.style.width=`${g}px`}else if(t===De.vertical.name){const g=n*a+16;f.cameraContainer.style.height=`${g}px`}const s=parseInt(f.cameraContainer.style.width||0),r=parseInt(f.cameraContainer.style.height||0);s>0&&T.set(e.dockWidth.tag,s),r>0&&T.set(e.dockHeight.tag,r)}static applyDockResize(e=null){if(!f.cameraContainer)return;e?f.currSettings.dockResizeOnUserJoin=e:e=f.currSettings.dockResizeOnUserJoin,f.cameraContainer.classList.remove("horizontal"),f.cameraContainer.classList.remove("vertical");const t=f.cameraContainer.querySelector("#camera-views");t.classList.remove("horizontal"),t.classList.remove("vertical"),e===De.horizontal.name?f.cameraContainer.classList.add("horizontal"):e===De.vertical.name&&f.cameraContainer.classList.add("vertical"),f.updateDockSize()}static makeResizeable(){if(f.cameraContainer){const e=document.querySelector("body.crlngn-ui"),t=document.createElement("div"),n=f.cameraContainer.querySelector(".resize-handle");n&&n.remove(),t.classList.add("resize-handle"),f.cameraContainer.append(t),t.addEventListener("mousedown",o=>{o.preventDefault(),o.stopPropagation(),f.isResizing=!0,O(f,Vt,o.clientX),O(f,Wt,o.clientY),O(f,Xt,parseInt(getComputedStyle(f.cameraContainer).bottom)||0),O(f,jt,f.cameraContainer.offsetWidth),O(f,Yt,f.cameraContainer.offsetHeight),e==null||e.addEventListener("mousemove",m(f,Qt)),e==null||e.addEventListener("mouseup",m(f,_t))})}}static checkMinimizedState(){if(!f.cameraContainer)return;const e=game.settings.get("core","rtcClientSettings"),t=(e==null?void 0:e.hideDock)===!0;t?document.querySelector("#av-holder").classList.add("minimized"):document.querySelector("#av-holder").classList.remove("minimized"),p.log("Checking minimized state",[e,t]),f.handleMinimizedState(t)}static handleMinimizedState(e){var a;const t=document.querySelector("#interface #players #players-active"),n=f.cameraContainer.querySelector("button[data-action=toggleDock]");if(!t||!n||!f.cameraContainer)return;if(p.log("handleMinimizedState",[e]),e)f.cameraContainer.parentNode!==t&&(f.originalParent=f.cameraContainer.parentNode,t.prepend(f.cameraContainer),n.classList.remove("fa-caret-down"),n.classList.remove("fa-caret-left"),n.classList.remove("fa-caret-right"),n.classList.remove("fa-compress"),n.classList.add("fa-camera"));else{if(!f.originalParent)return;f.originalParent.prepend(f.cameraContainer),f.makeDraggable(),f.makeResizeable(),n.classList.remove("fa-caret-up"),n.classList.remove("fa-caret-left"),n.classList.remove("fa-caret-right"),n.classList.remove("fa-expand"),n.classList.add("fa-caret-down"),p.log("Restored camera position from settings",[f.currSettings])}const o=(a=f.cameraContainer)==null?void 0:a.querySelector("#camera-views");o==null||o.classList.remove("horizontal"),o==null||o.classList.remove("vertical")}};at=new WeakMap,We=new WeakMap,Vt=new WeakMap,Wt=new WeakMap,jt=new WeakMap,Yt=new WeakMap,Xt=new WeakMap,Jt=new WeakMap,Kt=new WeakMap,Zt=new WeakMap,st=new WeakMap,Qt=new WeakMap,_t=new WeakMap,k(f,at,0),k(f,We,0),b(f,"isDragging",!1),b(f,"cameraContainer"),b(f,"isResizing",!1),k(f,Vt,0),k(f,Wt,0),k(f,jt,0),k(f,Yt,0),k(f,Xt,0),b(f,"currSettings",{}),b(f,"positionIntervalId",null),b(f,"positionAttempts",5),b(f,"useFadeOut",!0),b(f,"hidden",!1),b(f,"enableFloatingDock",!0),k(f,Jt,e=>{const t=document.querySelector("#av-holder.minimized #camera-views");if(!(!f.isDragging||t)){if(p.log("mousemove",[window.innerHeight,e.clientY,m(f,We)]),f.cameraContainer){let n=e.clientX-m(f,at),o=window.innerHeight-e.clientY-m(f,We);n+f.cameraContainer.offsetWidth>window.innerWidth&&(n=window.innerWidth-f.cameraContainer.offsetWidth),n<0&&(n=0),f.cameraContainer.style.left=`${n}px`,o+f.cameraContainer.offsetHeight>window.innerHeight&&(o=window.innerHeight-f.cameraContainer.offsetHeight),f.cameraContainer.style.bottom=`${o}px`}e.preventDefault(),e.stopPropagation()}}),k(f,Kt,e=>{var a,s;const t=w(),n={...f.currSettings},o=document.querySelector("#av-holder.minimized #camera-views");if(f.isDragging&&!o){const r=document.querySelector("body.crlngn-ui");n.dockPosX=parseInt((a=f.cameraContainer)==null?void 0:a.style.left)||0,n.dockPosY=parseInt((s=f.cameraContainer)==null?void 0:s.style.bottom)||0,n.dockPosY<=0&&(n.dockPosY=0),T.set(t.dockPosX.tag,n.dockPosX),T.set(t.dockPosY.tag,n.dockPosY),r==null||r.removeEventListener("mousemove",m(f,Jt)),r==null||r.removeEventListener("mouseup",m(f,Kt)),f.isDragging=!1,e.stopPropagation()}}),k(f,Zt,e=>{if(!(!f.isDragging||!e.touches[0])){if(f.cameraContainer){const t=e.touches[0];let n=t.clientX-m(f,at),o=window.innerHeight-t.clientY-m(f,We);n+f.cameraContainer.offsetWidth>window.innerWidth&&(n=window.innerWidth-f.cameraContainer.offsetWidth),n<0&&(n=0),f.cameraContainer.style.left=`${n}px`,o+f.cameraContainer.offsetHeight>window.innerHeight&&(o=window.innerHeight-f.cameraContainer.offsetHeight),f.cameraContainer.style.bottom=`${o}px`}e.preventDefault(),e.stopPropagation()}}),k(f,st,e=>{var o,a;const t=w(),n={...f.currSettings};if(f.isDragging){const s=document.querySelector("body.crlngn-ui");n.dockPosX=parseInt((o=f.cameraContainer)==null?void 0:o.style.left)||0,n.dockPosY=parseInt((a=f.cameraContainer)==null?void 0:a.style.bottom)||0,n.dockPosY<=0&&(n.dockPosY=0),T.set(t.dockPosX.tag,n.dockPosX),T.set(t.dockPosY.tag,n.dockPosY),s==null||s.removeEventListener("touchmove",m(f,Zt)),s==null||s.removeEventListener("touchend",m(f,st)),s==null||s.removeEventListener("touchcancel",m(f,st)),f.isDragging=!1,e.preventDefault(),e.stopPropagation()}}),k(f,Qt,e=>{if(!f.isResizing)return;const t=m(f,jt)+(e.clientX-m(f,Vt)),n=e.clientY-m(f,Wt),o=m(f,Yt)+n,a=m(f,Xt)-n;f.cameraContainer.style.width=`${t}px`,f.cameraContainer.style.height=`${o}px`,f.cameraContainer.style.bottom=`${a}px`}),k(f,_t,()=>{var o,a,s,r,i,c,g;const e=w(),t={...f.currSettings},n=document.querySelector("body.crlngn-ui");f.isResizing=!1,n==null||n.removeEventListener("mousemove",m(f,Qt)),n==null||n.removeEventListener("mouseup",m(f,_t)),p.log("onStopResize",[(o=f.cameraContainer)==null?void 0:o.style.width,(a=f.cameraContainer)==null?void 0:a.style.height,(s=f.cameraContainer)==null?void 0:s.style.bottom]),t.dockWidth=parseInt(((r=f.cameraContainer)==null?void 0:r.style.width)||0),t.dockHeight=parseInt(((i=f.cameraContainer)==null?void 0:i.style.height)||0),t.dockPosY=parseInt(((c=f.cameraContainer)==null?void 0:c.style.bottom)||0),t.dockPosX=parseInt(((g=f.cameraContainer)==null?void 0:g.style.left)||0),T.set(e.dockWidth.tag,t.dockWidth),T.set(e.dockHeight.tag,t.dockHeight),T.set(e.dockPosY.tag,t.dockPosY),T.set(e.dockPosX.tag,t.dockPosX)});let se=f;const W=class W{static init(){Hooks.on(A.RENDER_SIDE_BAR,W.onRender),Hooks.on(A.COLLAPSE_SIDE_BAR,W.onRender),Hooks.on(A.READY,W.onRender)}static applyFadeOut(e){W.useFadeOut=e,W.handleFadeOut()}static applyHide(e){W.hidden=e,W.handleHide()}static applyCustomStyle(e){var t;W.customStylesEnabled=e,p.log("applyCustomStyle",[W.customStylesEnabled]),(t=ui.sidebar)==null||t.render()}static onRender(e,t,n){const o=t&&typeof t===HTMLElement?t:document;o.querySelector("#roll-privacy button[data-action='toggleChat']")||W.addChatToggle(o),W.handleFadeOut(e,o,n),W.handleHide(e,o,n)}static handleFadeOut(e,t,n){p.log("handle FadeOut, ChatLogControls",[W.useFadeOut]);const o=t?t.querySelector("#chat-notifications"):document.querySelector("#ui-right #chat-notifications");W.useFadeOut?o==null||o.classList.add("faded-ui"):o==null||o.classList.remove("faded-ui")}static handleHide(e,t,n){p.log("handle Hide, ChatLogControls",[W.hidden]);const o=t?t.querySelector("#chat-notifications"):document.querySelector("#ui-right #chat-notifications");W.hidden?o==null||o.classList.add("hidden-ui"):o==null||o.classList.remove("hidden-ui")}};b(W,"useFadeOut",!0),b(W,"hidden",!1),b(W,"customStylesEnabled",!0),b(W,"addChatToggle",async e=>{if(!W.customStylesEnabled)return;const t=await L.renderTemplate(`modules/${q}/templates/chat-toggle-button.hbs`,{}),n=document.querySelector("#ui-right #roll-privacy");n.insertAdjacentHTML("afterbegin",t);const o=n.querySelector("button[data-action=toggleChat]");o.addEventListener("click",W.onToggleChatBox);const a=game.user.getFlag(q,"chatBoxHidden");if(a!==void 0){p.log("Applying saved chat box state",[a]);const s=document.querySelector("#chat-notifications");a?(o.classList.remove("fa-comment-slash"),o.classList.add("fa-comment"),s.classList.add("input-hidden"),L.addCSSVars("--chat-input-height","0px")):(o.classList.add("fa-comment-slash"),o.classList.remove("fa-comment"),s.classList.remove("input-hidden"),L.addCSSVars("--chat-input-height","100px"))}}),b(W,"onToggleChatBox",e=>{const t=document.querySelector("#ui-right button[data-action=toggleChat]"),n=document.querySelector("#chat-notifications");let o=!1;t.classList.contains("fa-comment-slash")?(t.classList.remove("fa-comment-slash"),t.classList.add("fa-comment"),n.classList.add("input-hidden"),L.addCSSVars("--chat-input-height","0px"),o=!0):(t.classList.add("fa-comment-slash"),t.classList.remove("fa-comment"),n.classList.remove("input-hidden"),L.addCSSVars("--chat-input-height","100px"),o=!1),game.user.setFlag(q,"chatBoxHidden",o),p.log("Chat box state saved to flag",[o])});let mt=W;const ve=class ve{static init(){const e=w();ve.enableChatStyles=T.get(e.enableChatStyles.tag),ve.chatBorderColor=T.get(e.chatBorderColor.tag),ve.chatBorderPosition=T.get(e.chatBorderPosition.tag)}};b(ve,"chatBorderColor"),b(ve,"enableChatStyles"),b(ve,"chatBorderPosition"),b(ve,"enrichCard",async(e,t)=>{var s,r,i,c,g,u,h,y;p.log("renderChatMessage",[ve.chatBorderColor,ve.enableChatStyles,Nt.playerColor.name,(s=e.author)==null?void 0:s.id]);const n=((c=(i=(r=e.flags)==null?void 0:r.dnd5e)==null?void 0:i.activity)==null?void 0:c.type)||((h=(u=(g=e.flags)==null?void 0:g.dnd5e)==null?void 0:u.roll)==null?void 0:h.type)||"custom";let o=t.get?t.get(0):t;if(!o)return;switch(o.classList.add(n),o.classList.add("crlngn"),ve.chatBorderPosition){case hn.left.name:o.classList.add("left-border");break;case hn.right.name:o.classList.add("right-border");break;case hn.top.name:o.classList.add("top-border");break}const a=o.querySelectorAll(".card-buttons button[data-action=rollSave]");a.length>0&&a.forEach(S=>{const N=S.querySelector(".visible-dc"),U=S.querySelector(".hidden-dc");p.log("enrichCard",[N,U]),N.setAttribute("data-ability",S.getAttribute("data-ability")||""),N.setAttribute("data-dc",S.getAttribute("data-dc")||""),U.setAttribute("data-ability",S.getAttribute("data-ability")||"")}),ve.chatBorderColor===Nt.playerColor.name&&((y=e.author)!=null&&y.id)&&o.style.setProperty("border-color",`var(--user-color-${e.author.id}) !important`)});let Xe=ve;const B=class B{static init(){this.preloadTemplates(),Hooks.on(A.RENDER_HOTBAR,B.onRender)}static applyFadeOut(e){B.useFadeOut=e,B.handleFadeOut()}static applyHide(e){B.hidden=e,B.handleHide()}static handleHide(e,t,n){const o=t||document.querySelector("#hotbar");B.hidden?o==null||o.classList.add("hidden-ui"):o==null||o.classList.remove("hidden-ui"),p.log("handle Hide",[B.hidden])}static onRender(e,t,n){p.log("MacroHotbar onRender",[B.customStylesEnabled]),B.applyCustomStyle(B.customStylesEnabled),B.handleFadeOut(e,t,n),B.handleHide(e,t,n),B.addCollapseButton(),B.applyHotBarCollapse()}static handleCollapse(e){const t=game.user.getFlag(q,"hotbarCollapsed");B.applyHotBarCollapse(!t)}static handleOpenDirectory(e){p.log("open directory")}static handleFadeOut(e,t,n){const o=t||document.querySelector("#hotbar");B.useFadeOut?o==null||o.classList.add("faded-ui"):o==null||o.classList.remove("faded-ui")}static applyCustomStyle(e){const t=w();B.customStylesEnabled=e!==void 0?e:T.get(t.enableMacroLayout.tag),p.log("applyCustomStyle",[B.customStylesEnabled]),B.applyHotBarLayout()}static applyHotBarLayout(){const e=document.querySelector("#hotbar");e&&(B.customStylesEnabled?e.classList.add("crlngn-macro"):e.classList.remove("crlngn-macro"))}};b(B,"useFadeOut",!0),b(B,"customStylesEnabled",!0),b(B,"macroStartCollapsed",!1),b(B,"hidden",!1),b(B,"preloadTemplates",async()=>{try{const e=[`modules/${q}/templates/macro-buttons.hbs`];return await L.loadTemplates(e),!0}catch(e){return console.error("Error loading navigation button templates:",e),!1}}),b(B,"addCollapseButton",async()=>{const e=document.querySelector("#hotbar #hotbar-controls-right");if(!e)return;game.user.getFlag(q,"hotbarCollapsed");const t=await L.renderTemplate(`modules/${q}/templates/macro-buttons.hbs`,{});e.insertAdjacentHTML("beforeend",t);const n=e.querySelector("button[data-action=collapse]"),o=e.querySelector("button[data-action=openDirectory]");n==null||n.addEventListener("click",B.handleCollapse),o==null||o.addEventListener("click",B.handleOpenDirectory)}),b(B,"applyHotBarCollapse",async e=>{const t=w();B.macroStartCollapsed=e!==void 0?e:T.get(t.collapseMacroBar.tag),game.user&&await game.user.setFlag(q,"hotbarCollapsed",B.macroStartCollapsed);const n=document.querySelector("#hotbar #hotbar-controls-right"),o=n==null?void 0:n.querySelector("button[data-action=collapse]"),a=document.querySelector("#hotbar");B.macroStartCollapsed&&a?(a.classList.add("collapsed"),o&&(o.classList.remove("fa-angle-down"),o.classList.add("fa-angle-up"),o.dataset.tooltip=game.i18n.localize("CRLNGN_UI.ui.macroBarTooltipKeepOpen"))):(a==null||a.classList.remove("collapsed"),o&&(o.classList.add("fa-angle-down"),o.classList.remove("fa-angle-up"),o.dataset.tooltip=game.i18n.localize("CRLNGN_UI.ui.macroBarTooltipAutoHide")))});let Re=B;var Pn;const K=class K{static init(){p.log("PlayersList init",[]),Hooks.on(A.RENDER_PLAYERS_LIST,K.onRender)}static applyFadeOut(e){K.useFadeOut=e,K.handleFadeOut()}static applyHide(e){K.hidden=e,K.handleHide()}static handleHide(e,t,n){const o=t||document.querySelector("#players");K.hidden?o==null||o.classList.add("hidden-ui"):o==null||o.classList.remove("hidden-ui"),p.log("handle Hide",[K.hidden])}static handleFadeOut(e,t,n){const o=t||document.querySelector("#players");O(K,Pn,setTimeout(()=>{p.log("handleFadeOut - PlayersList",[o,K.useFadeOut]),K.useFadeOut?o==null||o.classList.add("faded-ui"):o==null||o.classList.remove("faded-ui"),Lt.handleYTPlayerFadeOut()},500))}static applyCustomStyle(e){K.customStylesEnabled=e,ui.players&&ui.players.render()}static onRender(e,t,n){p.log("PlayersList onRender",[e,t,n]),w();const o=t||document.querySelector("#players");K.customStylesEnabled?o==null||o.classList.add("crlngn-ui"):o==null||o.classList.remove("crlngn-ui"),K.applyPlayersListSettings(),K.applyAvatars(),K.handleFadeOut(e,o,n),K.handleHide(e,o,n)}static applyPlayersListSettings(){var t,n,o,a;const e=w();p.log("applyPlayersListSettings",[T.get(e.autoHidePlayerList.tag)]),T.get(e.autoHidePlayerList.tag)?((t=document.querySelector("#players.crlngn-ui"))==null||t.classList.add("minimized"),(n=document.querySelector("body"))==null||n.classList.add("crlngn-players-minimized")):((o=document.querySelector("#players"))==null||o.classList.remove("minimized"),(a=document.querySelector("body"))==null||a.classList.remove("crlngn-players-minimized"))}static applyAvatars(){const e=w();p.log("applyAvatars",[game.users]);const t=document.querySelector("#players"),n=game.users.filter(s=>s.active===!0),o=game.users.filter(s=>s.active===!1),a=[...n,...o];T.get(e.playerListAvatars.tag)&&K.customStylesEnabled?(t==null||t.classList.add("crlngn-avatars"),a.forEach(s=>{var u;const r=t==null?void 0:t.querySelector(`li[data-user-id='${s.id}']`),i=game.users.get(s.id),c=((u=i.character)==null?void 0:u.img)||"";p.log("player",[i]);const g=document.createElement("img");g.src=c||i.avatar||"",g.alt="*",g.classList.add("crlngn-avatar"),r&&r.prepend(g)})):((t==null?void 0:t.querySelectorAll("li.player")).forEach(r=>{const i=r.querySelector("img.crlngn-avatar");i==null||i.remove()}),t==null||t.classList.remove("crlngn-avatars"))}};Pn=new WeakMap,k(K,Pn),b(K,"useFadeOut",!0),b(K,"customStylesEnabled",!0),b(K,"playerListAvatars",!0),b(K,"hidden",!1);let Ne=K;var ho,en,St;const ie=class ie{static init(){var o;if(L.isModuleOn("foundry-taskbar")&&Hooks.on(A.UPDATE_USER,ie.checkTaskbarLock),ie.checkTaskbarLock(),ie.addModuleClasses(),L.isModuleOn("minimal-ui")&&ui.notifications.warn(game.i18n.localize("CRLNGN_UI.ui.notifications.minimalUiNotSupported"),{permanent:!0}),Hooks.on(A.CLIENT_SETTING_CHANGED,a=>{a.includes("fvtt-youtube-player.windowPosition")&&ie.handleYTPlayerFadeOut()}),O(ie,St,0),O(ie,en,setInterval(()=>{(document.querySelector("#sidebar-video-player")||m(ie,St)>=10)&&(clearInterval(m(ie,en)),ie.handleYTPlayerFadeOut()),No(ie,St)._++},200)),L.isModuleOn("dfreds-chat-pins")){const a=document.querySelector("#chat-pins"),s=game.settings.get("core","uiConfig"),r=(o=s==null?void 0:s.colorScheme)==null?void 0:o.interface;p.log("currentTheme",[r,a]),a==null||a.classList.add(`theme-${r}`)}}static handleYTPlayerFadeOut(){var n,o;const e=L.isModuleOn("fvtt-youtube-player"),t=document.querySelector("#sidebar-video-player.tyw-docked");p.log("handleYTPlayerFadeOut",[e,Ne.useFadeOut,t]),e&&t&&Ne.useFadeOut?(n=document.querySelector("#sidebar-video-player.tyw-docked"))==null||n.classList.add("faded-ui"):e&&((o=document.querySelector("#sidebar-video-player"))==null||o.classList.remove("faded-ui"))}};ho=new WeakMap,en=new WeakMap,St=new WeakMap,k(ie,ho),k(ie,en),k(ie,St,0),b(ie,"addModuleClasses",()=>{const e=w(),t=T.get(e.otherModulesList.tag)||"",n=t.split(",");p.log("addModuleClasses",[n,t]),Object.entries(e.otherModulesList.options).forEach(o=>{const a=o[1].replace(/['''"]/g,"").trim();document.querySelector("body").classList.remove("crlngn-"+a)}),n.forEach(o=>{const a=o.replace(/['''"]/g,"").trim();a&&document.querySelector("body").classList.add("crlngn-"+a)})}),b(ie,"checkTaskbarLock",()=>{var a,s,r;const e=L.isModuleOn("foundry-taskbar"),t=(a=game.user.flags)==null?void 0:a["foundry-taskbar"];if(!e||!(t!=null&&t.taskbarSettings))return;const n=game.settings.get("foundry-taskbar","reduceSidebar");p.log("checkTaskbarLock #2",[t,n]),(s=t.taskbarSettings)!=null&&s.locked?L.addCSSVars("--crlngn-margin-bottom",n?"50px":"0px"):L.addCSSVars("--crlngn-margin-bottom",n?"10px":"0px"),(r=t.taskbarSettings)!=null&&r.locked?L.addCSSVars("--crlngn-taskbar-height","50px"):L.addCSSVars("--crlngn-taskbar-height","10px"),L.addCustomCSS("body.crlngn-ui #ui-right {height: calc((100% - var(--crlngn-margin-bottom)) / var(--ui-scale));}");const o=document.querySelector("#ft-move-players-macro");o&&(o.innerHTML="")});let Lt=ie;var Y,tn,rt,mo,vt,it,lt,Dn,yo,nn,Te,Ct,ct,we,je,Ae,Et,on,Fn,an,sn,An,Gn,qn,zn,xn,Bn,Hn;const d=class d{static applyFadeOut(e){d.useFadeOut=e,p.log("applyFadeOut",[e]),d.handleSceneFadeOut()}static applyHide(e){d.hidden=e,d.handleHide()}static handleHide(){const e=document.querySelector("#scene-navigation"),t=document.querySelector("#crlngn-scene-navigation-expand"),n=document.querySelectorAll("#ui-left-column-2 .crlngn-btn");d.hidden?(e==null||e.classList.add("hidden-ui"),t==null||t.classList.add("hidden-ui"),n.forEach(o=>{o.classList.add("hidden-ui")})):(e==null||e.classList.remove("hidden-ui"),t==null||t.classList.remove("hidden-ui"),n.forEach(o=>{o.classList.remove("hidden-ui")})),p.log("handle Hide",[d.hidden])}static applyCustomStyle(e){d.sceneNavEnabled=e,p.log("applyCustomStyle - TopNavigation",[d.sceneNavEnabled,ui.nav])}static resetLocalVars(){O(d,Y,document.querySelector("#scene-navigation")),O(d,vt,document.querySelector("#crlngn-scene-navigation-expand")),O(d,it,document.querySelector("#ui-left")),O(d,tn,document.querySelector("#scene-navigation-inactive"))}static handleSceneFadeOut(e,t,n){const o=document.querySelector("#ui-left-column-2"),a=t||document.querySelector("#ui-left-column-2 #scene-navigation")||null;p.log("handleSceneFadeOut",[t,a,document.querySelector("#ui-left-column-2 #scene-navigation")]),d.sceneNavEnabled?(a==null||a.classList.remove("faded-ui"),d.useFadeOut?o==null||o.classList.add("faded-ui"):o==null||o.classList.remove("faded-ui")):d.useFadeOut?a==null||a.classList.add("faded-ui"):a==null||a.classList.remove("faded-ui")}static handleFolderList(e,t,n){var o;!d.useSceneFolders||!((o=game.user)!=null&&o.isGM)||nt.addFolderButtons(e,t,n)}static handleNavState(){const e=w();m(d,nn)&&(O(d,nn,!1),d.toggleNav(T.get(e.navStartCollapsed.tag)))}static updateToggleButton(e){const t=document.querySelector("#crlngn-scene-navigation-expand");if(!t)return;const n=t.querySelector("i"),o=document.querySelector("#scene-navigation");o==null||o.classList.toggle("expanded",e),n&&(n.classList.toggle("fa-caret-down",!e),n.classList.toggle("fa-caret-up",e));const a=e?"SCENE_NAVIGATION.COLLAPSE":"SCENE_NAVIGATION.EXPAND",s=game.i18n.localize(a);t.setAttribute("data-tooltip",a),t.setAttribute("aria-label",s)}static toggleNav(e){O(d,Dn,setTimeout(()=>{d.resetLocalVars(),e===!0?(ui.nav.collapse(),d.isCollapsed=!0,p.log("toggleNav collapse",[ui.nav.collapse,e,d.navStartCollapsed]),document.querySelectorAll("#ui-left .crlngn-btn").forEach(n=>n.remove()),d.updateToggleButton(!1)):e===!1&&(d.isCollapsed=!1,ui.nav.expand(),p.log("toggleNav expand",[e,d.navStartCollapsed]),d.updateToggleButton(!0))},200))}static checkSceneNavCompat(){var e;w(),document.querySelector("#ui-left"),O(this,Et,L.isModuleOn("monks-scene-navigation")),p.log("checkSceneNavCompat",[m(this,Et)]),d.sceneNavEnabled&&!m(this,on)&&(e=game.user)!=null&&e.isGM&&m(this,Et)&&(ui.notifications.warn(game.i18n.localize("CRLNGN_UI.ui.notifications.monksScenesNotSupported"),{localize:!0,permanent:!0,console:!1}),O(this,on,!0))}static addListeners(){var e,t,n,o;(e=m(d,Y))==null||e.removeEventListener("mouseenter",m(d,an)),(t=m(d,Y))==null||t.removeEventListener("mouseleave",m(d,sn)),(n=m(d,Y))==null||n.addEventListener("mouseenter",m(d,an)),(o=m(d,Y))==null||o.addEventListener("mouseleave",m(d,sn))}static setNavPosition(e=null,t=!0,n=400){var o,a;try{const s=w();if(!m(d,Y))return;const r=((o=m(d,Y))==null?void 0:o.querySelectorAll("li.nav-item"))||[],i=0,c=e!==null?e:d.navPos||0,g=(a=m(d,Y))==null?void 0:a.querySelector("li.nav-item:first-of-type");if(!g)return;const u=r[c],h=g.offsetWidth||0,y=parseInt(h)*c;p.log("setNavPosition",["position",c,y,m(d,Y).scrollWidth]);const S=y-i;if(S>m(d,Y).scrollWidth)return;d.navPos=c,T.set(s.sceneNavPos.tag,c),t?L.smoothScrollTo(m(d,Y),S,"horizontal",n):m(d,Y).scrollTo({left:S,behavior:"instant"})}catch(s){p.log("setNavPosition",["Error:",s]),console.error("Error in setNavPosition:",s)}}static loadSettings(){const e=w();d.navStartCollapsed=T.get(e.navStartCollapsed.tag),d.showNavOnHover=T.get(e.showNavOnHover.tag),d.sceneNavEnabled=T.get(e.sceneNavEnabled.tag),d.useScenePreview=T.get(e.useScenePreview.tag),d.useSceneFolders=T.get(e.useSceneFolders.tag),d.navFoldersForPlayers=T.get(e.navFoldersForPlayers.tag),d.navShowRootFolders=T.get(e.navShowRootFolders.tag),d.useSceneIcons=T.get(e.useSceneIcons.tag),d.useSceneBackButton=T.get(e.useSceneBackButton.tag),d.useSceneLookup=T.get(e.useSceneLookup.tag),d.sceneClickToView=T.get(e.sceneClickToView.tag),d.isCollapsed=d.navStartCollapsed}static refreshSettings(){d.loadSettings();const e=document.querySelector("body");d.sceneNavEnabled?e.classList.add("crlngn-scene-nav"):e.classList.remove("crlngn-scene-nav"),ui.nav&&ui.nav.render()}};Y=new WeakMap,tn=new WeakMap,rt=new WeakMap,mo=new WeakMap,vt=new WeakMap,it=new WeakMap,lt=new WeakMap,Dn=new WeakMap,yo=new WeakMap,nn=new WeakMap,Te=new WeakMap,Ct=new WeakMap,ct=new WeakMap,we=new WeakMap,je=new WeakMap,Ae=new WeakMap,Et=new WeakMap,on=new WeakMap,Fn=new WeakMap,an=new WeakMap,sn=new WeakMap,An=new WeakMap,Gn=new WeakMap,qn=new WeakMap,zn=new WeakMap,xn=new WeakMap,Bn=new WeakMap,Hn=new WeakMap,k(d,Y),k(d,tn),k(d,rt),k(d,mo),k(d,vt),k(d,it),b(d,"sceneFoldersTemplate"),b(d,"navButtonsTemplate"),k(d,lt),k(d,Dn),k(d,yo),k(d,nn,!0),k(d,Te,null),k(d,Ct,null),k(d,ct,""),k(d,we,[]),k(d,je,!1),k(d,Ae),k(d,Et,!1),k(d,on,!1),b(d,"useFadeOut",!0),b(d,"hidden",!1),b(d,"sceneNavEnabled"),b(d,"useSceneFolders"),b(d,"navFoldersForPlayers"),b(d,"navShowRootFolders"),b(d,"hideInactiveOnFolderToggle"),b(d,"navStartCollapsed"),b(d,"showNavOnHover"),b(d,"useSceneIcons"),b(d,"useScenePreview"),b(d,"useSceneBackButton"),b(d,"useSceneLookup"),b(d,"sceneClickToView"),b(d,"isCollapsed"),b(d,"navPos"),b(d,"init",()=>{w(),Hooks.on(A.RENDER_SCENE_NAV,d.onRender),d.loadSettings(),p.log("SCENE NAV INIT",[d.sceneNavEnabled]);const e=document.querySelector("body");d.sceneNavEnabled?e.classList.add("crlngn-scene-nav"):e.classList.remove("crlngn-scene-nav"),d.sceneNavEnabled&&(d.checkSceneNavCompat(),d.preloadTemplates(),nt.init(),Hooks.on(A.READY,()=>{d.handleSceneFadeOut(),L.isModuleOn("forien-quest-log")&&Hooks.on("questTrackerBoundaries",t=>t.top=42)}),Hooks.on(A.COLLAPSE_SIDE_BAR,t=>{p.log(A.COLLAPSE_SIDE_BAR,[t]),d.checkSideBar(t.expanded||!1),d.placeNavButtons()}),Hooks.on(A.COLLAPSE_SCENE_NAV,(t,n)=>{clearTimeout(m(d,lt)),d.isCollapsed=n,n&&document.querySelectorAll("#ui-left .crlngn-btn").forEach(a=>a.remove()),O(d,lt,setTimeout(()=>{d.setCollapsedClass(n),d.updateToggleButton(!n)},250))}),d.placeNavButtons()),Hooks.on(A.CREATE_SCENE,()=>{var t;(t=ui.nav)==null||t.render()}),Hooks.on(A.UPDATE_SCENE,()=>{if(m(d,je)){O(d,je,!1);return}p.log(A.UPDATE_SCENE,[m(d,je)])}),Hooks.on(A.DELETE_SCENE,()=>{var t;(t=ui.nav)==null||t.render()}),Hooks.on(A.CANVAS_INIT,()=>{var n,o;const t=(o=(n=game.scenes)==null?void 0:n.viewed)==null?void 0:o.id;t!==m(d,we)[m(d,we).length-1]&&m(d,we).push(t),d.handleSceneFadeOut()}),Hooks.on(A.RENDER_SCENE_DIRECTORY,t=>{p.log(A.RENDER_SCENE_DIRECTORY,[t]),document.querySelector("#scenes .directory-list").querySelectorAll(".directory-item.scene").forEach(a=>{var r,i;const s=game.scenes.get(a.dataset.entryId);if(d.sceneClickToView&&(a.addEventListener("dblclick",d.onActivateScene),a.addEventListener("click",d.onSelectScene)),d.useSceneIcons&&s&&((r=game.user)!=null&&r.isGM)){let c=document.createElement("i");c.classList.add("fas"),c.classList.add("icon"),s.ownership.default!==0?(s.active&&(c.classList.add("fa-bullseye"),a.prepend(c)),((i=game.scenes.current)==null?void 0:i.id)===s.id&&(c.classList.add("fa-star"),a.prepend(c))):(c.classList.add("fa-eye-slash"),a.prepend(c))}})})}),b(d,"onRender",(e,t,n)=>{const o=w(),a=T.get(o.sceneNavPos.tag);if(d.preventNavRender)return;p.log("onRender - "+A.RENDER_SCENE_NAV,[t]),d.checkSceneNavCompat(),d.resetLocalVars(),d.sceneNavEnabled?(d.handleExtraButtons(e,t,n),d.handleSceneList(e,t,n),d.handleFolderList(e,t,n),d.setNavPosition(a,!1),d.handleNavState(),d.addListeners(),d.addSceneListeners(t),L.addCSSVars("--region-legend-offset","calc(-100vw + 500px)")):L.addCSSVars("--region-legend-offset","0px"),d.resetLocalVars(),d.sceneNavEnabled&&d.navShowRootFolders&&game.user.isGM&&(nt.init(),nt.renderFolderList()),d.sceneNavEnabled&&(clearTimeout(m(d,lt)),O(d,lt,setTimeout(()=>{p.log("NAV no transition remove"),d.placeNavButtons()},500)));const s=T.get(o.navShowRootFolders.tag),r=T.get(o.hideInactiveOnFolderToggle.tag),i=t.querySelectorAll("#scene-navigation-inactive .scene");p.log("hideInactiveOnToggle",[s,r,i]),r&&s?i.forEach(c=>c.classList.add("hidden")):r&&i.forEach(c=>c.classList.remove("hidden")),d.handleSceneFadeOut(e,t,n)}),b(d,"setCollapsedClass",e=>{const t=document.querySelector("body");e?(m(d,it).classList.add("navigation-collapsed"),t.classList.add("navigation-collapsed"),L.isModuleOn("forien-quest-log")&&Hooks.on("questTrackerBoundaries",n=>n.top=10)):(m(d,it).classList.remove("navigation-collapsed"),t.classList.remove("navigation-collapsed"),d.placeNavButtons(),L.isModuleOn("forien-quest-log")&&Hooks.on("questTrackerBoundaries",n=>n.top=42))}),b(d,"checkSideBar",(e=!1)=>{d.placeNavButtons();const t=document.querySelector("body");p.log("TopNavigation.checkSideBar",[ui.sidebar,e],!0),e?t.classList.add("crlngn-sidebar-expanded"):t.classList.remove("crlngn-sidebar-expanded")}),b(d,"handleSceneList",async(e,t,n)=>{var a,s,r,i;p.log("handleSceneList",[e,t,n,d.useScenePreview,(a=game.user)==null?void 0:a.isGM]);const o=t.querySelectorAll(".scene-navigation-menu li.scene");for(const c of o){const g=c.dataset.sceneId;if(d.useScenePreview&&((s=game.user)!=null&&s.isGM)){const u=game.scenes.find(y=>y.id===g);u.isGM=(r=game.user)==null?void 0:r.isGM;const h=await L.renderTemplate(`modules/${q}/templates/scene-nav-preview.hbs`,u);if(c.classList.add("nav-item"),c.insertAdjacentHTML("beforeend",h),u.isGM&&m(d,ct)===g){const y=new MouseEvent("mouseenter");c.dispatchEvent(y)}d.addPreviewIconListeners(c,u)}d.useSceneIcons&&c.classList.add("crlngn")}if(d.sceneNavEnabled){const c=document.querySelector("#ui-left-column-2"),g=document.querySelector("#crlngn-scene-navigation-expand");if(!c)return;g&&g.remove();const u=await L.renderTemplate(`modules/${q}/templates/scene-nav-toggle.hbs`,{isExpanded:((i=ui.nav)==null?void 0:i.expanded)||!1});c.insertAdjacentHTML("afterbegin",u);const h=document.querySelector("#crlngn-scene-navigation-expand");h&&h.addEventListener("click",y=>{y.preventDefault(),y.stopPropagation(),ui.nav&&(p.log("Toggle nav clicked",["expanded:",ui.nav.expanded]),d.toggleNav(ui.nav.expanded))}),d.handleHide()}}),b(d,"handleExtraButtons",async(e,t,n)=>{var s,r,i,c,g;w(),p.log("handleExtraButtons",[e,t,n]);const o=await L.renderTemplate(`modules/${q}/templates/scene-nav-extra-buttons.hbs`,{useSceneBackButton:d.useSceneBackButton,useSceneFolders:(s=game.user)!=null&&s.isGM?d.useSceneFolders:!1,useSceneLookup:(r=game.user)!=null&&r.isGM?d.useSceneLookup:!1,backButtonTooltip:game.i18n.localize("CRLNGN_UI.ui.sceneNav.backButtonTooltip"),sceneLookupTooltip:game.i18n.localize("CRLNGN_UI.ui.sceneNav.sceneLookupTooltip"),isGM:(i=game.user)==null?void 0:i.isGM});(c=t.querySelector("#scene-navigation-active"))==null||c.insertAdjacentHTML("afterbegin",o);const a=t.querySelector("#crlngn-back-button");a&&a.addEventListener("click",m(d,Fn)),d.sceneNavEnabled&&d.useSceneLookup&&((g=game.user)!=null&&g.isGM)&&nt.handleFolderLookup(e,t,n)}),k(d,Fn,e=>{var a;e.stopPropagation(),e.preventDefault();const t=m(d,we).length,n=m(d,we)[t-2];let o;p.log("#onBackButton before",[t,n,m(d,we)]),n&&n!==((a=game.scenes.current)==null?void 0:a.id)&&(o=game.scenes.get(n),o&&o.view(),m(d,we).pop()),p.log("#onBackButton after",[m(d,we)])}),k(d,an,e=>{if(p.log("TopNavigation mouseenter",[]),!d.isCollapsed||!d.showNavOnHover)return;e.stopPropagation(),clearTimeout(m(d,rt)),document.querySelector("#scene-navigation").classList.add("expanded")}),k(d,sn,e=>{p.log("TopNavigation mouseleave",[]),!(!d.isCollapsed||!d.showNavOnHover)&&(e.stopPropagation(),O(d,rt,setTimeout(()=>{clearTimeout(m(d,rt)),O(d,rt,null),document.querySelector("#scene-navigation").classList.remove("expanded")},700)))}),b(d,"placeNavButtons",async()=>{var i;const e=document.querySelector("#scene-navigation");if(!e||!d.sceneNavEnabled)return;e.querySelector("#scene-navigation-inactive");let t=document.querySelectorAll("button.crlngn-btn");const n=((i=m(d,vt))==null?void 0:i.offsetWidth)*2||0,o=e.offsetWidth-n<e.scrollWidth;if(p.log("placeNavButtons *",[d.isCollapsed,o,t]),!o||d.isCollapsed||m(d,it).classList.contains("navigation-collapsed")){t.forEach(c=>{p.log("placeNavButtons remove",[c.remove,c]),c.remove()}),t=[];return}if(t.length>0)return;const a=await L.renderTemplate(`modules/${q}/templates/scene-nav-buttons.hbs`,{});e.insertAdjacentHTML("afterend",a);const s=document.querySelector("#ui-left button.crlngn-btn.ui-nav-left"),r=document.querySelector("#ui-left button.crlngn-btn.ui-nav-right");s&&s.addEventListener("click",m(d,An)),r&&r.addEventListener("click",m(d,Gn)),d.handleHide()}),k(d,An,async e=>{const t=await d.getItemsPerPage(),n=d.navPos||0;if(!m(d,tn)||!m(d,Y))return;let o=n-(t-1);p.log("onNavLast",["pos",o,m(d,Y).scrollWidth]),o=o<0?0:o,d.setNavPosition(o)}),k(d,Gn,async e=>{var c,g;const t=await d.getItemsPerPage(),n=d.navPos||0,o=(c=m(d,Y))==null?void 0:c.querySelector("li.nav-item:first-of-type"),a=(o==null?void 0:o.offsetWidth)||0,s=((g=m(d,Y))==null?void 0:g.scrollWidth)||0;if(!a||!m(d,Y))return;let r=n+(t-1),i=r*a;p.log("onNavNext",["pos",n,r,o==null?void 0:o.offsetWidth,i,s]),i>=s&&(r=Math.floor(s/a)),d.setNavPosition(r)}),b(d,"getItemsPerPage",async()=>{var e,t;try{p.log("getItemsPerPage",["Starting"]),d.resetLocalVars();const n=0,o=0,a=((e=m(d,vt))==null?void 0:e.offsetWidth)||0,s=(t=m(d,Y))==null?void 0:t.querySelector("li.nav-item:first-of-type");if(!s||!m(d,Y))return p.log("getItemsPerPage",["No scene items found"]),0;const r=s.offsetWidth,i=m(d,Y).offsetWidth;if(!i)return p.log("getItemsPerPage",["Nav element has no width"]),0;const c=Math.floor((i-a*2)/r);return p.log("getItemsPerPage",["Calculated:",c,i,r]),c||0}catch(n){return p.log("getItemsPerPage",["Error:",n]),p.error("Error in getItemsPerPage:",n),0}}),b(d,"preloadTemplates",async()=>{try{const e=[`modules/${q}/templates/scene-nav-buttons.hbs`,`modules/${q}/templates/scene-nav-preview.hbs`,`modules/${q}/templates/scene-nav-toggle.hbs`];return await L.loadTemplates(e),!0}catch(e){return console.error("Error loading navigation button templates:",e),!1}}),b(d,"getCurrScenePosition",async e=>{try{if(!m(d,Y)||!e)return 0;const t=await d.getItemsPerPage()||1,n=m(d,Y).querySelectorAll("li.nav-item");if(!n||n.length===0)return 0;const a=Array.from(n).findIndex(i=>i.dataset.sceneId===e);if(a===-1)return 0;const s=a>=d.navPos&&a<=d.navPos+t,r=s?d.navPos:a;return p.log("getCurrScenePosition",["Final position:",r,"isVisible:",s]),r}catch(t){return p.log("getCurrScenePosition",["Error:",t]),console.error("Error in getCurrScenePosition:",t),0}}),b(d,"onActivateScene",e=>{e.stopPropagation(),e.preventDefault();const t=e.currentTarget,o=t.classList.contains("scene-name")?t.parentNode.dataset:t.dataset,a=game.scenes.get(o.entryId||o.sceneId);p.log("onActivateScene",[o,a]),a.activate(),a.sheet.render=m(d,Ae),m(d,Te)&&(clearTimeout(m(d,Te)),O(d,Te,null))}),b(d,"onSelectScene",e=>{var s;e.preventDefault(),e.stopPropagation();const t=e.currentTarget,n=t.classList.contains("scene-name"),o=n?t.parentNode.dataset:t.dataset,a=game.scenes.get(o.entryId||o.sceneId);O(d,ct,""),p.log("onSelectScene",[a,t,n]),a&&a.sheet&&!m(d,Te)&&(O(d,Ae,(s=a==null?void 0:a.sheet)==null?void 0:s.render),p.log("onSelectScene - originalRender",[m(d,Ae)]),a.sheet.render=()=>{},setTimeout(()=>{a.sheet.render=m(d,Ae)},500)),m(d,Te)&&(clearTimeout(m(d,Te)),a.sheet.render=m(d,Ae),O(d,Te,null)),O(d,Te,setTimeout(()=>{a.view(),a.sheet.render=m(d,Ae),O(d,Te,null)},350))}),b(d,"onScenePreviewOn",e=>{if(p.log("onScenePreviewOn",[]),e.preventDefault(),d.isCollapsed)return;const t=e.currentTarget,n=t.dataset;O(d,ct,n.sceneId),O(d,Ct,setTimeout(()=>{var o;clearTimeout(m(d,Ct)),(o=t.querySelector(".scene-preview"))==null||o.classList.add("open")},200))}),b(d,"onScenePreviewOff",e=>{var n;if(p.log("onScenePreviewOff",[]),e.preventDefault(),clearTimeout(m(d,Ct)),d.isCollapsed)return;const t=e.currentTarget;O(d,ct,""),(n=t.querySelector(".scene-preview"))==null||n.classList.remove("open")}),b(d,"addSceneListeners",e=>{e.querySelectorAll("li.scene").forEach(n=>{var o;if(n.querySelector(".scene-name").addEventListener("click",d.onSelectScene),n.querySelector(".scene-name").addEventListener("dblclick",d.onActivateScene),n.removeEventListener("mouseenter",d.onScenePreviewOn),n.removeEventListener("mouseleave",d.onScenePreviewOff),d.useScenePreview){const a=n.dataset.sceneId,s=game.scenes.find(r=>r.id===a);(o=game.user)!=null&&o.isGM&&d.addPreviewIconListeners(n,s),n.addEventListener("mouseenter",d.onScenePreviewOn),n.addEventListener("mouseleave",d.onScenePreviewOff)}})}),b(d,"addPreviewIconListeners",(e,t)=>{if(!e||!t)return;const n=game.scenes.get(t.id);if(!n)return;const o=e.querySelector(".scene-preview");if(!o)return;const a=o.querySelector(".ilum");a&&a.addEventListener("click",m(d,Bn));const s=o.querySelector(".token-vision");s&&s.addEventListener("click",m(d,Hn));const r=o.querySelector(".sound");r&&n.playlistSound&&r.addEventListener("click",m(d,xn));const i=o.querySelector(".preload");i&&i.addEventListener("click",m(d,zn));const c=o.querySelector(".config");c&&c.addEventListener("click",m(d,qn))}),k(d,qn,e=>{e.stopPropagation(),e.preventDefault();const t=e.currentTarget.closest("li.scene");d.getSceneFromElement(t).sheet.render(!0),p.log("Opened scene configuration")}),k(d,zn,e=>{e.stopPropagation(),e.preventDefault();const t=e.currentTarget.closest("li.scene"),n=d.getSceneFromElement(t);game.scenes.preload(n.id,!0),p.log("Preloaded scene")}),k(d,xn,async e=>{e.stopPropagation(),e.preventDefault();const t=e.currentTarget.closest("li.scene");let n=d.getSceneFromElement(t);const o=n.playlistSound;if(o){const a=o.sound.playing;a?o.sound.pause():o.sound.play(),await d.updateScenePreview(t,n.id),p.log("Toggled playlist sound",[!a])}}),k(d,Bn,async e=>{e.stopPropagation(),e.preventDefault();const t=e.currentTarget.closest("li.scene");let n=d.getSceneFromElement(t);const o=n.environment.globalLight.enabled;O(d,je,!0),await n.update({"environment.globalLight.enabled":!o}),await d.updateScenePreview(t,n.id),p.log("Toggled global illumination",[!o])}),k(d,Hn,async e=>{e.stopPropagation(),e.preventDefault();const t=e.currentTarget.closest("li.scene");let n=d.getSceneFromElement(t);const o=n.tokenVision;O(d,je,!0),await n.update({tokenVision:!o}),await d.updateScenePreview(t,n.id),p.log("Toggled token vision",[!o])}),b(d,"getSceneFromElement",e=>{const t=e.dataset.sceneId;return game.scenes.get(t)}),b(d,"updateScenePreview",async(e,t)=>{var c,g,u,h;if(!d.sceneNavEnabled||!e||!t)return;const n=game.scenes.get(t);if(!n)return;const o=e.querySelector(".scene-preview");if(!o)return;const a=o.classList.contains("open");p.log("Scene data for preview",[t,(g=(c=n.environment)==null?void 0:c.globalLight)==null?void 0:g.enabled,n.tokenVision]);const s={id:n.id,name:n.name,thumb:n.thumb||"",environment:n.environment,tokenVision:n.tokenVision,isGM:(u=game.user)==null?void 0:u.isGM},r=await L.renderTemplate(`modules/${q}/templates/scene-nav-preview.hbs`,s);o.outerHTML=r;const i=e.querySelector(".scene-preview");a&&i&&i.classList.add("open"),d.sceneNavEnabled&&d.useScenePreview&&(e.removeEventListener("mouseenter",d.onScenePreviewOn),e.removeEventListener("mouseleave",d.onScenePreviewOff),e.addEventListener("mouseenter",d.onScenePreviewOn),e.addEventListener("mouseleave",d.onScenePreviewOff),(h=game.user)!=null&&h.isGM&&d.addPreviewIconListeners(e,s))}),b(d,"applySceneItemWidth",()=>{const e=w(),t=T.get(e.sceneItemWidth.tag)||150;L.addCSSVars("--scene-nav-item-width",`${t}px`)}),b(d,"applyTopNavHeight",()=>{const e=w(),t=T.get(e.sceneNavEnabled.tag);L.addCSSVars("--top-nav-height",`${t?"calc(var(--control-item-size) + 1px)":"0px"}`)});let F=d;/**!
 * Sortable 1.15.6
 * @author	RubaXa   <trash@rubaxa.org>
 * @author	owenm    <owen23355@gmail.com>
 * @license MIT
 */function ko(l,e){var t=Object.keys(l);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(l);e&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(l,o).enumerable})),t.push.apply(t,n)}return t}function Oe(l){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?ko(Object(t),!0).forEach(function(n){La(l,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(t)):ko(Object(t)).forEach(function(n){Object.defineProperty(l,n,Object.getOwnPropertyDescriptor(t,n))})}return l}function bn(l){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?bn=function(e){return typeof e}:bn=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},bn(l)}function La(l,e,t){return e in l?Object.defineProperty(l,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):l[e]=t,l}function qe(){return qe=Object.assign||function(l){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(l[n]=t[n])}return l},qe.apply(this,arguments)}function wa(l,e){if(l==null)return{};var t={},n=Object.keys(l),o,a;for(a=0;a<n.length;a++)o=n[a],!(e.indexOf(o)>=0)&&(t[o]=l[o]);return t}function ka(l,e){if(l==null)return{};var t=wa(l,e),n,o;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(l);for(o=0;o<a.length;o++)n=a[o],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(l,n)&&(t[n]=l[n])}return t}var Ra="1.15.6";function Ge(l){if(typeof window<"u"&&window.navigator)return!!navigator.userAgent.match(l)}var ze=Ge(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),rn=Ge(/Edge/i),Ro=Ge(/firefox/i),Gt=Ge(/safari/i)&&!Ge(/chrome/i)&&!Ge(/android/i),bo=Ge(/iP(ad|od|hone)/i),jo=Ge(/chrome/i)&&Ge(/android/i),Yo={capture:!1,passive:!1};function x(l,e,t){l.addEventListener(e,t,!ze&&Yo)}function z(l,e,t){l.removeEventListener(e,t,!ze&&Yo)}function Ln(l,e){if(e){if(e[0]===">"&&(e=e.substring(1)),l)try{if(l.matches)return l.matches(e);if(l.msMatchesSelector)return l.msMatchesSelector(e);if(l.webkitMatchesSelector)return l.webkitMatchesSelector(e)}catch{return!1}return!1}}function Xo(l){return l.host&&l!==document&&l.host.nodeType?l.host:l.parentNode}function ke(l,e,t,n){if(l){t=t||document;do{if(e!=null&&(e[0]===">"?l.parentNode===t&&Ln(l,e):Ln(l,e))||n&&l===t)return l;if(l===t)break}while(l=Xo(l))}return null}var Io=/\s+/g;function be(l,e,t){if(l&&e)if(l.classList)l.classList[t?"add":"remove"](e);else{var n=(" "+l.className+" ").replace(Io," ").replace(" "+e+" "," ");l.className=(n+(t?" "+e:"")).replace(Io," ")}}function M(l,e,t){var n=l&&l.style;if(n){if(t===void 0)return document.defaultView&&document.defaultView.getComputedStyle?t=document.defaultView.getComputedStyle(l,""):l.currentStyle&&(t=l.currentStyle),e===void 0?t:t[e];!(e in n)&&e.indexOf("webkit")===-1&&(e="-webkit-"+e),n[e]=t+(typeof t=="string"?"":"px")}}function yt(l,e){var t="";if(typeof l=="string")t=l;else do{var n=M(l,"transform");n&&n!=="none"&&(t=n+" "+t)}while(!e&&(l=l.parentNode));var o=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return o&&new o(t)}function Jo(l,e,t){if(l){var n=l.getElementsByTagName(e),o=0,a=n.length;if(t)for(;o<a;o++)t(n[o],o);return n}return[]}function Ie(){var l=document.scrollingElement;return l||document.documentElement}function oe(l,e,t,n,o){if(!(!l.getBoundingClientRect&&l!==window)){var a,s,r,i,c,g,u;if(l!==window&&l.parentNode&&l!==Ie()?(a=l.getBoundingClientRect(),s=a.top,r=a.left,i=a.bottom,c=a.right,g=a.height,u=a.width):(s=0,r=0,i=window.innerHeight,c=window.innerWidth,g=window.innerHeight,u=window.innerWidth),(e||t)&&l!==window&&(o=o||l.parentNode,!ze))do if(o&&o.getBoundingClientRect&&(M(o,"transform")!=="none"||t&&M(o,"position")!=="static")){var h=o.getBoundingClientRect();s-=h.top+parseInt(M(o,"border-top-width")),r-=h.left+parseInt(M(o,"border-left-width")),i=s+a.height,c=r+a.width;break}while(o=o.parentNode);if(n&&l!==window){var y=yt(o||l),S=y&&y.a,N=y&&y.d;y&&(s/=N,r/=S,u/=S,g/=N,i=s+g,c=r+u)}return{top:s,left:r,bottom:i,right:c,width:u,height:g}}}function Oo(l,e,t){for(var n=Je(l,!0),o=oe(l)[e];n;){var a=oe(n)[t],s=void 0;if(s=o>=a,!s)return n;if(n===Ie())break;n=Je(n,!1)}return!1}function wt(l,e,t,n){for(var o=0,a=0,s=l.children;a<s.length;){if(s[a].style.display!=="none"&&s[a]!==P.ghost&&(n||s[a]!==P.dragged)&&ke(s[a],t.draggable,l,!1)){if(o===e)return s[a];o++}a++}return null}function So(l,e){for(var t=l.lastElementChild;t&&(t===P.ghost||M(t,"display")==="none"||e&&!Ln(t,e));)t=t.previousElementSibling;return t||null}function Ee(l,e){var t=0;if(!l||!l.parentNode)return-1;for(;l=l.previousElementSibling;)l.nodeName.toUpperCase()!=="TEMPLATE"&&l!==P.clone&&(!e||Ln(l,e))&&t++;return t}function Mo(l){var e=0,t=0,n=Ie();if(l)do{var o=yt(l),a=o.a,s=o.d;e+=l.scrollLeft*a,t+=l.scrollTop*s}while(l!==n&&(l=l.parentNode));return[e,t]}function Ia(l,e){for(var t in l)if(l.hasOwnProperty(t)){for(var n in e)if(e.hasOwnProperty(n)&&e[n]===l[t][n])return Number(t)}return-1}function Je(l,e){if(!l||!l.getBoundingClientRect)return Ie();var t=l,n=!1;do if(t.clientWidth<t.scrollWidth||t.clientHeight<t.scrollHeight){var o=M(t);if(t.clientWidth<t.scrollWidth&&(o.overflowX=="auto"||o.overflowX=="scroll")||t.clientHeight<t.scrollHeight&&(o.overflowY=="auto"||o.overflowY=="scroll")){if(!t.getBoundingClientRect||t===document.body)return Ie();if(n||e)return t;n=!0}}while(t=t.parentNode);return Ie()}function Oa(l,e){if(l&&e)for(var t in e)e.hasOwnProperty(t)&&(l[t]=e[t]);return l}function Xn(l,e){return Math.round(l.top)===Math.round(e.top)&&Math.round(l.left)===Math.round(e.left)&&Math.round(l.height)===Math.round(e.height)&&Math.round(l.width)===Math.round(e.width)}var qt;function Ko(l,e){return function(){if(!qt){var t=arguments,n=this;t.length===1?l.call(n,t[0]):l.apply(n,t),qt=setTimeout(function(){qt=void 0},e)}}}function Ma(){clearTimeout(qt),qt=void 0}function Zo(l,e,t){l.scrollLeft+=e,l.scrollTop+=t}function Qo(l){var e=window.Polymer,t=window.jQuery||window.Zepto;return e&&e.dom?e.dom(l).cloneNode(!0):t?t(l).clone(!0)[0]:l.cloneNode(!0)}function _o(l,e,t){var n={};return Array.from(l.children).forEach(function(o){var a,s,r,i;if(!(!ke(o,e.draggable,l,!1)||o.animated||o===t)){var c=oe(o);n.left=Math.min((a=n.left)!==null&&a!==void 0?a:1/0,c.left),n.top=Math.min((s=n.top)!==null&&s!==void 0?s:1/0,c.top),n.right=Math.max((r=n.right)!==null&&r!==void 0?r:-1/0,c.right),n.bottom=Math.max((i=n.bottom)!==null&&i!==void 0?i:-1/0,c.bottom)}}),n.width=n.right-n.left,n.height=n.bottom-n.top,n.x=n.left,n.y=n.top,n}var pe="Sortable"+new Date().getTime();function Pa(){var l=[],e;return{captureAnimationState:function(){if(l=[],!!this.options.animation){var n=[].slice.call(this.el.children);n.forEach(function(o){if(!(M(o,"display")==="none"||o===P.ghost)){l.push({target:o,rect:oe(o)});var a=Oe({},l[l.length-1].rect);if(o.thisAnimationDuration){var s=yt(o,!0);s&&(a.top-=s.f,a.left-=s.e)}o.fromRect=a}})}},addAnimationState:function(n){l.push(n)},removeAnimationState:function(n){l.splice(Ia(l,{target:n}),1)},animateAll:function(n){var o=this;if(!this.options.animation){clearTimeout(e),typeof n=="function"&&n();return}var a=!1,s=0;l.forEach(function(r){var i=0,c=r.target,g=c.fromRect,u=oe(c),h=c.prevFromRect,y=c.prevToRect,S=r.rect,N=yt(c,!0);N&&(u.top-=N.f,u.left-=N.e),c.toRect=u,c.thisAnimationDuration&&Xn(h,u)&&!Xn(g,u)&&(S.top-u.top)/(S.left-u.left)===(g.top-u.top)/(g.left-u.left)&&(i=Fa(S,h,y,o.options)),Xn(u,g)||(c.prevFromRect=g,c.prevToRect=u,i||(i=o.options.animation),o.animate(c,S,u,i)),i&&(a=!0,s=Math.max(s,i),clearTimeout(c.animationResetTimer),c.animationResetTimer=setTimeout(function(){c.animationTime=0,c.prevFromRect=null,c.fromRect=null,c.prevToRect=null,c.thisAnimationDuration=null},i),c.thisAnimationDuration=i)}),clearTimeout(e),a?e=setTimeout(function(){typeof n=="function"&&n()},s):typeof n=="function"&&n(),l=[]},animate:function(n,o,a,s){if(s){M(n,"transition",""),M(n,"transform","");var r=yt(this.el),i=r&&r.a,c=r&&r.d,g=(o.left-a.left)/(i||1),u=(o.top-a.top)/(c||1);n.animatingX=!!g,n.animatingY=!!u,M(n,"transform","translate3d("+g+"px,"+u+"px,0)"),this.forRepaintDummy=Da(n),M(n,"transition","transform "+s+"ms"+(this.options.easing?" "+this.options.easing:"")),M(n,"transform","translate3d(0,0,0)"),typeof n.animated=="number"&&clearTimeout(n.animated),n.animated=setTimeout(function(){M(n,"transition",""),M(n,"transform",""),n.animated=!1,n.animatingX=!1,n.animatingY=!1},s)}}}}function Da(l){return l.offsetWidth}function Fa(l,e,t,n){return Math.sqrt(Math.pow(e.top-l.top,2)+Math.pow(e.left-l.left,2))/Math.sqrt(Math.pow(e.top-t.top,2)+Math.pow(e.left-t.left,2))*n.animation}var dt=[],Jn={initializeByDefault:!0},ln={mount:function(e){for(var t in Jn)Jn.hasOwnProperty(t)&&!(t in e)&&(e[t]=Jn[t]);dt.forEach(function(n){if(n.pluginName===e.pluginName)throw"Sortable: Cannot mount plugin ".concat(e.pluginName," more than once")}),dt.push(e)},pluginEvent:function(e,t,n){var o=this;this.eventCanceled=!1,n.cancel=function(){o.eventCanceled=!0};var a=e+"Global";dt.forEach(function(s){t[s.pluginName]&&(t[s.pluginName][a]&&t[s.pluginName][a](Oe({sortable:t},n)),t.options[s.pluginName]&&t[s.pluginName][e]&&t[s.pluginName][e](Oe({sortable:t},n)))})},initializePlugins:function(e,t,n,o){dt.forEach(function(r){var i=r.pluginName;if(!(!e.options[i]&&!r.initializeByDefault)){var c=new r(e,t,e.options);c.sortable=e,c.options=e.options,e[i]=c,qe(n,c.defaults)}});for(var a in e.options)if(e.options.hasOwnProperty(a)){var s=this.modifyOption(e,a,e.options[a]);typeof s<"u"&&(e.options[a]=s)}},getEventProperties:function(e,t){var n={};return dt.forEach(function(o){typeof o.eventProperties=="function"&&qe(n,o.eventProperties.call(t[o.pluginName],e))}),n},modifyOption:function(e,t,n){var o;return dt.forEach(function(a){e[a.pluginName]&&a.optionListeners&&typeof a.optionListeners[t]=="function"&&(o=a.optionListeners[t].call(e[a.pluginName],n))}),o}};function Aa(l){var e=l.sortable,t=l.rootEl,n=l.name,o=l.targetEl,a=l.cloneEl,s=l.toEl,r=l.fromEl,i=l.oldIndex,c=l.newIndex,g=l.oldDraggableIndex,u=l.newDraggableIndex,h=l.originalEvent,y=l.putSortable,S=l.extraEventProperties;if(e=e||t&&t[pe],!!e){var N,U=e.options,X="on"+n.charAt(0).toUpperCase()+n.substr(1);window.CustomEvent&&!ze&&!rn?N=new CustomEvent(n,{bubbles:!0,cancelable:!0}):(N=document.createEvent("Event"),N.initEvent(n,!0,!0)),N.to=s||t,N.from=r||t,N.item=o||t,N.clone=a,N.oldIndex=i,N.newIndex=c,N.oldDraggableIndex=g,N.newDraggableIndex=u,N.originalEvent=h,N.pullMode=y?y.lastPutMode:void 0;var te=Oe(Oe({},S),ln.getEventProperties(n,e));for(var me in te)N[me]=te[me];t&&t.dispatchEvent(N),U[X]&&U[X].call(e,N)}}var Ga=["evt"],ge=function(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=n.evt,a=ka(n,Ga);ln.pluginEvent.bind(P)(e,t,Oe({dragEl:E,parentEl:Q,ghostEl:D,rootEl:J,nextEl:tt,lastDownEl:Sn,cloneEl:Z,cloneHidden:$e,dragStarted:Dt,putSortable:re,activeSortable:P.active,originalEvent:o,oldIndex:ft,oldDraggableIndex:zt,newIndex:Se,newDraggableIndex:He,hideGhostForTarget:oa,unhideGhostForTarget:aa,cloneNowHidden:function(){$e=!0},cloneNowShown:function(){$e=!1},dispatchSortableEvent:function(r){ue({sortable:t,name:r,originalEvent:o})}},a))};function ue(l){Aa(Oe({putSortable:re,cloneEl:Z,targetEl:E,rootEl:J,oldIndex:ft,oldDraggableIndex:zt,newIndex:Se,newDraggableIndex:He},l))}var E,Q,D,J,tt,Sn,Z,$e,ft,Se,zt,He,un,re,gt=!1,wn=!1,kn=[],Qe,Le,Kn,Zn,Po,Do,Dt,ut,xt,Bt=!1,gn=!1,vn,le,Qn=[],io=!1,Rn=[],Wn=typeof document<"u",fn=bo,Fo=rn||ze?"cssFloat":"float",qa=Wn&&!jo&&!bo&&"draggable"in document.createElement("div"),ea=function(){if(Wn){if(ze)return!1;var l=document.createElement("x");return l.style.cssText="pointer-events:auto",l.style.pointerEvents==="auto"}}(),ta=function(e,t){var n=M(e),o=parseInt(n.width)-parseInt(n.paddingLeft)-parseInt(n.paddingRight)-parseInt(n.borderLeftWidth)-parseInt(n.borderRightWidth),a=wt(e,0,t),s=wt(e,1,t),r=a&&M(a),i=s&&M(s),c=r&&parseInt(r.marginLeft)+parseInt(r.marginRight)+oe(a).width,g=i&&parseInt(i.marginLeft)+parseInt(i.marginRight)+oe(s).width;if(n.display==="flex")return n.flexDirection==="column"||n.flexDirection==="column-reverse"?"vertical":"horizontal";if(n.display==="grid")return n.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(a&&r.float&&r.float!=="none"){var u=r.float==="left"?"left":"right";return s&&(i.clear==="both"||i.clear===u)?"vertical":"horizontal"}return a&&(r.display==="block"||r.display==="flex"||r.display==="table"||r.display==="grid"||c>=o&&n[Fo]==="none"||s&&n[Fo]==="none"&&c+g>o)?"vertical":"horizontal"},za=function(e,t,n){var o=n?e.left:e.top,a=n?e.right:e.bottom,s=n?e.width:e.height,r=n?t.left:t.top,i=n?t.right:t.bottom,c=n?t.width:t.height;return o===r||a===i||o+s/2===r+c/2},xa=function(e,t){var n;return kn.some(function(o){var a=o[pe].options.emptyInsertThreshold;if(!(!a||So(o))){var s=oe(o),r=e>=s.left-a&&e<=s.right+a,i=t>=s.top-a&&t<=s.bottom+a;if(r&&i)return n=o}}),n},na=function(e){function t(a,s){return function(r,i,c,g){var u=r.options.group.name&&i.options.group.name&&r.options.group.name===i.options.group.name;if(a==null&&(s||u))return!0;if(a==null||a===!1)return!1;if(s&&a==="clone")return a;if(typeof a=="function")return t(a(r,i,c,g),s)(r,i,c,g);var h=(s?r:i).options.group.name;return a===!0||typeof a=="string"&&a===h||a.join&&a.indexOf(h)>-1}}var n={},o=e.group;(!o||bn(o)!="object")&&(o={name:o}),n.name=o.name,n.checkPull=t(o.pull,!0),n.checkPut=t(o.put),n.revertClone=o.revertClone,e.group=n},oa=function(){!ea&&D&&M(D,"display","none")},aa=function(){!ea&&D&&M(D,"display","")};Wn&&!jo&&document.addEventListener("click",function(l){if(wn)return l.preventDefault(),l.stopPropagation&&l.stopPropagation(),l.stopImmediatePropagation&&l.stopImmediatePropagation(),wn=!1,!1},!0);var _e=function(e){if(E){e=e.touches?e.touches[0]:e;var t=xa(e.clientX,e.clientY);if(t){var n={};for(var o in e)e.hasOwnProperty(o)&&(n[o]=e[o]);n.target=n.rootEl=t,n.preventDefault=void 0,n.stopPropagation=void 0,t[pe]._onDragOver(n)}}},Ba=function(e){E&&E.parentNode[pe]._isOutsideThisEl(e.target)};function P(l,e){if(!(l&&l.nodeType&&l.nodeType===1))throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(l));this.el=l,this.options=e=qe({},e),l[pe]=this;var t={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(l.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return ta(l,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(s,r){s.setData("Text",r.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:P.supportPointer!==!1&&"PointerEvent"in window&&(!Gt||bo),emptyInsertThreshold:5};ln.initializePlugins(this,l,t);for(var n in t)!(n in e)&&(e[n]=t[n]);na(e);for(var o in this)o.charAt(0)==="_"&&typeof this[o]=="function"&&(this[o]=this[o].bind(this));this.nativeDraggable=e.forceFallback?!1:qa,this.nativeDraggable&&(this.options.touchStartThreshold=1),e.supportPointer?x(l,"pointerdown",this._onTapStart):(x(l,"mousedown",this._onTapStart),x(l,"touchstart",this._onTapStart)),this.nativeDraggable&&(x(l,"dragover",this),x(l,"dragenter",this)),kn.push(this.el),e.store&&e.store.get&&this.sort(e.store.get(this)||[]),qe(this,Pa())}P.prototype={constructor:P,_isOutsideThisEl:function(e){!this.el.contains(e)&&e!==this.el&&(ut=null)},_getDirection:function(e,t){return typeof this.options.direction=="function"?this.options.direction.call(this,e,t,E):this.options.direction},_onTapStart:function(e){if(e.cancelable){var t=this,n=this.el,o=this.options,a=o.preventOnFilter,s=e.type,r=e.touches&&e.touches[0]||e.pointerType&&e.pointerType==="touch"&&e,i=(r||e).target,c=e.target.shadowRoot&&(e.path&&e.path[0]||e.composedPath&&e.composedPath()[0])||i,g=o.filter;if(Xa(n),!E&&!(/mousedown|pointerdown/.test(s)&&e.button!==0||o.disabled)&&!c.isContentEditable&&!(!this.nativeDraggable&&Gt&&i&&i.tagName.toUpperCase()==="SELECT")&&(i=ke(i,o.draggable,n,!1),!(i&&i.animated)&&Sn!==i)){if(ft=Ee(i),zt=Ee(i,o.draggable),typeof g=="function"){if(g.call(this,e,i,this)){ue({sortable:t,rootEl:c,name:"filter",targetEl:i,toEl:n,fromEl:n}),ge("filter",t,{evt:e}),a&&e.preventDefault();return}}else if(g&&(g=g.split(",").some(function(u){if(u=ke(c,u.trim(),n,!1),u)return ue({sortable:t,rootEl:u,name:"filter",targetEl:i,fromEl:n,toEl:n}),ge("filter",t,{evt:e}),!0}),g)){a&&e.preventDefault();return}o.handle&&!ke(c,o.handle,n,!1)||this._prepareDragStart(e,r,i)}}},_prepareDragStart:function(e,t,n){var o=this,a=o.el,s=o.options,r=a.ownerDocument,i;if(n&&!E&&n.parentNode===a){var c=oe(n);if(J=a,E=n,Q=E.parentNode,tt=E.nextSibling,Sn=n,un=s.group,P.dragged=E,Qe={target:E,clientX:(t||e).clientX,clientY:(t||e).clientY},Po=Qe.clientX-c.left,Do=Qe.clientY-c.top,this._lastX=(t||e).clientX,this._lastY=(t||e).clientY,E.style["will-change"]="all",i=function(){if(ge("delayEnded",o,{evt:e}),P.eventCanceled){o._onDrop();return}o._disableDelayedDragEvents(),!Ro&&o.nativeDraggable&&(E.draggable=!0),o._triggerDragStart(e,t),ue({sortable:o,name:"choose",originalEvent:e}),be(E,s.chosenClass,!0)},s.ignore.split(",").forEach(function(g){Jo(E,g.trim(),_n)}),x(r,"dragover",_e),x(r,"mousemove",_e),x(r,"touchmove",_e),s.supportPointer?(x(r,"pointerup",o._onDrop),!this.nativeDraggable&&x(r,"pointercancel",o._onDrop)):(x(r,"mouseup",o._onDrop),x(r,"touchend",o._onDrop),x(r,"touchcancel",o._onDrop)),Ro&&this.nativeDraggable&&(this.options.touchStartThreshold=4,E.draggable=!0),ge("delayStart",this,{evt:e}),s.delay&&(!s.delayOnTouchOnly||t)&&(!this.nativeDraggable||!(rn||ze))){if(P.eventCanceled){this._onDrop();return}s.supportPointer?(x(r,"pointerup",o._disableDelayedDrag),x(r,"pointercancel",o._disableDelayedDrag)):(x(r,"mouseup",o._disableDelayedDrag),x(r,"touchend",o._disableDelayedDrag),x(r,"touchcancel",o._disableDelayedDrag)),x(r,"mousemove",o._delayedDragTouchMoveHandler),x(r,"touchmove",o._delayedDragTouchMoveHandler),s.supportPointer&&x(r,"pointermove",o._delayedDragTouchMoveHandler),o._dragStartTimer=setTimeout(i,s.delay)}else i()}},_delayedDragTouchMoveHandler:function(e){var t=e.touches?e.touches[0]:e;Math.max(Math.abs(t.clientX-this._lastX),Math.abs(t.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){E&&_n(E),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var e=this.el.ownerDocument;z(e,"mouseup",this._disableDelayedDrag),z(e,"touchend",this._disableDelayedDrag),z(e,"touchcancel",this._disableDelayedDrag),z(e,"pointerup",this._disableDelayedDrag),z(e,"pointercancel",this._disableDelayedDrag),z(e,"mousemove",this._delayedDragTouchMoveHandler),z(e,"touchmove",this._delayedDragTouchMoveHandler),z(e,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(e,t){t=t||e.pointerType=="touch"&&e,!this.nativeDraggable||t?this.options.supportPointer?x(document,"pointermove",this._onTouchMove):t?x(document,"touchmove",this._onTouchMove):x(document,"mousemove",this._onTouchMove):(x(E,"dragend",this),x(J,"dragstart",this._onDragStart));try{document.selection?Cn(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch{}},_dragStarted:function(e,t){if(gt=!1,J&&E){ge("dragStarted",this,{evt:t}),this.nativeDraggable&&x(document,"dragover",Ba);var n=this.options;!e&&be(E,n.dragClass,!1),be(E,n.ghostClass,!0),P.active=this,e&&this._appendGhost(),ue({sortable:this,name:"start",originalEvent:t})}else this._nulling()},_emulateDragOver:function(){if(Le){this._lastX=Le.clientX,this._lastY=Le.clientY,oa();for(var e=document.elementFromPoint(Le.clientX,Le.clientY),t=e;e&&e.shadowRoot&&(e=e.shadowRoot.elementFromPoint(Le.clientX,Le.clientY),e!==t);)t=e;if(E.parentNode[pe]._isOutsideThisEl(e),t)do{if(t[pe]){var n=void 0;if(n=t[pe]._onDragOver({clientX:Le.clientX,clientY:Le.clientY,target:e,rootEl:t}),n&&!this.options.dragoverBubble)break}e=t}while(t=Xo(t));aa()}},_onTouchMove:function(e){if(Qe){var t=this.options,n=t.fallbackTolerance,o=t.fallbackOffset,a=e.touches?e.touches[0]:e,s=D&&yt(D,!0),r=D&&s&&s.a,i=D&&s&&s.d,c=fn&&le&&Mo(le),g=(a.clientX-Qe.clientX+o.x)/(r||1)+(c?c[0]-Qn[0]:0)/(r||1),u=(a.clientY-Qe.clientY+o.y)/(i||1)+(c?c[1]-Qn[1]:0)/(i||1);if(!P.active&&!gt){if(n&&Math.max(Math.abs(a.clientX-this._lastX),Math.abs(a.clientY-this._lastY))<n)return;this._onDragStart(e,!0)}if(D){s?(s.e+=g-(Kn||0),s.f+=u-(Zn||0)):s={a:1,b:0,c:0,d:1,e:g,f:u};var h="matrix(".concat(s.a,",").concat(s.b,",").concat(s.c,",").concat(s.d,",").concat(s.e,",").concat(s.f,")");M(D,"webkitTransform",h),M(D,"mozTransform",h),M(D,"msTransform",h),M(D,"transform",h),Kn=g,Zn=u,Le=a}e.cancelable&&e.preventDefault()}},_appendGhost:function(){if(!D){var e=this.options.fallbackOnBody?document.body:J,t=oe(E,!0,fn,!0,e),n=this.options;if(fn){for(le=e;M(le,"position")==="static"&&M(le,"transform")==="none"&&le!==document;)le=le.parentNode;le!==document.body&&le!==document.documentElement?(le===document&&(le=Ie()),t.top+=le.scrollTop,t.left+=le.scrollLeft):le=Ie(),Qn=Mo(le)}D=E.cloneNode(!0),be(D,n.ghostClass,!1),be(D,n.fallbackClass,!0),be(D,n.dragClass,!0),M(D,"transition",""),M(D,"transform",""),M(D,"box-sizing","border-box"),M(D,"margin",0),M(D,"top",t.top),M(D,"left",t.left),M(D,"width",t.width),M(D,"height",t.height),M(D,"opacity","0.8"),M(D,"position",fn?"absolute":"fixed"),M(D,"zIndex","100000"),M(D,"pointerEvents","none"),P.ghost=D,e.appendChild(D),M(D,"transform-origin",Po/parseInt(D.style.width)*100+"% "+Do/parseInt(D.style.height)*100+"%")}},_onDragStart:function(e,t){var n=this,o=e.dataTransfer,a=n.options;if(ge("dragStart",this,{evt:e}),P.eventCanceled){this._onDrop();return}ge("setupClone",this),P.eventCanceled||(Z=Qo(E),Z.removeAttribute("id"),Z.draggable=!1,Z.style["will-change"]="",this._hideClone(),be(Z,this.options.chosenClass,!1),P.clone=Z),n.cloneId=Cn(function(){ge("clone",n),!P.eventCanceled&&(n.options.removeCloneOnHide||J.insertBefore(Z,E),n._hideClone(),ue({sortable:n,name:"clone"}))}),!t&&be(E,a.dragClass,!0),t?(wn=!0,n._loopId=setInterval(n._emulateDragOver,50)):(z(document,"mouseup",n._onDrop),z(document,"touchend",n._onDrop),z(document,"touchcancel",n._onDrop),o&&(o.effectAllowed="move",a.setData&&a.setData.call(n,o,E)),x(document,"drop",n),M(E,"transform","translateZ(0)")),gt=!0,n._dragStartId=Cn(n._dragStarted.bind(n,t,e)),x(document,"selectstart",n),Dt=!0,window.getSelection().removeAllRanges(),Gt&&M(document.body,"user-select","none")},_onDragOver:function(e){var t=this.el,n=e.target,o,a,s,r=this.options,i=r.group,c=P.active,g=un===i,u=r.sort,h=re||c,y,S=this,N=!1;if(io)return;function U(Mt,ua){ge(Mt,S,Oe({evt:e,isOwner:g,axis:y?"vertical":"horizontal",revert:s,dragRect:o,targetRect:a,canSort:u,fromSortable:h,target:n,completed:te,onMove:function(Eo,ga){return pn(J,t,E,o,Eo,oe(Eo),e,ga)},changed:me},ua))}function X(){U("dragOverAnimationCapture"),S.captureAnimationState(),S!==h&&h.captureAnimationState()}function te(Mt){return U("dragOverCompleted",{insertion:Mt}),Mt&&(g?c._hideClone():c._showClone(S),S!==h&&(be(E,re?re.options.ghostClass:c.options.ghostClass,!1),be(E,r.ghostClass,!0)),re!==S&&S!==P.active?re=S:S===P.active&&re&&(re=null),h===S&&(S._ignoreWhileAnimating=n),S.animateAll(function(){U("dragOverAnimationComplete"),S._ignoreWhileAnimating=null}),S!==h&&(h.animateAll(),h._ignoreWhileAnimating=null)),(n===E&&!E.animated||n===t&&!n.animated)&&(ut=null),!r.dragoverBubble&&!e.rootEl&&n!==document&&(E.parentNode[pe]._isOutsideThisEl(e.target),!Mt&&_e(e)),!r.dragoverBubble&&e.stopPropagation&&e.stopPropagation(),N=!0}function me(){Se=Ee(E),He=Ee(E,r.draggable),ue({sortable:S,name:"change",toEl:t,newIndex:Se,newDraggableIndex:He,originalEvent:e})}if(e.preventDefault!==void 0&&e.cancelable&&e.preventDefault(),n=ke(n,r.draggable,t,!0),U("dragOver"),P.eventCanceled)return N;if(E.contains(e.target)||n.animated&&n.animatingX&&n.animatingY||S._ignoreWhileAnimating===n)return te(!1);if(wn=!1,c&&!r.disabled&&(g?u||(s=Q!==J):re===this||(this.lastPutMode=un.checkPull(this,c,E,e))&&i.checkPut(this,c,E,e))){if(y=this._getDirection(e,n)==="vertical",o=oe(E),U("dragOverValid"),P.eventCanceled)return N;if(s)return Q=J,X(),this._hideClone(),U("revert"),P.eventCanceled||(tt?J.insertBefore(E,tt):J.appendChild(E)),te(!0);var de=So(t,r.draggable);if(!de||Va(e,y,this)&&!de.animated){if(de===E)return te(!1);if(de&&t===e.target&&(n=de),n&&(a=oe(n)),pn(J,t,E,o,n,a,e,!!n)!==!1)return X(),de&&de.nextSibling?t.insertBefore(E,de.nextSibling):t.appendChild(E),Q=t,me(),te(!0)}else if(de&&$a(e,y,this)){var Me=wt(t,0,r,!0);if(Me===E)return te(!1);if(n=Me,a=oe(n),pn(J,t,E,o,n,a,e,!1)!==!1)return X(),t.insertBefore(E,Me),Q=t,me(),te(!0)}else if(n.parentNode===t){a=oe(n);var Ce=0,Ke,kt=E.parentNode!==t,ye=!za(E.animated&&E.toRect||o,n.animated&&n.toRect||a,y),Rt=y?"top":"left",xe=Oo(n,"top","top")||Oo(E,"top","top"),It=xe?xe.scrollTop:void 0;ut!==n&&(Ke=a[Rt],Bt=!1,gn=!ye&&r.invertSwap||kt),Ce=Wa(e,n,a,y,ye?1:r.swapThreshold,r.invertedSwapThreshold==null?r.swapThreshold:r.invertedSwapThreshold,gn,ut===n);var Pe;if(Ce!==0){var Ze=Ee(E);do Ze-=Ce,Pe=Q.children[Ze];while(Pe&&(M(Pe,"display")==="none"||Pe===D))}if(Ce===0||Pe===n)return te(!1);ut=n,xt=Ce;var Ot=n.nextElementSibling,Be=!1;Be=Ce===1;var cn=pn(J,t,E,o,n,a,e,Be);if(cn!==!1)return(cn===1||cn===-1)&&(Be=cn===1),io=!0,setTimeout(Ua,30),X(),Be&&!Ot?t.appendChild(E):n.parentNode.insertBefore(E,Be?Ot:n),xe&&Zo(xe,0,It-xe.scrollTop),Q=E.parentNode,Ke!==void 0&&!gn&&(vn=Math.abs(Ke-oe(n)[Rt])),me(),te(!0)}if(t.contains(E))return te(!1)}return!1},_ignoreWhileAnimating:null,_offMoveEvents:function(){z(document,"mousemove",this._onTouchMove),z(document,"touchmove",this._onTouchMove),z(document,"pointermove",this._onTouchMove),z(document,"dragover",_e),z(document,"mousemove",_e),z(document,"touchmove",_e)},_offUpEvents:function(){var e=this.el.ownerDocument;z(e,"mouseup",this._onDrop),z(e,"touchend",this._onDrop),z(e,"pointerup",this._onDrop),z(e,"pointercancel",this._onDrop),z(e,"touchcancel",this._onDrop),z(document,"selectstart",this)},_onDrop:function(e){var t=this.el,n=this.options;if(Se=Ee(E),He=Ee(E,n.draggable),ge("drop",this,{evt:e}),Q=E&&E.parentNode,Se=Ee(E),He=Ee(E,n.draggable),P.eventCanceled){this._nulling();return}gt=!1,gn=!1,Bt=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),lo(this.cloneId),lo(this._dragStartId),this.nativeDraggable&&(z(document,"drop",this),z(t,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),Gt&&M(document.body,"user-select",""),M(E,"transform",""),e&&(Dt&&(e.cancelable&&e.preventDefault(),!n.dropBubble&&e.stopPropagation()),D&&D.parentNode&&D.parentNode.removeChild(D),(J===Q||re&&re.lastPutMode!=="clone")&&Z&&Z.parentNode&&Z.parentNode.removeChild(Z),E&&(this.nativeDraggable&&z(E,"dragend",this),_n(E),E.style["will-change"]="",Dt&&!gt&&be(E,re?re.options.ghostClass:this.options.ghostClass,!1),be(E,this.options.chosenClass,!1),ue({sortable:this,name:"unchoose",toEl:Q,newIndex:null,newDraggableIndex:null,originalEvent:e}),J!==Q?(Se>=0&&(ue({rootEl:Q,name:"add",toEl:Q,fromEl:J,originalEvent:e}),ue({sortable:this,name:"remove",toEl:Q,originalEvent:e}),ue({rootEl:Q,name:"sort",toEl:Q,fromEl:J,originalEvent:e}),ue({sortable:this,name:"sort",toEl:Q,originalEvent:e})),re&&re.save()):Se!==ft&&Se>=0&&(ue({sortable:this,name:"update",toEl:Q,originalEvent:e}),ue({sortable:this,name:"sort",toEl:Q,originalEvent:e})),P.active&&((Se==null||Se===-1)&&(Se=ft,He=zt),ue({sortable:this,name:"end",toEl:Q,originalEvent:e}),this.save()))),this._nulling()},_nulling:function(){ge("nulling",this),J=E=Q=D=tt=Z=Sn=$e=Qe=Le=Dt=Se=He=ft=zt=ut=xt=re=un=P.dragged=P.ghost=P.clone=P.active=null,Rn.forEach(function(e){e.checked=!0}),Rn.length=Kn=Zn=0},handleEvent:function(e){switch(e.type){case"drop":case"dragend":this._onDrop(e);break;case"dragenter":case"dragover":E&&(this._onDragOver(e),Ha(e));break;case"selectstart":e.preventDefault();break}},toArray:function(){for(var e=[],t,n=this.el.children,o=0,a=n.length,s=this.options;o<a;o++)t=n[o],ke(t,s.draggable,this.el,!1)&&e.push(t.getAttribute(s.dataIdAttr)||Ya(t));return e},sort:function(e,t){var n={},o=this.el;this.toArray().forEach(function(a,s){var r=o.children[s];ke(r,this.options.draggable,o,!1)&&(n[a]=r)},this),t&&this.captureAnimationState(),e.forEach(function(a){n[a]&&(o.removeChild(n[a]),o.appendChild(n[a]))}),t&&this.animateAll()},save:function(){var e=this.options.store;e&&e.set&&e.set(this)},closest:function(e,t){return ke(e,t||this.options.draggable,this.el,!1)},option:function(e,t){var n=this.options;if(t===void 0)return n[e];var o=ln.modifyOption(this,e,t);typeof o<"u"?n[e]=o:n[e]=t,e==="group"&&na(n)},destroy:function(){ge("destroy",this);var e=this.el;e[pe]=null,z(e,"mousedown",this._onTapStart),z(e,"touchstart",this._onTapStart),z(e,"pointerdown",this._onTapStart),this.nativeDraggable&&(z(e,"dragover",this),z(e,"dragenter",this)),Array.prototype.forEach.call(e.querySelectorAll("[draggable]"),function(t){t.removeAttribute("draggable")}),this._onDrop(),this._disableDelayedDragEvents(),kn.splice(kn.indexOf(this.el),1),this.el=e=null},_hideClone:function(){if(!$e){if(ge("hideClone",this),P.eventCanceled)return;M(Z,"display","none"),this.options.removeCloneOnHide&&Z.parentNode&&Z.parentNode.removeChild(Z),$e=!0}},_showClone:function(e){if(e.lastPutMode!=="clone"){this._hideClone();return}if($e){if(ge("showClone",this),P.eventCanceled)return;E.parentNode==J&&!this.options.group.revertClone?J.insertBefore(Z,E):tt?J.insertBefore(Z,tt):J.appendChild(Z),this.options.group.revertClone&&this.animate(E,Z),M(Z,"display",""),$e=!1}}};function Ha(l){l.dataTransfer&&(l.dataTransfer.dropEffect="move"),l.cancelable&&l.preventDefault()}function pn(l,e,t,n,o,a,s,r){var i,c=l[pe],g=c.options.onMove,u;return window.CustomEvent&&!ze&&!rn?i=new CustomEvent("move",{bubbles:!0,cancelable:!0}):(i=document.createEvent("Event"),i.initEvent("move",!0,!0)),i.to=e,i.from=l,i.dragged=t,i.draggedRect=n,i.related=o||e,i.relatedRect=a||oe(e),i.willInsertAfter=r,i.originalEvent=s,l.dispatchEvent(i),g&&(u=g.call(c,i,s)),u}function _n(l){l.draggable=!1}function Ua(){io=!1}function $a(l,e,t){var n=oe(wt(t.el,0,t.options,!0)),o=_o(t.el,t.options,D),a=10;return e?l.clientX<o.left-a||l.clientY<n.top&&l.clientX<n.right:l.clientY<o.top-a||l.clientY<n.bottom&&l.clientX<n.left}function Va(l,e,t){var n=oe(So(t.el,t.options.draggable)),o=_o(t.el,t.options,D),a=10;return e?l.clientX>o.right+a||l.clientY>n.bottom&&l.clientX>n.left:l.clientY>o.bottom+a||l.clientX>n.right&&l.clientY>n.top}function Wa(l,e,t,n,o,a,s,r){var i=n?l.clientY:l.clientX,c=n?t.height:t.width,g=n?t.top:t.left,u=n?t.bottom:t.right,h=!1;if(!s){if(r&&vn<c*o){if(!Bt&&(xt===1?i>g+c*a/2:i<u-c*a/2)&&(Bt=!0),Bt)h=!0;else if(xt===1?i<g+vn:i>u-vn)return-xt}else if(i>g+c*(1-o)/2&&i<u-c*(1-o)/2)return ja(e)}return h=h||s,h&&(i<g+c*a/2||i>u-c*a/2)?i>g+c/2?1:-1:0}function ja(l){return Ee(E)<Ee(l)?1:-1}function Ya(l){for(var e=l.tagName+l.className+l.src+l.href+l.textContent,t=e.length,n=0;t--;)n+=e.charCodeAt(t);return n.toString(36)}function Xa(l){Rn.length=0;for(var e=l.getElementsByTagName("input"),t=e.length;t--;){var n=e[t];n.checked&&Rn.push(n)}}function Cn(l){return setTimeout(l,0)}function lo(l){return clearTimeout(l)}Wn&&x(document,"touchmove",function(l){(P.active||gt)&&l.cancelable&&l.preventDefault()});P.utils={on:x,off:z,css:M,find:Jo,is:function(e,t){return!!ke(e,t,e,!1)},extend:Oa,throttle:Ko,closest:ke,toggleClass:be,clone:Qo,index:Ee,nextTick:Cn,cancelNextTick:lo,detectDirection:ta,getChild:wt,expando:pe};P.get=function(l){return l[pe]};P.mount=function(){for(var l=arguments.length,e=new Array(l),t=0;t<l;t++)e[t]=arguments[t];e[0].constructor===Array&&(e=e[0]),e.forEach(function(n){if(!n.prototype||!n.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(n));n.utils&&(P.utils=Oe(Oe({},P.utils),n.utils)),ln.mount(n)})};P.create=function(l,e){return new P(l,e)};P.version=Ra;var ne=[],Ft,co,uo=!1,eo,to,In,At;function Ja(){function l(){this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0};for(var e in this)e.charAt(0)==="_"&&typeof this[e]=="function"&&(this[e]=this[e].bind(this))}return l.prototype={dragStarted:function(t){var n=t.originalEvent;this.sortable.nativeDraggable?x(document,"dragover",this._handleAutoScroll):this.options.supportPointer?x(document,"pointermove",this._handleFallbackAutoScroll):n.touches?x(document,"touchmove",this._handleFallbackAutoScroll):x(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(t){var n=t.originalEvent;!this.options.dragOverBubble&&!n.rootEl&&this._handleAutoScroll(n)},drop:function(){this.sortable.nativeDraggable?z(document,"dragover",this._handleAutoScroll):(z(document,"pointermove",this._handleFallbackAutoScroll),z(document,"touchmove",this._handleFallbackAutoScroll),z(document,"mousemove",this._handleFallbackAutoScroll)),Ao(),En(),Ma()},nulling:function(){In=co=Ft=uo=At=eo=to=null,ne.length=0},_handleFallbackAutoScroll:function(t){this._handleAutoScroll(t,!0)},_handleAutoScroll:function(t,n){var o=this,a=(t.touches?t.touches[0]:t).clientX,s=(t.touches?t.touches[0]:t).clientY,r=document.elementFromPoint(a,s);if(In=t,n||this.options.forceAutoScrollFallback||rn||ze||Gt){no(t,this.options,r,n);var i=Je(r,!0);uo&&(!At||a!==eo||s!==to)&&(At&&Ao(),At=setInterval(function(){var c=Je(document.elementFromPoint(a,s),!0);c!==i&&(i=c,En()),no(t,o.options,c,n)},10),eo=a,to=s)}else{if(!this.options.bubbleScroll||Je(r,!0)===Ie()){En();return}no(t,this.options,Je(r,!1),!1)}}},qe(l,{pluginName:"scroll",initializeByDefault:!0})}function En(){ne.forEach(function(l){clearInterval(l.pid)}),ne=[]}function Ao(){clearInterval(At)}var no=Ko(function(l,e,t,n){if(e.scroll){var o=(l.touches?l.touches[0]:l).clientX,a=(l.touches?l.touches[0]:l).clientY,s=e.scrollSensitivity,r=e.scrollSpeed,i=Ie(),c=!1,g;co!==t&&(co=t,En(),Ft=e.scroll,g=e.scrollFn,Ft===!0&&(Ft=Je(t,!0)));var u=0,h=Ft;do{var y=h,S=oe(y),N=S.top,U=S.bottom,X=S.left,te=S.right,me=S.width,de=S.height,Me=void 0,Ce=void 0,Ke=y.scrollWidth,kt=y.scrollHeight,ye=M(y),Rt=y.scrollLeft,xe=y.scrollTop;y===i?(Me=me<Ke&&(ye.overflowX==="auto"||ye.overflowX==="scroll"||ye.overflowX==="visible"),Ce=de<kt&&(ye.overflowY==="auto"||ye.overflowY==="scroll"||ye.overflowY==="visible")):(Me=me<Ke&&(ye.overflowX==="auto"||ye.overflowX==="scroll"),Ce=de<kt&&(ye.overflowY==="auto"||ye.overflowY==="scroll"));var It=Me&&(Math.abs(te-o)<=s&&Rt+me<Ke)-(Math.abs(X-o)<=s&&!!Rt),Pe=Ce&&(Math.abs(U-a)<=s&&xe+de<kt)-(Math.abs(N-a)<=s&&!!xe);if(!ne[u])for(var Ze=0;Ze<=u;Ze++)ne[Ze]||(ne[Ze]={});(ne[u].vx!=It||ne[u].vy!=Pe||ne[u].el!==y)&&(ne[u].el=y,ne[u].vx=It,ne[u].vy=Pe,clearInterval(ne[u].pid),(It!=0||Pe!=0)&&(c=!0,ne[u].pid=setInterval((function(){n&&this.layer===0&&P.active._onTouchMove(In);var Ot=ne[this.layer].vy?ne[this.layer].vy*r:0,Be=ne[this.layer].vx?ne[this.layer].vx*r:0;typeof g=="function"&&g.call(P.dragged.parentNode[pe],Be,Ot,l,In,ne[this.layer].el)!=="continue"||Zo(ne[this.layer].el,Be,Ot)}).bind({layer:u}),24))),u++}while(e.bubbleScroll&&h!==i&&(h=Je(h,!1)));uo=c}},30),sa=function(e){var t=e.originalEvent,n=e.putSortable,o=e.dragEl,a=e.activeSortable,s=e.dispatchSortableEvent,r=e.hideGhostForTarget,i=e.unhideGhostForTarget;if(t){var c=n||a;r();var g=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:t,u=document.elementFromPoint(g.clientX,g.clientY);i(),c&&!c.el.contains(u)&&(s("spill"),this.onSpill({dragEl:o,putSortable:n}))}};function vo(){}vo.prototype={startIndex:null,dragStart:function(e){var t=e.oldDraggableIndex;this.startIndex=t},onSpill:function(e){var t=e.dragEl,n=e.putSortable;this.sortable.captureAnimationState(),n&&n.captureAnimationState();var o=wt(this.sortable.el,this.startIndex,this.options);o?this.sortable.el.insertBefore(t,o):this.sortable.el.appendChild(t),this.sortable.animateAll(),n&&n.animateAll()},drop:sa};qe(vo,{pluginName:"revertOnSpill"});function Co(){}Co.prototype={onSpill:function(e){var t=e.dragEl,n=e.putSortable,o=n||this.sortable;o.captureAnimationState(),t.parentNode&&t.parentNode.removeChild(t),o.animateAll()},drop:sa};qe(Co,{pluginName:"removeOnSpill"});P.mount(new Ja);P.mount(Co,vo);const oo="root";var Ye,ae,Un,$n,ra;const R=class R{static init(){if(R.noFolderView()||!ui.scenes||!game.user.isGM)return;R.preloadTemplates(),game.user.getFlag(q,"activeSceneFolders")||game.user.setFlag(q,"activeSceneFolders",[]);const e=document.querySelector("#scene-navigation-inactive");((e==null?void 0:e.querySelectorAll("li.folder"))||[]).forEach(n=>{n.remove()}),Hooks.on(A.RENDER_SCENE_DIRECTORY,(n,o)=>{var a;H(a=R,$n,ra).call(a)})}static addFolderButtons(e,t,n){if(!F.useSceneFolders||game.scenes.size<2||game.scenes.folders.size<1)return;const o=w();if(document.querySelector("#crlngn-folder-toggle"))return;const s=t.querySelector("#scene-navigation-active");s==null||s.querySelector("li.scene");const r=`CRLNGN_UI.ui.sceneNav.${F.navShowRootFolders?"hideSceneFoldersTooltip":"showSceneFoldersTooltip"}`,i=document.createElement("div");i.dataset.tooltip=game.i18n.localize(r),i.id="crlngn-folder-toggle",i.innerHTML="<i class='fa-solid icon'></i>",i.addEventListener("click",()=>{F.setNavPosition(0);const c=!F.navShowRootFolders;T.set(o.navShowRootFolders.tag,c),F.placeNavButtons()}),s==null||s.append(i),F.navShowRootFolders?s==null||s.classList.add("with-folders"):s==null||s.classList.remove("with-folders")}static toggleFolderLookup(e){const t=e.target.parentNode;t.classList.contains("open")?t.classList.remove("open"):t.classList.add("open")}static buildTemplateData(e){if(!e||!ui.scenes)return{};const t=ui.scenes.collection.folders;let n={},o=[],a=e.contents?[...e.contents]:[];return a=a.filter(s=>s.permission>=2),O(R,Ye,game.scenes.sortingMode),p.log("buildFolderData A",[e.name,e]),e.id===oo?o=t.filter(s=>s.folder===null)||[]:o=e.children,o=R.sortFolderList(o),n={currentFolder:e,folders:o,scenes:a},p.log("buildFolderData",[o,n]),n}static sortFolderList(e){return e=e.map((t,n)=>t.folder?t.folder:t),m(R,Ye)==="a"?e.sort((t,n)=>t.name.toLowerCase().localeCompare(n.name.toLowerCase())):e.sort((t,n)=>t.sort-n.sort),e}};Ye=new WeakMap,ae=new WeakMap,Un=new WeakMap,$n=new WeakSet,ra=function(){try{if(game.scenes&&game.scenes.sortingMode!==void 0){O(R,Ye,game.scenes.sortingMode);return}}catch(e){console.error("Error checking scene directory sort mode:",e)}O(R,Ye,"a"),p.log("updateSortMode fallback",[m(R,Ye)])},k(R,$n),b(R,"selectedFolder",oo),k(R,Ye,"a"),k(R,ae,[]),b(R,"searchValue",""),b(R,"renderFolderList",async e=>{O(R,ae,game.user.getFlag(q,"activeSceneFolders")||[]);let t;const n=ui.scenes.collection.folders,o=e?n.get(e.dataset.folderId):{name:"",id:oo},a=R.buildTemplateData(o),s=await L.renderTemplate(`modules/${q}/templates/scene-nav-folders.hbs`,a);e?t=e.parentNode:t=document.querySelector("#scene-navigation-inactive"),t.insertAdjacentHTML("afterbegin",s);const r=t.querySelectorAll("li.folder");R.addFolderListeners(r),F.placeNavButtons()}),b(R,"handleFolderLookup",async()=>{const e=await L.renderTemplate(`modules/${q}/templates/scene-nav-lookup.hbs`,{}),t=document.querySelector("#crlngn-lookup-list");t&&t.remove();const n=document.querySelector("#crlngn-scene-lookup");n.insertAdjacentHTML("beforeend",e);const o=n.querySelector(".search-container .input-scene-search");o.addEventListener("keyup",R.onSearchInput),o.addEventListener("keydown",s=>{s.stopPropagation()});const a=n==null?void 0:n.querySelector(".scene-lookup-toggle");a&&a.addEventListener("click",R.toggleFolderLookup)}),b(R,"addFolderListeners",e=>{const t=ui.scenes.collection.folders;e&&e.forEach(n=>{n.querySelector(".folder-item").addEventListener("click",m(R,Un));const o=n.dataset.folderId,a=t.get(o),s=m(R,ae).includes(o);p.log("addFolderListeners isActive",[s,o,a.name]),s&&(n.classList.add("crlngn-folder-active"),R.injectSubfolders(a,n))})}),k(R,Un,async e=>{e.preventDefault(),e.stopPropagation();const t=e.currentTarget;t.offsetLeft,t.parentNode.parentNode.querySelectorAll(".crlngn-folder-active");const n=t.dataset.folderId||t.parentNode.dataset.folderId,o=ui.scenes.collection.folders,a=n?o.get(n):null;if(!a)return;await R.injectSubfolders(a,t.parentNode),F.addSceneListeners(t.parentNode),p.log("onNavFolderClick",[t,t.parentNode,t.parentNode.dataset]),t.classList.contains("crlngn-folder-active")||t.parentNode.classList.contains("crlngn-folder-active")?R.updateActiveFolders(n,!0):R.updateActiveFolders(n,!1)}),b(R,"injectSubfolders",async(e,t)=>{const n=R.buildTemplateData(e),o=await L.renderTemplate(`modules/${q}/templates/scene-nav-subfolders.hbs`,n),a=t.querySelector(".contents");a&&a.remove(),t.insertAdjacentHTML("beforeend",o);const s=t.querySelectorAll("li.folder");R.addFolderListeners(s),F.addSceneListeners(t.querySelector(".contents"))}),b(R,"updateActiveFolders",async(e,t=!1)=>{const n=document.querySelector("#scene-navigation-inactive"),o=n==null?void 0:n.querySelector(`li.folder[data-folder-id="${e}"]`),a=m(R,ae).indexOf(e);p.log("updateActiveFolders A",[a,e,game.user.getFlag(q,"activeSceneFolders"),m(R,ae)]),t?(O(R,ae,m(R,ae).filter(s=>s!==e)),o.classList.remove("crlngn-folder-active")):m(R,ae).includes(e)||(o.parentNode.querySelectorAll("li.folder").forEach(r=>{r!==o&&(O(R,ae,m(R,ae).filter(i=>i!==r.dataset.folderId)),r.classList.remove("crlngn-folder-active"))}),m(R,ae).push(e),o.classList.add("crlngn-folder-active")),await game.user.setFlag(q,"activeSceneFolders",m(R,ae)),p.log("updateActiveFolders B",[t,e,game.user.getFlag(q,"activeSceneFolders"),m(R,ae)])}),b(R,"selectFolder",e=>R.getFolderById(e)||null),b(R,"noFolderView",()=>{var t;return!((t=game==null?void 0:game.user)==null?void 0:t.isGM)&&!F.navFoldersForPlayers||!F.useSceneFolders||!F.sceneNavEnabled}),b(R,"preloadTemplates",async()=>{const e=[`modules/${q}/templates/scene-nav-folders.hbs`,`modules/${q}/templates/scene-nav-subfolders.hbs`,`modules/${q}/templates/scene-nav-lookup.hbs`];return await L.loadTemplates(e),!0}),b(R,"onSearchInput",e=>{e.stopPropagation();const n=e.currentTarget.value;R.searchValue=n,R.updateSearchResults(n)}),b(R,"updateSearchResults",e=>{var a,s;if(!F.useSceneLookup)return;const t=document.querySelector("#crlngn-scene-lookup .search-container .search-results");if(!t)return;if(t.innerHTML="",!e){t.classList.add("hidden");return}const n=((a=game.scenes)==null?void 0:a.filter(r=>r.name.toLowerCase().includes(e.toLowerCase())&&r.permission>=2))||[];n.sort((r,i)=>r.name.toLowerCase().localeCompare(i.name.toLowerCase()));let o=[];if(F.useSceneFolders&&(o=((s=game.scenes)==null?void 0:s.folders.filter(r=>r.name.toLowerCase().includes(e.toLowerCase())))||[],o.sort((r,i)=>r.name.toLowerCase().localeCompare(i.name.toLowerCase())),o.forEach(r=>{const i=document.createElement("li");i.className="search-folder",i.dataset.folderId=r.id,i.innerHTML=`<a><i class="fas fa-folder"></i> ${r.name}</a>`,i.addEventListener("click",R.onSelectSearchedFolder),t.appendChild(i)})),t.classList.remove("hidden"),n.forEach(r=>{const i=document.createElement("li");i.className="search-scene",i.dataset.sceneId=r.id,i.innerHTML=`<a><i class="fas fa-map"></i> ${r.name}</a>`,i.addEventListener("dblclick",F.onActivateScene),i.addEventListener("click",F.onSelectScene),t.appendChild(i)}),o.length===0&&n.length===0){const r=document.createElement("li");r.className="no-results",r.textContent="No matching results found",t.appendChild(r)}}),b(R,"onSelectSearchedFolder",async e=>{e.stopPropagation(),e.preventDefault();const n=e.currentTarget.dataset.folderId,o=document.querySelector("#crlngn-folder-toggle");if(F.navShowRootFolders||o.click(),!n)return;const r=[...ui.scenes.collection.folders.get(n).ancestors];O(R,ae,[]);for(const i of r)m(R,ae).push(i.id);m(R,ae).push(n),await game.user.setFlag(q,"activeSceneFolders",m(R,ae)),setTimeout(async()=>{ui.nav.render()},200)});let nt=R;var he,ia,la,ca,Tn,da;const j=class j{static init(){const e=w();p.log("SheetsUtil.init",[]),!(game.system.id!=="dnd5e"&&game.system.id!=="daggerheart")&&(j.themeStylesEnabled=T.get(e.applyThemeToSheets.tag),j.horizontalSheetTabsEnabled=T.get(e.useHorizontalSheetTabs.tag),Hooks.on(A.RENDER_ACTOR_SHEET,H(j,he,ia)),Hooks.on(A.RENDER_COMPENDIUM_BROWSER,H(j,he,la)))}static applyThemeToSheets(e){j.themeStylesEnabled=e,e?document.body.classList.add("crlngn-sheets"):(document.body.classList.remove("crlngn-sheets"),document.body.classList.remove("crlngn-sheet-tabs"),j.horizontalSheetTabsEnabled=!1)}static applyHorizontalSheetTabs(e){var t,n;j.horizontalSheetTabsEnabled=e,j.horizontalSheetTabsEnabled&&j.themeStylesEnabled?(document.body.classList.add("crlngn-sheet-tabs"),H(t=j,he,Tn).call(t)):(document.body.classList.remove("crlngn-sheet-tabs"),H(n=j,he,da).call(n))}};he=new WeakSet,ia=function(e,t,n){var a;p.log(A.RENDER_ACTOR_SHEET,[e,t.querySelector(".sheet-body"),n]),(a=t.querySelector(".sheet-body .main-content"))==null||a.addEventListener("scroll",H(j,he,ca));const o=t.querySelectorAll("nav.tabs > a.item");for(const s of o)s.removeAttribute("data-tooltip"),s.removeAttribute("data-tooltip-delay");j.applyThemeToSheets(j.themeStylesEnabled),j.applyHorizontalSheetTabs(j.horizontalSheetTabsEnabled),j.horizontalSheetTabsEnabled&&setTimeout(()=>{var s;H(s=j,he,Tn).call(s)},100)},la=function(e,t,n){p.log(A.RENDER_COMPENDIUM_BROWSER,[e,t,n]),j.horizontalSheetTabsEnabled&&setTimeout(()=>{var o;H(o=j,he,Tn).call(o)},100)},ca=function(e){const t=e.target.closest(".window-content"),n=t==null?void 0:t.querySelector(".ability-scores");n&&(e.target.scrollTop>30?n.classList.add("fadeout"):n.classList.remove("fadeout"))},Tn=function(){document.querySelectorAll(".dnd5e2.vertical-tabs nav.tabs").forEach(t=>{const n=t.parentElement;if(n.querySelector(".crlngn-tab-scroll-btn"))return;const o=document.createElement("div");o.className="crlngn-tab-scroll-wrapper";const a=document.createElement("button");a.className="crlngn-tab-scroll-btn crlngn-tab-scroll-prev",a.innerHTML='<i class="fas fa-caret-left"></i>',a.addEventListener("click",r=>{r.preventDefault(),t.scrollBy({left:-150,behavior:"smooth"})});const s=document.createElement("button");s.className="crlngn-tab-scroll-btn crlngn-tab-scroll-next",s.innerHTML='<i class="fas fa-caret-right"></i>',s.addEventListener("click",r=>{r.preventDefault(),t.scrollBy({left:150,behavior:"smooth"})}),n.insertBefore(o,t),o.appendChild(a),o.appendChild(t),o.appendChild(s)})},da=function(){document.querySelectorAll(".crlngn-tab-scroll-wrapper").forEach(t=>{const n=t.querySelector("nav.tabs");n&&t.parentElement&&(t.parentElement.insertBefore(n,t),t.remove())})},k(j,he),b(j,"themeStylesEnabled",!0),b(j,"horizontalSheetTabsEnabled",!0);let ot=j;const V=class V{static init(){Hooks.on(A.RENDER_SIDE_BAR,V.onRender)}static applyFadeOut(e){V.useFadeOut=e,V.handleFadeOut()}static applyHide(e){V.hidden=e,V.handleHide()}static handleHide(e,t,n){var a;const o=t?t.querySelector("#sidebar-tabs"):document.querySelector("#sidebar-tabs");V.hidden?(a=game.user)!=null&&a.isGM||o==null||o.classList.add("hidden-ui"):o==null||o.classList.remove("hidden-ui"),p.log("handle Hide",[V.hidden])}static applyCustomStyle(e){var t;V.customStylesEnabled=e,p.log("applyCustomStyle",[V.customStylesEnabled]),(t=ui.sidebar)==null||t.render()}static applyFolderStyles(e){V.folderStylesEnabled=e,V.folderStylesEnabled?document.querySelector("body").classList.add("crlngn-folder-style"):document.querySelector("body").classList.remove("crlngn-folder-style"),p.log("applyFolderStyles",[V.folderStylesEnabled])}static onRender(e,t,n){var o,a;V.handleClassApplication(),V.handleFadeOut(e,t,n),V.handleHide(e,t,n),V.applyFolderStyles(V.folderStylesEnabled),p.log("SidebarTabs onRender",[(a=(o=foundry.applications)==null?void 0:o.sidebar)==null?void 0:a.tabs])}static handleClassApplication(){V.customStylesEnabled?document.querySelector("body").classList.add("crlngn-tabs"):document.querySelector("body").classList.remove("crlngn-tabs")}static handleFadeOut(e,t,n){const o=t?t.querySelector("#sidebar-tabs"):document.querySelector("#sidebar-tabs");V.useFadeOut?o==null||o.classList.add("faded-ui"):o==null||o.classList.remove("faded-ui"),p.log("SidebarTabs handle fade out",[V.useFadeOut])}};b(V,"useFadeOut",!0),b(V,"hidden",!1),b(V,"customStylesEnabled",!0),b(V,"folderStylesEnabled",!0),b(V,"applySideBarWidth",()=>{const e=w(),t=T.get(e.sideBarWidth.tag)||300;L.addCSSVars("--sidebar-width",`${t}px`)});let Fe=V;var Tt;const v=class v{static get(e,t=q){if(!e)return null;let n=!1;if(t===q)n=game.settings.get(t,e);else{let a=game.settings.storage.get("client")[`${t}.${e}`];a===void 0&&(a=game.settings.storage.get("world").getSetting(`${t}.${e}`)),n=a==null?void 0:a.value,p.log("GET Setting",[a,n])}return n}static set(e,t,n=q){var s;if(!e)return!1;let o=game.settings.storage.get("client")[`${n}.${e}`],a=!!o;o||(o=game.settings.storage.get("world").getSetting(`${n}.${e}`)),p.log("Setting",[e,o,t]);try{game.settings.set(n,e,t)}catch(r){(!a||!((s=r.message)!=null&&s.includes("lacks permission")))&&p.log("Unable to change setting",[e,o,r.message])}return!0}static apply(e,t=void 0){var o,a,s,r,i,c,g,u,h,y,S,N,U,X;const n=w();switch(t===void 0&&(t=v.get(e)),p.log("SettingsUtil.apply",[e,t,v.get(e)]),e){case n.disableUI.tag:location.reload();break;case n.enableMacroLayout.tag:Re.applyCustomStyle(t);break;case n.collapseMacroBar.tag:Re.applyHotBarCollapse();break;case n.playerListAvatars.tag:Ne.applyAvatars();break;case n.autoHidePlayerList.tag:Ne.applyPlayersListSettings();break;case n.uiFontBody.tag:case n.uiFontTitles.tag:case n.journalFontBody.tag:case n.journalFontTitles.tag:v.applyCustomFonts(e,t);break;case n.controlsAutoHide.tag:v.applyLeftControlsSettings(e,t);break;case n.dockHeight.tag:se.currSettings.dockHeight=t,v.applyCameraHeight(t);break;case n.dockWidth.tag:se.currSettings.dockWidth=t,v.applyCameraWidth(t);break;case n.dockPosX.tag:se.currSettings.dockPosX=t,v.applyCameraPosX(t);break;case n.dockPosY.tag:se.currSettings.dockPosY=t,v.applyCameraPosY(t);break;case n.defaultVideoWidth.tag:se.currSettings.defaultVideoWidth=t,se.applyVideoWidth(t);break;case n.dockResizeOnUserJoin.tag:se.currSettings.dockResizeOnUserJoin=t,se.applyDockResize(t);break;case n.chatBorderColor.tag:Xe.chatBorderColor=t,v.applyBorderColors();break;case n.chatBorderPosition.tag:Xe.chatBorderPosition=t,v.applyBorderColors();break;case n.sideBarWidth.tag:F.sideBarWidth=t,Fe.applySideBarWidth();break;case n.useLeftChatBorder.tag:Xe.useLeftChatBorder=t;case n.enableChatStyles.tag:Xe.enableChatStyles=t,v.applyChatStyles();break;case n.debugMode.tag:v.applyDebugSettings();break;case n.useSceneFolders.tag:F.useSceneFolders=t,(o=ui.nav)==null||o.render();break;case n.navShowRootFolders.tag:F.navShowRootFolders=t,(a=ui.nav)==null||a.render();break;case n.hideInactiveOnFolderToggle.tag:F.hideInactiveOnFolderToggle=t,(s=ui.nav)==null||s.render();break;case n.sceneClickToView.tag:F.sceneClickToView=t,(r=ui.nav)==null||r.render(),(c=(i=game.scenes)==null?void 0:i.directory)==null||c.render();break;case n.useSceneIcons.tag:F.useSceneIcons=t,(g=ui.nav)==null||g.render(),(h=(u=game.scenes)==null?void 0:u.directory)==null||h.render();break;case n.useSceneBackButton.tag:F.useSceneBackButton=t,(y=ui.nav)==null||y.render();break;case n.useSceneLookup.tag:F.useSceneLookup=t,(S=ui.nav)==null||S.render();break;case n.useScenePreview.tag:F.useScenePreview=t,(N=ui.nav)==null||N.render();break;case n.sceneItemWidth.tag:F.sceneItemWidth=t,F.applySceneItemWidth();break;case n.navStartCollapsed.tag:F.navStartCollapsed=t,(U=ui.nav)==null||U.render();break;case n.showNavOnHover.tag:F.showNavOnHover=t;break;case n.sceneNavCollapsed.tag:F.isCollapsed=v.get(n.sceneNavCollapsed.tag);break;case n.colorTheme.tag:v.applyThemeSettings();break;case n.playerColorTheme.tag:v.applyThemeSettings();break;case n.customThemeColors.tag:v.applyThemeSettings();break;case n.playerCustomThemeColors.tag:v.applyThemeSettings();break;case n.customStyles.tag:v.applyCustomCSS(t);break;case n.forcedDarkTheme.tag:v.applyForcedDarkTheme(t);break;case n.adjustOtherModules.tag:v.applyModuleAdjustments(t);break;case n.applyDarkThemeToModules.tag:v.applyDarkThemeToModules(t);break;case n.otherModulesList.tag:v.applyOtherModulesList(t);break;case n.enablePlayerList.tag:Ne.applyCustomStyle(t);break;case n.sceneNavEnabled.tag:F.applyTopNavHeight(),F.applyCustomStyle(t);break;case n.enableMacroLayout.tag:Re.applyCustomStyle(t);break;case n.enableFloatingDock.tag:se.applyCustomStyle(t);break;case n.enableSidebarTabs.tag:Fe.applyCustomStyle(t);break;case n.enableChatLogControls.tag:mt.applyCustomStyle(t);break;case n.enableSceneControls.tag:ht.applyCustomStyle(t);break;case n.sceneControlsFadeOut.tag:ht.applyFadeOut(t);break;case n.playerListFadeOut.tag:Ne.applyFadeOut(t);break;case n.sidebarTabsFadeOut.tag:Fe.applyFadeOut(t);break;case n.cameraDockFadeOut.tag:se.applyFadeOut(t);break;case n.macroHotbarFadeOut.tag:Re.applyFadeOut(t);break;case n.chatLogControlsFadeOut.tag:mt.applyFadeOut(t);break;case n.sceneNavFadeOut.tag:F.applyFadeOut(t);break;case n.sceneControlsHide.tag:ht.applyHide(t);break;case n.playerListHide.tag:Ne.applyHide(t);break;case n.sidebarTabsHide.tag:Fe.applyHide(t);break;case n.cameraDockHide.tag:se.applyHide(t);break;case n.macroHotbarHide.tag:Re.applyHide(t);break;case n.chatLogControlsHide.tag:mt.applyHide(t);break;case n.sceneNavHide.tag:F.applyHide(t);break;case n.useFolderStyle.tag:Fe.applyFolderStyles(t);break;case n.applyThemeToSheets.tag:ot.applyThemeToSheets(t);break;case n.useHorizontalSheetTabs.tag:ot.applyHorizontalSheetTabs(t);break;case n.enforceGMSettings.tag:t&&((X=game.user)!=null&&X.isGM)&&(v.saveDefaultSettings(),ui.notifications.info("Current settings saved as defaults for players"));break}}static applyBorderColors(){const e=w(),t=v.get(e.chatBorderColor.tag),n=document.querySelector("body");t===Nt.playerColor.name?(n.classList.add("player-chat-borders"),n.classList.remove("roll-chat-borders")):t===Nt.rollType.name?(n.classList.add("roll-chat-borders"),n.classList.remove("player-chat-borders")):(n.classList.remove("player-chat-borders"),n.classList.remove("roll-chat-borders"))}static applyChatStyles(){const e=w(),t=v.get(e.enableChatStyles.tag),n=document.querySelector("body");p.log("applyChatStyles",[t,e]),t?n.classList.add("crlngn-chat"):n.classList.remove("crlngn-chat")}static applyLeftControlsSettings(e,t){const n=w();v.get(n.sceneNavEnabled.tag);const o=document.querySelector("#ui-left");switch(document.querySelector("body.crlngn-ui"),document.querySelector("#crlngn-ui-vars"),p.log("applyLeftControlsSettings",[e]),e){case n.controlsAutoHide.tag:v.get(n.controlsAutoHide.tag)?o.classList.add("auto-hide"):o.classList.remove("auto-hide");break}}static applyControlIconSize(){const e=w(),t=v.get(e.controlsIconSize.tag);document.querySelector("body");const n=Pt[t]?Pt[t].size:Pt.regular.size;function o(a){switch(a){case Pt.large.name:return"var(--font-size-18);";case Pt.regular.name:return"var(--font-size-16);";default:return"var(--font-size-14);"}}p.log("applyControlIconSize",[n]),L.addCSSVars("--icon-font-size",o(t)),L.addCSSVars("--control-item-size",n),v.applyLeftControlsSettings()}static applySceneNavPos(e){const t=w();F.navPos=e||v.get(t.sceneNavPos.tag)}static applyCameraPosX(e){const t=w(),n=v.get(t.dockPosX.tag),o=e||n;se.resetPositionAndSize({x:o})}static applyCameraPosY(e){const t=w(),n=v.get(t.dockPosY.tag),o=e||n;se.resetPositionAndSize({y:o})}static applyCameraWidth(e){const t=w(),n=v.get(t.dockWidth.tag),o=e||n;se.resetPositionAndSize({w:o})}static applyCameraHeight(e){const t=w(),n=v.get(t.dockHeight.tag),o=e||n;se.resetPositionAndSize({h:o})}static applyCustomFonts(e,t){const n=w(),o=n.customFontsMenu.fields,a={};switch(p.log("applyCustomFonts",[e,t]),o.forEach(s=>{a[s]=v.get(n[s].tag)}),document.querySelector("body.crlngn-ui"),e){case n.uiFontBody.tag:L.addCSSVars("--crlngn-font-family",t||a.uiFontBody||"");break;case n.uiFontTitles.tag:L.addCSSVars("--crlngn-font-titles",t||a.uiFontTitles||"");break;case n.journalFontBody.tag:L.addCSSVars("--crlngn-font-journal-body",t||a.journalFontBody||"");break;case n.journalFontTitles.tag:L.addCSSVars("--crlngn-font-journal-title",t||a.journalFontTitles||"");break}}static resetFoundryThemeSettings(){}static applyDebugSettings(e){const t=w();p.debugOn=e||v.get(t.debugMode.tag)}static enforceGMSettings(){var o;const e=w();if((o=game.user)!=null&&o.isGM||!v.get(e.enforceGMSettings.tag))return;const t=v.get(e.defaultSettings.tag);if(!t||Object.keys(t).length<=1){p.log("No default GM settings found to enforce");return}p.log("Enforcing GM settings to player",[t]);let n=!1;for(const[a,s]of Object.entries(t))if(a!=="_version")try{const r=Object.values(e).find(i=>i.tag===a);r&&r.scope==="client"&&v.get(a)!==s&&(v.set(a,s),p.log(`Applied GM setting: ${a}`,[s]),n=!0)}catch(r){p.log(`Failed to apply GM setting: ${a}`,[r])}return n}static saveDefaultSettings(){var n;const e=w();if(!((n=game.user)!=null&&n.isGM)||!v.get(e.enforceGMSettings.tag))return;const t={_version:Date.now()};for(const[o,a]of Object.entries(e))if(a.tag&&a.scope==="client"&&!a.isMenu){const s=v.get(a.tag);s!==void 0&&(t[a.tag]=s)}v.set(e.defaultSettings.tag,t),p.log("Saved default GM settings",[t])}static onSettingChange(e){var n;const t=w();(n=game.user)!=null&&n.isGM&&v.get(t.enforceGMSettings.tag)&&v.saveDefaultSettings()}};Tt=new WeakMap,k(v,Tt,!1),b(v,"firstLoad",!0),b(v,"foundryUiConfig",null),b(v,"registerSettings",async()=>{const e=w();Object.entries(e).forEach(async c=>{const g=c[1];if(g.showOnRoot&&g.isMenu||!g.isMenu){const u={name:g.label,hint:g.hint,default:g.default,type:g.propType,scope:g.scope,config:g.config,requiresReload:g.requiresReload||!1,onChange:h=>{v.apply(g.tag,h),g.tag!=="v2-enforce-gm-settings"&&g.tag!=="v2-default-settings"&&v.onSettingChange(g.tag)}};(g.choices||g.options)&&(u.choices=g.choices||g.options),await game.settings.register(q,g.tag,u),v.get(g.tag)===void 0&&(p.log("resetting...",[g.tag]),v.set(g.tag,g.default))}}),game.keybindings.register(q,"hideInterface",{name:game.i18n.localize("CRLNGN_UI.settings.hideInterface.label"),hint:game.i18n.localize("CRLNGN_UI.settings.hideInterface.hint"),editable:[{key:"0",modifiers:["Control"]}],onDown:()=>{},onUp:()=>{v.hideInterface()},restricted:!1});const n=Object.entries(Wo());for(const[c,g]of n){const u={name:g.tag,label:g.label,hint:g.hint,icon:g.icon,type:g.propType,restricted:g.restricted||!1};await game.settings.registerMenu(q,g.tag,u)}if(v.get(e.disableUI.tag)===!0)return;v.applyThemeSettings(),v.applyCustomCSS(),v.applyModuleAdjustments(),F.applyTopNavHeight(),v.foundryUiConfig=game.settings.get("core","uiConfig")||null,Hooks.on(A.RENDER_SCENE_CONTROLS,v.applyLeftControlsSettings),Hooks.on(A.RENDER_PLAYERS_LIST,Ne.applyPlayersListSettings),Hooks.on(A.RENDER_HOTBAR,()=>{Re.applyCustomStyle(),v.firstLoad&&(v.firstLoad=!1,Re.applyHotBarCollapse())}),v.applyDebugSettings(),v.applyChatStyles(),v.applyBorderColors(),ot.applyThemeToSheets(v.get(e.applyThemeToSheets.tag)),ot.applyHorizontalSheetTabs(v.get(e.useHorizontalSheetTabs.tag)),e.sceneNavMenu.fields.forEach(c=>{v.apply(e[c].tag)}),e.cameraDockMenu.fields.forEach(c=>{v.apply(e[c].tag)}),e.customFontsMenu.fields.forEach(c=>{v.applyCustomFonts(e[c].tag)}),e.leftControlsMenu.fields.forEach(c=>{v.applyLeftControlsSettings(e[c].tag)}),e.interfaceOptionsMenu.fields.forEach(c=>{v.apply(e[c].tag)}),v.applyForcedDarkTheme(),Fe.applySideBarWidth(),v.applyDarkThemeToModules()}),b(v,"applyThemeSettings",async e=>{const t=w(),n=document.querySelector("body");let o=v.get(t.playerCustomThemeColors.tag),a="player";if(o||(o=v.get(t.customThemeColors.tag),a="world"),o!=null&&o.accent&&(o!=null&&o.secondaryDark||o!=null&&o.secondary)){const{ColorPickerUtil:s}=await qo(async()=>{const{ColorPickerUtil:r}=await Promise.resolve().then(()=>Ca);return{ColorPickerUtil:r}},void 0);s.applyCustomTheme(o),p.log("Applied custom theme colors",[o,a])}else{const s=e||v.get(t.playerColorTheme.tag)||v.get(t.colorTheme.tag)||"";$.forEach(r=>{r.className&&n.classList.remove(r.className)}),s&&n.classList.add(s),p.log("Applied legacy theme",[s])}}),b(v,"applyCustomCSS",e=>{const t=w(),n=e||v.get(t.customStyles.tag)||"";L.addCustomCSS(n)}),b(v,"applyForcedDarkTheme",e=>{var s,r,i,c;if(!(((r=(s=v.foundryUiConfig)==null?void 0:s.colorScheme)==null?void 0:r.applications)==="dark"||((c=(i=v.foundryUiConfig)==null?void 0:i.colorScheme)==null?void 0:c.interface)==="dark"))return;const n=w(),o=e||v.get(n.forcedDarkTheme.tag)||"";if(!o.trim())return;const a=L.processCSSRules(ha,o);p.log("applyForcedDarkTheme",[a.substring(0,100)+"..."]),L.addCustomCSS(a,"crlngn-forced-dark-mode")}),b(v,"applyModuleAdjustments",e=>{const t=w();(e||v.get(t.adjustOtherModules.tag)||!1)&&Lt.addModuleClasses()}),b(v,"applyDarkThemeToModules",e=>{var a;const t=w(),n=e||v.get(t.applyDarkThemeToModules.tag)||!1,o=game.settings.get("core","uiConfig")||null;n&&((a=o==null?void 0:o.colorScheme)==null?void 0:a.applications)==="dark"&&(v.applyForcedDarkTheme(".app.theme-light:not(.sheet.dnd5e2, .sheet.journal-sheet), .system-pf2e .sheet.theme-light, #AA-autorec-settings"),document.querySelector("body").classList.add("crlngn-forced-dark-theme"))}),b(v,"applyOtherModulesList",e=>{const t=w(),n=e||v.get(t.otherModulesList.tag);p.log("applyOtherModulesList",[n]),n.split(",").length===0?(v.set(t.adjustOtherModules.tag,!1),v.set(t.otherModulesList.tag,"")):v.set(t.adjustOtherModules.tag,!0),Lt.addModuleClasses()}),b(v,"hideInterface",()=>{p.log("hideInterface");const e=document.querySelector("#interface"),t=document.querySelector("#camera-views"),n=document.querySelector(".taskbar");m(v,Tt)?(e&&e.style.removeProperty("visibility"),e&&t.style.removeProperty("visibility"),e&&n.style.removeProperty("visibility"),O(v,Tt,!1)):(e&&e.style.setProperty("visibility","hidden"),t&&t.style.setProperty("visibility","hidden"),n&&n.style.setProperty("visibility","hidden"),O(v,Tt,!0))});let T=v;const Ht=class Ht{static getUpdateNewsUrl(){var n;const e=(n=game.modules.get("crlngn-ui"))==null?void 0:n.version,t=e?`https://github.com/crlngn/crlngn-ui/releases/download/v${e}/module-updates.json`:"";return`https://proxy.carolingian.io/proxy?url=${encodeURIComponent(t)}&v=${e}`}static init(){var e;(e=game.user)!=null&&e.isGM&&this.checkForUpdates()}static cleanSetting(){const e=w();T.set(e.lastUpdateId.tag,"")}static async checkForUpdates(){const e=w();try{const t=new AbortController,n=setTimeout(()=>t.abort(),1e4);try{const o=await T.get(e.lastUpdateId.tag),a=await Ht.getIdFromRawJson();if(p.log("checkForUpdates...",[a,o]),o===a)return;const s=await fetch(Ht.getUpdateNewsUrl(),{signal:t.signal,mode:"cors",credentials:"omit"});if(clearTimeout(n),!s.ok){p.warn("checkForUpdates | Failed to fetch update news",[s.status,s.statusText]);return}const r=await s.json();await this.displayUpdateNews(r),T.set(e.lastUpdateId.tag,r.id),p.log("checkForUpdates | SUCCESS",[r.id])}catch(o){clearTimeout(n),o.name==="AbortError"?p.warn("checkForUpdates | Request timed out",[o]):p.warn("checkForUpdates | Fetch error",[o.message])}}catch(t){p.warn("checkForUpdates | Unexpected error",[t])}}static async displayUpdateNews(e){try{const t=`
        <div class="crlngn-news">
          <h3>${e.title}</h3>
          ${e.imageUrl?`<img src="${e.imageUrl}" alt="Update Preview" />`:""}
          ${e.videoUrl?`<div class="updates-media-container"><video controls autoplay loop src="${e.videoUrl}" alt="Update Preview" style="width: 100%"></video></div>`:""}
          <div class="crlngn-news-content">
          ${e.content}
          </div>
        </div>
      `;p.error("displayUpdateNews | Chat message created",[e]);const n=await ChatMessage.create({content:t,whisper:[game.user.id],speaker:{alias:"Carolingian UI"}});p.error("displayUpdateNews | Chat message created",[n,e])}catch(t){p.error("displayUpdateNews | Error creating chat message",[t])}}};b(Ht,"getIdFromRawJson",async()=>{const t=await fetch("https://raw.githubusercontent.com/crlngn/crlngn-ui/refs/heads/v2/news/module-updates.json"),n=t.ok?await t.json():null;return n&&n.id||""});let go=Ht;class Ka{static init(){Handlebars.registerHelper("normalizedIncludes",function(e,t){return p.log("CustomHandlebarsHelpers",[e,t,e==null?void 0:e.includes(t)]),e==null?void 0:e.includes(t)})}}var Vn;const Ue=class Ue{static init(){Hooks.once(A.INIT,()=>{var a,s;if(document.querySelector("body").classList.add(q),(a=document.querySelector("#ui-middle"))==null||a.classList.add(q),game.data.version<"13.339"){Ue.isIncompatible=!0;return}p.log("Initiating module...",[game.system.title],!0),window.crlngnUI=window.crlngnUI||{},T.registerSettings();const n=w(),o=T.get(n.disableUI.tag);if(p.log(A.INIT,[o]),o){document.querySelector("body").classList.remove(q),(s=document.querySelector("#ui-middle"))==null||s.classList.remove(q);return}Ne.init(),F.init(),se.init(),ht.init(),mt.init(),Xe.init(),Fe.init(),Re.init(),Hooks.on(A.RENDER_CHAT_MESSAGE,m(Ue,Vn))}),Hooks.once(A.READY,()=>{var a;if(p.log("Core Ready",[game]),Ue.isIncompatible){ui.notifications.error(game.i18n.localize("CRLNGN_UI.notifications.incompatibleVersion"),{permanent:!0});return}const e=w();var t=T.get(e.debugMode.tag);t&&(CONFIG.debug.hooks=!0),Ka.init(),F.checkSideBar(((a=ui.sidebar)==null?void 0:a.expanded)||!1),T.enforceGMSettings()&&F.refreshSettings(),Ne.applyPlayersListSettings(),Lt.init(),go.init(),ot.init(),T.get(e.enableChatStyles.tag)&&Ue.addCSSLocalization(),setTimeout(()=>{var s;(s=ui.combat.popout)==null||s.close()},200)})}static addCSSLocalization(){const e="CRLNGN_UI.dnd5e.chatCard.buttons";L.addCSSVars("--crlngn-i18n-attack",game.i18n.localize(`${e}.attack`)),L.addCSSVars("--crlngn-i18n-damage",game.i18n.localize(`${e}.damage`)),L.addCSSVars("--crlngn-i18n-summons",game.i18n.localize(`${e}.summons`)),L.addCSSVars("--crlngn-i18n-healing",game.i18n.localize(`${e}.healing`)),L.addCSSVars("--crlngn-i18n-template",game.i18n.localize(`${e}.template`)),L.addCSSVars("--crlngn-i18n-consume",game.i18n.localize(`${e}.consume`)),L.addCSSVars("--crlngn-i18n-refund",game.i18n.localize(`${e}.refund`)),L.addCSSVars("--crlngn-i18n-macro",game.i18n.localize(`${e}.macro`)),L.addCSSVars("--crlngn-i18n-save-dc",game.i18n.localize(`${e}.savedc`)),L.addCSSVars("--crlngn-i18n-save",game.i18n.localize(`${e}.save`))}};Vn=new WeakMap,b(Ue,"isIncompatible",!1),k(Ue,Vn,(e,t,n)=>{p.log(A.RENDER_CHAT_MESSAGE,[e,t,n]),Xe.enrichCard(e,t)});let fo=Ue;fo.init();
//# sourceMappingURL=crlngn-ui.js.map

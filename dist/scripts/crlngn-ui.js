var Tt=Object.defineProperty;var ct=w=>{throw TypeError(w)};var Mt=(w,e,t)=>e in w?Tt(w,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):w[e]=t;var L=(w,e,t)=>Mt(w,typeof e!="symbol"?e+"":e,t),Xe=(w,e,t)=>e.has(w)||ct("Cannot "+t);var u=(w,e,t)=>(Xe(w,e,"read from private field"),t?t.call(w):e.get(w)),C=(w,e,t)=>e.has(w)?ct("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(w):e.set(w,t),E=(w,e,t,s)=>(Xe(w,e,"write to private field"),s?s.call(w,t):e.set(w,t),t),G=(w,e,t)=>(Xe(w,e,"access private method"),t);const I={INIT:"init",READY:"ready",RENDER_CHAT_MESSAGE:"renderChatMessage",GET_SCENE_CONTROLS:"getSceneControlButtons",RENDER_SCENE_CONTROLS:"renderSceneControls",RENDER_PLAYERS_LIST:"renderPlayerList",RENDER_SCENE_NAV:"renderSceneNavigation",COLLAPSE_SCENE_NAV:"collapseSceneNavigation",EXPAND_SCENE_NAV:"expandSceneNavigation",GET_SCENE_NAV_CONTEXT:"getSceneNavigationContext",GET_SCENE_DIRECTORY_ENTRY_CONTEXT:"getSceneDirectoryEntryContext",RENDER_DOCUMENT_DIRECTORY:"renderDocumentDirectory",CREATE_FOLDER:"createFolder",UPDATE_FOLDER:"updateFolder",DELETE_FOLDER:"deleteFolder",CREATE_SCENE:"createScene",UPDATE_SCENE:"updateScene",DELETE_SCENE:"deleteScene",COLLAPSE_SIDE_BAR:"collapseSidebar",RENDER_HOTBAR:"renderHotbar",RENDER_CAMERA_VIEWS:"renderCameraViews",UPDATE_USER:"updateUser",UPDATE_DOCUMENT:"updateDocument"},B="crlngn-ui",xe=["%cCarolingian UI","color:rgb(54, 0, 119); font-weight: bold;","|"],He=class He{static log(e="",t=[],s=!1){try{const n=He.debugOn;if(!(s||n))return;console.log(...xe,e,...t)}catch{console.log(...xe,e,...t)}}static warn(e="",t=[]){console.warn(...xe,e,...t)}static logError(e,t){var s;t.ui&&((s=ui.notifications)==null||s.error(e,{localize:!0,permanent:t.permanent})),t.console&&console.error(...xe,e)}};L(He,"debugOn",!1);let d=He;const T={select:"select",checkbox:"checkbox",text:"text",number:"number"},M={client:"client",world:"world"},Ce={small:{name:"small",size:"36px"},regular:{name:"regular",size:"42px"}},pe={playerColor:{name:"playerColor"},rollType:{name:"rollType"},none:{name:"none"}},$=[{label:"Carolingian Teal",className:"",colorPreview:["rgb(62, 62, 88)","rgb(68, 147, 173)"]},{label:"Gold and Chocolate",className:"crlngn-theme-gold-chocolate",colorPreview:["rgb(34, 25, 25)","rgb(164, 138, 51)"]},{label:"Royal Blood",className:"crlngn-theme-royal-blood",colorPreview:["rgb(40, 31, 49)","rgb(127, 18, 36)"]},{label:"Dark Sorcery",className:"crlngn-theme-dark-sorcery",colorPreview:["rgb(31, 47, 49)","rgb(94, 57, 127)"]},{label:"Tangerine",className:"crlngn-theme-tangerine",colorPreview:["rgb(40, 31, 49)","rgb(220, 120, 43)"]}];function y(){return{customFontsMenu:{tag:"custom-font-families",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.label"),title:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.hint"),description:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.description"),propType:Object,inputType:T.button,fields:["uiFontBody","uiFontTitles","journalFontBody","journalFontTitles"],default:{uiFontBody:'"Work Sans", Arial, sans-serif',uiFontTitles:'"Roboto Slab", Arial, sans-serif',journalFontBody:'"Work Sans", Arial, sans-serif',journalFontTitles:'"Roboto Slab", Arial, sans-serif'},scope:M.world,config:!1,requiresReload:!1},themeAndStylesMenu:{tag:"theme-styles-menu",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.label"),title:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.hint"),propType:String,fields:["colorTheme","adjustOtherModules","customStyles"],default:{colorTheme:"",adjustOtherModules:!1,customStyles:""},scope:M.world,config:!1},chatMessagesMenu:{tag:"chat-messages-menu",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.hint"),propType:Object,inputType:T.button,fields:["enableChatStyles","chatBorderColor"],default:{enableChatStyles:!0,chatBorderColor:pe.playerColor.name},scope:M.client,config:!1,requiresReload:!1},leftControlsMenu:{tag:"left-controls-menu",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.hint"),propType:Object,inputType:T.button,fields:["controlsBottomBuffer","controlsIconSize","controlsAutoHide","hideFoundryLogo"],default:{bottomBuffer:200,iconSize:Ce.small.name,autoHideSecondary:!1,hideFoundryLogo:!0},scope:M.client,config:!1,requiresReload:!1},cameraDockMenu:{tag:"camera-dock-menu",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.hint"),propType:Object,inputType:T.button,fields:{enableFloatingDock:{tag:"enable-floating-camera-dock",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.enableFloatingDock.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.enableFloatingDock.hint"),inputType:T.checkbox},dockPosX:{tag:"camera-dock-x",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosX.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosX.hint"),inputType:T.number},dockPosY:{tag:"camera-dock-y",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosY.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockPosY.hint"),inputType:T.number},dockWidth:{tag:"camera-dock-width",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockWidth.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockWidth.hint"),inputType:T.number},dockHeight:{tag:"camera-dock-height",label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockHeight.label"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.fields.dockHeight.hint"),inputType:T.number}},default:{enableFloatingDock:!0,dockPosX:0,dockPosY:120,dockWidth:140,dockHeight:140},scope:M.client,config:!1,requiresReload:!1},sceneNavMenu:{tag:"scene-nav-menu",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.hint"),propType:Object,inputType:T.button,fields:["sceneNavEnabled","navFoldersEnabled","navFoldersForPlayers","showFolderListOnClick","showNavOnHover"],default:{sceneNavEnabled:!0,navFoldersEnabled:!0,navFoldersForPlayers:!1,showFolderListOnClick:!1,showNavOnHover:!1},scope:M.client,config:!1,requiresReload:!0},sceneNavEnabled:{tag:"scene-nav-enabled",oldName:"sceneNavEnabled",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneNavEnabled.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.sceneNavEnabled.hint"),propType:Boolean,inputType:T.checkbox,default:!0,scope:M.client,config:!1},navFoldersEnabled:{tag:"nav-folders-enabled",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navFoldersEnabled.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navFoldersEnabled.hint"),propType:Boolean,inputType:T.checkbox,default:!0,scope:M.client,config:!1},navFoldersForPlayers:{tag:"nav-folders-for-players",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navFoldersForPlayers.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.navFoldersForPlayers.hint"),propType:Boolean,inputType:T.checkbox,default:!1,scope:M.client,config:!1},showFolderListOnClick:{tag:"nav-folders-for-players",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.showFolderListOnClick.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.showFolderListOnClick.hint"),propType:Boolean,inputType:T.checkbox,default:!1,scope:M.client,config:!1},showNavOnHover:{tag:"show-nav-on-hover",oldName:"showNavOnHover",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.showNavOnHover.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.fields.showNavOnHover.hint"),propType:Boolean,inputType:T.checkbox,default:!1,scope:M.client,config:!1},sceneNavCollapsed:{tag:"scene-nav-collapsed",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavCollapsed.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavCollapsed.hint"),propType:Boolean,inputType:T.checkbox,default:!0,scope:M.client,config:!1},sceneNavPos:{tag:"scene-nav-pos",label:game.i18n.localize("CRLNGN_UI.settings.sceneNavPos.label"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavPos.hint"),propType:Number,inputType:T.number,default:0,scope:M.client,config:!1},enableMacroLayout:{tag:"enable-macro-layout",label:game.i18n.localize("CRLNGN_UI.settings.enableMacroLayout.label"),hint:game.i18n.localize("CRLNGN_UI.settings.enableMacroLayout.hint"),propType:Boolean,inputType:T.checkbox,default:!0,scope:M.client,config:!0,requiresReload:!1},collapseMacroBar:{tag:"collapse-macro-bar",label:game.i18n.localize("CRLNGN_UI.settings.collapseMacroBar.label"),hint:game.i18n.localize("CRLNGN_UI.settings.collapseMacroBar.hint"),propType:Boolean,inputType:T.checkbox,default:!0,scope:M.client,config:!0,requiresReload:!1},enforceDarkMode:{tag:"enforce-dark-mode",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.enforceDarkMode.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.enforceDarkMode.hint"),propType:Boolean,inputType:T.checkbox,default:!0,scope:M.world,config:!0},autoHidePlayerList:{tag:"auto-hide-player-list",label:game.i18n.localize("CRLNGN_UI.settings.autoHidePlayersList.label"),hint:game.i18n.localize("CRLNGN_UI.settings.autoHidePlayersList.hint"),propType:Boolean,inputType:T.checkbox,default:!0,scope:M.client,config:!0,requiresReload:!1},debugMode:{tag:"debug-mode",label:game.i18n.localize("CRLNGN_UI.settings.debugMode.label"),hint:game.i18n.localize("CRLNGN_UI.settings.debugMode.hint"),propType:Boolean,inputType:T.checkbox,default:!1,scope:M.client,config:!0},uiFontBody:{tag:"ui-font-body",oldName:"uiFont",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiBody.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiBody.hint"),inputType:T.text,propType:String,default:'"Work Sans", Arial, sans-serif',scope:M.world,config:!1},uiFontTitles:{tag:"ui-font-titles",oldName:"uiTitles",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiTitles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.uiTitles.hint"),inputType:T.text,propType:String,default:'"Roboto Slab", Arial, sans-serif',scope:M.world,config:!1},journalFontBody:{tag:"journal-font-body",oldName:"journalBody",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalBody.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalBody.hint"),inputType:T.text,propType:String,default:'"Work Sans", Arial, sans-serif',scope:M.world,config:!1},journalFontTitles:{tag:"journal-font-titles",oldName:"journalTitles",label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalTitles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.fields.journalTitles.hint"),inputType:T.text,propType:String,default:'"Roboto Slab", Arial, sans-serif',scope:M.world,config:!1},colorTheme:{tag:"color-theme",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.colorTheme.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.colorTheme.hint"),inputType:T.text,propType:String,default:"",scope:M.world,config:!1},adjustOtherModules:{tag:"adjust-other-modules",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.adjustOtherModules.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.adjustOtherModules.hint"),inputType:T.checkbox,propType:Boolean,default:!1,scope:M.world,config:!1},customStyles:{tag:"custom-styles",label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.customStyles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.fields.customStyles.hint"),inputType:T.text,propType:String,default:"",scope:M.world,config:!1},chatBorderColor:{tag:"chat-border-color",oldName:"borderColor",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.hint"),options:{playerColor:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.options.playerColor"),rollType:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.options.rollType"),none:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.borderColor.options.none")},propType:String,inputType:T.text,default:pe.playerColor.name,scope:M.client,config:!1},enableChatStyles:{tag:"enable-chat-styles",oldName:"enableChatStyles",label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.enableChatStyles.label"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.fields.enableChatStyles.hint"),propType:Boolean,inputType:T.checkbox,default:!0,scope:M.client,config:!1,requiresReload:!0},controlsBottomBuffer:{tag:"control-bottom-buffer",oldName:"bottomBuffer",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.bottomBuffer.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.bottomBuffer.hint"),propType:Number,inputType:T.number,default:200,scope:M.client,config:!1},controlsIconSize:{tag:"control-icon-size",oldName:"iconSize",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.hint"),inputType:T.select,options:{small:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.options.small"),regular:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.iconSize.options.regular")},propType:String,default:Ce.small.name,scope:M.client,config:!1},controlsAutoHide:{tag:"auto-hide-secondary-controls",oldName:"autoHideSecondary",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.autoHideSecondary.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.autoHideSecondary.hint"),inputType:T.checkbox,propType:Boolean,default:!1,scope:M.client,config:!1},hideFoundryLogo:{tag:"hide-foundry-logo",oldName:"hideFoundryLogo",label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.hideFoundryLogo.label"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.fields.hideFoundryLogo.hint"),inputType:T.checkbox,propType:Boolean,default:!0,scope:M.client,config:!1}}}const{ApplicationV2:It,HandlebarsApplicationMixin:kt}=foundry.applications.api;var ye,dt,ut;const se=class se extends kt(It){static get DEFAULT_OPTIONS(){return{id:y().cameraDockMenu.tag,actions:{redefine:G(se,ye,ut)},form:{handler:G(se,ye,dt),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-camera",title:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title")}_prepareContext(e){const t=y(),s={...b.get(t.cameraDockMenu.tag),default:{...t.cameraDockMenu.default},fields:{...t.cameraDockMenu.fields},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.cameraDockMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.cameraDockMenu.save"}]};return d.log("_prepareContext",[s,e]),s}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,d.log("_preparePartContext",[e,t]),t}_onRender(e,t){d.log("_onRender",[e,t])}};ye=new WeakSet,dt=async function(e,t,s){const n=y();let a=b.get(n.cameraDockMenu.tag),o=a.enableFloatingDock;e.preventDefault(),e.stopPropagation();const i=s.object;i.hasOwnProperty("enableFloatingDock")||(i.enableFloatingDock=!1);const c=foundry.utils.expandObject(i);await b.set(n.cameraDockMenu.tag,c),a=b.get(n.cameraDockMenu.tag),d.log("Saving settings:",[n.cameraDockMenu.tag,t,s.object,c,a]),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated")),a.enableFloatingDock!=o&&location.reload()},ut=async function(e,t){const s=y(),a=this.element.querySelectorAll("input, select"),o=s.cameraDockMenu.default;a.forEach(i=>{i.value=o[i.name],i.type==="checkbox"&&(i.checked=o[i.name])}),d.log("#onReset",[e,t,s.cameraDockMenu.default])},C(se,ye),L(se,"PARTS",{content:{template:"modules/crlngn-ui/templates/camera-dock-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Ke=se;const{ApplicationV2:Rt,HandlebarsApplicationMixin:wt}=foundry.applications.api;var Se,gt,ft;const ne=class ne extends wt(Rt){static get DEFAULT_OPTIONS(){return{id:y().chatMessagesMenu.tag,actions:{redefine:G(ne,Se,ft)},form:{handler:G(ne,Se,gt),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-cog",title:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title")}_prepareContext(e){const t=y(),s=b.get(t.chatMessagesMenu.tag),n=t.chatMessagesMenu.fields,a={},o={},i={};n.forEach(r=>{if(d.log("_prepareContext",[t[r].oldName]),t[r]){const p=b.get(t[r].tag);a[r]=t[r],o[r]=p!==void 0?p:s[t[r].oldName]||t[r].default,i[r]=t[r].default}}),d.log("_prepareContext",[o,i]);const c={...o,default:{...i},isGM:game.user.isGM,fields:{...a},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.chatMessagesMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.chatMessagesMenu.save"}]};return d.log("_prepareContext",[c,e]),c}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,d.log("_preparePartContext",[e,t]),t}_onRender(e,t){const s=y(),n=b.get(s.chatMessagesMenu.tag);d.log("_onRender",[e,t,n])}};Se=new WeakSet,gt=async function(e,t,s){const n=y();e.preventDefault(),e.stopPropagation();const a=n.chatMessagesMenu.fields,o=s.object;a.forEach(p=>{n[p].inputType==="checkbox"&&!o.hasOwnProperty(p)&&(o[p]=!1)});const i=foundry.utils.expandObject(o),c=b.get(n.chatBorderColor.tag);d.log("Compared settings:",[i.chatBorderColor,c]),a.forEach(p=>{d.log("Saving setting >>",[n[p].tag,i[p]]),i[p]!==void 0&&b.set(n[p].tag,i[p])}),await b.set(n.chatMessagesMenu.tag,i),i.chatBorderColor!==c&&location.reload(),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},ft=async function(e,t){const s=y(),a=this.element.querySelectorAll("input, select"),o=s.chatMessagesMenu.fields,i={};o.forEach(c=>{s[c]&&(s[c],i[c]=s[c].default)}),a.forEach(c=>{c.value=i[c.name]})},C(ne,Se),L(ne,"PARTS",{content:{template:"modules/crlngn-ui/templates/chat-messages-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Ze=ne;class v{static isModuleOn(e){var s;const t=(s=game.modules)==null?void 0:s.get(e);return!!(t!=null&&t.active)}static html(e,t){return e.querySelector(t)}static getFullWidth(e){return window.getComputedStyle(e).width==="0px"?0:e.offsetWidth}static getOffsetBottom(e){const t=e.offsetTop,s=e.offsetHeight,n=e.offsetParent;return(n?n.clientHeight:window.innerHeight)-(t+s)}static getOffsetBottom(e){const t=e.offsetTop,s=e.offsetHeight,n=e.offsetParent;return(n?n.clientHeight:window.innerHeight)-(t+s)}static async getAllFonts(){const e=new Set(Object.keys(CONFIG.fontDefinitions)),t=b.get("fonts","core")||{},s=Object.entries(t).map(([o])=>o),n=new Set;return await this.processStyleSheets(n),d.log("Found fonts:",[{foundry:Array.from(e),custom:s,cssImported:Array.from(n)}]),Array.from(new Set([...e,...s,...n])).filter(o=>!/FontAwesome|Font Awesome|FoundryVTT/.test(o)).map(o=>o.replace(/['"`]/g,"").trim()).sort((o,i)=>o.toLowerCase().localeCompare(i.toLowerCase()))||[]}static addCSSVars(e,t){let s=document.querySelector("#crlngn-ui-vars");if(!s){const h=document.querySelector("body");s=document.createElement("style"),s.id="crlngn-ui-vars",s.textContent=`body.crlngn-ui {
}
`,h.prepend(s)}let n=s.textContent,a=n.indexOf("body.crlngn-ui {"),o=n.indexOf("}",a);a===-1&&(n=`body.crlngn-ui {
}
`,a=0,o=n.indexOf("}"));const c=n.substring(a+16,o).split(";").map(h=>h.trim()).filter(h=>h!==""),r={};c.forEach(h=>{const N=h.split(":");if(N.length>=2){const k=N[0].trim(),z=N.slice(1).join(":").trim();k&&(r[k]=z)}}),e.includes("i18n")&&typeof t=="string"&&!t.startsWith('"')&&!t.startsWith("'")&&!t.match(/^url\(|^rgba?\(|^hsla?\(/)&&(t=`"${t}"`),r[e]=t;const p=Object.entries(r).map(([h,N])=>`  ${h}: ${N};`).join(`
`),S=n.substring(0,a)+`body.crlngn-ui {
`+p+`
}`+n.substring(o+1);s.textContent=S}static addCustomCSS(e){let t=document.querySelector("#crlngn-ui-custom-css");if(!t){const s=document.querySelector("body");t=document.createElement("style"),t.id="crlngn-ui-custom-css",t.textContent=`body.crlngn-ui {
}
`,s.appendChild(t)}t.textContent=e}}L(v,"getAllFonts",async()=>{new Set(Object.keys(CONFIG.fontDefinitions));const e=game.settings.get("core","fonts")||{};Object.entries(e).map(([s])=>s);const t=new Set;for(const s of document.styleSheets)try{if(s.ownerNode){const n=s.href||"",a=n.includes("/css/")||n.includes("/styles/"),o=n.includes("/modules/crlngn-ui/");if(n&&!a&&!o){d.log("Skipping non-core/module stylesheet:",[n]);continue}let i="";if(s.ownerNode instanceof Element){if(s.ownerNode.tagName==="STYLE")i=s.ownerNode.textContent;else if(s.ownerNode.tagName==="LINK")try{const p=s.cssRules||s.rules;i=Array.from(p).map(S=>S.cssText).join(`
`)}catch(p){d.warn("Could not read stylesheet rules:",[p])}}d.log("Processing stylesheet:",[n||"inline style"]);const c=/@import\s+url\(['"]([^'"]+)['"]\)/g;let r;for(;(r=c.exec(i))!==null;){let p=r[1];if(p.includes("fonts.googleapis.com")){const S=p.match(/family=([^&]+)/);S&&decodeURIComponent(S[1]).split("|").map(N=>N.split(":")[0].replace(/\+/g," ")).forEach(N=>{t.add(N)})}else{if(p.startsWith("./")||p.startsWith("../")){d.log("Skipping relative import:",[p]);continue}let S=p;try{const h=await fetch(S);if(!h.ok){d.warn("Error loading imported CSS:",[h.status]);continue}const k=(await h.text()).match(/@font-face\s*{[^}]+}/g);if(!k)continue;k.forEach(z=>{const te=z.match(/font-family:\s*['"]?([^'";]+)['"]?/);if(te&&te[1]){const Et=te[1].trim();t.add(Et)}})}catch(h){d.warn("Error processing imported CSS:",[h])}}}}if(!s.href||s.href.startsWith(window.location.origin))try{const n=s.cssRules||s.rules;for(const a of n)if(a instanceof CSSFontFaceRule){const o=a.style.getPropertyValue("font-family").replace(/['"`]/g,"").trim();t.add(o)}}catch(n){d.warn("Could not read stylesheet rules:",[n])}}catch(n){d.warn("Error processing stylesheet:",[n])}return[]}),L(v,"wrapFontName",e=>{const t=e.replace(/['"`]/g,"");return t.includes(" ")?`"${t}"`:t});const{ApplicationV2:Gt,HandlebarsApplicationMixin:Ft}=foundry.applications.api;var Z,Y,mt,pt,ht;const x=class x extends Ft(Gt){static get DEFAULT_OPTIONS(){return{id:y().customFontsMenu.tag,actions:{redefine:G(x,Y,ht)},form:{handler:G(x,Y,mt),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-text",title:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),contentClasses:["standard-form","datalists"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title")}async _prepareContext(e){const t=y(),s=b.get(t.customFontsMenu.tag),n=t.customFontsMenu.fields,a={},o={},i={};return n.forEach(r=>{if(t[r]){const p=b.get(t[r].tag);a[r]=t[r],o[r]=p!==void 0?p:s[t[r].oldName]||t[r].default,i[r]=t[r].default}}),{...o,default:{...i},fontList:await v.getAllFonts(),fields:{...a},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.customFontsMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.customFontsMenu.save"}]}}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,t}_onRender(e,t){E(x,Z,this.element),u(x,Z).querySelectorAll('input[type="text"]').forEach(a=>{const o=a.closest(".dropdown-wrapper"),i=o==null?void 0:o.querySelector(".dropdown-options");if(!o||!i)return;const c=()=>{var r;G(r=x,Y,pt).call(r),i.classList.add("active")};a.addEventListener("focus",c),a.addEventListener("click",c),a.addEventListener("keydown",r=>{const p=i.classList.contains("active"),S=Array.from(i.querySelectorAll(".dropdown-option"));let h=S.findIndex(N=>N.classList.contains("highlighted"));r.key==="ArrowDown"||r.key==="ArrowUp"?(r.preventDefault(),p||i.classList.add("active"),S.forEach(N=>N.classList.remove("highlighted")),h===-1?h=r.key==="ArrowDown"?0:S.length-1:h=r.key==="ArrowDown"?(h+1)%S.length:(h-1+S.length)%S.length,S[h]&&(S[h].classList.add("highlighted"),S[h].scrollIntoView({block:"nearest"}))):r.key==="Enter"?(r.preventDefault(),p&&h!==-1&&S[h]&&S[h].click()):r.key==="Escape"&&i.classList.remove("active")}),document.addEventListener("click",r=>{o.contains(r.target)||i.classList.remove("active")})}),u(x,Z).querySelectorAll(".dropdown-option").forEach(a=>{a.addEventListener("mouseenter",()=>{a.closest(".dropdown-options").querySelectorAll(".dropdown-option").forEach(i=>i.classList.remove("highlighted")),a.classList.add("highlighted")}),a.addEventListener("click",o=>{const i=a.closest(".dropdown-wrapper").querySelector("input");let c=a.dataset.value;c.includes(" ")&&!c.startsWith('"')?c=`"${c}"`:c.startsWith("&quot;")&&(c=c.replace(/&quot;/g,'"')),i.value=c,a.closest(".dropdown-options").classList.remove("active")})})}};Z=new WeakMap,Y=new WeakSet,mt=async function(e,t,s){const n=y();e.preventDefault(),e.stopPropagation();const a=n.customFontsMenu.fields,o=foundry.utils.expandObject(s.object);a.forEach(i=>{o[i]!==void 0&&(d.log("Saving setting:",[o[i]]),b.set(n[i].tag,o[i]))}),b.set(n.customFontsMenu.tag,o),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},pt=function(){u(x,Z).querySelectorAll(".dropdown-options").forEach(e=>{e.classList.remove("active")})},ht=async function(e,t){const s=y(),a=this.element.querySelectorAll("input[type=text]"),o=s.customFontsMenu.fields,i={};o.forEach(c=>{s[c]&&(s[c],i[c]=s[c].default)}),a.forEach(c=>{c.value=i[c.name]})},C(x,Y),C(x,Z),L(x,"PARTS",{content:{template:"modules/crlngn-ui/templates/custom-fonts-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Je=x;const{ApplicationV2:Pt,HandlebarsApplicationMixin:Dt}=foundry.applications.api;var be,yt,St;const oe=class oe extends Dt(Pt){static get DEFAULT_OPTIONS(){return{id:y().leftControlsMenu.tag,actions:{redefine:G(oe,be,St)},form:{handler:G(oe,be,yt),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-cog",title:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title")}_prepareContext(e){const t=y(),s=b.get(t.leftControlsMenu.tag),n=t.leftControlsMenu.fields,a={},o={},i={};n.forEach(r=>{if(t[r]){const p=b.get(t[r].tag);a[r]=t[r],o[r]=p!==void 0?p:s[t[r].oldName]||t[r].default,i[r]=t[r].default}});const c={...o,default:{...i},fields:{...a},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.leftControlsMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.leftControlsMenu.save"}]};return d.log("_prepareContext",[c,e]),c}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,d.log("_preparePartContext",[e,t]),t}_onRender(e,t){const s=y(),n=b.get(s.leftControlsMenu.tag);d.log("_onRender",[e,t,n])}};be=new WeakSet,yt=async function(e,t,s){const n=y();e.preventDefault(),e.stopPropagation();const a=n.leftControlsMenu.fields,o=foundry.utils.expandObject(s.object);a.forEach(i=>{o[i]!==void 0&&(d.log("Saving setting:",[o[i]]),b.set(n[i].tag,o[i]))}),await b.set(n.leftControlsMenu.tag,o),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},St=async function(e,t){const s=y(),a=this.element.querySelectorAll("input, select"),o=s.leftControlsMenu.default;a.forEach(i=>{i.value=o[i.name],i.type==="checkbox"&&(i.checked=o[i.name])}),d.log("#onReset",[e,t,s.leftControlsMenu.default])},C(oe,be),L(oe,"PARTS",{content:{template:"modules/crlngn-ui/templates/left-controls-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let Qe=oe;const{ApplicationV2:At,HandlebarsApplicationMixin:Ot}=foundry.applications.api;var Ne,bt,Nt;const ae=class ae extends Ot(At){static get DEFAULT_OPTIONS(){return{id:y().sceneNavMenu.tag,actions:{redefine:G(ae,Ne,Nt)},form:{handler:G(ae,Ne,bt),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-cog",title:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title"),contentClasses:["standard-form","crlngn"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title")}_prepareContext(e){const t=y(),s=b.get(t.sceneNavMenu.tag),n=t.sceneNavMenu.fields,a={},o={},i={};n.forEach(r=>{if(t[r]){const p=b.get(t[r].tag);a[r]=t[r],o[r]=p!==void 0?p:s[t[r].oldName]||t[r].default,i[r]=t[r].default}});const c={...o,default:{...i},fields:{...a},buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.sceneNavMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.sceneNavMenu.save"}]};return d.log("_prepareContext",[c,e]),c}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,d.log("_preparePartContext",[e,t]),t}_onRender(e,t){d.log("_onRender",[e,t])}};Ne=new WeakSet,bt=async function(e,t,s){e.preventDefault(),e.stopPropagation();const n=y(),a=n.sceneNavMenu.fields;let o=b.get(n.sceneNavEnabled.tag),i=b.get(n.navFoldersEnabled.tag);const c=foundry.utils.expandObject(s.object);a.forEach(S=>{c[S]!==void 0&&(d.log("Saving setting:",[c[S]]),b.set(n[S].tag,c[S]))});let r=b.get(n.sceneNavEnabled.tag),p=b.get(n.navFoldersEnabled.tag);d.log("Saving settings...",[t,s.object,c]),await b.set(n.sceneNavMenu.tag,c),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated")),(o!==r||i!==p)&&location.reload()},Nt=async function(e,t){const s=y(),a=this.element.querySelectorAll("input, select"),o=s.sceneNavMenu.default;a.forEach(i=>{i.value=o[i.name],i.type==="checkbox"&&(i.checked=o[i.name])}),d.log("#onReset",[e,t,s.sceneNavMenu.default])},C(ae,Ne),L(ae,"PARTS",{content:{template:"modules/crlngn-ui/templates/scene-nav-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let _e=ae;const{ApplicationV2:zt,HandlebarsApplicationMixin:xt}=foundry.applications.api;var J,X,Ct,Lt,vt;const U=class U extends xt(zt){static get DEFAULT_OPTIONS(){return{id:y().themeAndStylesMenu.tag,actions:{redefine:G(U,X,vt)},form:{handler:G(U,X,Ct),closeOnSubmit:!0},position:{width:480,height:"auto"},tag:"form",window:{icon:"fas fa-brush",title:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title"),contentClasses:["standard-form","datalists"],resizable:!1}}}get title(){return game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title")}_prepareContext(e){const t=y();b.get(t.themeAndStylesMenu.tag);const s=t.themeAndStylesMenu.fields,n={},a={},o={};s.forEach(r=>{if(t[r]){const p=b.get(t[r].tag);n[r]=t[r],a[r]=p!==void 0?p:t[r].default,o[r]=t[r].default}});const i=$.find(r=>r.className===a.colorTheme);a.colorTheme=(i==null?void 0:i.label)||$[0].label;const c={...a,default:{...o},fields:{...n},selectedTheme:i,themes:$,buttons:[{type:"button",icon:"",label:"CRLNGN_UI.settings.themeAndStylesMenu.reset",action:"redefine"},{type:"submit",icon:"",label:"CRLNGN_UI.settings.themeAndStylesMenu.save"}]};return this._initialContext={...a},c}async _preparePartContext(e,t){return t.partId=`${e}-${this.id}`,t}_onRender(e,t){E(U,J,this.element),this._themes=$,u(U,J).querySelectorAll('input[type="text"]').forEach(o=>{const i=o.closest(".dropdown-wrapper"),c=i==null?void 0:i.querySelector(".dropdown-options");if(!i||!c)return;const r=()=>{var p;G(p=U,X,Lt).call(p),c.classList.add("active")};o.addEventListener("focus",r),o.addEventListener("click",r),o.addEventListener("keydown",p=>{const S=c.classList.contains("active"),h=Array.from(c.querySelectorAll(".dropdown-option"));let N=h.findIndex(k=>k.classList.contains("highlighted"));p.key==="ArrowDown"||p.key==="ArrowUp"?(p.preventDefault(),S||c.classList.add("active"),h.forEach(k=>k.classList.remove("highlighted")),N===-1?N=p.key==="ArrowDown"?0:h.length-1:N=p.key==="ArrowDown"?(N+1)%h.length:(N-1+h.length)%h.length,h[N]&&(h[N].classList.add("highlighted"),h[N].scrollIntoView({block:"nearest"}))):p.key==="Enter"?(p.preventDefault(),S&&N!==-1&&h[N]&&h[N].click()):p.key==="Escape"&&c.classList.remove("active")}),document.addEventListener("click",p=>{i.contains(p.target)||c.classList.remove("active")})});const n=u(U,J).querySelectorAll(".dropdown-option"),a=this;n.forEach(o=>{o.addEventListener("mouseenter",()=>{o.closest(".dropdown-options").querySelectorAll(".dropdown-option").forEach(c=>c.classList.remove("highlighted")),o.classList.add("highlighted")}),o.addEventListener("click",function(i){d.log("option",[o,o.querySelector(".theme-name")]);const c=o.closest(".dropdown-wrapper").querySelector("input");let r=o.querySelector(".theme-name").innerHTML.toString();if(c.value=r,c.name==="colorTheme"){const S=a._themes.find(h=>h.label===r);a._selectedTheme=S,a._updateThemePreview(S)}o.closest(".dropdown-options").classList.remove("active")})})}_updateThemePreview(e){if(d.log("Selected theme updated:",[e]),!e)return;this.element.querySelectorAll("span.selected-theme").forEach((s,n)=>{s.style.setProperty("background-color",e.colorPreview[n])})}};J=new WeakMap,X=new WeakSet,Ct=async function(e,t,s){const n=y();e.preventDefault(),e.stopPropagation();const a=n.themeAndStylesMenu.fields,o=foundry.utils.expandObject(s.object),i=$.find(c=>c.label===o.colorTheme);o.colorTheme=i?i.className:"",a.forEach(c=>{o[c]!==void 0&&(d.log("Saving setting:",[o[c]]),b.set(n[c].tag,o[c]))}),b.set(n.themeAndStylesMenu.tag,o),ui.notifications.info(game.i18n.localize("CRLNGN_UI.ui.notifications.settingsUpdated"))},Lt=function(){u(U,J).querySelectorAll(".dropdown-options").forEach(e=>{e.classList.remove("active")})},vt=async function(e,t){const s=y(),a=this.element.querySelectorAll("input[type=text]"),o=s.themeAndStylesMenu.fields,i={};o.forEach(r=>{s[r]&&(s[r],i[r]=s[r].default)});const c=$.find(r=>r.label===s.colorTheme.default);i.colorTheme=(c==null?void 0:c.label)||$[0].label,a.forEach(r=>{r.value=i[r.name]})},C(U,X),C(U,J),L(U,"PARTS",{content:{template:"modules/crlngn-ui/templates/theme-and-styles-settings.hbs"},footer:{template:"templates/generic/form-footer.hbs"}});let et=U;function Ut(){return{customFonts:{tag:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.customFontsMenu.hint"),icon:"fas fa-text",propType:Je,restricted:!0},themeAndStylesMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.themeAndStylesMenu.hint"),icon:"fas fa-brush",propType:et,restricted:!0},chatMessagesMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.chatMessagesMenu.hint"),icon:"fas fa-cog",propType:Ze,restricted:!1},leftControls:{tag:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.leftControlsMenu.hint"),icon:"fas fa-cog",propType:Qe,restricted:!1},cameraDockMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.cameraDockMenu.hint"),icon:"fas fa-camera",propType:Ke,restricted:!1},sceneNavMenu:{tag:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.label"),name:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title"),label:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.title"),hint:game.i18n.localize("CRLNGN_UI.settings.sceneNavMenu.hint"),icon:"fas fa-cog",propType:_e,restricted:!1}}}var ve,Ee,Te,Me,Ie,ke,Re,A,tt,st,nt,ot;const f=class f{static init(){const e=y(),t=b.get(e.cameraDockMenu.tag);t.enableFloatingDock?(Hooks.on(I.RENDER_CAMERA_VIEWS,f.onRenderFloating),d.log("CameraUtil",[t]),f.onRenderFloating()):(Hooks.on(I.RENDER_CAMERA_VIEWS,f.onRenderPlain),f.onRenderPlain())}static onRenderPlain(){var e;(e=document.querySelector("#camera-views"))==null||e.classList.add("visible")}static onRenderFloating(){var a,o,i;const e=y(),t=b.get(e.cameraDockMenu.tag);(a=document.querySelector("#camera-views"))==null||a.classList.add("crlngn-ui"),f.cameraContainer=document.querySelector("#camera-views .camera-container");const s=document.querySelector("#camera-views .user-controls"),n=document.querySelector("#camera-views .camera-grid");d.log("CameraUtil.onRender",[t.dockPosX,t.dockPosY]),f.cameraContainer&&n&&s&&((o=f.cameraContainer)==null||o.insertBefore(s,n),(i=document.querySelector("#camera-views .camera-container"))==null||i.classList.add("visible")),f.makeDraggable(),f.makeResizeable(),f.resetPositionAndSize(),f.placeControlsToggle()}static placeControlsToggle(){const e=document.querySelector("#camera-views .user-controls"),t=e==null?void 0:e.querySelectorAll(".crlngn-video-toggle");if(d.log("placeControlsToggle",[e,t]),(t==null?void 0:t.length)>0)return;const s=document.querySelector("#camera-views .user-controls .control-bar"),n=document.createElement("button");n.classList.add("crlngn-video-toggle"),n.innerHTML='<i class="fa fa-play-circle" aria-hidden="true"></i>',e==null||e.insertBefore(n,s)}static makeDraggable(){var e;(e=f.cameraContainer)==null||e.addEventListener("mousedown",t=>{var a,o;const s=document.querySelector("body.crlngn-ui");if((a=t.target.parentNode)!=null&&a.classList.contains("volume-bar"))return;s==null||s.addEventListener("mousemove",G(f,A,st)),s==null||s.addEventListener("mouseup",G(f,A,tt));const n=v.getOffsetBottom(f.cameraContainer);f.isDragging=!0,E(f,ve,t.clientX-((o=f.cameraContainer)==null?void 0:o.offsetLeft)),E(f,Ee,window.innerHeight-t.clientY-n),t.stopPropagation()})}static makeResizeable(){if(f.cameraContainer){const e=document.querySelector("body.crlngn-ui"),t=document.createElement("div");t.classList.add("resize-handle"),f.cameraContainer.append(t),t.addEventListener("mousedown",s=>{s.preventDefault(),s.stopPropagation(),f.isResizing=!0,E(f,Te,s.clientX),E(f,Me,s.clientY),E(f,Re,parseInt(getComputedStyle(f.cameraContainer).bottom)||0),E(f,Ie,f.cameraContainer.offsetWidth),E(f,ke,f.cameraContainer.offsetHeight),e==null||e.addEventListener("mousemove",G(f,A,nt)),e==null||e.addEventListener("mouseup",G(f,A,ot))})}}static resetPositionAndSize({x:e,y:t,w:s,h:n}={x:null,y:null,w:null,h:null}){const a=y(),o=b.get(a.cameraDockMenu.tag);if(!(!o.enableFloatingDock||!f.cameraContainer))if(!e&&!t&&!s&&!n){const i=o.dockPosX||0,c=o.dockPosY||0,r=o.dockWidth||0,p=o.dockHeight||0;f.cameraContainer.style.left=`${i}px`,f.cameraContainer.style.bottom=`${c}px`,f.cameraContainer.style.width=`${r}px`,f.cameraContainer.style.height=`${p}px`}else e&&(f.cameraContainer.style.left=`${e}px`),t&&(f.cameraContainer.style.bottom=`${t}px`),s&&(f.cameraContainer.style.width=`${s}px`),n&&(f.cameraContainer.style.height=`${n}px`)}};ve=new WeakMap,Ee=new WeakMap,Te=new WeakMap,Me=new WeakMap,Ie=new WeakMap,ke=new WeakMap,Re=new WeakMap,A=new WeakSet,tt=function(e){var n,a;const t=y(),s={...b.get(t.cameraDockMenu.tag)};if(f.isDragging){const o=document.querySelector("body.crlngn-ui");s.dockPosX=parseInt((n=f.cameraContainer)==null?void 0:n.style.left)||0,s.dockPosY=parseInt((a=f.cameraContainer)==null?void 0:a.style.bottom)||0,s.dockPosY<=0&&(s.dockPosY=0),b.set(t.cameraDockMenu.tag,s),o==null||o.removeEventListener("mousemove",G(f,A,st)),o==null||o.removeEventListener("mouseup",G(f,A,tt)),f.isDragging=!1,e.stopPropagation()}},st=function(e){if(f.isDragging&&(d.log("mousemove",[e.target.parentNode]),f.cameraContainer)){let t=e.clientX-u(f,ve),s=window.innerHeight-e.clientY-u(f,Ee);t+f.cameraContainer.offsetWidth>window.innerWidth&&(t=window.innerWidth-f.cameraContainer.offsetWidt),f.cameraContainer.style.left=`${t}px`,s+f.cameraContainer.offsetHeight>window.innerHeight&&(s=window.innerHeight-f.cameraContainer.offsetHeight),f.cameraContainer.style.bottom=`${s}px`}},nt=function(e){if(!f.isResizing)return;const t=u(f,Ie)+(e.clientX-u(f,Te)),s=e.clientY-u(f,Me),n=u(f,ke)+s,a=u(f,Re)-s;f.cameraContainer.style.width=`${t}px`,f.cameraContainer.style.height=`${n}px`,f.cameraContainer.style.bottom=`${a}px`},ot=function(){var n,a,o,i,c,r;const e=y(),t={...b.get(e.cameraDockMenu.tag)},s=document.querySelector("body.crlngn-ui");f.isResizing=!1,s==null||s.removeEventListener("mousemove",G(f,A,nt)),s==null||s.removeEventListener("mouseup",G(f,A,ot)),d.log("onStopResize",[(n=f.cameraContainer)==null?void 0:n.style.width,(a=f.cameraContainer)==null?void 0:a.style.height,(o=f.cameraContainer)==null?void 0:o.style.bottom]),t.dockWidth=parseInt(((i=f.cameraContainer)==null?void 0:i.style.width)||0),t.dockHeight=parseInt(((c=f.cameraContainer)==null?void 0:c.style.height)||0),t.dockPosY=parseInt(((r=f.cameraContainer)==null?void 0:r.style.bottom)||0),b.set(e.cameraDockMenu.tag,t)},C(f,A),C(f,ve,0),C(f,Ee,0),L(f,"isDragging",!1),L(f,"cameraContainer"),L(f,"isResizing",!1),C(f,Te,0),C(f,Me,0),C(f,Ie,0),C(f,ke,0),C(f,Re,0);let K=f;const q=class q{static init(){const e=y();q.enableChatStyles=b.get(e.enableChatStyles.tag),q.chatBorderColor=b.get(e.chatBorderColor.tag)}};L(q,"chatBorderColor"),L(q,"enableChatStyles"),L(q,"enrichCard",async(e,t)=>{var o,i,c,r,p,S,h,N;d.log("renderChatMessage",[q.chatBorderColor,q.enableChatStyles,pe.playerColor.name,(o=e.author)==null?void 0:o.id]);const s=((r=(c=(i=e.flags)==null?void 0:i.dnd5e)==null?void 0:c.activity)==null?void 0:r.type)||((h=(S=(p=e.flags)==null?void 0:p.dnd5e)==null?void 0:S.roll)==null?void 0:h.type)||"custom";let n=t.get?t.get(0):t;if(!n)return;n.classList.add(s),n.classList.add("crlngn");const a=n.querySelectorAll(".card-buttons button[data-action=rollSave]");a.length>0&&a.forEach(k=>{const z=k.querySelector(".visible-dc"),te=k.querySelector(".hidden-dc");d.log("enrichCard",[z,te]),z.setAttribute("data-ability",k.getAttribute("data-ability")||""),z.setAttribute("data-dc",k.getAttribute("data-dc")||""),te.setAttribute("data-ability",k.getAttribute("data-ability")||"")}),q.chatBorderColor===pe.playerColor.name&&((N=e.author)!=null&&N.id)&&n.style.setProperty("border-color",`var(--user-color-${e.author.id})`)});let he=q;var ie;const O=class O{static init(){Hooks.on(I.RENDER_PLAYERS_LIST,O.checkPlayersList),Hooks.on(I.RENDER_HOTBAR,O.checkPlayersList),v.isModuleOn("foundry-taskbar")&&Hooks.on(I.UPDATE_USER,O.checkTaskbarLock),O.checkTaskbarLock()}};ie=new WeakMap,C(O,ie),L(O,"checkTaskbarLock",()=>{var a,o,i;const e=v.isModuleOn("foundry-taskbar"),t=(a=game.user.flags)==null?void 0:a["foundry-taskbar"];if(d.log("checkTaskbarLock",[t]),!e||!(t!=null&&t.taskbarSettings))return;const s=game.settings.get("foundry-taskbar","reduceSidebar");(o=t.taskbarSettings)!=null&&o.locked?v.addCSSVars("--crlngn-sidebar-bottom",s?"50px":"0px"):v.addCSSVars("--crlngn-sidebar-bottom","0px"),(i=t.taskbarSettings)!=null&&i.locked?v.addCSSVars("--crlngn-taskbar-height","50px"):v.addCSSVars("--crlngn-taskbar-height","10px");const n=document.querySelector("#ft-move-players-macro");n&&(n.innerHTML=""),O.checkPlayersList()}),L(O,"checkPlayersList",()=>{const e=document.querySelector("body"),t=document.querySelector("#players"),s=v.isModuleOn("foundry-taskbar"),n=s?game.settings.get("foundry-taskbar","dockPlayersList"):!1,a=s?game.settings.get("foundry-taskbar","dockMacroBar"):!1;d.log("checkPlayersList",[n,s,a,game.settings]);let o=10;n&&(o=250);const i=document.querySelector("#hotbar");i&&i instanceof HTMLElement&&i.style.setProperty("visibility","hidden"),clearTimeout(u(O,ie)),E(O,ie,setTimeout(()=>{n?(d.log("checkPlayersList TEST",[n]),e.classList.remove("with-players"),e.classList.remove("with-players-hide"),e.classList.add("players-hidden")):(e.classList.remove("players-hidden"),e.querySelector("#players.auto-hide")?(e.classList.add("with-players-hide"),e.classList.remove("with-players")):t&&(e.classList.add("with-players"),e.classList.remove("with-players-hide"))),i&&i instanceof HTMLElement&&i.style.removeProperty("visibility"),clearTimeout(u(O,ie))},o))});let Ue=O;var D,F,Q,qe,le,re,we,Ge,ce,Be,Ve;const g=class g{static toggleNav(e){clearTimeout(u(g,Ge)),E(g,Ge,setTimeout(()=>{g.resetLocalVars(),e?(ui.nav.collapse(),u(g,re).classList.add("navigation-collapsed")):(ui.nav.expand(),u(g,re).classList.remove("navigation-collapsed"))},500))}static checkSceneNavCompat(){const e=y(),t=v.isModuleOn("monks-scene-navigation"),s=v.isModuleOn("compact-scene-navigation"),n=document.querySelector("#ui-middle");(t||s)&&g.sceneNavEnabled&&(n.classList.remove("crlngn-ui"),b.set(e.sceneNavEnabled.tag,!1),b.set(e.navFoldersEnabled.tag,!1),g.sceneNavEnabled=!1,g.navFoldersEnabled=!1,d.log("checkSceneNavCompat",[t,s]),game.user.isGM&&t&&ui.notifications.warn(game.i18n.localize("CRLNGN_UI.ui.notifications.monksScenesNotSupported"),{permanent:!0}),game.user.isGM&&s&&ui.notifications.warn(game.i18n.localize("CRLNGN_UI.ui.notifications.ripperScenesNotSupported"),{permanent:!0}))}static resetLocalVars(){E(g,D,document.querySelector("#navigation")),E(g,qe,document.querySelector("#navigation .nav-item.is-root")),E(g,le,document.querySelector("#nav-toggle")),E(g,re,document.querySelector("#ui-middle")),g.navFoldersEnabled?(E(g,F,document.querySelector("#crlngn-scene-list")),d.log("TopNavigation resetLocalVars",[u(g,F)])):E(g,F,document.querySelector("#scene-list"))}static addListeners(){var e,t;(e=u(g,D))==null||e.addEventListener("mouseenter",s=>{if(d.log("TopNavigation mouseenter",[]),!g.isCollapsed||!g.showNavOnHover)return;s.stopPropagation(),clearTimeout(u(g,Q));const n=document.querySelector("#scene-list");n&&(n.style.display="flex"),document.querySelector("#navigation").classList.remove("collapsed")}),(t=u(this,D))==null||t.addEventListener("mouseleave",s=>{d.log("TopNavigation mouseleave",[]),!(!g.isCollapsed||!g.showNavOnHover)&&(s.stopPropagation(),E(this,Q,setTimeout(()=>{clearTimeout(u(this,Q)),E(this,Q,null);const n=document.querySelector("#scene-list");n&&(n.style.display="none"),document.querySelector("#navigation").classList.add("collapsed")},700)))})}static placeNavButtons(){clearTimeout(u(this,ce)),E(g,ce,setTimeout(()=>{var c,r,p,S,h,N,k;clearTimeout(u(this,ce)),g.resetLocalVars();const e=((r=(c=u(this,D))==null?void 0:c.querySelector("#crlngn-scene-folders"))==null?void 0:r.offsetWidth)||0,t=(p=u(this,D))==null?void 0:p.querySelectorAll("button.crlngn-nav"),s=((S=u(this,F))==null?void 0:S.scrollWidth)+e>=((h=u(this,D))==null?void 0:h.offsetWidth);if(d.log("placeNavButtons",[u(this,F),s]),!s)return;t.forEach(z=>z.remove());const n=document.createElement("button");n.classList.add("crlngn-nav"),n.classList.add("ui-nav-left");const a=document.createElement("i");a.classList.add("fa"),a.classList.add("fa-chevron-left"),n.addEventListener("click",u(this,Be)),n.append(a);const o=document.createElement("button");o.classList.add("crlngn-nav"),o.classList.add("ui-nav-right");const i=document.createElement("i");i.classList.add("fa"),i.classList.add("fa-chevron-right"),o.append(i),o.addEventListener("click",u(this,Ve)),(N=u(this,D))==null||N.appendChild(n),(k=u(this,D))==null||k.appendChild(o),u(this,F)&&u(this,F).classList.remove("no-transition")},250))}static setNavPosition(e){var o,i;const t=y();if(!u(this,F))return;const s=((o=u(this,F))==null?void 0:o.querySelectorAll("li.nav-item:not(.is-root)"))||[],n=e!==void 0?e:g.navPos||0,a=parseInt((i=s[n])==null?void 0:i.offsetLeft)*-1;u(this,F).style.marginLeft=a+"px",g.navPos=n,b.set(t.sceneNavPos.tag,n),d.log("setNavPosition",[e,n,s,s[n],a])}};D=new WeakMap,F=new WeakMap,Q=new WeakMap,qe=new WeakMap,le=new WeakMap,re=new WeakMap,we=new WeakMap,Ge=new WeakMap,ce=new WeakMap,Be=new WeakMap,Ve=new WeakMap,C(g,D),C(g,F),C(g,Q),C(g,qe),C(g,le),C(g,re),L(g,"sceneFoldersTemplate"),C(g,we),C(g,Ge),C(g,ce),L(g,"sceneNavEnabled"),L(g,"navFoldersEnabled"),L(g,"navFoldersForPlayers"),L(g,"showFolderListOnClick"),L(g,"showNavOnHover"),L(g,"isCollapsed"),L(g,"navPos"),L(g,"init",async()=>{const e=y();g.isCollapsed=b.get(e.sceneNavCollapsed.tag),g.navPos=b.get(e.sceneNavPos.tag),g.resetLocalVars();const t=document.querySelector("#ui-middle");if(d.log("SCENE NAV INIT",[g.sceneNavEnabled]),g.sceneNavEnabled&&t)t.classList.add("crlngn-ui");else if(t){t.classList.remove("crlngn-ui");return}const s=v.isModuleOn("monks-scene-navigation"),n=v.isModuleOn("compact-scene-navigation");if(!s&&!n){await ee.renderSceneFolders();const a=b.get(e.sceneNavPos.tag);g.setNavPosition(a),g.placeNavButtons(),g.addListeners(),g.toggleNav(b.get(e.sceneNavCollapsed.tag))}else s&&t.classList.add("with-monks-scene");Hooks.on(I.RENDER_SCENE_NAV,async()=>{d.log("SCENE NAV",[g.navPos]);const a=y(),o=v.isModuleOn("monks-scene-navigation"),i=v.isModuleOn("compact-scene-navigation");if(d.log(I.RENDER_SCENE_NAV,[o,i]),!o&&!i){d.log("NAV no transition add"),g.navPos=b.get(a.sceneNavPos.tag),ee.init(),await ee.renderSceneFolders(),u(g,F)&&u(g,F).classList.add("no-transition");const c=g.navPos;g.setNavPosition(c),g.placeNavButtons(),g.addListeners(),g.toggleNav(b.get(a.sceneNavCollapsed.tag)),clearTimeout(u(g,we)),E(g,we,setTimeout(()=>{d.log("NAV no transition remove"),u(g,F)&&u(g,F).classList.remove("no-transition")},250))}}),Hooks.on(I.COLLAPSE_SIDE_BAR,a=>{const o=v.isModuleOn("monks-scene-navigation");d.log(I.COLLAPSE_SIDE_BAR,["isMonksSceneNavOn",o]),!o&&!n&&g.placeNavButtons()}),Hooks.on(I.COLLAPSE_SCENE_NAV,(a,o)=>{const i=y();b.set(i.sceneNavCollapsed.tag,o),d.log("NAV toggle",[a,o]),g.isCollapsed=o,g.toggleNav(o)}),Hooks.on(I.EXPAND_SCENE_NAV,(a,o)=>{d.log("NAV expand",[a,!1])}),window.addEventListener("resize",()=>{const a=v.isModuleOn("monks-scene-navigation"),o=v.isModuleOn("compact-scene-navigation");!a&&!o&&g.placeNavButtons()}),d.log("TopNavigation - init",[g.sceneNavEnabled])}),C(g,Be,e=>{var r,p,S,h,N,k;const t=((p=(r=u(g,D))==null?void 0:r.querySelector("#crlngn-scene-folders"))==null?void 0:p.offsetWidth)||0,s=(S=u(g,le))==null?void 0:S.offsetWidth,n=(h=u(g,F))==null?void 0:h.querySelector("li.nav-item:not(.is-root)");(N=u(g,F))!=null&&N.querySelectorAll("li.nav-item:not(.is-root)");const a=n.offsetWidth,o=g.navPos||0,i=Math.floor((((k=u(g,D))==null?void 0:k.offsetWidth)-(o===0?t:0)-s*2)/a);let c=o-(i-1);c=c<0?0:c,d.log("onNavLast",["currPos",o,"items",i,c]),g.setNavPosition(c)}),C(g,Ve,e=>{var p,S,h,N,k,z;const t=((S=(p=u(g,D))==null?void 0:p.querySelector("#crlngn-scene-folders"))==null?void 0:S.offsetWidth)||0,s=(h=u(g,le))==null?void 0:h.offsetWidth,n=(N=u(g,F))==null?void 0:N.querySelector("li.nav-item:not(.is-root)"),a=((k=u(g,F))==null?void 0:k.querySelectorAll("li.nav-item:not(.is-root)"))||[],o=n.offsetWidth,i=g.navPos||0,c=Math.floor((((z=u(g,D))==null?void 0:z.offsetWidth)-(i===0?t:0)-s*2)/o);let r=i+(c-1);r=r>a.length-1?a.length-1:r,d.log("onNavNext",["currPos",i,"items",c,r]),g.setNavPosition(r)});let R=g;const j="favorites";var de,ue,ge,_,je,$e,Fe,V,Pe,H,De,Ae,fe,We,lt;const l=class l{static init(){if(!l.noFolderView()&&(E(l,de,game.i18n.localize("CRLNGN_UI.ui.sceneNav.favoritesFolder")),!l.folderListData||l.folderListData.length===0)){const e=v.isModuleOn("monks-scene-navigation"),t=v.isModuleOn("compact-scene-navigation");!e&&!t&&l.preloadTemplate(),d.log("SceneNavFolders",[ui.scenes]),l.folderListData=l.getFolders(ui.scenes.folders),l.selectedFolder=l.selectFolder(j)}}static getFolderById(e){return ui.scenes.folders.find(t=>t.id===e)||j}static registerHooks(){Hooks.on(I.CREATE_FOLDER,e=>{e.type==="Scene"&&l.refreshFolderView()}),Hooks.on(I.UPDATE_FOLDER,e=>{e.type==="Scene"&&l.refreshFolderView()}),Hooks.on(I.DELETE_FOLDER,e=>{e.type==="Scene"&&l.refreshFolderView()}),Hooks.on(I.CREATE_SCENE,()=>{l.refreshFolderView()}),Hooks.on(I.UPDATE_SCENE,()=>{l.refreshFolderView()}),Hooks.on(I.DELETE_SCENE,()=>{l.refreshFolderView()}),Hooks.on(I.RENDER_DOCUMENT_DIRECTORY,e=>{if(e.entryType!=="Scene")return;document.querySelector("#scenes .directory-list").addEventListener("contextmenu",s=>{var a;const n=s.target.closest(".directory-item");if(n&&(l.contextMenuSceneId=n.dataset.documentId||null,l.contextMenuSceneId)){const i=game.scenes.get(l.contextMenuSceneId).navigation?"removeFromFavorites":"addToFavorites",c=game.i18n.localize("CRLNGN_UI.ui.sceneNav."+i);u(a=l,Fe).call(a,c)}})}),Hooks.on(I.RENDER_SCENE_NAV,()=>{document.querySelector("#navigation").addEventListener("contextmenu",t=>{var n;const s=t.target.closest(".nav-item");if(s&&(l.contextMenuSceneId=t.currentTarget.dataset.sceneId||s.dataset.sceneId||null,l.contextMenuSceneId)){const o=game.scenes.get(l.contextMenuSceneId).navigation?"removeFromFavorites":"addToFavorites",i=game.i18n.localize("CRLNGN_UI.ui.sceneNav."+o);u(n=l,Fe).call(n,i)}})})}};de=new WeakMap,ue=new WeakMap,ge=new WeakMap,_=new WeakMap,je=new WeakMap,$e=new WeakMap,Fe=new WeakMap,V=new WeakMap,Pe=new WeakMap,H=new WeakMap,De=new WeakMap,Ae=new WeakMap,fe=new WeakMap,We=new WeakMap,lt=new WeakMap,L(l,"selectedFolder"),L(l,"folderList"),L(l,"folderListData",[]),L(l,"searchValue",""),C(l,de,"Favorites"),L(l,"contextMenuSceneId",null),L(l,"getFolders",e=>{let t=e.filter(s=>s.folder===null);return t.sort((s,n)=>s.name.toLowerCase().localeCompare(n.name.toLowerCase())),t}),L(l,"selectFolder",e=>l.getFolderById(e)||null),L(l,"createFolderElem",()=>document.createElement("li")),L(l,"createListElement",e=>{const t=document.createElement("ol");return t.classList.add("folder-list"),e.forEach(s=>{const n=document.createElement("li");d.log("createListElement",[s]),s.children&&s.children.length>0?n.innerHTML=`<a class="with-subfolders">${s.name}</a>`:n.innerHTML=`<a>${s.name}</a>`,t.append(n)}),t}),L(l,"preloadTemplate",async()=>{const e=[`modules/${B}/templates/scene-folder-list.hbs`];return await loadTemplates(e),d.log("preloadTemplate",[!0]),!0}),L(l,"getFoldersData",e=>({...e,children:e.children.map(t=>l.getFoldersData(t)),hasSubfolders:e.children.length>0,id:e.id})),C(l,ue,null),C(l,ge,null),C(l,_,null),L(l,"renderSceneFolders",async()=>{var r,p,S,h;if(l.noFolderView()||!l.selectedFolder)return;d.log("SCENE NAV renderSceneFolders",[]);const e=l.getFolders(ui.scenes.folders),t={favoritesId:j,favoritesName:u(l,de)||j,folderList:e.map(N=>l.getFoldersData(N)),viewedSceneId:game.scenes.current.id,users:game.users.contents,isGM:game.user.isGM,searchValue:l.searchValue,showSearchResults:!!l.searchValue};if(l.selectedFolder===j)E(l,ue,{...t,currFolder:{name:u(l,de)||j,id:j},currIcon:"fa-star",folders:[],scenes:ui.nav.scenes.filter(N=>N.permission>=2)});else{const N=l.selectedFolder.children;d.log("foldersData",[N,l.selectedFolder]),E(l,ue,{...t,currFolder:l.selectedFolder,currIcon:"fa-folder",folders:N,scenes:l.selectedFolder.contents})}d.log("Elements not in DOM, rendering template",[]),(r=u(l,ge))==null||r.remove(),(p=u(l,_))==null||p.remove();const s=await renderTemplate(`modules/${B}/templates/scene-folder-list.hbs`,u(l,ue)),n=document.querySelector("#scene-list");n.insertAdjacentHTML("beforebegin",s),E(l,ge,document.querySelector("#crlngn-scene-folders")),E(l,_,document.querySelector("#crlngn-scene-list")),n==null||n.classList.add("hidden");const a=u(l,_),o=a.querySelectorAll("li.nav-item"),i=R.navPos||0,c=parseInt((S=o[i])==null?void 0:S.offsetLeft)*-1;a.style.marginLeft=c+"px",l.activateFolderListeners(u(l,ge)),u(h=l,je).call(h,u(l,_)),R.resetLocalVars()}),L(l,"activateFolderListeners",e=>{if(l.noFolderView())return;d.log("activateFolderListeners",[e]);const t=e.querySelector("a.selected");R.showFolderListOnClick?(t==null||t.removeEventListener("mouseover",u(l,V)),e.removeEventListener("mouseleave",u(l,V)),t==null||t.addEventListener("click",u(l,V))):(t==null||t.addEventListener("mouseover",u(l,V)),e.addEventListener("mouseleave",u(l,V)),t==null||t.removeEventListener("click",u(l,V))),e.querySelectorAll("span.toggle").forEach(a=>{a.addEventListener("click",o=>{o.preventDefault(),o.stopPropagation();const c=o.currentTarget.closest("li").querySelector("ol.subfolders");if(!c)return;!c.classList.contains("open")?(c.classList.add("open"),o.currentTarget.textContent=""):(c.classList.remove("open"),o.currentTarget.textContent="+")})}),e.querySelectorAll(".folder-list li.folder").forEach(a=>{a.addEventListener("click",u(l,fe))});const n=e.querySelector(".search-container .input-scene-search");n.addEventListener("keyup",u(l,We)),n.addEventListener("keydown",a=>{a.stopPropagation()})}),C(l,je,e=>{var s;e.querySelectorAll("li.nav-item").forEach(n=>{const a=n.classList.contains("folder");n.addEventListener("click",a?u(l,fe):u(l,De)),n.addEventListener("dblclick",a?()=>{}:u(l,Ae))}),game.user.isGM&&u(s=l,$e).call(s,e)}),C(l,$e,e=>{const t={animation:150,draggable:".nav-item",delay:50,delayOnTouchOnly:!0,onEnd:async s=>{const n=e.querySelectorAll(".nav-item"),a=[],o=Array.from(n).map(S=>game.scenes.get(S.dataset.sceneId)),i=Array.from(n),c=SortingHelpers.performIntegerSort(s.item,{target:s.to,siblings:i,sortBefore:!0});let r=0;const p=CONST.SORT_INTEGER_DENSITY;for(let[S,h]of Object.entries(c||{})){const N=game.scenes.get(S);if(!N)continue;const k={_id:N.id,sort:h};N.navigation&&(k.navOrder=r,r+=p),a.push(k)}for(const S of o)!S||!S.navigation||a.some(h=>h._id===S.id)||(a.push({_id:S.id,navOrder:r}),r+=p);a.length&&(await Scene.updateDocuments(a),ui.nav.render())}};new Sortable(e,t)}),L(l,"refreshFolderView",async()=>{l.noFolderView()||(l.folderListData=l.getFolders(ui.scenes.folders),await l.renderSceneFolders(),R.placeNavButtons())}),L(l,"updateSearchResults",e=>{if(l.noFolderView())return;const t=document.querySelector(".search-container .search-results");if(!t)return;if(t.innerHTML="",!e){t.classList.add("hidden");return}const s=game.scenes.filter(a=>a.name.toLowerCase().includes(e.toLowerCase())&&a.permission>=2),n=game.scenes.folders.filter(a=>a.name.toLowerCase().includes(e.toLowerCase()));if(t.classList.remove("hidden"),n.forEach(a=>{const o=document.createElement("li");o.className="folder",o.dataset.folderId=a.id,o.innerHTML=`<a><i class="fas fa-folder"></i> ${a.name}</a>`,o.addEventListener("click",u(l,fe)),t.appendChild(o)}),s.forEach(a=>{const o=document.createElement("li");o.className="scene",o.dataset.sceneId=a.id,o.innerHTML=`<a><i class="fas fa-map"></i> ${a.name}</a>`,o.addEventListener("dblclick",u(l,Ae)),o.addEventListener("click",u(l,De)),t.appendChild(o)}),n.length===0&&s.length===0){const a=document.createElement("li");a.className="no-results",a.textContent="No matching results found",t.appendChild(a)}}),C(l,Fe,e=>{const t=()=>{const n=document.querySelector("#context-menu");if(!n)return!1;const a=n.querySelectorAll(".context-item"),o=Array.from(a).find(i=>i.innerHTML.includes(game.i18n.localize("SCENES.ToggleNav")));return o?(d.log("updating toggle nav item",[o]),o.innerHTML=`<i class="fas fa-star fa-fw"></i>${e}`,!0):!1};if(t())return;const s=new MutationObserver((n,a)=>{t()&&a.disconnect()});s.observe(document.body,{childList:!0,subtree:!0}),setTimeout(()=>s.disconnect(),1e3)}),C(l,V,e=>{e.stopPropagation(),e.preventDefault();const t=document.querySelector("#crlngn-scene-folders"),s=e.type.startsWith("mouse"),n=!R.showFolderListOnClick;if(s&&n&&e.type==="mouseover"){t!=null&&t.classList.contains("open")||t==null||t.classList.add("open");return}if(s&&n&&e.type==="mouseleave"){t==null||t.classList.remove("open");return}s||(t!=null&&t.classList.contains("open")?t==null||t.classList.remove("open"):(t==null||t.classList.add("open"),document.addEventListener("click",u(l,Pe))))}),C(l,Pe,e=>{e.preventDefault(),e.stopPropagation();const t=e.target,s=document.querySelector("#crlngn-scene-folders");d.log("#onOutsideClick",[s,t,s.contains(t)]),s!=null&&s.classList.contains("open")&&!s.contains(t)&&(s.classList.remove("open"),document.removeEventListener("click",u(l,Pe)))}),C(l,H,null),C(l,De,e=>{var o;e.preventDefault(),e.stopPropagation();const t=e.currentTarget,s=t.dataset,n=game.scenes.get(s.sceneId),a=(o=t.parentElement)==null?void 0:o.classList.contains("search-results");d.log("scene click",[n,t.parentElement,a]),u(l,H)&&(clearTimeout(u(l,H)),E(l,H,null)),E(l,H,setTimeout(()=>{a&&(n.navigation=!0,l.selectedFolder=l.selectFolder(j)),n.view(),l.refreshFolderView(),E(l,H,null)},250))}),C(l,Ae,e=>{e.stopPropagation(),e.preventDefault();const s=e.currentTarget.dataset,n=game.scenes.get(s.sceneId);u(l,H)&&(clearTimeout(u(l,H)),E(l,H,null)),d.log("#onActivateScene",[n]),n.activate(),l.refreshFolderView()}),C(l,fe,e=>{e.stopPropagation(),e.preventDefault();const s=e.currentTarget.dataset;d.log("#onSelectFolder",[s]);const n=l.selectFolder(s.folderId||"");n!==l.selectedFolder&&(R.navPos=0),l.selectedFolder=n,l.refreshFolderView()}),C(l,We,e=>{e.stopPropagation();const s=e.currentTarget.value;l.searchValue=s,l.updateSearchResults(s)}),C(l,lt,e=>{var n,a,o,i;e.preventDefault(),e.stopPropagation();let t=((a=(n=e.currentTarget)==null?void 0:n.dataset)==null?void 0:a.sceneId)||"",s=((i=(o=e.currentTarget)==null?void 0:o.dataset)==null?void 0:i.folderId)||"";t?game.scenes.get(t).view():s&&(l.selectedFolder=l.selectFolder(s),l.refreshFolderView())}),L(l,"noFolderView",()=>{var t;return!((t=game==null?void 0:game.user)==null?void 0:t.isGM)&&!R.navFoldersForPlayers||!R.navFoldersEnabled||!R.sceneNavEnabled});let ee=l;var me;const m=class m{static registerSettings(){const e=y();d.log("registerSettings - test",[e],!0),document.querySelector("body").classList.add(B),Object.entries(e).forEach(async o=>{const i=o[1];d.log("Registering... ",[o],!0);const c={name:i.label,hint:i.hint,default:i.default,type:i.propType,scope:i.scope,config:i.config,requiresReload:i.requiresReload||!1,onChange:r=>m.apply(i.tag,r)};i.choices&&(c.choices=i.choices),await game.settings.register(B,i.tag,c),m.get(i.tag)===void 0&&m.set(i.tag,i.default),game.keybindings.register(B,"hideInterface",{name:"Toggle Hide/Show User Interface",hint:"Hides or shows the UI. This will affect all elements inside the `#interface` html block",editable:[{key:"0",modifiers:["Control"]}],onDown:()=>{},onUp:()=>{m.hideInterface()},restricted:!1})}),m.applyThemeSettings(),m.applyCustomCSS(),m.applyModuleAdjustments(),R.sceneNavEnabled=m.get(e.sceneNavEnabled.tag),R.navFoldersEnabled=m.get(e.navFoldersEnabled.tag),R.navFoldersForPlayers=m.get(e.navFoldersForPlayers.tag),R.showFolderListOnClick=m.get(e.showFolderListOnClick.tag),R.showNavOnHover=m.get(e.showNavOnHover.tag),Object.entries(Ut()).forEach(async o=>{const i=o[1],c={name:i.tag,label:i.label,hint:i.hint,icon:i.icon,type:i.propType,restricted:i.restricted};await game.settings.registerMenu(B,i.tag,c)}),Hooks.on(I.RENDER_SCENE_CONTROLS,m.applyLeftControlsSettings),Hooks.on(I.RENDER_PLAYERS_LIST,m.applyPlayersListSettings),Hooks.on(I.RENDER_HOTBAR,()=>{m.firstLoad&&(m.firstLoad=!1,m.applyHotBarCollapse()),m.applyHotBarSettings()}),m.applyDebugSettings(),m.applySceneNavPos(),m.applyChatStyles(),m.applyBorderColors(),e.customFontsMenu.fields.forEach(o=>{m.applyCustomFonts(e[o].tag)}),e.leftControlsMenu.fields.forEach(o=>{m.applyLeftControlsSettings(e[o].tag)})}static get(e,t=B){if(!e)return null;let s=!1;if(t===B)s=game.settings.get(t,e);else{let a=game.settings.storage.get("client")[`${t}.${e}`];a===void 0&&(a=game.settings.storage.get("world").getSetting(`${t}.${e}`)),s=a==null?void 0:a.value,d.log("GET Setting",[a,s])}return s}static set(e,t,s=B){if(!e)return!1;let n=game.settings.storage.get("client")[`${s}.${e}`];n||(n=game.settings.storage.get("world").getSetting(`${s}.${e}`)),d.log("Setting",[e,n]);try{game.settings.set(s,e,t)}catch{d.log("Unable to change setting",[e,n])}return!0}static apply(e,t=void 0){const s=y();switch(t===void 0&&(t=m.get(e)),d.log("SettingsUtil.apply",[e,t,m.get(e)]),e){case s.enableMacroLayout.tag:m.applyHotBarSettings();break;case s.collapseMacroBar.tag:m.applyHotBarCollapse();break;case s.autoHidePlayerList.tag:m.applyPlayersListSettings();break;case s.uiFontBody.tag:case s.uiFontTitles.tag:case s.journalFontBody.tag:case s.journalFontTitles.tag:m.applyCustomFonts(e,t);break;case s.controlsBottomBuffer.tag:case s.controlsIconSize.tag:case s.controlsAutoHide.tag:case s.hideFoundryLogo.tag:m.applyLeftControlsSettings(e,t);break;case s.cameraDockMenu.tag:m.applyCameraPosX(),m.applyCameraPosY(),m.applyCameraWidth(),m.applyCameraHeight();break;case s.chatBorderColor.tag:he.chatBorderColor=m.get(s.chatBorderColor.tag),d.log("SettingsUtil.apply",[e]),m.applyBorderColors();break;case s.enableChatStyles.tag:he.enableChatStyles=m.get(s.enableChatStyles.tag),d.log("SettingsUtil.apply",[e]),m.applyChatStyles();break;case s.enforceDarkMode.tag:m.resetFoundryThemeSettings();break;case s.debugMode.tag:m.applyDebugSettings();break;case s.sceneNavEnabled.tag:R.sceneNavEnabled=t;break;case s.navFoldersEnabled.tag:R.navFoldersEnabled=t;break;case s.navFoldersForPlayers.tag:R.navFoldersForPlayers=t;break;case s.showFolderListOnClick.tag:R.showFolderListOnClick=t,ee.refreshFolderView();break;case s.showNavOnHover.tag:R.showNavOnHover=t;break;case s.sceneNavCollapsed.tag:R.isCollapsed=m.get(s.sceneNavCollapsed.tag);break;case s.sceneNavPos.tag:m.applySceneNavPos();break;case s.colorTheme.tag:m.applyThemeSettings();break;case s.customStyles.tag:m.applyCustomCSS();break;case s.adjustOtherModules.tag:m.applyModuleAdjustments();break}}static applyBorderColors(){const e=y(),t=m.get(e.chatBorderColor.tag),s=document.querySelector("body");t===pe.playerColor.name?(s.classList.add("player-chat-borders"),s.classList.remove("roll-chat-borders")):t===pe.rollType.name?(s.classList.add("roll-chat-borders"),s.classList.remove("player-chat-borders")):(s.classList.remove("player-chat-borders"),s.classList.remove("roll-chat-borders"))}static applyChatStyles(){const e=y(),t=m.get(e.enableChatStyles.tag),s=document.querySelector("body");d.log("applyChatStyles",[t,e]),t?s.classList.add("crlngn-chat"):s.classList.remove("crlngn-chat")}static applyHotBarSettings(){const e=y(),t=m.get(e.enableMacroLayout.tag),s=document.querySelector("#hotbar");!t&&s?s.classList.add("foundry-default"):s&&s.classList.remove("foundry-default")}static applyHotBarCollapse(){const e=y();m.get(e.collapseMacroBar.tag)&&ui.hotbar.collapse()}static applyLeftControlsSettings(e,t){const s=y(),n=m.get(s.sceneNavEnabled.tag),a=document.querySelector("#ui-left"),o=document.querySelector("#ui-left #logo"),i=document.querySelector("body.crlngn-ui");switch(document.querySelector("#crlngn-ui-vars"),d.log("applyLeftControlsSettings",[e]),e){case s.controlsAutoHide.tag:m.get(s.controlsAutoHide.tag)?a.classList.add("auto-hide"):a.classList.remove("auto-hide");break;case s.hideFoundryLogo.tag:const r=window.getComputedStyle(i).getPropertyValue("--top-nav-height")||"0px",p=parseFloat(r)||0,S=m.get(s.hideFoundryLogo.tag);d.log("applyLeftControlsSettings",[e,p,r]),S===void 0||S===!0?(o.classList.remove("visible"),v.addCSSVars("--ui-top-padding",`${p}px`),document.querySelector("body").classList.remove("logo-visible")):(o.classList.add("visible"),n?(v.addCSSVars("--ui-top-padding",`${72+p}px`),document.querySelector("body").classList.add("logo-visible")):v.addCSSVars("--ui-top-padding","72px"));break;case s.controlsBottomBuffer.tag:m.applyControlsBuffer();break;case s.controlsIconSize.tag:m.applyControlIconSize();break}}static applyControlIconSize(){const e=y(),t=m.get(e.controlsIconSize.tag);document.querySelector("body");const s=t==Ce.small.name?Ce.small.size:Ce.regular.size;d.log("applyControlIconSize",[s]),v.addCSSVars("--left-control-item-size",s),m.applyLeftControlsSettings(e.hideFoundryLogo.tag)}static applyControlsBuffer(){const e=y(),t=m.get(e.leftControlsMenu.tag),s=isNaN(t.bottomBuffer)?e.leftControlsMenu.default.bottomBuffer:t.bottomBuffer;v.addCSSVars("--controls-bottom-buffer",`${s||0}px`)}static applyPlayersListSettings(){var t,s;const e=y();d.log("applyPlayersListSettings",[document.querySelector("#players"),m.get(e.autoHidePlayerList.tag)]),m.get(e.autoHidePlayerList.tag)?(t=document.querySelector("#players"))==null||t.classList.add("auto-hide"):(s=document.querySelector("#players"))==null||s.classList.remove("auto-hide"),Ue.checkPlayersList()}static applySceneNavPos(e){const t=y();R.navPos=e||m.get(t.sceneNavPos.tag)}static applyCameraPosX(e){const t=y(),s=m.get(t.cameraDockMenu.tag),n=e||s.dockPosX;K.resetPositionAndSize({x:n})}static applyCameraPosY(e){const t=y(),s=m.get(t.cameraDockMenu.tag),n=e||s.dockPosY;K.resetPositionAndSize({y:n})}static applyCameraWidth(e){const t=y(),s=m.get(t.cameraDockMenu.tag),n=e||s.dockWidth;K.resetPositionAndSize({w:n})}static applyCameraHeight(e){const t=y(),s=m.get(t.cameraDockMenu.tag),n=e||s.dockHeight;K.resetPositionAndSize({h:n})}static applyCustomFonts(e,t){const s=y(),n=s.customFontsMenu.fields,a={};switch(d.log("applyCustomFonts",[e,t]),n.forEach(o=>{a[o]=m.get(s[o].tag)}),document.querySelector("body.crlngn-ui"),e){case s.uiFontBody.tag:v.addCSSVars("--crlngn-font-family",t||a.uiFontBody||s.uiFontBody.default.uiFont||"");break;case s.uiFontTitles.tag:v.addCSSVars("--crlngn-font-titles",t||a.uiFontTitles||s.uiFontTitles.default.uiTitles||"");break;case s.journalFontBody.tag:v.addCSSVars("--crlngn-font-journal-body",t||a.journalFontBody||a.journalFontBody||"");break;case s.journalFontTitles.tag:v.addCSSVars("--crlngn-font-journal-title",t||a.journalFontTitles||a.journalFontTitles||"");break}}static resetFoundryThemeSettings(){const e=y(),t=v.isModuleOn("monks-player-settings"),s=v.isModuleOn("force-client-settings"),n=m.get(e.enforceDarkMode.tag);if(n&&t){game.user.isGM&&(ui.notifications.warn(game.i18n.localize("CRLNGN_UI.ui.notifications.monksPlayerSettingsConflict"),{permanent:!0}),m.set(e.enforceDarkMode.tag,!1));return}if(n&&s){game.user.isGM&&(ui.notifications.warn(game.i18n.localize("CRLNGN_UI.ui.notifications.forceClientSettingsConflict"),{permanent:!0}),m.set(e.enforceDarkMode.tag,!1));return}const a=game.settings.get("core","colorScheme");d.log("resetFoundryThemeSettings",[a,n]),a===!1&&n&&game.settings.set("core","colorScheme","dark")}static applyDebugSettings(e){const t=y();d.debugOn=e||m.get(t.debugMode.tag)}};me=new WeakMap,C(m,me,!1),L(m,"firstLoad",!0),L(m,"applyThemeSettings",e=>{const t=y(),s=e||m.get(t.colorTheme.tag)||"",n=document.querySelector("body");d.log("applyThemeSettings",[e,s,m.get(t.colorTheme.tag)]),$.forEach(a=>{a.className&&n.classList.remove(a.className)}),s&&n.classList.add(s)}),L(m,"applyCustomCSS",e=>{const t=y(),s=e||m.get(t.customStyles.tag)||"";v.addCustomCSS(s)}),L(m,"applyModuleAdjustments",e=>{const t=y(),s=e||m.get(t.adjustOtherModules.tag)||!1,n=document.querySelector("body");s?n.classList.add("crlngn-enforce-styles"):n.classList.remove("crlngn-enforce-styles")}),L(m,"hideInterface",()=>{d.log("hideInterface");const e=document.querySelector("#interface"),t=document.querySelector("#camera-views"),s=document.querySelector(".taskbar");u(m,me)?(e&&e.style.removeProperty("visibility"),e&&t.style.removeProperty("visibility"),e&&s.style.removeProperty("visibility"),E(m,me,!1)):(e&&e.style.setProperty("visibility","hidden"),t&&t.style.setProperty("visibility","hidden"),s&&s.style.setProperty("visibility","hidden"),E(m,me,!0))});let b=m;class rt{static init(){Hooks.on(I.RENDER_PLAYERS_LIST,rt.onRender)}static onRender(){const e=document.querySelector("aside#players"),t=document.querySelector("aside#players h3:first-child");if(!e||!(e instanceof HTMLElement)||!t)return;const s=e.offsetHeight;v.addCSSVars("--players-list-height",s+"px"),t.addEventListener("click",()=>{e.classList.contains("expanded")?e.classList.remove("expanded"):e.classList.add("expanded")})}}var W,Oe,ze;const P=class P{static init(){d.log("LeftControls - init",[]),Hooks.on(I.RENDER_SCENE_CONTROLS,P.initSceneControls),P.initSceneControls()}static resetLocalVars(){E(P,W,document.querySelector("#ui-left #controls")),E(P,Oe,document.querySelector("#ui-left"))}static initSceneControls(){d.log("initSceneControls",[]),P.resetLocalVars(),P.observeControlsWidth()}static observeControlsWidth(){if(d.log("observeControlsWidth",[]),!u(P,W))return;let e;const t=(s,n)=>{e||(e=setTimeout(()=>{s(),e=null},n))};E(P,ze,new ResizeObserver(s=>{t(()=>P.updateCSSVars(),250)})),u(P,ze).observe(u(P,W),{box:"border-box"}),P.updateCSSVars()}static updateCSSVars(){if(!u(P,W))return;let e=Number(u(P,Oe).offsetWidth),t=Number(u(P,W).offsetWidth),s=-e+t+24;d.log("updateCSSVars",[t,e]),!isNaN(t)&&!isNaN(e)&&v.addCSSVars("--ui-controls-margin-left",s+"px")}};W=new WeakMap,Oe=new WeakMap,ze=new WeakMap,C(P,W),C(P,Oe),C(P,ze);let at=P;var Ye;const Le=class Le{static init(){Hooks.once(I.INIT,()=>{var e;(e=document.querySelector("#ui-middle"))==null||e.classList.add(B),d.log("Initiating module...",[],!0),Hooks.on(I.RENDER_CHAT_MESSAGE,u(Le,Ye)),b.registerSettings(),R.init(),K.init(),rt.init(),at.init(),he.init(),ee.registerHooks()}),Hooks.once(I.READY,()=>{d.log("Core Ready",[]);const e=y();var t=b.get(e.debugMode.tag);t&&(CONFIG.debug.hooks=!0),Ue.init(),R.checkSceneNavCompat(),b.get(e.enableChatStyles.tag)&&Le.addCSSLocalization(),b.resetFoundryThemeSettings()})}static addCSSLocalization(){const e="CRLNGN_UI.dnd5e.chatCard.buttons";v.addCSSVars("--crlngn-i18n-attack",game.i18n.localize(`${e}.attack`)),v.addCSSVars("--crlngn-i18n-damage",game.i18n.localize(`${e}.damage`)),v.addCSSVars("--crlngn-i18n-summons",game.i18n.localize(`${e}.summons`)),v.addCSSVars("--crlngn-i18n-healing",game.i18n.localize(`${e}.healing`)),v.addCSSVars("--crlngn-i18n-template",game.i18n.localize(`${e}.template`)),v.addCSSVars("--crlngn-i18n-consume",game.i18n.localize(`${e}.consume`)),v.addCSSVars("--crlngn-i18n-refund",game.i18n.localize(`${e}.refund`)),v.addCSSVars("--crlngn-i18n-macro",game.i18n.localize(`${e}.macro`)),v.addCSSVars("--crlngn-i18n-save-dc",game.i18n.localize(`${e}.savedc`)),v.addCSSVars("--crlngn-i18n-save",game.i18n.localize(`${e}.save`))}};Ye=new WeakMap,C(Le,Ye,(e,t)=>{d.log(I.RENDER_CHAT_MESSAGE,[e,t]),he.enrichCard(e,t)});let it=Le;it.init();
//# sourceMappingURL=crlngn-ui.js.map
